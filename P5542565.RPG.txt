SER  H/TITLE P5542565  - Sales Order Invoices Print                             
     H*                                                                         
     H*    Copyright (c) 1992,1993                                              
     H*    J. D. Edwards & Company                                              
     H*                                                                         
     H*        This unpublished material is proprietary to                      
     H*        J. D. Edwards & Company.  All rights reserved.                   
     H*        The methods and techniques described herein are                  
     H*        considered trade secrets and/or confidential.                    
     H*        Reproduction or distribution, in whole or in part,               
     H*        is forbidden except by express written permission                
     H*        of J. D. Edwards & Company.                                      
     H*                                                                         
     H* ----------------------------------------------------------------        
     F*                                                                         
     F*    PROGRAM REVISION LOG                                                 
     F*    --------------------                                                 
     F*                                                                         
     F*          Date     Programmer     Nature of Revision                     
     F*        --------   ----------  -----------------------------------       
     F*        03/06/92   LJD         SAR #   439961      (AS/400  A/G)         
     F*        09/16/92   LJD         SAR #   525042                            
     F*        09/18/92   LJD         SAR #   525181                            
     F*        10/27/92   LJD         SAR #   535929                            
     F*        11/10/92   TC          SAR #   536739                            
     F*        11/18/92   CONROY      SAR #   546249               (A6)         
     F*        12/09/92   CONROY      SAR #   550055                            
     F*        12/14/92   TC          SAR #   554610,556156                     
     F*        01/20/93   TC          SAR #   549212,551718,552577              
     F*                                       554468,561297,561351              
     F*                                       566215,567656,572877              
     F*                                       571508                            
     F*        03/22/93   TC          SAR #   573079                            
     F*        03/25/93   MORGAN      SAR #   593096                            
     F*        04/16/93   MORGAN      SAR #   595770                            
     F*        06/08/93   ALLGEIER    SAR #   476703                            
     F*        06/18/93   HMK         SAR #   626812                            
     F*        07/14/93   EGK         SAR #   577002                            
     F*        07/15/93   EGK         SAR #   634214,608972                     
     F*        07/19/93   EGK         SAR #   581546,596457,633789              
     F*        07/25/93   EGK         SAR #   638629                            
     F*        08/17/93   TC          SAR #   647761,647761                     
     F*        08/16/93   EGK         SAR #   659331                            
     F*        09/28/93   EGK         SAR #   661562,661589                     
     F*        10/22/93   EGK         SAR #   661589                            
     F*        10/25/93   EGK         SAR #   666030                            
     F*        11/04/93   EGK         SAR #   639808                            
     F*        11/08/93   EGK         SAR #   675411                            
     F*        01/07/94   EGK         SAR #   685337,656608                     
     F*        03/02/94   EGK         SAR #   725255                            
     F*        03/08/94   RICCIARDI   SAR #   727023                            
     F*        03/14/94   EGK         SAR #   714556,718549                     
     F*        03/15/94   EGK         SAR #   721191                            
     F*        03/29/94   EGK         SAR #   732148                            
     F*        03/30/94   RICCIARDI   SAR #   731268                            
     F*        04/04/94   TC          SAR #   736000                            
     F*        04/11/94   EGK         SAR #   744317                            
     F*        04/16/94   VBS         SAR #   741159, 718629, 745176            
     F*        04/19/94   EGK         SAR #   745125                            
     F*        05/15/94   EGK         SAR #   760528                            
     F*        05/23/94   EGK         SAR #   746865                            
     F*        06/10/94   RICCIARDI   SAR #   772609                            
     F*        09/06/94   LJS         SAR #   812931                            
     F*        09/10/94   VBS         SAR #   818056                            
     F*        09/13/94   VBS         SAR #   738662                            
     F*        09/26/94   LJS         SAR #   808894                            
     F*        09/29/94   VBS         SAR #   787181                            
     F*        09/12/94   VBS         SAR #   818056                            
     F*        10/05/94   LJS         SAR #   809256                            
     F*        10/05/94   VBS         SAR #   753029                            
     F*        10/06/94   LJS         SAR #   825037                            
     F*        10/10/94   LJS         SAR #   776634                            
     F*        10/11/94   MORGAN      SAR #   783594                            
     F*        12/13/94   ZOMI        SAR #   856183                            
     F*        02/01/95   ZOMI        SAR #   863199                            
     F*        02/02/95   ZOMI        SAR #   871164                            
     F*        02/15/95   ZOMI        SAR #   889680                            
     F*        02/17/95   ZOMI        SAR #   881901                            
     F*        02/27/95   RICCIARDI   SAR #   871957                            
     F*        03/09/95   ZOMI        SAR #   824624                            
     F*        03/13/95   ZOMI        SAR #   907374                            
     F*        03/29/95   ZOMI        SAR #   916852                            
     F*        04/12/95   ZOMI        SAR #   875157                            
     F*        05/17/95   ZOMI        SAR #   916457                            
     F*        06/14/95   ZOMI        SAR #   928351                            
     F*        08/03/95   PERRY       SAR #   988071                            
     F*        08/07/95   ZOMI        SAR #   1002788                           
     F*        08/09/95   ZOMI        SAR #   1012564                           
     F*        08/30/95   ZOMI        SAR #   979327                            
     F*        09/08/95   LEWIS       SAR #   991684                            
     F*        09/28/95   LEWIS       SAR #   996397                            
     F*        10/25/95   JW4884561   SAR #   951594                            
     F*        10/26/95   TJI         SAR #  1050851                            
     F*        11/15/95   ZOMI        SAR #   1038967                           
     F*        11/22/95   ZOMI        SAR #   1038959                           
     F*        11/28/95   NIKHIL      SAR #   1038941                           
     F*        12/15/95   ZOMI        SAR #   1090247                           
     F*        01/04/96   ZOMI        SAR #   1068496,973419,1087056            
     F*        01/10/96   ZOMI        SAR #   1105381                           
     F*        02/15/96   ZOMI        SAR #   1110594,753264,1143741            
     F*        02/22/96   ZOMI        SAR #   1124961                           
     F*        04/15/96   ZOMI        SAR #   1193692,1195057,1207716           
     F*        05/21/96   ZOMI        SAR #   1237376                           
     F*        06/17/96   BC1886069   SAR #   1255110                           
     F*        06/21/96   ULRICH      SAR #   1220013                           
     F*        07/11/96   ULRICH/ZOMI SAR #   1278389,1270660                   
     F*        07/11/96   ULRICH      SAR #   1253026,1255638                   
     F*        07/12/96   ULRICH      SAR #   1293415 TAX ROUNDING              
     F*        07/12/96   ULRICH      SAR #   1244584 GLOBAL PRINT MESSAGE      
     F*        07/22/96   ULRICH      SAR #   1247208 INTERBRANCH CURRENCY=OFF  
     F*        08/09/96   ZOMI        SAR #   1287736                           
     F*        08/23/96   ULRICH      SAR #   1327961 Correct Gross & Open Total
     F*        10/10/96   SEAMUS      SAR #   1349271                           
     F*        11/01/96   ULRICH      SAR #   1382741 RELATED ADDRESS#'S        
     F*        12/16/96   ULRICH      SAR #   1363225 HISTORY INV PRINTS        
     F*                                       1401439 ADV PRICE CODE=1          
     F*                                       1311011 COVER PAGE ERROR          
     F*        12/18/96   ZOMI        SAR #   1410087                           
     F*        12/19/96   LEWIS       SAR #   1444965                           
     F*        12/19/96   ZOMI        SAR #   1435444                           
     F*        12/20/96   ULRICH      SAR #   1402407 CREDIT ORDER ADJSS        
     F*                                       1367867 ASSOC TEXT                
     F*                                       1371858 ASSOC TEXT ALSO           
     F*        01/20/97   ULRICH      SAR #   1461634 CONSOLIDATION VERTEX      
     F*                                       1449205 EDI ITEM CON.             
     F*        02/25/97   ULRICH      SAR #   1494256 F0311 SERVER              
     F*        03/04/97   ULRICH      SAR #   1475411 SUBSYSTEM OUTQ            
     F*        03/14/97   ULRICH      SAR #   1516834 TAX DESCRIPTION           
     F*        03/20/97   ULRICH      SAR #   1525520 EDI ITEM CON HDR          
     F*        03/25/97   ULRICH      SAR #   1525280 LANGUAGE PREF.            
     F*                                       1334230 PRINT MSG - KITS          
     F*        03/26/97   ULRICH      SAR #   1317991 CONS/EXCHANGE RTE         
     F*        04/04/97   ULRICH      SAR #   1504315 TAX ISSUES       en Totals
     F*        05/01/97   ULRICH      SAR #1552421 Detached Adjustmentsnting    
     F*                                                                         
     F*****************************************************************         
     F*    PROGRAM REVISION LOG                                                 
     F*    --------------------                                                 
      * CC27295 07.13.2009 Charlie McLean                                       
      *         Removed 2nd spool file for PDFs. Added overlay to               
      *         R5542565. Will create PDFs and print from same spool.           
      *         General cleanup removing old comments, ect.                     
      *         Saved previous to JDEARCHIVE/P5542565A                          
      *         Decreased lines at bottom from 26 to 10 ($TOTL)                 
      *         Chg'd conditions statement & included Mexico                    
      *                                                                         
      * CC27472 09.07.2009 Charlie McLean                                       
      *         Fixed minor page overflow problems                              
      *                                                                         
      * CC27482 09.08.2009 Charlie McLean                                       
      *         Fixed *IN74 *ON when R5542565 has been closed                   
      *                                                                         
      * CC27486 09.09.2009 Charlie McLean                                       
      *         Facturas - added back order note at top,                        
      *         no more than five lines                                         
      *                                                                         
      * CC27587 10.15.2009 Charlie McLean                                       
      *         Added invoice doc type to mail tag                              
      *                                                                         
      * CC27836 01.28.2010 Charlie McLean                                       
      *         Added USD to amount in words for Facturas                       
      *                                                                         
      * CC27942 03.02.2010 Chalrie McLean                                       
      *         Added print of global text to print before detail               
      *         print on front page. Company name change is first.              
      *                                                                         
      * CC27954 03.04.2010 Charlie McLean                                       
      *         Changed name on inside address                                  
      *         Changed logo on overlay for R5542565                            
      *         Chg'd remit to infor                                            
      *         chg'd disclosure statement                                      
      *                                                                         
      * CC28068 04.28.2010 Charlie McLean                                       
      *         Conditioned ENDPAGGRP if file is open                           
      *                                                                         
      * T28221  08.25.2010 Charlie McLean                                       
      *         Added ' - Sericol Unit' to inside address                       
      *                                                                         
      * T23240  04.07.2011 Charlie McLean                                       
      *         Removed ' - Sericol Unit' to inside address                     
      *                                                                         
      * T23256  06.21.2011 Charlie McLean                                       
      *         Changes for electronic factura                                  
      *         11.14.2011 excluded SX orders                                   
      *         11.15.2011 installed OFF/ON switch in UDC                       
      *                                                                         
      * T23271  02.10.2012 Charlie McLean                                       
      *         Used *IN76 to condition write to F55029 - Factura               
      *                                                                         
      * T23272  02.13.2012 Charlie McLean                                       
      *         If reprint reuse factura number                                 
      *                                                                         
      * T23273  02.15.2012 Charlie McLean                                       
      *         Fixes for processing F55029                                     
      *                                                                         
      * T23276  04.04.2012 Charlie McLean                                       
      *         Shut off all F55029 processing if UDC 42 SF FTP = NO            
      *         Move retrieve of UDC 42 SF values to where *IN76                
      *         is turned on (order is for Mexico)                              
      *                                                                         
      * T23292  06.29.2012 Charlie McLean                                       
      *         minor fix to W9SHD, now sources R1ADD1...                       
      *                                                                         
      *****************************************************************         
      *           DW Versions being processed...                     *          
      *                                                              *          
      *              56 = Canada              UCANUSD or UCANCAD     *          
      *              57 = Canadian Dollars    UCANCAD                *          
      *              58 = USA             not UCAN* or UMEX*         *          
      *              59 = US Dollars      not UCANCAD or UMEXMXP     *          
      *              76 = Mexico              UMEXUSD or UMEXMXP     *          
      *              77 = Mexican Peso        UMEXMXP                *          
      *              54 = Austrialian Dollar  UUSAAUD                *          
      *                                                              *          
      *****************************************************************         
      *                                                                         
      *    C0010     - Standard Report without Subheadings                      
      *                Temporary glossary for C0010                             
      *                                                                         
      *****************************************************************         
      *                                                                         
     FF0001   IF  E           K        DISK                                     
      *       NN automatic next number                                          
     FF0002   UF  E           K        DISK                                     
     FF0014   IF  E           K        DISK                                     
     FF0030   IF  E           K        DISK                                     
SER  FF0301   IF  E           K        DISK                                     
SER  F            I0301                             KRENAMEI03012               
     F*F0311LD IF  E           K        DISK                                    
     F*            I0311                             KRENAMEI0311D              
     FF4006   IF  E           K        DISK                                     
     FF4008   IF  E           K        DISK                                     
     FF40203LAIF  E           K        DISK                                     
     F            I40203                            KRENAMEI40203A              
     FF4071   IF  E           K        DISK                           UC        
     FF4074LC IF  E           K        DISK                                     
     F            I4074                             KRENAMEI4074C               
     FF4201LA IF  E           K        DISK                                     
     F            I4201                             KRENAMEI4201A               
     FF4211   UF  E           K        DISK                                     
     FF4211LM IF  E           K        DISK                           UC        
     F            I4211                             KRENAMEI4211M               
     FF4211LA UF  E           K        DISK                                     
     F            I4211                             KRENAMEI4211A               
     FF49211  UF  E           K        DISK                           UC        
     FF49211JAIF  E           K        DISK                                     
     F            I4211                             KRENAMEI49211J              
     FF4220LG IF  E           K        DISK                                     
     F            I4220                             KRENAMEI4220G               
     FF4314   IF  E           K        DISK                                     
     FF98312  IF  E           K        DISK                                     
     FF49219  IF  E           K        DISK                                     
     F            I49219                            KRENAMEI49219A              
     FF47046  UF  E           K        DISK                      A    UC        
     FF47047  UF  E           K        DISK                      A    UC        
     FF470461 UF  E           K        DISK                      A    UC        
     FF470471 UF  E           K        DISK                      A    UC        
     FF4706   O   E           K        DISK                           UC        
     FF4714   O   E           K        DISK                           UC        
     FF4715   O   E           K        DISK                           UC        
     FF47186  UF  E           K        DISK                      A    UC        
     FF47187  UF  E           K        DISK                      A    UC        
     FF471861 UF  E           K        DISK                      A    UC        
     FF471871 UF  E           K        DISK                      A    UC        
     FF47106  UF  E           K        DISK                      A    UC        
     FF47107  UF  E           K        DISK                      A    UC        
     FF471061 UF  E           K        DISK                      A    UC        
     FF471071 UF  E           K        DISK                      A    UC        
     FF0005D  IF  E           K        DISK                                     
10153FF0005   IF  E           K        DISK                                     
S6527FF56255  IF  E           K        DISK                                     
S5599FF0116   IF  E           K        DISK                                     
     F            I0116                             KRENAMEI0116S               
S5717FF0016   IF  E           K        DISK                                     
S5717FF00163  IF  E           K        DISK                                     
S5171FF41002  IF  E           K        DISK                                     
10153FF0006   IF  E           K        DISK                                     
     F            I0006                             KRENAMEI0006S               
23256FF0015LC IF  E           K        DISK                                     
23273FF55029L2UF  E           K        DISK                           UC        
23272F            I55029                            KRENAMEI55029A              
23273FF55029  O   E           K        DISK                           UC        
SER  FR5542565O   E                    PRINTER      KINFDS SRVFDS     UC        
     FR47042  O   E                    PRINTER                        UC        
      *****************************************************************         
      *    PROGRAM TABLES AND ARRAYS                                            
      *    -------------------------                                            
      *                                                                         
     E                    @A1         8 40               Ship To Address        
     E                    @A3         9 40               Sold To Address        
     E                    @AH       999  1 0             Authority Line Cnt     
     E                    @KY        10  1               Vocab. Override Key    
     E                    @O     80 160  1               OVRPRTF                
     E                    @C     80 160  1               CRTDTAQ                
     E                    @SH         8 40               Ship To Address        
     E                    @SL         9 40               Sold To Address        
     E                    @TD       999 30   @TR     7 0 Descr/Rate             
     E                    @TF       999  2               % or $ Factor          
     E                    @TM       999 29 9 @TT    29 9 Total/Tax Amt          
     E                    @TY       999 29 9 @TZ    29 9 Foreign Tot/Tx         
     E                    @IT       999 15 0 @TA    10   Item Number/Tax Area   
     E                    ##T        10 15 0             Clr Lvl Totals         
     E                    @PR        10  1               Preferences            
     E                    @PT       999  8               Adjustment Typ         
     E                    @PD       999 15 0             Domestic Price         
     E                    @PF       999 15 0             Foreign Price          
     E                    XTA         5  8 0                                    
     E                    XTR         5  7 0                                    
     E                    XAM         5 15 2                                    
S7321E                    @L         84  1               Dollar Text            
23256E                    @M        500  1               payment method         
23256E                    @A        300  1               address                
      *****************************************************************         
      *                                                                         
      *    Copy Member for Composite Common Subroutine - C81DRPT                
      *                                                                         
     E/COPY JDECPY,E81DRPT                                                      
      *****************************************************************         
      *                                                                         
      *    Copy Member for Composite Common Subroutine - C0012                  
      *                                                                         
     E/COPY JDECPY,E0012                                                        
      **************************************************************            
      *                                                                         
      *    Copy Composite Member for Common Subroutine - X01100                 
      *                                                                         
     E/COPY JDECPY,E01100                                                       
      **************************************************************            
      *                                                                         
      *    Copy Common Subroutine - Double Byte Truncation                      
      *                                                                         
     E/COPY JDECPY,E9822                                                        
      *****************************************************************         
      *    PROGRAM INPUT SPECIFICATIONS AND DATA STRUCTURES                     
      *    ------------------------------------------------                     
      *                                                                         
      *    Data Structure to Load Video Screen Text                             
      *                                                                         
     IDSTXT       DS                           4920                             
     I                                        1  12 VTX001                      
     I                                       41  52 VTX002                      
     I                                       81  92 VTX003                      
     I                                      121 132 VTX004                      
     I                                      161 173 VTX005                      
     I                                      201 213 VTX006                      
     I                                      241 248 VTX007                      
     I                                      281 288 VTX008                      
     I                                      321 360 VTX009                      
     I                                      361 400 VTX010                      
     I                                      401 440 VTX011                      
     I                                      441 444 VTX012                      
     I                                      481 520 VTX013                      
     I                                      521 560 VTX014                      
     I                                      561 600 VTX015                      
     I                                      601 604 VTX016                      
     I                                      641 653 VTX017                      
     I                                      681 720 VTX018                      
     I                                      721 727 VTX019                      
     I                                      761 773 VTX020                      
     I                                      801 806 VTX021                      
     I                                      841 846 VTX022                      
     I                                      881 886 VTX023                      
     I                                      921 926 VTX024                      
     I                                      961 985 VTX025                      
     I                                     10011021 VTX026                      
     I                                     10411048 VTX027                      
     I                                     10811082 VTX028                      
     I                                     11211135 VTX029                      
     I                                     11611167 VTX030                      
     I                                     12011226 VTX031                      
     I                                     12411255 VTX032                      
     I                                     12811295 VTX033                      
     I                                     13211337 VTX034                      
     I                                     13611389 VTX035                      
     I                                     14011409 VTX036                      
     I                                     14411461 VTX037                      
     I                                     14811489 VTX038                      
     I                                     15211531 VTX039                      
     I                                     15611600 VTX040                      
     I                                     16011640 VTX041                      
     I                                     16411680 VTX042                      
     I                                     16811684 VTX043                      
     I                                     17211732 VTX044                      
     I                                     17611772 VTX045                      
     I                                     18011803 VTX046                      
     I                                     18411856 VTX047                      
     I                                     18811886 VTX048                      
     I                                     19211923 VTX049                      
     I                                     19612000 VTX050                      
     I                                     20012040 VTX051                      
     I                                     20412080 VTX052                      
     I                                     20812095 VTX053                      
     I                                     21212150 VTX054                      
     I                                     21612185 VTX055                      
     I                                     22012208 VTX056                      
     I                                     22412242 VTX057                      
     I                                     22812295 VTX058                      
     I                                     23212335 VTX059                      
     I                                     23612375 VTX060                      
     I                                     24012415 VTX061                      
     I                                     24412441 VTX062                      
     I                                     24812481 VTX063                      
     I                                     25212521 VTX064                      
     I                                     25612600 VTX065                      
     I                                     26012606 VTX066                      
     I                                     26412655 VTX067                      
     I                                     26812720 VTX068                      
     I                                     27212760 VTX069                      
     I                                     27612800 VTX070                      
     I                                     28012827 VTX071                      
     I                                     28412865 VTX072                      
     I                                     28812883 VTX073                      
     I                                     29212931 VTX074                      
     I                                     29612963 VTX075                      
     I                                     30013006 VTX076                      
     I                                     30413047 VTX077                      
     I                                     30813087 VTX078                      
     I                                     31213138 VTX079                      
     I                                     31613166 VTX080                      
     I                                     32013240 VTX081                      
     I                                     32413280 VTX082                      
     I                                     32813281 VTX083                      
     I                                     33213321 VTX084                      
     I                                     33613400 VTX085                      
     I                                     34013430 VTX086                      
     I                                     34413470 VTX087                      
     I                                     34813498 VTX088                      
     I                                     35213530 VTX089                      
     I                                     35613572 VTX090                      
SER  I                                     36013630 VTX091                      
SER  I                                     36413670 VTX092                      
SER  I                                     36813695 VTX093                      
SER  I                                     37213735 VTX094                      
SER  I                                     37613776 VTX095                      
SER  I                                     38013805 VTX096                      
     I*                                                                         
     I                                     40014012 VTX101                      
     I                                     40414052 VTX102                      
     I                                     40814088 VTX103                      
     I                                     41214122 VTX104                      
     I                                     41614169 VTX105                      
     I                                     42014209 VTX106                      
     I                                     42414247 VTX107                      
     I                                     42814305 VTX108                      
     I                                     43214350 VTX109                      
     I                                     43614376 VTX110                      
     I                                     44014417 VTX111                      
     I                                     44414448 VTX112                      
     I                                     44814482 VTX113                      
     I                                     45214528 VTX114                      
     I                                     45614568 VTX115                      
     I                                     46014608 VTX116                      
     I                                     46414647 VTX117                      
     I                                     46814705 VTX118                      
     I                                     47214750 VTX119                      
     I                                     47614776 VTX120                      
     I                                     48014817 VTX121                      
     I                                     48414853 VTX122                      
     I                                     48814888 VTX123                      
      *                                                                         
      *    Data Structure to Load Video Screen Text for 2nd report              
      *                                                                         
     IDSTXT2      DS                            920                             
      *                                                                         
     IDSVTX       DS                           2900                             
      *                                                                         
      *                                                                         
      *    Data Structure containing key to Printer Outque                      
      *                                                                         
     IDSKEY       DS                                                            
     I                                        1  10 DSTERM                      
     I                                       11  20 DSPID                       
      *                                                                         
     I/COPY JDECPY,I00PS@@                                                      
     I/COPY JDECPY,I00DSINX                                                     
     I/COPY JDECPY,I00DSPROG                                                    
     I/COPY JDECPY,IO42199                                                      
     I/COPY JDECPY,I01100                                                       
     I/COPY JDECPY,I41002                                                       
     I/COPY JDECPY,I40300                                                       
     I/COPY JDECPY,I4074PAX                                                     
      *                                                                         
      *    Data Structure for - Company Constants                               
      *                                                                         
     IDS0010    E DSF0010                                                       
      *                                                                         
      *    Data Structure for - Currency Codes                                  
      *                                                                         
     IDS0013    E DSF0013                                                       
      *                                                                         
      *    Data Structure for Sales Detail History File                         
      *                                                                         
     I/COPY JDECPY,IO42019                                                      
      *                                                                         
      *    Data Structure for Default Location/Printers                         
      *                                                                         
     ID40096    E DSF40096                                                      
      *                                                                         
      *    Data Structure for Line Type Constants                               
      *                                                                         
     IDS4020    E DSF40205                                                      
      *                                                                         
      *    Data Structure for Branch/Plant Constants                            
      *                                                                         
     IDSINVC    E DSF41001                                                      
      *                                                                         
      *    Data Structure for Item Master                                       
      *                                                                         
     IDS4101    E DSF4101                                                       
      *                                                                         
      *    Data Structure for Sales Order Detail                                
      *                                                                         
     I***DS4211    E DSF4211                                                    
     IDS4211    E DSF49211JA                                                    
     IPS0116      DS                            400                             
     I/COPY JDECPY,I011671                                                      
     I/COPY JDECPY,I000671                                                      
      *                                                                         
      *    Data Structure for System Constants                                  
      *                                                                         
     IDS4009    E DSF4009                                                       
      *                                                                         
      *    Data Structure for VERTEX                                            
      *                                                                         
     IDS7301    E DSF7301                                                      V
      *                                                                        V
      *                                                                         
     IDS7305    E DSF7305                                                      V
      *                                                                        V
      *    Data Structure for passed PARMS                                      
      *                                                                         
     IDSPAR       DS                                                            
     I                                        1   8 PSDOCO                      
     I                                        9  10 PSDCTO                      
     I                                       11  15 PSKCOO                      
     I                                       16  18 PSSFXO                      
     I                                       19  28 PSTERM                      
     I                                       29  38 PSUSER                      
      *                                                                         
      *    Data structure for Subsystem Processing                              
      *                                                                         
     IWKPARM      DS                                                            
     I                                        1   8 $WDOCO                      
     I                                        9  10 $WDCTO                      
     I                                       11  15 $WKCOO                      
     I                                       16  18 $WSFXO                      
     I                                       19  28 $WTERM                      
     I                                       29  38 $WUSER                      
      *                                                                         
      *    Data Structure to Retrieve Order Address.                            
      *                                                                         
     IDS4006      DS                            100                             
     I                                        1   8 $ADOCO                      
     I                                        9  10 $ADCTO                      
     I                                       11  15 $AKCOO                      
     I                                       16  24 $AEDOC                      
     I                                       25  26 $AEDCT                      
     I                                       27  31 $AEKCO                      
     I                                       32  39 $AAN8                       
     I                                       40  47 $ASHAN                      
      *                                                                         
      *    Data structure for Tax Code                                          
      *                                                                         
     I            DS                                                            
     I                                        1  22 $WKITX                      
     I                                        1   3 $WKI3                       
     I                                        4   5 $WKI2                       
     I                                        6  22 $WKI4                       
      *                                                                         
      *    Data structure for Person Tax Code Format                            
      *                                                                         
     I            DS                                                            
     I                                        1  22 $WKOTX                      
     I                                        1   3 $WKO3                       
     I                                        4   4 $DSH1                       
     I                                        5   6 $WKO2                       
     I                                        7   7 $DSH2                       
     I                                        8  22 $WKO4                       
      *                                                                         
      *    Data structure for Ship to Address                                   
      *                                                                         
     I            DS                                                            
     I                                        1 320 @SH                         
     I                                        1  40 RRSHL1                      
     I                                       41  80 RRSHL2                      
     I                                       81 120 RRSHL3                      
     I                                      121 160 RRSHL4                      
     I                                      161 200 RRSHL5                      
     I                                      201 240 RRSHL6                      
     I                                      241 280 RR#S27                      
     I                                      281 320 RR#A12                      
      *                                                                         
      *    Data structure for Sold to Address                                   
      *                                                                         
     I            DS                                                            
     I                                        1 360 @SL                         
     I                                        1  40 RRSLD1                      
     I                                       41  80 RRSLD2                      
     I                                       81 120 RRSLD3                      
     I                                      121 160 RRSLD4                      
     I                                      161 200 RRSLD5                      
     I                                      201 240 RRSLD6                      
     I                                      241 280 RR#A17                      
     I                                      281 320 RR#A11                      
     I                                      321 360 RR#A37                      
      *                                                                         
      *    Data structure for Ship to Address - Drafts                          
      *                                                                         
     I            DS                                                            
     I                                        1 320 @A1                         
     I                                        1  40 R1ADD1                      
     I                                       41  80 R1ADD2                      
     I                                       81 120 R1ADD3                      
     I                                      121 160 R1ADD4                      
     I                                      161 200 R1ADD5                      
     I                                      201 240 R1ADD6                      
     I                                      241 280 R1#ADD                      
     I                                      281 320 R1ADD8                      
      *                                                                         
      *    Data structure for Sold to Address - Drafts                          
      *                                                                         
     I            DS                                                            
     I                                        1 360 @A3                         
     I                                        1  40 R3ADD1                      
     I                                       41  80 R3ADD2                      
     I                                       81 120 R3ADD3                      
     I                                      121 160 R3ADD4                      
     I                                      161 200 R3ADD5                      
     I                                      201 240 R3ADD6                      
     I                                      241 280 R3#ADD                      
     I                                      281 320 R3ADD8                      
     I                                      321 360 R3ADD9                      
      *                                                                         
      *    Data Structure containing Parameter list.                            
      *                                                                         
     IDSPLST      DS                            100                             
     I                                        1   8 $IDOCO                      
     I                                        9  10 $IDCTO                      
     I                                       11  15 $IKCOO                      
     I                                       16  23 $IDOC                       
     I                                       24  25 $IDCT                       
     I                                       26  30 $IKCO                       
     I                                       31  33 $I#STT                      
     I                                       34  36 $I#STF                      
     I                                       37  37 $I#STB                      
     I                                       38  38 $I#IBO                      
     I                                       39  48 $IFILE                      
     I                                       49  49 $ICRRM                      
      *---------------------------------------------------------------          
      *                                                                         
      *    Text Message User Index                                              
      *                                                                         
     IDS4016      DS                                                            
     I                                        1   1 DS$BLK                      
     I                                        2   40DS$SEQ                      
     I                                        5  84 DS$TXT                      
      *---------------------------------------------------------------          
      *                                                                         
      *    User Index Name and Location                                         
      *                                                                         
     IDSUIDX      DS                                                            
     I I            'P4016     QTEMP     '    1  20 $IDXNM                      
      *                                                                         
      *                                                                         
      *    User Index Starting Point and Length of each entry                   
      *                                                                         
     IDSRCLN      DS                                                            
     I I            84                    B   1   40$RCLN                       
      *                                                                         
      *    User Index Key Length                                                
      *                                                                         
     IDSKYLN      DS                                                            
     I I            4                     B   1   40$KYLN                       
      *                                                                         
      *---------------------------------------------------------------          
      *                                                                         
      *    Print Message User Index                                             
      *                                                                         
     IDSPRNT      DS                                                            
     I                                        1   1 DS#BLK                      
     I                                        2   2 DS#TYP                      
     I                                        3   70DS#SEQ                      
     I                                        8  17 DSINMG                      
      *                                                                         
      *    User Index Name and Location                                         
      *                                                                         
     IDS#IDX      DS                                                            
     I I            'P40400P   QTEMP     '    1  20 #IDXN2                      
      *                                                                         
      *                                                                         
      *    User Index Starting Point and Length of each entry                   
      *                                                                         
     IDS#RCL      DS                                                            
     I I            17                    B   1   40#RCL2                       
      *                                                                         
      *    User Index Key Length                                                
      *                                                                         
     IDS#KYL      DS                                                            
     I I            2                     B   1   40#KYL2                       
     I I            7                     B   5   80#KYL3                       
      *****************************************************************         
      *                                                                         
      *    User Index Name for Tax Summary for Rounding                         
      *                                                                         
     IDSIDX1      DS                                                            
     I I            'P42565    QTEMP     '    1  20 $1DXNM                      
      *                                                                         
      *    User Index Starting Point and Length of each entry                   
      *                                                                         
     IDSRCL1      DS                                                            
     I I            66                    B   1   40$1RCLN                      
      *                                                                         
      *    User Index Key Length                                                
      *                                                                         
     IDSKYL1      DS                                                            
     I I            22                    B   1   40$1KYLN                      
      *                                                                         
      *    User Index Name for Tax Summary for Rounding                         
      *                                                                         
     IDS$1        DS                                                            
     I                                        1   1 $1BLK                       
     I                                        2  11 $1TXA1                      
     I                                       12  190$1ITM1                      
     I                                       20  21 $1EXR1                      
     I                                       22  22 $1TAX1                      
     I                                       23  370$1STAM                      
     I                                       38  669$1UTAM                      
      *                                                                         
     IDSKY$1      DS                                                            
     I                                        1   1 K1BLK                       
     I                                        2  11 K1TXA1                      
     I                                       12  190K1ITM                       
     I                                       20  21 K1EXR1                      
     I                                       22  22 K1TAX1                      
      *****************************************************************         
      *                                                                         
      *    User Index Name for Serial #                                         
      *                                                                         
     IDSIDX2      DS                                                            
     I I            'P42565S   QTEMP     '    1  20 $2DXNM                      
      *                                                                         
      *    User Index Starting Point and Length of each entry                   
      *                                                                         
     IDSRCL2      DS                                                            
     I I            55                    B   1   40$2RCLN                      
      *                                                                         
      *    User Index Key Length                                                
      *                                                                         
     IDSKYL2      DS                                                            
     I I            22                    B   1   40$2KYLN                      
      *                                                                         
      *    User Index Name for Serial #                                         
      *                                                                         
     IDS$2        DS                                                            
     I                                        1   1 $2BLK                       
     I                                        2   6 $2KCOO                      
     I                                        7  140$2DOCO                      
     I                                       15  16 $2DCTO                      
     I                                       17  220$2LNID                      
     I                                       23  25 $2SFXO                      
     I                                       26  55 $2LOTN                      
      *                                                                         
      *---------------------------------------------------------------          
      *                                                                         
      *    Printer overrides for the subsystem mode.                            
      *                                                                         
     IPRTOVR      DS                            512                             
      *                                                                         
     I/COPY JDECPY,I00RSC                                                       
     I/COPY JDECPY,I00TX                                                        
     I/COPY JDECPY,I00XFSRV                                                     
     I/COPY JDECPY,I9800E                                                       
     I/COPY JDECPY,I0005U                                                       
     I/COPY JDECPY,I010171                                                      
     I/COPY JDECPY,I030171                                                      
     I/COPY JDECPY,I410271                                                      
     I/COPY JDECPY,I410871                                                      
     I/COPY JDECPY,I7300                                                        
      *                                                                         
      *    Vertex Sales Tax Parameters                                          
      *                                                                         
     I/COPY JDECPY,I73VTS                                                       
     I/COPY JDECPY,I410571                                                      
     I/COPY JDECPY,I4102171                                                     
      *****************************************************************         
      *    Copy Member for F0311 File                                           
     I/COPY JDECPY,IO0311                                                       
      ***************************************************************           
S5651I              'Please remit all fun-C         US$                         
  |  I              'ds in US dollars'                                          
27250I              'Please remit all fun-C         AUD$                        
27250I              'ds in AUD dollars'                                         
  |  I              'Please remit all fun-C         CAN$                        
  |  I              'ds in Canadian dolla-                                      
  |  I              'rs'                                                        
S7312I              'Favor de pagar en Pe-C         MEXMX$                      
S7312I              'sos'                                                       
S7312I              'Favor de pagar en US-C         MEXUS$                      
S7312I              ' dolares'                                                  
  |  I              'Sericol, Inc.'       C         MATTEL                      
  |  I              'Price per Gallon'    C         PPG                         
  |  I              'Pounds'              C         POUNDS                      
  |  I              'Fujifilm Sericol Can-C         CANAD1                      
  |  I              'ada LTD.'                                                  
24995I              '600 Suffolk Court'   C         CANAD2                      
24995I              'Mississauga, Ontario'C         CANAD3                      
24995I              'Canada  L5R 4G4'     C         CANAD4                      
24995I              '905-890-9961  Fax 90-C         CANAD6                      
24995I              '5-755-2900'                                                
24995I              '          '          C         CANAD5                      
S6042 * S7312       'Sericol de Mxico'   C         MXAD1                       
S6042 * S7312       'Av. Ejrcito Naciona-C         MXAD2                       
S6042 * S7312       'l 904 Piso 12'                                             
S6042 * S7312       'Polanco, Los Morales'C         MXAD3                       
S6042 * S7312       'Mxico D.F., MX. 115-C         MXAD4                       
S6042 * S7312       '10'                                                        
S7312I              'SERICOL DE MEXICO, S-C         MXAD1                       
S7312I              '.A. DE C.V.'                                               
S7312I              'AV. EJERCITO NACIONA-C         MXAD2                       
S7312I              'L 904 PISO 7 Y 12'                                         
S7312I              'COLONIA LOS MORALES -C         MXAD3                       
S7312I              'POLANCO'                                                   
S7312I              'DELEGACION MIGUEL HI-C         MXAD4                       
S7312I              'DALGO'                                                     
S7312I              'MEXICO 11510 D. F.  'C         MXAD5                       
S7312I              'R.F.C. SME 020724 AQ-C         MXAD6                       
S7312I              '7'                                                         
NOV06 ***           'GST No. 853053864'   C         CAN2                        
NOV06I              'GST No. 863053864'   C         CAN2                        
  |  I              'Remit to:'           C         CANRM1                      
  |  I              'Fujifilm Sericol Can-C         CCDRM2                      
  |  I              'ada LTD. B9101'                                            
  |  I              'Fujifilm Sericol Can-C         CUSRM2                      
  |  I              'ada LTD. B9101U'                                           
S7312I              'X00500S2'            C         AMTWRD                      
  |  I              'P.O. Box 9100'       C         CANRM3                      
  |  I              'Postal Station F'    C         CANRM4                      
  |  I              'Toronto, Ontario'    C         CANRM5                      
  |  I              'Canada  M4Y 3A5'     C         CANRM6                      
      *                                                                         
27954I*CC27954      'FUJIFILM Sericol U.S-C         US1                         
27954I*CC27954      '.A., Inc.'                                                 
27954I*CC27954      '1101 W. Cambridge Dr-C         US2                         
27954I*CC27954      'ive'                                                       
27954I*CC27954      'Kansas City, KS 6610-C         US3                         
27954I*CC27954      '3-1311'                                                    
27954I*CC27954      '913-342-4060  Fax 91-C         US4                         
27954I*CC27954      '3-342-4752'                                                
27954I*T28221       'FUJIFILM North Ameri-C         US1                         
27954I*T28221       'ca Corp'                                                   
28221I*ses13        'FUJIFILM North Ameri-C         US1                         
28221I*ses13        'ca Corp             -                                      
28221I*ses13        '     '                                                     
ses13I              'FUJIFILM Manufacturi-C         US1                         
ses13I              'ng U.S.A., Inc.     -                                      
ses13I              '     '                                                     
27954I*ses13        'Graphics Systems Div-C         US2                         
27954I*ses13        'ision'                                                     
ses13I              '211 Puckett Ferry Rd-C         US2                         
ses13I              '.    '                                                     
28221I*T23240       'Graphics Systems Div-C         US2                         
28221I*T23240       'ision - Sericol Unit-                                      
28221I*T23240       '     '                                                     
27954I*ses13        '1101 W. Cambridge Dr-C         US3                         
27954I*ses13        'ive'                                                       
27954I*ses13        'Kansas City, KS 6610-C         US4                         
27954I*ses13        '3-1311'                                                    
27954I*ses13        '913-342-4060  Fax 91-C         US5                         
27954I*ses13        '3-342-4752'                                                
ses13I              '                    -C         US3                         
ses13I              '   '                                                       
ses13I              'Greenwood, SC 29649 -C         US4                         
ses13I              '      '                                                    
ses13I              'U.S.A.              -C         US5                         
ses13I              '          '                                                
      *                                                                         
  |  I              'Remit To:'           C         USRM1                       
     I* CC27954     'FUJIFILM Sericol U.S-C         USRM2                       
     I* CC27954     '.A., Inc.'                                                 
27954I*ses13        'FUJIFILM North Ameri-C         USRM2                       
27954I*ses13        'ca Corp'                                                   
  |  I*ses13        '12554 Collections Ce-C         USRM3                       
  |  I*ses13        'nter'                                                      
  |  I*ses13        'Chicago, IL  60693'  C         USRM4                       
ses13I              'FUJIFILM Manufacturi-C         USRM2                       
ses13I              'ng USA '                                                   
ses13I              '                    -C         USRM3                       
ses13I              '    '                                                      
ses13I              '                  '  C         USRM4                       
  |  I              'Wire To:'            C         WR1                         
  |  I*ses13        'Bank of America'     C         WR2                         
ses13I              '               '     C         WR2                         
      *                                                                         
S8307I              'Pagar solamente por -C         MXWR0                       
S8307I              'transferencia x:    '                                      
S8307I              'Banco Nacional de Me-C         MXWR1                       
S8307I              'xico                '                                      
S8307I              'Branch No. 261   Eje-C         MXWR2                       
S8307I              'rcito Nacional      '                                      
S8307I              'Plaza: Mexico DF    -C         MXWR3                       
     I              '                    '                                      
S6042I              'FUJIFILM SERICOL DE -C         MXWR4                       
S6042I              'MEXICO S.A. DE C.V. '                                      
S8307I              'Acc #: 9263092      -C         MXWR5U                      
     I              '                    '                                      
S8307I              'Acc #: 5717331      -C         MXWR5P                      
     I              '                    '                                      
S8307I              'Clabe No. 0021800261-C         MXWR6U                      
S8307I              '92630921            '                                      
S8307I              'Clabe No. 0021800261-C         MXWR6P                      
S8307I              '57173313            '                                      
S8307I              'Swift Code: BNMXMXMM-C         MXWR7                       
     I              '                    '                                      
      *                                                                         
27099I              'Bank of America Dome-C         FCANW2                      
  |  I              'stic Deposits 5687  '                                      
  |  I              'Swift Code: BOFAUS6S-C         FCANW3                      
  |  I              'FCD                 '                                      
  |  I              'Acct# 711465090227  -C         FCANW4                      
  |  I              '                    '                                      
  |  I              'Reference: Fujifilm -C         FCANW5                      
  |  I              'Sericol U.S.A., Inc.'                                      
  |  I              'Acct# 12319002      -C         FCANW6                      
27099I              '                    '                                      
      *                                                                         
  |  I*ses13        'Kansas City, MO'     C         USWR3                       
ses13I              '               '     C         USWR3                       
  |  I* CC27954     'Credit: FUJIFILM Ser-C         USWR4                       
14247I* CC27954     'icol U.S.A., Inc.'                                         
27954I*ses13        'Credit: FUJIFILM Nor-C         USWR4                       
27954I*ses13        'th America Corp'                                           
  |  I*ses13        'Acct#: 010100068446' C         USWR5                       
  |  I*ses13        'Routing#: 0260-0959--C         USWR6                       
  |  I*ses13        '3'                                                         
ses13I              '                    -C         USWR4                       
ses13I              '               '                                           
ses13I              '                   ' C         USWR5                       
ses13I              '                    -C         USWR6                       
ses13I              ' '                                                         
  |  I              'Toronto, Ontario'    C         CNWR3                       
  |  I              'Canada M5V 3LT'      C         CNWR4                       
  |  I              'Credit: Fujifilm Ser-C         CNWR5                       
  |  I              'icol Canada LTD.'                                          
S7312I              'Acc #: 45740206'     C         CCDWR6                      
S7312I              'Acc #: 45740199'     C         CUSWR6                      
  |  I              'Swift Code: BOFACATT'C         CNWR7                       
  |  I              'The Parties confirm -C         CANAG1                      
  |  I              'that it is their wis-                                      
  |  I              'h that this agreemen-                                      
  |  I              't as well as all oth-                                      
  |  I              'er documents'                                              
  |  I              'relating to this agr-C         CANAG2                      
  |  I              'eement, including no-                                      
  |  I              'tices, be drawn up i-                                      
  |  I              'n English only.'                                           
  |  I              'Les parties confirme-C         CANAG3                      
  |  I              'nt quec''''''est leu-                                      
  |  I              'volont que la prse-                                      
  |  I              'nte convention de m-                                      
  |  I              'me que'                                                    
  |  I              'tous les documents, -C         CANAG4                      
  |  I              'y compris les avis, -                                      
  |  I              's''''''y rattachant,-                                      
  |  I              ' soient redigs en A-                                      
  |  I              'ngla is seulement.'                                        
27295I              'In the production of-C         DISCL1                      
27295I              ' articles in this no-                                      
27295I              'tice, Seller has ful-                                      
27295I              'ly complied with the-                                      
27295I              ' Fair Labor Standard-                                      
27295I              's Act of 1938 '                                            
27295I* CC27954     'as ammended. For TER-C         DISCL2                      
27295I* CC27954     'MS OF SALE: www.fuji-                                      
27295I* CC27954     'filmsericol.com/lega-                                      
27295I* CC27954     'l/conditionsofsale_e-                                      
27295I* CC27954     'nglish.html         -                                      
27295I* CC27954     '            '                                              
27954I*ses13        'as ammended. This in-C         DISCL2                      
27954I*ses13        'voice incorporates a-                                      
27954I*ses13        'nd is subject to the-                                      
27954I*ses13        ' Terms and Condition-                                      
27954I*ses13        's of Sale at:       -                                      
27954I*ses13        '            '                                              
ses13I              'as amended.         -C         DISCL2                      
ses13I              '                    -                                      
ses13I              '                    -                                      
ses13I              '                    -                                      
ses13I              '                    -                                      
ses13I              '            '                                              
27954I*ses13        'www.fujifilmsericol.-C         DISCL3                      
27954I*ses13        'com/legal/conditions-                                      
27954I*ses13        'ofsale_english.html -                                      
27954I*ses13        '                    -                                      
27954I*ses13        '                    -                                      
27954I*ses13        '            '                                              
ses13I              '                    -C         DISCL3                      
ses13I              '                    -                                      
ses13I              '                    -                                      
ses13I              '                    -                                      
ses13I              '                    -                                      
ses13I              '            '                                              
      *                                                                         
27295I              'In the production of-C         DISCM1                      
27295I              ' articles in this no-                                      
27295I              'tice, Seller has ful-                                      
27295I              'ly complied with the-                                      
27295I              ' Fair Labor Standard-                                      
27295I              's Act of 1938 '                                            
27295I              'as ammended. For TER-C         DISCM2                      
27295I              'MS OF SALE: www.fuji-                                      
27295I              'filmsericol.com/lega-                                      
27295I              'l/conditionsofsale_m-                                      
27295I              'exico.html          -                                      
27295I              '            '                                              
      *                                                                         
S7312I              'Bill To:'            C         BILLTO                      
  |  I              'Ship To:'            C         SHIPTO                      
  |  I              'Invoice:'            C         INVHDR                      
  |  I              'Date:'               C         DTEHDR                      
  |  I              'Page:'               C         PGEHDR                      
  |  I              'Order:'              C         ORDHDR                      
  |  I              'PO:'                 C         POHDR                       
  |  I              'Shipping:'           C         SHPHDR                      
  |  I              'Terms:'              C         TRMHDR                      
  |  I              'Qty'                 C         QTYHDR                      
  |  I              'U/M'                 C         UMHDR                       
  |  I              'Product No.'         C         PRDHDR                      
  |  I              'Description'         C         DESHDR                      
  |  I              'Each'                C         ECHHDR                      
  |  I              'Extended'            C         EXTHDR                      
  |  I              'T'                   C         TAXHDR                      
  |  I              'Sales Tax'           C         STXHDR                      
S7312I              'Sericol Referencia#:'C         REFHDR                      
S7312I              'I.V.A.   '           C         IVAHDR                      
  |  I              'Shipped From'        C         SHPFRM                      
S7312I              '      Pay this amoun-C         PAYBY                       
S7312I              't by'                                                      
S7312I              'Pagar esta cantidad -C         PAYBYM                      
S7312I              'para'                                                      
S7312 **            'Retenida Por Cheque' C         MEXHFC                      
S7312 **            'Muestra Sin Cobro'   C         MEXNC                       
S7312 **            'Deuda en 30 dias'    C         MEXNET                      
S7312 **            'Deuda Sobre Recibo'  C         MEXN00                      
S7312 **            'Deuda en 10 dias'    C         MEXN10                      
S7312 **            'Deuda en 15 dias'    C         MEXN15                      
S7312 **            'Deuda en 30 dias'    C         MEXN30                      
S7312 **            'Deuda en 40 dias'    C         MEXN40                      
S7312 **            'Deuda en 45 dias'    C         MEXN45                      
S7312 **            'Deuda en 52 dias'    C         MEXN52                      
S7312 **            'Deuda en 60 dias'    C         MEXN60                      
S7312 **            'Deuda en 75 dias'    C         MEXN75                      
S7312 **            'Deuda en 90 dias'    C         MEXN90                      
S7312 **            'Deuda en 120 dias'   C         MEX120                      
Nov06 ** Change text for Mexico terms                                           
     I              'Detenida Por Pago  ' C         MEXHFC                      
     I              'Muestra Sin Cargo'   C         MEXNC                       
     I              'Plazo de Vencimiento-C         MEXNET                      
     I              ' 30 dias'                                                  
     I              'Cobrar al Entregar ' C         MEXN00                      
     I              'Plazo de Vencimiento-C         MEXN10                      
     I              ' 10 dias'                                                  
     I              'Plazo de Vencimiento-C         MEXN15                      
     I              ' 15 dias'                                                  
     I              'Plazo de Vencimiento-C         MEXN30                      
     I              ' 30 dias'                                                  
     I              'Plazo de Vencimiento-C         MEXN40                      
     I              ' 40 dias'                                                  
     I              'Plazo de Vencimiento-C         MEXN45                      
     I              ' 45 dias'                                                  
     I              'Plazo de Vencimiento-C         MEXN52                      
     I              ' 52 dias'                                                  
     I              'Plazo de Vencimiento-C         MEXN60                      
     I              ' 60 dias'                                                  
     I              'Plazo de Vencimiento-C         MEXN75                      
     I              ' 75 dias'                                                  
     I              'Plazo de Vencimiento-C         MEXN90                      
     I              ' 90 dias'                                                  
     I              'Plazo de Vencimiento-C         MEX120                      
Nov06I              ' 120 dias'                                                 
      **                                                                        
S7312I              'Cobro Contra Entrega-C         MEX302                      
S7312I              '- Cheque'                                                  
S7312I              'Cobro En Fondos Cert-C         MEX303                      
S7312I              'ificados'                                                  
S7312I              'Tarjeta de Credito'  C         MEX305                      
S7312I              'Ninjuna Venta'       C         MEX309                      
S7312I              '1% en 10 Deuda en 30'C         MEX320                      
S7312I              '2% en 10 Deuda en 30'C         MEX321                      
S7312I              '2% en 10'            C         MEX322                      
S7312I              '1% en 10'            C         MEX323                      
S7312I              '1/2% 15 Deuda en 30' C         MEX324                      
S7312I              '1% en 10 Deuda en 45'C         MEX325                      
  |  I              'Taxable Item T'      C         TAXITM                      
  |  I              'Pounds'              C         LBS                         
  |  I              '--------------'      C         DOTLIN                      
S7312I              'UUSAUSDR'            C         USUSDR                      
S7312I              'UUSACADR'            C         USCADR                      
S7312I              'UUSAMXPR'            C         USMXPR                      
S7312I              'UCANUSDR'            C         CNUSDR                      
S7312I              'UCANCADR'            C         CNCADR                      
S7312I              'UCANMXPR'            C         CNMXPR                      
S7312I              'UMEXUSDR'            C         MXUSDR                      
S7312I              'UMEXCADR'            C         MXCADR                      
S7312I              'UMEXMXPR'            C         MXMXPR                      
27250I              'UUSAAUDR'            C         USAUDR                      
  |  I              'U0000004C '          C         CANVER                      
  |  I              'U0000004  '          C         USVER                       
  |  I              'U0000005  '          C         CMEMO                       
  |  I              'U0000001  '          C         NIGVER                      
  |  I              'TEST0004  '          C         TSTVER                      
  |  I              'Reprint'             C         REPRT                       
  |  I              'Tracking Numbers'    C         TRKHDR                      
12724I              'ACH To:'             C         USCH1                       
12724I*ses13        'Bank of America'     C         USCH2                       
12724I*ses13        'Kansas City, MO'     C         USCH3                       
ses13I              '               '     C         USCH2                       
ses13I              '               '     C         USCH3                       
12724 **            'Credit: Fujifilm Ser-C         USCH4                       
12724 **            'icol USA Inc.'                                             
14247I* CC27954     'Credit: FUJIFILM Ser-C         USCH4                       
14247I* CC27954     'icol U.S.A., Inc.'                                         
23256I              '/line '              C         $CRLF                       
27954I*ses13        'Credit: FUJIFILM Nor-C         USCH4                       
27954I*ses13        'th America Corp'                                           
12724I*ses13        'Acct#: 010100068446' C         USCH5                       
12724I*ses13        'Routing#: 0810-0003--C         USCH6                       
12724I*ses13        '2'                                                         
ses13I              '                    -C         USCH4                       
ses13I              '               '                                           
ses13I              '                   ' C         USCH5                       
ses13I              '                    -C         USCH6                       
ses13I              ' '                                                         
  |  I           IDS                                                            
  |  I                                        1 113 RRDATA                      
  |  I                                        1  10 R2SOQS                      
  |  I                                       15  16 RRUM                        
  |  I                                       20  34 HRUITM                      
  |  I                                       39  68 RRRDSC                      
  |  I                                       74  88 RRUPRC                      
  |  I                                       93 107 R2AEXP                      
  |  I                                      109 109 RRTX                        
  |  I           IDS                                                            
  |  I                                        1  96 RRTXT                       
  |  I                                        1   8 RPSP                        
  |  I                                        9  96 RPTXT                       
  |  I           IDS                                                            
  |  I                                        1 109 PRICE                       
  |  I                                       50  65 PPG1                        
  |  I                                       67  77 ISMCS1                      
  |  I           IDS                                                            
  |  I                                        1  20 POUND                       
  |  I                                        1  130GALPN1                      
  |  I                                       15  20 POUND1                      
  |  I           IDS                                                            
  |  I                                        1 109 DOTLN                       
  |  I                                       95 109 DOTLH                       
  |  I           IDS                                                            
  |  I                                        1 107 SLSTAX                      
  |  I                                       39  55 CANH                        
  |  I                                       70  78 STXHDH                      
  |  I                                       80  86 RRTRAH                      
  |  I                                       93 107 RR#ATH                      
  |  I           IDS                                                            
  |  I                                        1 107 PAY                         
  |  I                                       52  75 PAYBYH                      
  |  I                                       77  84 RR#DDH                      
  |  I                                       93 107 RR#ATR                      
      ***************************************************************           
      *    MAINLINE PROGRAM                                                     
      *    ----------------                                                     
      *                                                                         
      *    Process housekeeping.                                                
      *                                                                         
     C                     EXSR S999                                            
      *                    ---- ----                                            
23273C                     OPEN F55029L2               32                       
23273C                     OPEN F55029                 32                       
      *                                                                         
      *    If LR on, end program.                                               
      *                                                                         
     C           *INLR     CABEQ'1'       EOJ                                   
      *                    -----          ---                                   
      *                                                                         
      *    Load data field dictionary parameters.                               
      *                                                                         
     C                     EXSR S998                                            
      *                    ---- ----                                            
      *                                                                         
      *    If processing online, SETLL to specific record.                      
      *                                                                         
B1   C           ##MODE    IFEQ '1'                                             
B2   C           $$HIST    IFEQ 'N'                                             
      *                                                                         
B3   C           $4211     IFEQ 'A'                                             
     C           SDKYA3    SETLLI4211A                   81                     
X3   C                     ELSE                                                 
     C           SDKY0M    SETLLI4211M                   81                     
E3   C                     ENDIF                                                
      *                                                                         
X2   C                     ELSE                                                 
      *                                                                         
      *    Call to History File server.                                         
      *                                                                         
     C           PSFILE    IFEQ 'F49219  '                                      
     C           UDKY01    SETLLI49219A                9981                     
     C                     ELSE                                                 
B3   C           $4211     IFEQ 'A'                                             
     C                     MOVEL'SDK1A3  '@@KLST                                
X3   C                     ELSE                                                 
     C                     MOVEL'SDK1G3  '@@KLST                                
E3   C                     ENDIF                                                
      *                                                                         
     C                     MOVEL'A71     '@@FMT                                 
     C                     MOVE 'K'       @@ACCS                                
     C                     MOVEL'SETLL   '@@OPER                                
     C                     MOVE 'N'       @@LOCK                                
     C                     MOVE 'N'       @@CHGR                                
     C                     CALL 'XF42119 '                                      
      *                    ---- ----------                                      
     C                     PARM           PS@@1                                 
     C                     PARM           DS4211                                
     C                     ENDIF                                       9        
E2   C                     ENDIF                                       9        
E1   C                     ENDIF                                       9        
      *                                                                         
      *    Begin normal program processing.                                     
      *    --------------------------------                                     
      *                                                                         
B1   C           *INLR     DOWEQ'0'                                             
      *                                                                         
      *----------------------------------------------------------------         
      *    Detached adjustments processing                                      
      *                                                                         
B2   C           $$FRST    IFNE *BLANKS                                         
B3   C           SDASN     IFNE *BLANKS                                         
     C           $@ADV     ANDNE*BLANKS                                         
     C           $@IC      ANDNE'1'                                             
     C                     Z-ADDSDDOCO    #9DOCO                                
     C                     MOVELSDDCTO    #9DCTO                                
     C                     MOVELSDKCOO    #9KCOO                                
     C                     Z-ADDSDLNID    #9LNID                                
     C                     MOVE $@CNV     #9CNV                                 
     C                     MOVE $$CRYR    #9CRYR                                
     C                     MOVE $CDO      #9CDO                                 
     C                     MOVE $FDO      #9FDO                                 
DBN61C                     MOVELD42019    PS4201                                
     C                     MOVEL$$4211    PS4211                                
     C                     CALL 'X4074PA'                                       
      *                    ---- ---------                                       
     C                     PARM           DS#9                                  
     C                     PARM           PS4201                                
     C                     PARM           PS4211                                
      *                                                                         
B4   C           #9STS     IFNE 'EOF'                                           
     C           #9STS     ANDNE'ERR'                                           
     C                     MOVEL'Y'       $$DADJ  1                             
DBN  C                     MOVELPS4211    DS4211                                
     C                     MOVEL'N'       LFIVI                                 
      *                                                                         
      *  Set discount flag ($$CDSC is the parent line discount flag)            
      *   If parent is not discountable then adjustment isn't either            
      *   regardless of adjustment flag                                         
     C                     MOVEL$$CDSC    LFCDSC                                
     C           $$CDSC    IFEQ 'Y'                                             
     C           #9PA03    IFEQ '1'                                             
     C                     MOVEL'N'       LFCDSC                                
     C                     ENDIF                                                
     C                     ENDIF                                                
      *                                                                         
X4   C                     ELSE                                                 
     C                     CLEARDS#9                                            
     C                     MOVEL*BLANKS   $$DADJ                                
E4   C                     ENDIF                                                
      *                                                                         
X3   C                     ELSE                                                 
     C                     CLEARDS#9                                            
     C                     MOVEL*BLANKS   $$DADJ                                
E3   C                     ENDIF                                                
      *                                                                         
X2   C                     ELSE                                                 
     C                     CLEARDS#9                                            
     C                     MOVEL'N'       $$FRST  1                             
E2   C                     ENDIF                                                
      *                                                                         
      *----------------------------------------------------------------         
      *                                                                         
      *    Initialized record written flag                                      
      *                                                                         
     C                     MOVE *BLANKS   $$1REC  1                             
      *                                                                         
     C           $$DADJ    IFNE 'Y'                                             
      *                                                                         
      *    If processing by batch, and the Sales Detail                         
      *    file is specified as the Based-On file, read                         
      *    Physical file.                                                       
      *                                                                         
B2   C           ##MODE    IFEQ ' '                                             
      *                                                                         
B3   C           $$HIST    IFEQ 'N'                                             
B3   C           $@IC      ANDNE'1'                                             
     C           $CYCLE    ANDEQ' '                                             
S6042 * Only want one order at a time to process for Mexico                     
S6042C                     Z-ADDSDDOCO    WDOCO   80                            
 6042C                     MOVE SDMCU     WMCU   12                             
     C                     READ I4211                  99LR                     
S7312 *                                                                         
S7312C           *IN76     IFEQ *ON                        MEXICO               
S7312 *          @@CLNO    ANDGT40                                              
25920C           @@CLNO    ANDGT45                                              
S7312C           $$FRST    ANDNE*BLANKS                                         
S7312C           $$RCD     ANDGT1                                               
S7312C                     SETON                       LR                       
S7312C                     ENDIF                                                
S7312 *                                                                         
S6042 *                                                                         
S6042C           *IN76     IFEQ *ON                        MEXICO               
S6042C           SDDOCO    IFNE WDOCO                                           
S6042C           $$FRST    ANDNE*BLANKS                                         
S6042C           $$RCD     ANDGE1                                               
S6042C                     SETON                     LR                         
23256 * create TXT file and FTP to Solucion Factible                            
23256 * exclude SX orders (11.14.2011)                                          
23256 * execute based on OFF/ON switchs in UDC (11.15.2011)                     
23276 * moved UDC lookup to S999 (04.05.2012)                                   
      *                                                                         
23256 * USE - UDC 42 FS                                                         
23256C*                    MOVE *BLANKS   DRKY                                  
23256C*                    MOVE *BLANKS   $$USE                                 
23256C*                    MOVE '42  '    DRSY                                  
23256C*                    MOVE 'FS'      DRRT                                  
23256C*                    MOVEL'USE'     DRKY                                  
23256C*          DRKEY     CHAINF0005                31                         
23256C*          *IN31     IFEQ *OFF                                            
23256C*                    MOVELDRDL01    $$USE   3                             
23256C*                    ENDIF                                                
      *                                                                         
23271 * FTP - UDC 42 FS (02.14.2012)                                            
23271C*                    MOVE *BLANKS   DRKY                                  
23271C*                    MOVE *BLANKS   $$FTP                                 
23271C*                    MOVE '42  '    DRSY                                  
23271C*                    MOVE 'FS'      DRRT                                  
23271C*                    MOVEL'FTP'     DRKY                                  
23271C*          DRKEY     CHAINF0005                31                         
23271C*          *IN31     IFEQ *OFF                                            
23271C*                    MOVELDRDL01    $$FTP   3                             
23271C*                    ENDIF                                                
      *                                                                         
23256C           SDDCTO    IFNE 'SX'                                            
23256C           $$USE     ANDEQ'ON'                                            
23273C                     CLOSEF55029L2                                        
23273C                     CLOSEF55029                                          
      *                                                                         
23256C                     CALL 'J55029'                                        
23256 *                    ---- --------                                        
23256C                     PARM           W9FACT                                
23256C                     PARM           W9SERI                                
23271C                     PARM           $$FTP                                 
23256C                     ENDIF                                                
      *                                                                         
S6042C                     ENDIF                                                
S6042C           SDMCU     IFNE WMCU                                            
S6042C           $$FRST    ANDNE*BLANKS                                         
S6042C           $$RCD     ANDGE1                                               
S6042C                     SETON                     LR                         
S6042C                     ENDIF                                                
S6042C                     ENDIF                                                
S6042 *                                                                         
X3   C                     ELSE                                                 
      *                                                                         
      *    If processing by batch, and the Sales Detail                         
      *    Tag file is specified as the Based-On file, read                     
      *    the Join file.                                                       
      *                                                                         
B3   C           $$HIST    IFEQ 'N'                                             
B3   C           $@IC      ANDEQ'1'                                             
     C           $$HIST    OREQ 'N'                                             
     C           $CYCLE    ANDEQ'1'                                             
     C                     READ I49211J                99LR                     
     C           $CYCLE    IFEQ '1'                                             
     C           *INLR     ANDEQ'0'                                             
     C                     MOVE UDDOCO    SDDOCO                                
     C                     MOVE UDDCTO    SDDCTO                                
     C                     MOVE UDLNID    SDLNID                                
     C                     MOVE UDKCOO    SDKCOO                                
     C           SDKY0A    CHAINI4211A               9899                       
     C                     ENDIF                                                
      *                                                                         
      *   If interbranch invoice, the unit cost on F4211 is the price           
      *   to the selling branch.                                                
      *                                                                         
      *                                                                         
     C           SDUOM     IFNE SDUOM1                                          
      *                                                                         
      *    Read Item Master File                                                
      *                                                                         
     C                     MOVE *BLANKS   PS@@                                  
     C                     MOVELSDITM     KY@@                                  
     C                     CALL 'XS4101LA'                                      
      *                    ---- ----------                                      
     C                     PARM           PS@@                                  
     C                     PARM           DS4101                                
      *                                                                         
      *    Retrieve Branch Master.                                              
      *                                                                         
     C                     CLEARI4102                                           
     C           LFIVI     IFNE 'N'                                             
     C                     MOVE SDMCU     IBMCU                                 
     C                     Z-ADDSDITM     IBITM                                 
     C                     MOVEL'CHAIN'   @@OPER                                
     C                     MOVEL'IBKY01  '@@KLST                                
     C                     Z-ADD2         @@KNUM                                
     C                     MOVEL'A71'     @@FMT                                 
     C                     MOVE 'N'       @@LOCK                                
     C                     CALL 'XF4102 '                                       
      *                    ---- ---------                                       
     C                     PARM           PS@@1                                 
     C                     PARM           I4102                                 
     C                     END                                                  
      *                                                                         
     C                     EXSR S0042                                           
      *                    ---- -----                                           
      *                                                                         
     C                     Z-ADD1.0       #QTY                                  
     C                     MOVE SDUOM     #UOM                                  
     C                     MOVE SDUOM1    #UOM1                                 
     C                     MOVELSDMCU     #MCU                                  
     C                     MOVE LFIVI     #IVI                                  
     C                     MOVE SDCOMM    #READ                                 
     C                     MOVE *BLANKS   #OT1Y                                 
     C                     Z-ADD*ZEROS    #STDP                                 
     C                     MOVEL*BLANKS   #LOTN                                 
      *                                                                         
     C                     CALL 'X41002  '             98                       
      *                    ---- ----------                                      
     C                     PARM           DS4101                                
     C                     PARM           DS@UOM                                
      *                                                                         
B5   C           #ERTST    IFEQ '1'                                             
     C                     Z-ADD1         #CNVP                                 
     C                     Z-ADD1         #CNVQ                                 
E5   C                     ENDIF                                                
      *                                                                         
     C           SDUNCS    DIV  #CNVP     $WK299    H                           
     C                     MULT #PQT      $WK299    H                           
     C           $WK299    MULT #@FDO     $WK150    H                           
     C                     MOVEL$WK150    SDUNCS                                
     C                     ENDIF                                                
      *                                                                         
     C           $@IC      IFEQ '1'                                             
     C           $@CNV     IFEQ '1'                                             
     C                     Z-ADDSDUNCS    SDFUP                                 
     C                     Z-ADDSDECST    SDFEA                                 
     C           UDCRR     IFEQ *ZERO                                           
     C                     Z-ADD1         UDCRR                                 
     C                     ENDIF                                                
B2   C           $@CNV     IFEQ '1'                                             
     C           $@CURR    ANDEQ' '                                             
     C           SDFUP     DIV  #@UNCS    $WFUP  299H                           
B3   C           $$CRYR    IFEQ 'Y'                                             
     C           $WFUP     DIV  UDCRR     $WFUP     H                           
E3   C                     ENDIF                                                
B3   C           $$CRYR    IFEQ 'Z'                                             
     C           $WFUP     MULT UDCRR     $WFUP     H                           
     C                     ENDIF                                                
     C           SDSOBK    DIV  #@SOBK    $WSOBK 299H                           
     C           SDSOQS    DIV  #@SOQS    $WSOQS 299H                           
     C           $WSOBK    ADD  $WSOQS    $WQTY  299                            
     C           $WFUP     MULT $WQTY     $WFEA  299H                           
     C                     MOVE *BLANKS   PS@@                                  
     C                     MOVEL$CDO      $ICDO   1                             
     C                     MOVELUDCRCD    KY@@                                  
     C                     CALL 'XS0013'               81                       
      *                    ---- --------                                        
     C                     PARM           PS@@                                  
     C                     PARM           DS0013                                
B3   C           RT@@      IFNE 'N'                                             
     C           CVCDEC    ANDNE*BLANK                                          
     C                     MOVE CVCDEC    $CDO    1                             
E3   C                     ENDIF                                                
     C                     Z-ADD1         #@CDO  110                            
     C                     MOVE $CDO      #A                                    
B2   C                     DO   #A                                              
     C                     MULT 10        #@CDO                                 
E2   C                     ENDDO                                                
     C           SDRLIT    IFEQ *BLANKS                                         
     C           $WFEA     MULT #@CDO     SDAEXP    H                           
     C                     ENDIF                                                
     C           $WFUP     MULT #@UNCS    SDUPRC    H                           
     C                     ELSE                                                 
     C           #@FDO     IFNE *ZEROS                                          
     C           SDFUP     DIV  #@FDO     SDFUP                                 
     C                     ENDIF                                                
     C                     ENDIF                                                
      *                                                                         
      *  CURRENCY NOT ON                                                        
     C                     ELSE                                                 
     C                     Z-ADDSDUNCS    SDUPRC                                
     C                     Z-ADDSDECST    SDAEXP                                
     C                     ENDIF                                                
      *                                                                         
     C                     Z-ADDUDCRR     SDCRR                                 
     C                     Z-ADDUDIAN8    SDAN8                                 
     C                     Z-ADDUDIAN8    SHAN8                                 
     C                     MOVE UDPTC     SDPTC                                 
     C                     MOVE CCCRCD    SDCRCD                                
     C                     MOVE UDTXA1    SDTXA1                                
     C                     MOVE UDEXR1    SDEXR1                                
      *                                                                         
      *  Tax codes are reset to blanks because inter-branch tax                 
      *    is not going to be calculated at this time.  Future change.          
     C                     MOVE *BLANKS   SDTXA1                                
     C                     MOVE *BLANKS   SDEXR1                                
      *                                                                         
     C                     ENDIF                                                
X3   C                     ELSE                                                 
      *                                                                         
      *    If processing by batch, and the Sales History                        
      *    file is specified as the Based-On file, read                         
      *    F42119 file.                                                         
      *                                                                         
      *    Call to History File server.                                         
      *                                                                         
     C           PSFILE    IFEQ 'F49219  '                                      
     C                     READ I49219A                99LR                     
     C                     MOVELUDDOCO    SDDOCO                                
     C                     MOVELUDDCTO    SDDCTO                                
     C                     MOVELUDKCOO    SDKCOO                                
     C                     MOVELUDLNID    SDLNID                                
     C                     MOVEL'A71     '@@FMT                                 
     C                     MOVE 'K'       @@ACCS                                
     C                     MOVEL'CHAIN   '@@OPER                                
     C                     MOVE 'N'       @@LOCK                                
     C                     MOVE 'N'       @@CHGR                                
     C                     MOVEL'SDK1A4  '@@KLST                                
     C                     Z-ADD4         @@KNUM                                
     C                     CALL 'XF42119 '             81                       
      *                    ---- ----------                                      
     C                     PARM           PS@@1                                 
     C                     PARM           DS4211                                
      *                                                                         
      *   If interbranch invoice, the unit cost on F4211 is the price           
      *   to the selling branch.                                                
      *                                                                         
      *                                                                         
     C           SDUOM     IFNE SDUOM1                                          
     C                     Z-ADD1.0       #QTY                                  
     C                     MOVE SDUOM     #UOM                                  
     C                     MOVE SDUOM1    #UOM1                                 
     C                     MOVELSDMCU     #MCU                                  
     C                     MOVE LFIVI     #IVI                                  
     C                     MOVE SDCOMM    #READ                                 
     C                     MOVE *BLANKS   #OT1Y                                 
     C                     Z-ADD*ZEROS    #STDP                                 
     C                     MOVEL*BLANKS   #LOTN                                 
      *                                                                         
     C                     CALL 'X41002  '             98                       
      *                    ---- ----------                                      
     C                     PARM           DS4101                                
     C                     PARM           DS@UOM                                
      *                                                                         
B5   C           #ERTST    IFEQ '1'                                             
     C                     Z-ADD1         #CNVP                                 
     C                     Z-ADD1         #CNVQ                                 
E5   C                     ENDIF                                                
      *                                                                         
     C           SDUNCS    DIV  #CNVP     $WK299    H                           
     C                     MULT #PQT      $WK299    H                           
     C           $WK299    MULT #@FDO     $WK150    H                           
     C                     MOVEL$WK150    SDUNCS                                
     C                     ENDIF                                                
      *                                                                         
     C           $@IC      IFEQ '1'                                             
     C           $@CNV     IFEQ '1'                                             
     C                     Z-ADDSDUNCS    SDFUP                                 
     C                     Z-ADDSDECST    SDFEA                                 
     C           UDCRR     IFEQ *ZERO                                           
     C                     Z-ADD1         UDCRR                                 
     C                     ENDIF                                                
B2   C           $@CNV     IFEQ '1'                                             
     C           $@CURR    ANDEQ' '                                             
     C           SDFUP     DIV  #@UNCS    $WFUP  299H                           
B3   C           $$CRYR    IFEQ 'Y'                                             
     C           $WFUP     DIV  UDCRR     $WFUP     H                           
E3   C                     ENDIF                                                
B3   C           $$CRYR    IFEQ 'Z'                                             
     C           $WFUP     MULT UDCRR     $WFUP     H                           
     C                     ENDIF                                                
     C           SDSOBK    DIV  #@SOBK    $WSOBK 299H                           
     C           SDSOQS    DIV  #@SOQS    $WSOQS 299H                           
     C           $WSOBK    ADD  $WSOQS    $WQTY  299                            
     C           $WFUP     MULT $WQTY     $WFEA  299H                           
     C                     MOVE *BLANKS   PS@@                                  
     C                     MOVEL$CDO      $ICDO   1                             
     C                     MOVELUDCRCD    KY@@                                  
     C                     CALL 'XS0013'               81                       
      *                    ---- --------                                        
     C                     PARM           PS@@                                  
     C                     PARM           DS0013                                
B3   C           RT@@      IFNE 'N'                                             
     C           CVCDEC    ANDNE*BLANK                                          
     C                     MOVE CVCDEC    $CDO    1                             
E3   C                     ENDIF                                                
     C                     Z-ADD1         #@CDO  110                            
     C                     MOVE $CDO      #A                                    
B2   C                     DO   #A                                              
     C                     MULT 10        #@CDO                                 
E2   C                     ENDDO                                                
     C           SDRLIT    IFEQ *BLANKS                                         
     C           $WFEA     MULT #@CDO     SDAEXP    H                           
     C                     ENDIF                                                
     C           $WFUP     MULT #@UNCS    SDUPRC    H                           
     C                     ELSE                                                 
     C           #@FDO     IFNE *ZEROS                                          
     C           SDFUP     DIV  #@FDO     SDFUP                                 
     C                     ENDIF                                                
     C                     ENDIF                                                
      *                                                                         
      * CURRENCY IS OFF                                                         
     C                     ELSE                                                 
     C                     Z-ADDSDUNCS    SDUPRC                                
     C                     Z-ADDSDECST    SDAEXP                                
     C                     ENDIF                                                
      *                                                                         
     C                     Z-ADDUDCRR     SDCRR                                 
     C                     Z-ADDUDIAN8    SDAN8                                 
     C                     Z-ADDUDIAN8    SHAN8                                 
     C                     MOVE UDPTC     SDPTC                                 
     C                     MOVE CCCRCD    SDCRCD                                
     C                     MOVE UDTXA1    SDTXA1                                
     C                     MOVE UDEXR1    SDEXR1                                
      *                                                                         
      *  Tax codes are reset to blanks because inter-branch tax                 
      *    is not going to be calculated at this time.  Future change.          
     C                     MOVE *BLANKS   SDTXA1                                
     C                     MOVE *BLANKS   SDEXR1                                
      *                                                                         
     C                     ENDIF                                                
     C                     ELSE                                                 
     C                     MOVEL'A71     '@@FMT                                 
     C                     MOVE 'R'       @@ACCS                                
     C                     MOVEL'READ    '@@OPER                                
     C                     MOVE 'N'       @@LOCK                                
     C                     MOVE 'N'       @@CHGR                                
     C                     MOVEL*BLANKS   @@KLST                                
     C                     CALL 'XF42119 '                                      
      *                    ---- ----------                                      
     C                     PARM           PS@@1                                 
     C                     PARM           DS4211                                
      *                                                                         
      *    Set indicators based on I/O file server return value.                
      *                                                                         
B4   C           @@IOR     IFEQ 'EOF'                                           
     C                     SETON                     LR                         
E4   C                     ENDIF                                                
      *                                                                         
B4   C           @@IOR     IFEQ 'RL '                                           
     C                     SETON                     99                         
E4   C                     ENDIF                                                
      *                                                                         
B4   C           @@ERR     IFNE *BLANKS                                         
     C                     SETON                     99                         
E4   C                     ENDIF                                                
      *                                                                         
     C                     ENDIF                                       9        
E3   C                     ENDIF                                       9        
E3   C                     ENDIF                                       9        
E2   C                     ENDIF                                       9        
      *                                                                         
B2   C           ##MODE    IFEQ '1'                                             
      *                                                                         
      *    If processing online, READE to specific record.                      
      *                                                                         
B3   C           $$HIST    IFEQ 'N'                                             
      *                                                                         
     C           INV       TAG                                                  
B4   C           $4211     IFEQ 'A'                                             
     C           SDKYA3    READEI4211A                 99LR                     
X4   C                     ELSE                                                 
     C           SDKY0M    READEI4211M                 99LR                     
E4   C                     ENDIF                                                
     C           $IDOC     IFEQ *BLANKS                                         
     C           SDDOC     ANDNE*ZEROS                                          
     C           *IN99     ANDEQ'0'                                             
     C           *INLR     ANDEQ'0'                                             
     C                     GOTO INV                                             
S5599C                     ELSE                                                 
S5599C                     MOVE SDMCU     $#MCU                                 
     C                     ENDIF                                                
      *                                                                         
X3   C                     ELSE                                                 
      *                                                                         
      *    Call to History File server.                                         
      *                                                                         
     C           PSFILE    IFEQ 'F49219  '                                      
     C           UDKY01    READEI49219A                  90                     
     C                     MOVELUDDOCO    SDDOCO                                
     C                     MOVELUDDCTO    SDDCTO                                
     C                     MOVELUDKCOO    SDKCOO                                
     C                     MOVELUDLNID    SDLNID                                
     C                     MOVEL'A71     '@@FMT                                 
     C                     MOVE 'K'       @@ACCS                                
     C                     MOVEL'CHAIN   '@@OPER                                
     C                     MOVE 'N'       @@LOCK                                
     C                     MOVE 'N'       @@CHGR                                
     C                     MOVEL'SDK1A4  '@@KLST                                
     C                     Z-ADD4         @@KNUM                                
     C                     CALL 'XF42119 '             81                       
      *                    ---- ----------                                      
     C                     PARM           PS@@1                                 
     C                     PARM           DS4211                                
     C                     ELSE                                                 
B4   C           $4211     IFEQ 'A'                                             
     C                     MOVEL'SDK1A3  '@@KLST                                
X4   C                     ELSE                                                 
     C                     MOVEL'SDK1G3  '@@KLST                                
E4   C                     ENDIF                                                
      *                                                                         
     C                     MOVEL'A71     '@@FMT                                 
     C                     MOVE 'K'       @@ACCS                                
     C                     MOVEL'READE   '@@OPER                                
     C                     MOVE 'N'       @@LOCK                                
     C                     MOVE 'N'       @@CHGR                                
     C                     CALL 'XF42119 '                                      
      *                                                                         
     C                     PARM           PS@@1                                 
     C                     PARM           DS4211                                
      *                                                                         
      *    Set indicators based on I/O file server return value.                
      *                                                                         
B4   C           @@IOR     IFEQ 'EOK'                                           
     C                     SETON                     LR                         
E4   C                     ENDIF                                                
      *                                                                         
B4   C           @@IOR     IFEQ 'RL '                                           
     C                     SETON                     99                         
E4   C                     ENDIF                                                
      *                                                                         
B4   C           @@ERR     IFNE *BLANKS                                         
     C                     SETON                     99                         
E4   C                     ENDIF                                                
      *                                                                         
     C                     ENDIF                                       9        
E3   C                     ENDIF                                       9        
E2   C                     ENDIF                                       9        
      *                                                                         
      *    Receive parameters, if processing by subsystem.                      
      *                                                                         
B2   C           ##MODE    IFEQ '2'                                             
     C           $$SETL    ANDEQ*BLANKS                                         
     C                     EXSR S000                                            
      *                    ---- ----                                            
     C           *INLR     CABEQ'1'       EOJ                                   
      *                    -----          ---                                   
     C                     MOVE '1'       $$SETL                                
     C                     MOVE $WDCTO    SDDCTO                                
     C                     MOVE $WSFXO    SDSFXO                                
     C                     MOVE $WKCOO    SDKCOO                                
     C           SDKYA3    SETLLI4211A                   81                     
E2   C                     ENDIF                                                
      *                                                                         
      *    Read logical file if processing interactively.                       
      *                                                                         
B2   C           ##MODE    IFEQ '2'                                             
     C           SDKYA3    READEI4211A                 99LR                     
      *                                                                         
      *    Set off indicators if running in subsystem mode.                     
      *                                                                         
B3   C           *IN99     IFEQ '1'                                             
     C           *INLR     OREQ '1'                                             
     C                     SETOF                     99                         
     C                     MOVE *BLANKS   $$SETL  1                             
     C                     MOVE *BLANKS   $$FSP   1                             
E3   C                     ENDIF                                                
E2   C                     ENDIF                                                
      *                                                                         
     C                     ENDIF                           DETACH ADJ           
     C                     MOVE *BLANKS   $FOR    1                             
     C           $@CURR    IFEQ '1'                                             
     C           SDFUP     ANDEQ*ZEROS                                          
     C                     Z-ADDSDUPRC    SDFUP                                 
     C                     Z-ADDSDAEXP    SDFEA                                 
     C                     MOVE '1'       $FOR    1                             
     C                     ENDIF                                                
      *                                                                         
      *                                                                         
      *    If data file read error, end program.                                
      *                                                                         
     C           *IN99     CABEQ'1'       EOJ                                   
      *                    -----          ---                                   
      *                                                                         
B2   C           *INLR     IFEQ '0'                                             
      *                                                                         
     C           $$DADJ    IFNE 'Y'                                             
      *                                                                         
      *    Save the F4211 image                                                 
DBN18C                     MOVELDS4211    $$4211                                
      *                                                                         
      *    Cost Center Security Edit.                                           
      *                                                                         
     C                     MOVEL'F4201   '#FILE                                 
     C                     MOVELSDMCU     #MCU                                  
B3   C           #AUT      IFNE '1'                                             
     C           #FAUT     ANDNE'1'                                             
     C                     EXSR C0000                                           
      *                    ---- -----                                           
E3   C                     ENDIF                                                
B3   C           #AUT      IFNE '1'                                             
     C           #FAUT     ANDNE'1'                                             
     C           #MAUT     ANDNE'1'                                             
     C                     GOTO END                                             
      *                    ---- ---                                             
E3   C                     ENDIF                                                
      *                                                                         
     C           $@SUMZ    IFEQ *BLANKS                                         
     C           SHDOCO    IFNE *ZERO                                           
     C           $$READ    ANDEQ'1'                                             
     C                     MOVELSHDOCO    $PDOCO                                
     C                     MOVELSHDCTO    $PDCTO                                
     C                     MOVELSHKCOO    $PKCOO                                
     C                     MOVEL*BLANKS   $$READ  1                             
     C                     ENDIF                                                
     C                     MOVELSHINMG    SVINMG                                
     C                     ENDIF                                                
      *                                                                         
     C                     MOVE SDDOCO    SHDOCO                                
     C                     MOVE SDDCTO    SHDCTO                                
     C                     MOVE SDKCOO    SHKCOO                                
      *                                                                         
      *    Read F4201 for heading information first. If no records are          
      *    found, read the History file for the heading information.            
      *                                                                         
     C           SHKY0A    CHAINI4201A               9899                       
     C           $@IC      IFEQ '1'                                             
     C                     Z-ADDUDIAN8    SHAN8                                 
     C                     MOVELSHCO      KY@@                                  
     C                     CALL 'XS0010'               81                       
      *                    ---- --------                                        
     C                     PARM           PS@@                                  
     C                     PARM           DS0010                                
     C                     MOVELCCCRCD    SDCRCD                                
     C                     ENDIF                                                
      *                                                                         
      *    Retrieve Sales History Header from F42019 if the Based-              
      *    On file is the History file (F42119). ('$$HIST'='Y')                 
      *                                                                         
B3   C           *IN98     IFEQ '1'                                             
     C           $$HIST    ANDEQ'Y'                                             
     C                     SETOF                       98                       
     C                     MOVEL'A61     '@@FMT                                 
     C                     MOVE 'K'       @@ACCS                                
     C                     MOVEL'CHAIN   '@@OPER                                
     C                     MOVE 'N'       @@LOCK                                
     C                     MOVE 'N'       @@CHGR                                
     C                     MOVEL'SHK1A3  '@@KLST                                
     C                     Z-ADD3         @@KNUM                                
     C                     CALL 'XF42019 '                                      
      *                    ---- ----------                                      
     C                     PARM           PS@@1                                 
     C                     PARM           D42019                                
      *                                                                         
      *    Set indicators based on I/O file server return value.                
      *                                                                         
B4   C           @@IOR     IFEQ 'NF '                                           
     C                     SETON                     98                         
E4   C                     ENDIF                                                
      *                                                                         
B4   C           @@IOR     IFEQ 'RL '                                           
     C                     SETON                     99                         
E4   C                     ENDIF                                                
      *                                                                         
B4   C           @@ERR     IFNE *BLANKS                                         
     C                     SETON                     98                         
E4   C                     ENDIF                                                
      *                                                                         
E3   C                     ENDIF                                                
      *                                                                         
      *    Bypass if not found or on order hold.                                
      *                                                                         
B3   C           *IN98     IFEQ '1'                                             
     C           *IN99     OREQ '1'                                             
     C           *IN98     OREQ '0'                                             
     C           *IN99     ANDEQ'0'                                             
     C           SHHOLD    ANDNE*BLANKS                                         
     C                     GOTO END                                             
      *                    ---- ---                                             
E3   C                     ENDIF                                                
      *                                                                         
      *   HAZOX                                                                 
      *                                                                         
     C           $@SPPI    IFEQ '1'                                             
     C                     CLEARDSDISP                                          
     C                     MOVEL'42  '    #HSY                                  
     C                     Z-ADDSHSHAN    #HSHAN                                
DBN  C                     MOVELDS4211    PS@@5                                 
     C                     CALL 'X73DISP'              99                       
      *                    ---- ---------                                       
     C                     PARM           PS@@5                                 
     C                     PARM           DSDISP                                
     C                     ENDIF                                                
      *                                                                         
B3   C           ##MODE    IFEQ '1'                                             
     C           ##MODE    OREQ '2'                                             
     C                     MOVE '1'       $4211A  1                             
     C                     MOVE *BLANKS   $TPID                                 
     C                     MOVE *BLANKS   $TVERS                                
      *                                                                         
      *    Call inventory commit program if processing option was               
      *    set to hard commit inventory.                                        
      *                                                                         
      *    NOTE:  Only run commitments for Detail (F4211) quantities.           
      *           Quantities for History lines (F42119) are not to be           
      *           committed again.                                              
      *                                                                         
B4   C           $$HIST    IFNE 'Y'                                             
     C           $@COMM    ANDEQ'1'                                             
      *                                                                         
B5   C           SDDOCO    IFNE SVDOCO                                          
     C           SDDCTO    ORNE SVDCTO                                          
     C           SDKCOO    ORNE SVKCOO                                          
      *                                                                         
     C                     EXCPTU4211A                                          
      *                    -----------                                          
     C                     MOVE '0'       $4211A                                
      *                                                                         
      *    Call program to commit inventory for this order                      
      *                                                                         
     C                     MOVE SDDOCO    $TDOCO                                
     C                     MOVE SDDCTO    $TDCTO                                
     C                     MOVE SDKCOO    $TKCOO                                
     C                     MOVE *BLANK    $TLNID                                
      *                                                                         
     C                     MOVEL$@PREF    #PREF                                 
     C                     MOVEL$@COMM    #HC                                   
     C                     MOVEL'Y'       #AVAIL                                
     C                     MOVEL'3'       #EDIT                                 
      *                                                                         
     C                     CALL 'P42997'               98                       
      *                    ---- --------                                        
     C                     PARM 'P42997  '$TPID  10                             
     C                     PARM 'XJDE0001'$TVERS 10                             
     C                     PARM '1'       $TMODE  1                             
     C                     PARM *BLANKS   $TLIB  10                             
     C                     PARM *BLANKS   $TQTXT 30                             
     C                     PARM           $TDOCO  8                             
     C                     PARM           $TDCTO  2                             
     C                     PARM           $TKCOO  5                             
     C                     PARM           $TLNID  6                             
     C                     PARM           G40300                                
      *                                                                         
      *    Save the key fields                                                  
      *                                                                         
     C                     MOVE SDDOCO    SVDOCO                                
     C                     MOVE SDDCTO    SVDCTO                                
     C                     MOVE SDKCOO    SVKCOO                                
     C                     MOVE SDLNID    SVLNID                                
E5   C                     ENDIF                                                
E4   C                     ENDIF                                                
      *                                                                         
B4   C           $$HIST    IFNE 'Y'                                             
     C           $@UDT     ANDEQ'1'                                             
      *                                                                         
B5   C           $4211A    IFEQ '1'                                             
     C                     EXCPTU4211A                                          
      *                    -----------                                          
     C                     MOVE '0'       $4211A                                
E5   C                     ENDIF                                                
      *                                                                         
      *    Call Sales Cost Update program if specified.                         
      *                                                                         
     C                     MOVE SDDOCO    $TDOCO                                
     C                     MOVE SDDCTO    $TDCTO                                
     C                     MOVE SDKCOO    $TKCOO                                
     C                     MOVE SDLNID    $TLNID                                
     C                     MOVEL@OP,6     $TOPT6                                
     C                     MOVEL@OP,9     $TOPT9                                
      *                                                                         
     C                     CALL 'P42950'               98                       
      *                    ---- --------                                        
     C                     PARM 'P42950  '$TPID  10                             
     C                     PARM $@UVER    $TVERS 10                             
     C                     PARM           $TDOCO  8                             
     C                     PARM           $TDCTO  2                             
     C                     PARM           $TKCOO  5                             
     C                     PARM           $TLNID  6                             
     C                     PARM           $TOPT6 25                             
     C                     PARM           $TOPT9 25                             
E4   C                     ENDIF                                                
      *                                                                         
      *    Retrieve record if unlocked before.                                  
      *                                                                         
B4   C           $4211A    IFEQ '0'                                             
     C           SDKY0A    CHAINI4211A               9899                       
E4   C                     ENDIF                                                
E3   C                     ENDIF                                                
      *                                                                         
      *    Read Line Type Constants                                             
      *                                                                         
     C                     MOVE ' '       LFTXYN                                
     C                     MOVE *BLANKS   PS@@                                  
     C                     MOVELSDLNTY    KY@@                                  
     C                     CALL 'XS40205'                                       
      *                    ---- ---------                                       
     C                     PARM           PS@@                                  
     C                     PARM           DS4020                                
      *                                                                         
     C                     MOVELLFCDSC    $$CDSC                                
      *                                                                         
     C           RT@@      CABEQ'N'       SKIP                                  
      *                    -----          ----                                  
      *                                                                         
     C                     ENDIF                           DETACH ADJ           
      *                                                                         
      *    If quantity shipped is not zero or text line, select                 
      *    record.                                                              
      *                                                                         
B3   C           SDSOQS    IFNE *ZEROS                                          
     C           SDSONE    ANDEQ*ZEROS                                          
     C           LFTXYN    OREQ 'Y'                                             
     C           SDUORG    OREQ *ZEROS                                          
     C           LFIVI     ANDEQ'N'                                             
      *                                                                         
      *    Check Last Status to see if the order is within the                  
      *    specified rnage.                                                     
      *                                                                         
B4   C           $I#STB    IFEQ '1'                                             
B5   C           SDLTTR    IFLT $@STF                                           
     C           SDLTTR    ORGT $@STT                                           
     C                     GOTO END                                             
      *                    ---- ---                                             
E5   C                     ENDIF                                                
      *                                                                         
      *    Check Next Status to see if the order is within the                  
      *    specified range.                                                     
      *                                                                         
X4   C                     ELSE                                                 
B5   C           SDNXTR    IFLT $@STF                                           
     C           SDNXTR    ORGT $@STT                                           
     C                     GOTO END                                             
      *                    ---- ---                                             
E5   C                     ENDIF                                                
E4   C                     ENDIF                                                
      *                                                                         
X3   C                     ELSE                                                 
      *                                                                         
B4   C           SDSOBK    IFNE *ZERO                                           
     C           SDSOCN    ORNE *ZERO                                           
     C           SDSOBK    OREQ *ZEROS                                          
     C           SDSOCN    ANDEQ*ZEROS                                          
     C           SDUORG    ANDEQ*ZEROS                                          
     C           SDSOQS    ANDEQ*ZEROS                                          
     C           SDSONE    ANDEQ*ZEROS                                          
     C           SDUOPN    ANDEQ*ZEROS                                          
     C           SDNXTR    ANDEQ'999'                                           
      *                                                                         
      *    Bypass if neither is to be printed.                                  
      *                                                                         
B5   C           $@BOCN    IFEQ '4'                                             
     C                     GOTO END                                             
      *                    ---- ---                                             
E5   C                     ENDIF                                                
      *                                                                         
     C                     MOVE '0'       $SEL    1                             
      *                                                                         
      *    Print cancelled lines                                                
      *                                                                         
B5   C           $@BOCN    IFNE '1'                                             
     C           SDSOCN    ANDNE*ZEROS                                          
     C           $@BOCN    ORNE '1'                                             
     C           SDSOBK    ANDEQ*ZEROS                                          
     C           SDSOCN    ANDEQ*ZEROS                                          
     C           SDUORG    ANDEQ*ZEROS                                          
     C           SDSOQS    ANDEQ*ZEROS                                          
     C           SDSONE    ANDEQ*ZEROS                                          
     C           SDUOPN    ANDEQ*ZEROS                                          
     C           SDNXTR    ANDEQ'999'                                           
     C                     MOVE '1'       $SEL                                  
E5   C                     ENDIF                                                
      *                                                                         
      *    Print backordered lines                                              
      *                                                                         
B5   C           $@BOCN    IFNE '2'                                             
     C           SDSOBK    ANDNE*ZEROS                                          
     C                     MOVE '1'       $SEL                                  
E5   C                     ENDIF                                                
      *                                                                         
     C           $SEL      CABEQ'0'       END                                   
      *                    -----          ---                                   
      *                                                                         
      *    Print backordered and cancelled lines only once                      
      *                                                                         
B5   C           $@BCPT    IFEQ '1'                                             
     C           SDRESL    ANDEQ'1'                                             
     C                     GOTO END                                             
      *                    ---- ---                                             
E5   C                     ENDIF                                                
      *                                                                         
E4   C                     ENDIF                                                
E3   C                     ENDIF                                                
      *                                                                         
      *    Do not print future commited inventory                               
      *                                                                         
B3   C           $@FTCM    IFEQ *BLANKS                                         
     C           SDSONE    ANDNE*ZERO                                           
     C                     GOTO END                                             
      *                    ---- ---                                             
E3   C                     ENDIF                                                
E2   C                     ENDIF                                                
      *                                                                         
      *    Good detail read                                                     
     C                     MOVEL'1'       $$READ                                
      *                                                                         
      *    Check for report level break.                                        
      *                                                                         
      *                    MOVE $$SDOC    SDDOC                                 
B2   C           $LVLB     CASEQ' '       S002                                  
      *                    -----          ----                                  
E2   C                     ENDCS                                                
     C           $@IC      IFEQ '1'                                             
     C                     MOVE UDDOC     SDDOC                                 
     C                     MOVE UDDCT     SDDCT                                 
     C                     MOVE UDKCO     SDKCO                                 
     C                     ENDIF                                                
      *                                                                         
     C                     MOVE '1'       $PTC    1                             
      *                                                                         
      *    If first time through -                                              
      *    reset break flags & process report level break routine               
      *                                                                         
B2   C           $#DOCO    IFEQ *ZERO                                           
     C                     MOVE '1'       #A                                    
     C                     MOVEA*BLANKS   @$L                                   
     C                     MOVE '1'       $$PAGE                                
     C                     Z-ADD0         $$L                                   
     C                     MOVE '1'       *IN02                                 
     C                     MOVE '0'       *IN03                                 
     C                     MOVE ' '       $PFLAG                                
     C                     MOVE ' '       $HFLAG                                
     C                     MOVE ' '       $ATHR   1                             
     C                     MOVE ' '       $PTC                                  
     C                     Z-ADDSDDOC     $#DOC                                 
     C                     MOVELSDDCT     $#DCT                                 
     C                     MOVELSDKCO     $#KCO                                 
     C                     EXSR S010B                                           
      *                    ---- -----                                           
E2   C                     ENDIF                                                
      *                                                                         
      *    If errors found in the heading -                                     
      *    bypass remaining logic.                                              
      *                                                                         
B2   C           $#DOCO    IFEQ *ZERO                                           
     C                     GOTO SKIP1                                           
      *                    ---- -----                                           
E2   C                     ENDIF                                                
      *----------------------------------------------------------------         
      *                                                                         
      *    Summarize detail lines                                               
      *                                                                         
B2   C           $@SUMZ    IFNE *BLANK                                          
      *                                                                         
      *    If end of file or text line, set on flags.                           
      *                                                                         
B3   C           *INLR     IFEQ '1'                                             
     C                     MOVE '1'       $$FITM                                
     C                     MOVE '1'       $$LNID                                
     C                     MOVE '1'       $$TOT                                 
X3   C                     ELSE                                                 
      *                                                                         
      *    If item summary requested -                                          
      *    check if a break in item or price                                    
      *                                                                         
     C                     MOVE ' '       $$FITM  1                             
B4   C           $@SUMZ    IFEQ '1'                                             
     C           $SLITM    IFEQ *BLANKS                                         
     C           $$RCD     ANDNE*ZEROS                                          
     C           SDLNTY    IFNE $SLNTY                                          
     C                     MOVE '1'       $$FITM                                
     C                     ELSE                                                 
     C           SDUPRC    IFNE $SUPRC                                          
     C           SDUOM     ORNE $SUOM                                           
     C                     MOVE '1'       $$FITM                                
     C                     END                                                  
     C                     END                                                  
     C                     END                                                  
B5   C           $SLITM    IFEQ *BLANKS                                         
     C           $$RCD     OREQ 0                                               
     C                     MOVE SDLITM    $SLITM                                
     C                     MOVE SDUPRC    $SUPRC                                
     C                     MOVE SDUOM     $SUOM                                 
     C                     MOVE SDLNTY    $SLNTY                                
E5   C                     ENDIF                                                
B5   C           $SLITM    IFNE SDLITM                                          
     C           $SUPRC    ORNE SDUPRC                                          
     C           $SUOM     ORNE SDUOM                                           
     C           $SLNTY    ORNE SDLNTY                                          
     C           LFTXYN    OREQ 'Y'                                             
     C                     MOVE '1'       $$FITM                                
E5   C                     ENDIF                                                
E4   C                     ENDIF                                                
      *                                                                         
      *    If summarizing by whole line numbers -                               
      *    check if a change in line number                                     
      *                                                                         
     C                     MOVE ' '       $$LNID  1                             
B4   C           $@SUMZ    IFEQ '2'                                             
     C           SDLNID    DIV  #@LNID    $LNID   70                            
     C                     MVR            $$REM  150                            
B5   C           $SLNID    IFEQ *ZEROS                                          
     C           $$RCD     OREQ 0                                               
     C                     MOVE $LNID     $SLNID  70                            
E5   C                     ENDIF                                                
      *                                                                         
B5   C           $SLNID    IFNE $LNID                                           
     C                     MOVE '1'       $$LNID                                
E5   C                     ENDIF                                                
      *                                                                         
B5   C           LFTXYN    IFEQ 'Y'                                             
     C                     MOVE '1'       $$LNID                                
     C                     Z-ADD*ZERO     $$REM                                 
E5   C                     ENDIF                                                
      *                                                                         
B5   C           $$RCD     IFGT 0                                               
B6   C           SDDOCO    IFNE $#DOCO                                          
     C           SDDCTO    ORNE $#DCTO                                          
     C           SDKCOO    ORNE $#KCOO                                          
S5599C           SDMCU     ORNE $#MCU                                           
     C           SDDOC     ORNE $#DOC                                           
     C           SDDCT     ORNE $#DCT                                           
     C           SDKCO     ORNE $#KCO                                           
     C                     MOVE '1'       $$LNID                                
E6   C                     ENDIF                                                
E5   C                     ENDIF                                                
      *                                                                         
E4   C                     ENDIF                                                
E3   C                     ENDIF                                                
E2   C                     ENDIF                                                
      *                                                                         
      *    If Item or Line summary -                                            
      *                                                                         
B2   C           $@SUMZ    IFNE *BLANK                                          
      *                                                                         
      *    If Address Book Changes,                                             
      *    set total, item, line, and page flags.                               
      *                                                                         
B3   C           SDAN8     IFNE $#AN8                                           
     C           SDCRCD    ORNE $#CRCD                                          
S5599C           SDMCU     ORNE $#MCU                                           
     C                     MOVE '1'       $$FITM                                
     C                     MOVE '1'       $$LNID                                
     C                     MOVE '1'       $$TOT                                 
     C                     MOVE '1'       $$PAGE                                
B4   C           $5ICON    IFEQ 'Y'                                             
     C                     MOVE ' '       $PTC                                  
     C                     Z-ADD$#PG      ##PGSV  40                            
     C                     Z-ADD*ZEROS    $#PG                                  
E4   C                     ENDIF                                                
E3   C                     ENDIF                                                
      *                                                                         
      *    If no consolidation requested, but order number changes              
      *    set total, item, line, and page flags.                               
      *                                                                         
B3   C           $5ICON    IFNE 'Y'                                             
B4   C           SDDOCO    IFNE $#DOCO                                          
     C           SDDCTO    ORNE $#DCTO                                          
     C           SDKCOO    ORNE $#KCOO                                          
S5599C           SDMCU     ORNE $#MCU                                           
     C                     MOVE '1'       $$FITM                                
     C                     MOVE '1'       $$LNID                                
     C                     MOVE '1'       $$TOT                                 
     C                     MOVE '1'       $$PAGE                                
     C                     MOVE ' '       $PTC                                  
     C                     Z-ADD$#PG      ##PGSV                                
     C                     Z-ADD*ZEROS    $#PG                                  
E4   C                     ENDIF                                                
E3   C                     ENDIF                                                
      *                                                                         
      *   If interbranch, level break, retrieve new next numbers                
      *                                                                         
B3   C*          $5ICON    IFEQ 'Y'                                             
B4   C*          $@IC      ANDEQ'1'                                             
     C*          $$L       ANDEQ1                                               
     C*                    MOVE '1'       $$FITM                                
     C*                    MOVE '1'       $$LNID                                
     C*                    MOVE '1'       $$TOT                                 
     C*                    MOVE '1'       $$PAGE                                
     C*                    MOVE ' '       $PTC                                  
     C*                    Z-ADD$#PG      ##PGSV                                
     C*                    Z-ADD*ZEROS    $#PG                                  
E4   C*                    ENDIF                                                
B3   C           SDDOC     IFNE $#DOC                                           
     C           SDDCT     ORNE $#DCT                                           
     C           SDKCO     ORNE $#KCO                                           
     C                     MOVE '1'       $$FITM                                
     C                     MOVE '1'       $$LNID                                
     C                     MOVE '1'       $$TOT                                 
     C                     MOVE '1'       $$PAGE                                
     C                     MOVE ' '       $PTC                                  
     C                     Z-ADD$#PG      ##PGSV                                
     C                     Z-ADD*ZEROS    $#PG                                  
E3   C                     ENDIF                                                
B3   C           SDPTC     IFNE $#PTC                                           
     C                     MOVE '1'       $$FITM                                
     C                     MOVE '1'       $$LNID                                
     C                     MOVE '1'       $$TOT                                 
     C                     MOVE '1'       $$PAGE                                
     C                     MOVE ' '       $PTC                                  
E3   C                     ENDIF                                                
E2   C                     ENDIF                                                
      *                                                                         
      *    Reset breaks if no consolidation requested for this customer         
      *                                                                         
B2   C           $@SUMZ    IFEQ *BLANK                                          
      *                                                                         
      *    Level break if at the end of file.                                   
      *                                                                         
     C           *INLR     IFEQ '1'                                             
     C                     Z-ADD1         $$L                                   
     C                     MOVELSHINMG    SVINMG                                
     C                     END                                                  
      *                                                                         
B3   C           SDDOCO    IFEQ $#DOCO                                          
     C           SDDCTO    ANDEQ$#DCTO                                          
     C           SDKCOO    ANDEQ$#KCOO                                          
S5599C           SDMCU     ANDEQ$#MCU                                           
B4   C           *INLR     IFEQ '0'                                             
     C           $$PAGE    ANDEQ' '                                             
     C                     Z-ADD0         $$L     20                            
E4   C                     ENDIF                                                
      *                                                                         
X3   C                     ELSE                                                 
      *                                                                         
B4   C           $5ICON    IFNE 'Y'                                             
     C                     MOVE '1'       #A                                    
     C                     MOVE '1'       @$L,#A                                
     C                     MOVE '1'       $$PAGE                                
     C                     Z-ADD1         $$L                                   
     C                     MOVE '1'       *IN02                                 
     C                     MOVE '0'       *IN03                                 
     C                     MOVE ' '       $PFLAG                                
     C                     MOVE ' '       $HFLAG                                
     C                     MOVE ' '       $ATHR                                 
     C                     MOVE ' '       $PTC                                  
     C                     Z-ADD$#PG      ##PGSV                                
     C                     Z-ADD*ZEROS    $#PG                                  
E4   C                     ENDIF                                                
E3   C                     ENDIF                                                
      *                                                                         
      *    Reset breaks & flags if A/B number changes                           
      *                                                                         
B3   C           SDAN8     IFNE $#AN8                                           
     C           $5ICON    ANDEQ'Y'                                             
     C           SDCRCD    ORNE $#CRCD                                          
     C           $5ICON    ANDEQ'Y'                                             
S5599C           SDMCU     ORNE $#MCU                                           
S5599C           $5ICON    ANDEQ'Y'                                             
B3   C           SDAN8     ORNE $#AN8                                           
     C           $@IC      ANDEQ'1'                                             
     C           SDCRR     ORNE $#CRR                                           
     C           $5ICON    ANDEQ'Y'                                             
     C                     MOVE '1'       #A                                    
     C                     MOVE '1'       @$L,#A                                
     C                     MOVE '1'       $$PAGE                                
     C                     Z-ADD1         $$L                                   
     C                     MOVE '1'       *IN02                                 
     C                     MOVE '0'       *IN03                                 
     C                     MOVE ' '       $PFLAG                                
     C                     MOVE ' '       $HFLAG                                
     C                     MOVE ' '       $ATHR                                 
     C                     MOVE ' '       $PTC                                  
     C                     Z-ADD$#PG      ##PGSV                                
     C                     Z-ADD*ZEROS    $#PG                                  
E3   C                     ENDIF                                                
     C*                                                                         
B3   C*          $5ICON    IFEQ 'Y'                                             
B4   C*          $@IC      ANDEQ'1'                                             
     C*          $$L       ANDEQ1                                               
     C*                    MOVE '1'       $$FITM                                
     C*                    MOVE '1'       $$LNID                                
     C*                    MOVE '1'       $$TOT                                 
     C*                    MOVE '1'       $$PAGE                                
     C*                    MOVE ' '       $PTC                                  
     C*                    Z-ADD$#PG      ##PGSV                                
     C*                    Z-ADD*ZEROS    $#PG                                  
E4   C*                    ENDIF                                                
     C*                                                                         
B3   C*          SDDOC     IFNE $#DOC                                           
     C*          SDDCT     ORNE $#DCT                                           
     C*          SDKCO     ORNE $#KCO                                           
     C*                    MOVE '1'       $$FITM                                
     C*                    MOVE '1'       $$LNID                                
     C*                    MOVE '1'       $$TOT                                 
     C*                    MOVE '1'       $$PAGE                                
     C*                    MOVE ' '       $PTC                                  
     C*                    Z-ADD$#PG      ##PGSV                                
     C*                    Z-ADD*ZEROS    $#PG                                  
E3   C*                    ENDIF                                                
      *                                                                         
      *    Reset breaks & flags if A/R number changes                           
      *                                                                         
     C                     MOVE 'Y'       $$PGBK  1                             
     C           SDDOCO    IFEQ $#DOCO                                          
     C           SDDOC     ANDEQ*ZEROS                                          
     C           SDSOBK    ANDNE*ZEROS                                          
     C           SDSOQS    ANDEQ*ZEROS                                          
     C           SDDOCO    OREQ $#DOCO                                          
     C***        SDDOC     ANDNE$#DOC                                           
     C           $#DOC     ANDEQ*ZEROS                                          
     C           SDSOBK    ANDEQ*ZEROS                                          
     C           SDSOQS    ANDNE*ZEROS                                          
     C                     MOVE 'N'       $$PGBK  1                             
     C                     ENDIF                                                
      *                                                                         
      *    Reset breaks & flags if A/R number changes                           
      *                                                                         
     C           $@IC      IFNE '1'                                             
      *                                                                         
     C           $$PGBK    IFEQ 'Y'                                             
B3   C           SDDOC     IFNE $#DOC                                           
     C           SDDCT     ORNE $#DCT                                           
     C           SDKCO     ORNE $#KCO                                           
     C                     MOVE '1'       #A                                    
     C                     MOVE '1'       @$L,#A                                
     C                     MOVE '1'       $$PAGE                                
     C                     Z-ADD1         $$L                                   
     C                     MOVE '1'       *IN02                                 
     C                     MOVE '0'       *IN03                                 
     C                     MOVE ' '       $PFLAG                                
     C                     MOVE ' '       $HFLAG                                
     C                     MOVE ' '       $ATHR                                 
     C                     MOVE ' '       $PTC                                  
     C           $#PG      IFNE *ZEROS                                          
     C                     Z-ADD$#PG      ##PGSV                                
     C                     Z-ADD*ZEROS    $#PG                                  
     C                     ENDIF                                                
E3   C                     ENDIF                                                
     C                     ENDIF                                                
     C                     ENDIF                                                
      *                                                                         
      *    Reset breaks & flags if Payment terms change                         
      *                                                                         
B3   C           SDPTC     IFEQ $#PTC                                           
B4   C           *INLR     IFEQ '0'                                             
     C           $$PAGE    ANDEQ' '                                             
     C                     Z-ADD0         $$L     20                            
E4   C                     ENDIF                                                
      *                                                                         
X3   C                     ELSE                                                 
      *                                                                         
     C                     MOVE '1'       #A                                    
     C                     MOVE '1'       @$L,#A                                
     C                     MOVE '1'       $$PAGE                                
     C                     Z-ADD1         $$L                                   
     C                     MOVE '1'       *IN02                                 
     C                     MOVE '0'       *IN03                                 
     C                     MOVE ' '       $PFLAG                                
     C                     MOVE ' '       $HFLAG                                
     C                     MOVE ' '       $ATHR                                 
E3   C                     ENDIF                                                
E2   C                     ENDIF                                                
      *                                                                         
      *    Reset breaks & flags if A/B number changes                           
      *                                                                         
B2   C           SDKCOO    IFNE $#KCOO                                          
     C                     MOVE '1'       #A                                    
     C                     MOVE '1'       @$L,#A                                
     C                     MOVE '1'       $$PAGE                                
     C                     Z-ADD1         $$L                                   
     C                     MOVE '1'       *IN02                                 
     C                     MOVE '0'       *IN03                                 
     C                     MOVE ' '       $PFLAG                                
     C                     MOVE ' '       $HFLAG                                
     C                     MOVE ' '       $ATHR                                 
     C                     MOVE ' '       $PTC                                  
     C                     Z-ADD$#PG      ##PGSV                                
     C                     Z-ADD*ZEROS    $#PG                                  
E2   C                     ENDIF                                                
S5599 *                                                                         
S5599C           SDMCU     IFNE $#MCU                                           
S5599C                     MOVE '1'       #A                                    
S5599C                     MOVE '1'       @$L,#A                                
S5599C                     MOVE '1'       $$PAGE                                
S5599C                     Z-ADD1         $$L                                   
S5599C                     MOVE '1'       *IN02                                 
S5599C                     MOVE '0'       *IN03                                 
S5599C                     MOVE ' '       $PFLAG                                
S5599C                     MOVE ' '       $HFLAG                                
S5599C                     MOVE ' '       $ATHR                                 
S5599C                     MOVE ' '       $PTC                                  
S5599C                     Z-ADD$#PG      ##PGSV                                
S5599C                     Z-ADD*ZEROS    $#PG                                  
S5599C                     ENDIF                                                
      *                                                                         
      *    If intercompany invoice & ship to break, reset print                 
      *       control indicator                                                 
      *                                                                         
B4   C           SHSHAN    IFNE $#SHAN                                          
B4   C           $@IC      ANDEQ'1'                                             
     C                     MOVE '1'       *IN40                                 
      *                                                                         
      *    Ship to address -                                                    
      *                                                                         
      *    Store in array ship to address                                       
      *                                                                         
     C                     MOVE *BLANKS   @AD                                   
     C                     Z-ADDSHSHAN    $#SHAN                                
      *                                                                         
      *    Retrieve order address information - Ship-to                         
      *                                                                         
     C                     CLEARDS4006                                          
     C                     CLEARDS1100                                          
     C                     MOVELSHDOCO    $ADOCO                                
     C                     MOVELSHDCTO    $ADCTO                                
     C                     MOVELSHKCOO    $AKCOO                                
     C                     MOVELSHSHAN    $ASHAN                                
     C                     MOVELSHTRDJ    #1EFTB                                
      *                                                                         
     C                     CALL 'X4006'                98                       
      *                    ---- -------                                         
     C                     PARM           DS4006                                
     C                     PARM           DS1100                                
     C                     PARM           @AD                                   
      *                                                                         
      *    Format the address based on the country constants.                   
      *                                                                         
     C                     CALL 'X01100'               98                       
      *                    ---- --------                                        
     C                     PARM           DS1100                                
     C                     PARM           @AD                                   
      *                                                                         
      *    Move Address to output field array.                                  
      *                                                                         
DBN  C                     MOVEA@AD       @SH                                   
      *----------------------------------------------------------------         
      *                    ---- -----                                           
E4   C                     ENDIF                                                
      *                                                                         
      *    Bypass remaining select logic if end of file                         
      *    and no records written.                                              
      *                                                                         
B2   C           *INLR     IFEQ '1'                                             
B3   C           $$RCD     IFEQ 0                                               
     C                     GOTO SKIP1                                           
      *                    ---- -----                                           
X3   C                     ELSE                                                 
     C                     GOTO SKIP                                            
      *                    ---- ----                                            
E3   C                     ENDIF                                                
E2   C                     ENDIF                                                
      *                                                                         
      *    Bypass record if no header found                                     
      *                                                                         
     C                     MOVE '1'       $SEL                                  
B2   C           $#HDR     IFEQ 'N'                                             
     C           *INLR     ANDEQ'0'                                             
     C                     MOVE '0'       $SEL                                  
E2   C                     ENDIF                                                
      *                                                                         
     C           $SEL      CABEQ'0'       SKIP1                                 
      *                    -----          -----                                 
      *                                                                         
      *    Determine if status codes should be updated                          
      *                                                                         
B2   C           $@UPDT    IFEQ ' '                                             
     C           *INLR     ANDEQ'0'                                             
     C                     MOVE '0'       $SEL                                  
      *                                                                         
      *    Don't update status if quantity ship is zero,                        
      *    if line is cancelled, or if the line is future committed.            
      *                                                                         
B3   C           SDSOQS    IFEQ *ZEROS                                          
     C           SDSOBK    ANDNE*ZEROS                                          
     C           SDSOQS    OREQ *ZEROS                                          
     C           SDSOCN    ANDNE*ZEROS                                          
     C           SDSONE    ORNE *ZEROS                                          
     C           SDNXTR    OREQ '999'                                           
     C                     MOVE '1'       $SEL                                  
E3   C                     ENDIF                                                
      *                                                                         
      *    Update next status for text lines                                    
      *                                                                         
B3   C           LFTXYN    IFEQ 'Y'                                             
     C                     MOVE '0'       $SEL                                  
E3   C                     ENDIF                                                
      *                                                                         
      *    Retrieve next status value from Status Flow file                     
      *                                                                         
B3   C           $SEL      IFEQ '0'                                             
     C                     MOVE '1'       $SEL                                  
     C                     MOVE SDDCTO    FSDCTO                                
     C                     MOVE SDNXTR    FSTRTY                                
     C                     MOVE SDLNTY    FSLNTY                                
     C           FSKY0A    CHAINI40203A              97                         
B4   C           *IN97     IFEQ '0'                                             
      *                                                                         
B5   C           FSNXTR    IFNE *BLANKS                                         
      *                                                                         
      *    Load work field                                                      
      *                                                                         
     C                     MOVE SDLTTR    $$WK30  30                            
B6   C           $$WK30    IFLT 900                                             
      *                                                                         
      *    Compare override next status to those in the activity rules          
      *                                                                         
B7   C           $@STS     IFEQ FSNXTR                                          
     C           $@STS     OREQ FSA1TR                                          
     C           $@STS     OREQ FSA2TR                                          
     C           $@STS     OREQ FSA3TR                                          
     C           $@STS     OREQ FSA4TR                                          
     C           $@STS     OREQ FSA5TR                                          
     C           $@STS     OREQ *BLANKS                                         
      *                                                                         
      *    Load the last and next status codes -                                
      *    Use the override status code for the next status                     
      *                                                                         
     C                     MOVELSDNXTR    SDLTTR                                
B8   C           $@STS     IFEQ *BLANKS                                         
     C                     MOVELFSNXTR    SDNXTR                                
X8   C                     ELSE                                                 
     C                     MOVEL$@STS     SDNXTR                                
E8   C                     ENDIF                                                
E7   C                     ENDIF                                                
      *                                                                         
X6   C                     ELSE                                                 
      *                                                                         
      *    If the last status is > 900 -                                        
      *    Load the override status code as the next status                     
      *                                                                         
B7   C           $@STS     IFEQ *BLANKS                                         
     C                     MOVELFSNXTR    SDNXTR                                
X7   C                     ELSE                                                 
     C                     MOVEL$@STS     SDNXTR                                
E7   C                     ENDIF                                                
E6   C                     ENDIF                                                
      *                                                                         
E5   C                     ENDIF                                                
E4   C                     ENDIF                                                
E3   C                     ENDIF                                                
      *                                                                         
     C           $SEL      CABEQ'0'       SKIP1                                 
      *                    -----          -----                                 
E2   C                     ENDIF                                                
      *----------------------------------------------------------------         
      *                                                                         
     C                     Z-ADDSDDOC     $#DOC                                 
     C                     MOVELSDDCT     $#DCT                                 
     C                     MOVELSDKCO     $#KCO                                 
     C                     MOVE SDPTC     $#PTC                                 
      *                                                                         
      *    Check for page skip requested                                        
      *                                                                         
B2   C           $$PAGE    IFEQ '1'                                             
     C                     Z-ADDSDDOCO    $#DOCO                                
     C                     MOVE SDDCTO    $#DCTO                                
     C                     MOVELSDKCOO    $#KCOO                                
S5599C                     MOVE SDMCU     $#MCU                                 
     C                     Z-ADDSDAN8     $#AN8                                 
     C                     MOVELSDCRCD    $#CRCD                                
     C                     MOVELSDCRR     $#CRR                                 
E2   C                     ENDIF                                                
      *                                                                         
      *    Accumulate fields if summarization was requested                     
      *    and it is not an item or line change.                                
      *                                                                         
B2   C           $@SUMZ    IFEQ '1'                                             
     C           $$FITM    ANDEQ' '                                             
DBN  C                     MOVELDS4211    SV4211                                
     C           $$RCD     IFEQ 0                                               
     C                     MOVELSHINMG    SVINMG                                
     C                     MOVELSHDOCO    $PDOCO                                
     C                     MOVELSHDCTO    $PDCTO                                
     C                     MOVELSHKCOO    $PKCOO                                
     C                     END                                                  
     C                     ADD  SDSOQS    $SOQS  150                            
     C                     ADD  SDSOBK    $SOBK  150                            
     C                     ADD  SDSOCN    $SOCN  150                            
     C                     ADD  SDAEXP    $AEXP  150                            
     C                     ADD  SDFEA     $FEA   150                            
     C                     ADD  SDECST    $ECST  150                            
     C                     ADD  SDFEC     $FEC   150                            
     C                     ADD  SDPQOR    $PQOR  150                            
     C                     ADD  SDUORG    $UORG  150                            
      *                                                                         
      *    Add to number of records written field                               
      *                                                                         
     C                     ADD  1         $$RCD                                 
E2   C                     ENDIF                                                
      *                                                                         
B2   C           $@SUMZ    IFEQ '2'                                             
     C           $$LNID    ANDEQ' '                                             
     C           $$REM     ANDNE*ZERO                                           
     C           $$RCD     ANDNE0                                               
B3   C           SDRLIT    IFEQ *BLANKS                                         
DBN  C                     MOVELDS4211    SV4211                                
     C                     ADD  SDSOQS    $SOQS  150                            
     C                     ADD  SDSOBK    $SOBK  150                            
     C                     ADD  SDSOCN    $SOCN  150                            
     C                     ADD  SDAEXP    $AEXP  150                            
     C                     ADD  SDFEA     $FEA   150                            
     C                     ADD  SDECST    $ECST  150                            
     C                     ADD  SDFEC     $FEC   150                            
     C                     ADD  SDPQOR    $PQOR  150                            
     C                     ADD  SDUORG    $UORG  150                            
E3   C                     ENDIF                                                
      *                                                                         
      *    Add to number of records written field                               
      *                                                                         
     C                     ADD  1         $$RCD                                 
E2   C                     ENDIF                                                
      *                                                                         
      *    Print kit component lines                                            
      *                                                                         
B2   C           $@KITS    IFEQ *BLANKS                                         
     C           SDRLIT    ANDNE*BLANKS                                         
     C                     MOVE '3'       $SEL                                  
     C                     GOTO SKIP                                            
      *                    ---- ----                                            
E2   C                     ENDIF                                                
      *                                                                         
      *    Check configured parts flag if part should be printed.               
      *                                                                         
B2   C           $@KITS    IFNE *BLANKS                                         
     C           SDRLIT    ANDNE*BLANKS                                         
B3   C           SDSO03    IFEQ 'N'                                             
     C           SDSO03    OREQ '0'                                             
     C           SDSO03    OREQ '3'                                             
     C                     MOVE '3'       $SEL                                  
     C                     GOTO SKIP                                            
      *                    ---- ----                                            
E3   C                     ENDIF                                                
E2   C                     ENDIF                                                
      *                                                                         
      *    Determine if record is a kit                                         
      *                                                                         
     C                     MOVE ' '       $KIT    1                             
     C                     MOVE *OFF      *IN80                                 
     C                     Z-ADDSDITM     IBITM                                 
     C                     MOVE SDMCU     IBMCU                                 
      *                                                                         
     C                     MOVEL'CHAIN'   @@OPER                                
     C                     MOVEL'IBKY01  '@@KLST                                
     C                     Z-ADD2         @@KNUM                                
     C                     MOVEL'A71'     @@FMT                                 
     C                     MOVE 'N'       @@LOCK                                
     C                     CALL 'XF4102'               80                       
      *                    ---- --------                                        
     C                     PARM           PS@@1                                 
     C                     PARM           I4102                                 
      *                                                                         
B2   C           @@IOR     IFEQ 'NF '                                           
     C           @@IOR     OREQ 'RL '                                           
     C                     MOVE *ON       *IN80                                 
E2   C                     ENDIF                                                
      *                                                                         
B2   C           *IN80     IFEQ '0'                                             
B3   C           $@KITS    IFEQ *BLANKS                                         
B4   C           IBSTKT    IFEQ 'K'                                             
     C           IBSTKT    OREQ 'C'                                             
     C                     MOVE 'Y'       $KIT                                  
E4   C                     ENDIF                                                
E3   C                     ENDIF                                                
E2   C                     ENDIF                                                
      *                                                                         
      *    If no summarization requested - load report detail output            
      *                                                                         
B2   C           $@SUMZ    IFEQ *BLANK                                          
     C                     EXSR S004                                            
      *                    ---- ----                                            
E2   C                     ENDIF                                                
      *                                                                         
     C           SKIP      TAG                                                  
      *          ----      ---                                                  
26435 *    turn off tax for freight if                                          
26435 *    no other items have been taxed                                       
26435C           SDLNTY    IFEQ 'F'                        freight line         
26435C           $#ATT     ANDEQ0                          tax total            
26435C                     MOVE 'N'       SDTAX1           taxable Y/N          
26435C                     ENDIF                                                
      *                                                                         
      *    If no summarization requested - print report & update files          
      *    If summarization requested - print report                            
      *                                                                         
B2   C           $@SUMZ    IFEQ *BLANK                                          
     C                     EXSR S010                       this one             
      *                    ---- ----                                            
X2   C                     ELSE                                                 
     C                     EXSR S010A                                           
      *                    ---- -----                                           
E2   C                     ENDIF                                                
      *                                                                         
     C           SKIP1     TAG                                                  
      *          -----     ---                                                  
      *                                                                         
      *    Set off indicators if running in subsystem mode.                     
      *                                                                         
B2   C           ##MODE    IFEQ '2'                                             
     C           *INLR     ANDEQ'1'                                             
     C                     SETOF                     LR                         
     C                     Z-ADD$#PG      ##PGSV  40                            
     C                     Z-ADD*ZEROS    $#PG                                  
E2   C                     ENDIF                                                
      *                                                                         
      *    If end of file, end program.                                         
      *                                                                         
     C           *INLR     CABEQ'1'       EOJ                                   
      *                    -----          ---                                   
      *                                                                         
      *    End master file read cycle.                                          
      *                                                                         
     C           END       TAG                                                  
      *          ---       ---                                                  
E1   C                     ENDDO                                                
      *                                                                         
      *    End of program processing.                                           
      *                                                                         
     C           EOJ       TAG                                                  
      *          ---       ---                                                  
27295 *                                                                         
27295 * complete last page group                                                
27295C*  CC28068           WRITETOTAL7                                          
28068C   74                WRITETOTAL7                                          
      *   HAZOX                                                                 
      *                                                                         
     C           $@SPPI    IFEQ '1'                                             
     C                     CLEARDSDISP                                          
     C                     CLEARPS@@5                                           
     C                     CALL 'X73DISP'              99                       
      *                    ---- ---------                                       
     C                     PARM           PS@@5                                 
     C                     PARM           DSDISP                                
     C                     ENDIF                                                
      *                                                                         
     C                     SETON                       LR                       
      *                                                                         
      *  If Detail file (F4211) read error, send incomplete message.            
      *                                                                         
B1   C           *IN99     IFEQ '1'                                             
     C           $$HIST    ANDEQ'N'                                             
     C                     MOVEL'F4211   '#@MDTA 10                             
     C                     MOVEL'JDE9900' #@MSG   7                             
     C                     CALL 'J98CMSG'              81                       
      *                    ---- ---------                                       
     C                     PARM           #@MSG                                 
     C                     PARM           #@MDTA                                
E1   C                     ENDIF                                                
      *                                                                         
      *  If History file (F42019) read error, send incomplete message.          
      *                                                                         
B1   C           *IN99     IFEQ '1'                                             
     C           $$HIST    ANDEQ'Y'                                             
B2   C           PSFILE    IFEQ 'F49219  '                                      
     C                     MOVEL'F49219  '#@MDTA                                
     C                     ELSE                                                 
     C                     MOVEL'F42119  '#@MDTA 10                             
E2   C                     ENDIF                                                
     C                     MOVEL'JDE9900' #@MSG   7                             
     C                     CALL 'J98CMSG'              81                       
      *                    ---- ---------                                       
     C                     PARM           #@MSG                                 
     C                     PARM           #@MDTA                                
E1   C                     ENDIF                                                
      *                                                                         
      *    END MAINLINE PROGRAM                                                 
      *    --------------------                                                 
      *****************************************************************         
      *                                                                         
      *    Copy Common Subroutine - Cost Center Security Check                  
      *                                                                         
     C/COPY JDECPY,C0000                                                        
      ****************************************************************          
      *                                                                         
      *    SUBROUTINE S000  - Wait for passed PARMS                             
      *    ----------------------------------------                             
      *                                                                         
     CSR         S000      BEGSR                                                
      *          ----      -----                                                
      *                                                                         
SER  CSR                   CLOSER5542565               89                       
27482C                     MOVE *OFF      *IN74                                 
      *                                                                         
     CSR                   CLOSER47042                 89                       
      *                    -----------                                          
      *                                                                         
     CSR                   Z-ADD*ZERO     $#DOCO                                
      *                                                                         
     CSR                   MOVEL'DTAQINV' PSDTAQ 10                             
     CSR                   Z-ADD38        PSFLDL  50                            
     CSR                   Z-SUB1         PSWAIT  50                            
      *                                                                         
     CSR                   MOVEL*BLANKS   PSLIB  10                             
B1   CSR         ##LIB     IFEQ *BLANKS                                         
     CSR                   MOVEL'*LIBL'   PSLIB                                 
X1   CSR                   ELSE                                                 
     CSR                   MOVEL##LIB     PSLIB                                 
E1   CSR                   ENDIF                                                
      *----------------------------------------------------------------         
      *                                                                         
     CSR         T000A     TAG                                                  
      *          -----     ---                                                  
      *                                                                         
      *    Entry point for program call                                         
      *                                                                         
     CSR                   MOVE *BLANKS   DSPAR                                 
     CSR                   CALL 'QRCVDTAQ'             99                       
      *                    ---- ----------                                      
     CSR                   PARM           PSDTAQ                                
     CSR                   PARM           PSLIB                                 
     CSR                   PARM           PSFLDL                                
     CSR                   PARM           DSPAR                                 
     CSR                   PARM           PSWAIT                                
      *                                                                         
      *    If error, exit subroutine.                                           
      *                                                                         
     CSR         *IN99     CABEQ'1'       END000         LR                     
      *                    -----          ------                                
      *----------------------------------------------------------------         
     CSR                   CLEARDS4211                                          
DBN  CSR                   MOVELDS4211    SV4211                                
DBN  CSR                   MOVELDS4211    PR4211                                
      *                                                                         
      *    Move to work data structure - returned information                   
      *                                                                         
DBN  CSR                   MOVE DSPAR     WKPARM                                
     CSR                   MOVE *BLANKS   DSPAR                                 
      *                                                                         
      *    Check Document number for end of job flag                            
      *                                                                         
DBN  CSR                   MOVEL$WDOCO    $WK2    2                             
     CSR         $WK2      CABEQ'/*'      END000         LR                     
      *                    -----          ------                                
      *                                                                         
      *    Check Document number for any processing information                 
      *                                                                         
     CSR                   MOVEA$WDOCO    @NM                                   
     CSR                   EXSR C0012                                           
      *                    ---- -----                                           
     CSR                   Z-ADD#NUMR     SDDOCO                                
      *                                                                         
     CSR         SDDOCO    CABEQ*ZEROS    T000A                                 
      *                    -----          -----                                 
      *----------------------------------------------------------------         
      *                                                                         
      *    Retrieve Term Id default printer information.                        
      *                                                                         
     CSR                   MOVEL$WUSER    DSTERM                                
     CSR                   MOVEL'P42565  'DSPID                                 
     CSR                   MOVE *BLANKS   PS@@                                  
DBN  CSR                   MOVELDSKEY     KY@@                                  
     CSR                   CALL 'XS40096'              81                       
      *                    ---- ---------                                       
     CSR                   PARM           PS@@                                  
     CSR                   PARM           D40096                                
B1   CSR         RT@@      IFEQ 'N'                                             
     CSR                   MOVEL$WTERM    DSTERM                                
     CSR                   MOVEL'P42565  'DSPID                                 
     CSR                   MOVE *BLANKS   PS@@                                  
DBN  CSR                   MOVELDSKEY     KY@@                                  
     CSR                   CALL 'XS40096'              81                       
      *                    ---- ---------                                       
     CSR                   PARM           PS@@                                  
     CSR                   PARM           D40096                                
E1   CSR                   ENDIF                                                
      *                                                                         
      *----------------------------------------------------------------         
      *                                                                         
      *    Build printer override.                                              
      *                                                                         
     CSR                   MOVE *BLANKS   DPFMTP                                
     CSR                   MOVE *BLANKS   $PHLDQ                                
     CSR         DPKY01    CHAINF98312               9899                       
B1   CSR         *IN98     IFEQ '1'                                             
     CSR                   MOVEL'*STD  '  DPFMTP                                
     CSR                   MOVEL'*NO   '  $PHLDQ                                
E1   CSR                   ENDIF                                                
      *                                                                         
B1   CSR         *IN81     IFEQ '0'                                             
      *                                                                         
      *    Print Queue Pickslip.                                                
      *                                                                         
B2   CSR         DQOUTQ    IFEQ *BLANK                                          
     CSR                   MOVELDPPRTQ    DQOUTQ                                
E2   CSR                   ENDIF                                                
      *                                                                         
      *    Hold Queue.                                                          
      *                                                                         
B2   CSR         DPHLDQ    IFEQ 'Y'                                             
     CSR                   MOVEL'*YES  '  $PHLDQ  4                             
X2   CSR                   ELSE                                                 
     CSR                   MOVEL'*NO   '  $PHLDQ                                
E2   CSR                   ENDIF                                                
E1   CSR                   ENDIF                                                
      *                                                                         
      *    Format Type.                                                         
      *                                                                         
B1   CSR         DPFMTP    IFEQ *BLANKS                                         
     CSR                   MOVEL'*STD  '  DPFMTP                                
E1   CSR                   ENDIF                                                
      *                                                                         
      *    Hold Queue.                                                          
      *                                                                         
B1   CSR         $PHLDQ    IFEQ *BLANKS                                         
     CSR                   MOVEL'*NO   '  $PHLDQ                                
E1   CSR                   ENDIF                                                
      *                                                                         
      *    Print Queue Pickslip.                                                
      *                                                                         
B1   CSR         DQOUTQ    IFEQ *BLANKS                                         
     CSR                   MOVEL'QPRINT'  DQOUTQ                                
E1   CSR                   ENDIF                                                
      *                                                                         
      *    Lines per Inch.                                                      
      *                                                                         
B1   CSR         DPLPI     IFEQ *BLANKS                                         
     CSR                   MOVE *BLANKS   DPLPI                                 
E1   CSR                   ENDIF                                                
      *                                                                         
      *    Characters per Inch.                                                 
      *                                                                         
B1   CSR         DPCPI     IFEQ *BLANKS                                         
     CSR                   MOVE *BLANKS   DPCPI                                 
E1   CSR                   ENDIF                                                
      *                                                                         
      *    Number of invoice copies.                                            
      *                                                                         
B1   CSR         DPCOPY    IFEQ *BLANKS                                         
     CSR                   MOVEL'01'      DPCOPY                                
E1   CSR                   ENDIF                                                
      *----------------------------------------------------------------         
      *                                                                         
      *    Override printer file.                                               
      *                                                                         
SER  CSR                   MOVEADQOUTQ    @O,29                                 
SER  CSR                   MOVEADPFMTP    @O,62                                 
DBN  CSR                   MOVEA$PHLDQ    @O,86                                 
DBN  CSR                   MOVEADPLPI     @O,108                                
DBN  CSR                   MOVEADPCPI     @O,117                                
DBN  CSR                   MOVEADPCOPY    @O,130                                
     C                     Z-ADD160       PSLEN  155                            
      *                                                                         
SER  CSR                   MOVEA'R5542565'@O,14                                 
     CSR                   CALL 'QCMDEXC'              98                       
      *                    ---- ---------                                       
     CSR                   PARM           @O                                    
     CSR                   PARM           PSLEN                                 
      *                                                                         
      *----------------------------------------------------------------         
      *    Override printer file.                                               
      *                                                                         
DBN  CSR                   MOVEA'R47042'  @O,14                                 
     CSR                   CALL 'QCMDEXC'              98                       
      *                                                                         
     CSR                   PARM           @O                                    
     CSR                   PARM           PSLEN                                 
      *----------------------------------------------------------------         
      *                                                                         
      *    Open report file if necessary.                                       
      *                                                                         
B1   CSR         $@EDI     IFNE '2'                                             
27295C*                    OPEN R5542565               81                       
E1   CSR                   ENDIF                                                
B1   CSR         $@EDI     IFNE ' '                                             
     CSR                   OPEN R47042                 81                       
E1   CSR                   ENDIF                                                
      *----------------------------------------------------------------         
      *                                                                         
      *    If print cover page requested, print cover page.                     
      *                                                                         
B1   CSR         DEPTSP    IFEQ '1'                                             
     CSR                   CALL 'P98COVER'             81                       
      *                    ---- ---------                                       
     CSR                   PARM           ##PID                                 
     CSR                   PARM           ##VERS                                
E1   CSR                   ENDIF                                                
      *                                                                         
      *    If print help instructions requested, print help.                    
      *                                                                         
B1   CSR         DEPTIN    IFEQ '1'                                             
     CSR                   CALL 'P98RPTH'              81                       
      *                    ---- ----------                                      
     CSR                   PARM           ##PID                                 
E1   CSR                   ENDIF                                                
      *----------------------------------------------------------------         
      *                                                                         
      *    Initialize accumulative fields                                       
      *                                                                         
     CSR                   MOVE *ZEROS    $SOQS                                 
     CSR                   MOVE *ZEROS    $SOBK                                 
     CSR                   MOVE *ZEROS    $SOCN                                 
     CSR                   MOVE *ZEROS    $AEXP                                 
     CSR                   MOVE *ZEROS    $FEA                                  
     CSR                   MOVE *ZEROS    $ECST                                 
     CSR                   MOVE *ZEROS    $FEC                                  
     CSR                   MOVE *ZEROS    $PQOR                                 
     CSR                   MOVE *ZEROS    $UORG                                 
     CSR                   MOVE *ZEROS    $$RCD                                 
     CSR                   MOVE ' '       $$FITM                                
     CSR                   MOVE ' '       $$LNID                                
     CSR                   MOVE ' '       $$TOT                                 
     CSR                   MOVE *BLANKS   $SLITM                                
     CSR                   MOVE *BLANKS   $SLNTY                                
     CSR                   Z-ADD*ZEROS    $SLNID                                
     CSR                   MOVE ' '       $$EDIH  1                             
     CSR         END000    ENDSR                                                
      *****************************************************************         
      *                                                                         
      *    SUBROUTINE S002 - Monitor Report Level Breaks                        
      *    ---------------------------------------------                        
      *                                                                         
      *    Processing:  1.  Check for change in field values.                   
      *                 2.  Set total printing level.                           
      *                                                                         
     CSR         S002      BEGSR                                                
      *          ----      -----                                                
      *                                                                         
      *    If no level breaks requested, bypass subroutine.                     
      *                                                                         
DBN  CSR                   MOVEA@@L       #@LCA  36                             
B1   CSR         #@LCA     IFEQ *BLANK                                          
     CSR                   MOVE '1'       $LVLB   1                             
     CSR                   GOTO END002                                          
      *                    ---- ------                                          
E1   CSR                   ENDIF                                                
      *----------------------------------------------------------------         
      *                                                                         
      *    Load file buffer work array.                                         
      *                                                                         
DBN  CSR                   MOVEADS4211    @@1                                   
      *                                                                         
      *    Monitor level Breaks                                                 
      *                                                                         
B1   CSR                   DO   20        #G                                    
B2   CSR         @@L,#G    IFNE *BLANK                                          
      *                                                                         
      *    Load current value for data field.                                   
      *                                                                         
     CSR                   CLEAR@@2                                             
     CSR         @@B,#G    ADD  @@X,#G    $NBR5   50                            
     CSR                   SUB  1         $NBR5                                 
B3   CSR         @@B,#G    IFGT 2000                                            
     CSR         $NBR5     ORGT 2000                                            
     CSR                   Z-ADD0         @@B,#G                                
     CSR                   Z-ADD0         @@X,#G                                
E3   CSR                   ENDIF                                                
     CSR                   Z-ADD@@X,#G    $$SIZE  50                            
     CSR                   Z-ADD@@B,#G    #X                                    
     CSR                   Z-ADD1         #Y                                    
B3   CSR                   DO   $$SIZE                                          
     CSR                   MOVE @@1,#X    @@2,#Y                                
     CSR                   ADD  1         #X                                    
     CSR                   ADD  1         #Y                                    
E3   CSR                   ENDDO                                                
     CSR                   MOVEA@@2       $WRK40 40                             
     CSR                   MOVEL$WRK40    @CV,#G                                
      *                                                                         
      *    If end of file or field value changed, set level breaks.             
      *                                                                         
B3   CSR         *INLR     IFEQ '1'                                             
     CSR         @CV,#G    ORNE @PV,#G                                          
     CSR                   MOVE @1L,#G    #A                                    
      *                                                                         
      *    If level break requested, set level break flag.                      
      *                                                                         
B4   CSR         #A        IFGT 0                                               
     CSR         #A        ANDLE9                                               
     CSR                   MOVE '1'       @$L,#A                                
E4   CSR                   ENDIF                                                
      *                                                                         
      *    If page skip requested, set page skip.                               
      *                                                                         
B4   CSR         @@P,#G    IFEQ 'Y'                                             
     CSR                   MOVE '1'       $$PAGE                                
E4   CSR                   ENDIF                                                
      *                                                                         
      *    Retrieve total line description.                                     
      *                                                                         
     CSR                   MOVE *BLANK    $$@D   40                             
     CSR                   MOVEL@@D,#G    $$@D                                  
B4   CSR         @@R,#G    IFEQ '1'                                             
     CSR                   MOVE @@L,#G    $$@FN   4                             
     CSR                   MOVE *BLANK    $$@KEY 12                             
DBN  CSR                   MOVEL@CV,#G    $$@KEY                                
     CSR                   CALL 'X81DRPTD'             81                       
      *                    ---- ----------                                      
     CSR                   PARM           $$@FN                                 
     CSR                   PARM           $$@KEY                                
     CSR                   PARM           $$@D                                  
E4   CSR                   ENDIF                                                
      *                                                                         
B4   CSR         #A        IFGT 0                                               
     CSR         #A        ANDLE9                                               
     CSR                   MOVEL@CV,#G    @V@,#A                                
     CSR                   MOVEL$$@D      @L@,#A                                
B5   CSR         $$PGLV    IFLE #A                                              
     CSR         $$PAGE    ANDEQ'1'                                             
     CSR                   MOVEL$$@D      VC1PTL 40                             
     CSR                   Z-ADD#A        $$PGLV                                
E5   CSR                   ENDIF                                                
X4   CSR                   ELSE                                                 
     CSR                   MOVEL$$@D      VC1PTL                                
E4   CSR                   ENDIF                                                
      *                                                                         
      *                                                                         
E3   CSR                   ENDIF                                                
      *                                                                         
      *    Move current value to previous value.                                
      *                                                                         
     CSR                   MOVEL@CV,#G    @PV,#G                                
E2   CSR                   ENDIF                                                
E1   CSR                   ENDDO                                                
      *----------------------------------------------------------------         
      *                                                                         
      *    Bypass level break test on first cycle.                              
      *                                                                         
B1   CSR         $$CYC1    IFNE ' '                                             
      *                                                                         
      *    Set total printing level.                                            
      *                                                                         
     CSR                   Z-ADD9         #G                                    
     CSR                   Z-ADD0         $$L     20                            
B2   CSR         #G        DOWGT0                                               
B3   CSR         @$L,#G    IFEQ '1'                                             
B4   CSR         #G        IFGT $$L                                             
     CSR                   Z-ADD#G        $$L                                   
E4   CSR                   ENDIF                                                
     CSR                   MOVE ' '       @$L,#G                                
E3   CSR                   ENDIF                                                
     CSR                   SUB  1         #G                                    
E2   CSR                   ENDDO                                                
      *                                                                         
X1   CSR                   ELSE                                                 
     CSR                   MOVE *BLANK    @$L                                   
     CSR                   MOVEA@L@       @T@                                   
     CSR                   MOVEA@V@       @TV                                   
E1   CSR                   ENDIF                                                
     CSR                   MOVE '1'       $$CYC1  1                             
      *----------------------------------------------------------------         
     CSR         END002    ENDSR                                                
      ****************************************************************          
      *                                                                         
      *    SUBROUTINE S004 - Load report output.                                
      *    -------------------------------------                                
      *                                                                         
      *    Processing:  1.  Move data base information to report.               
      *                     All report fields are alpha and therefore           
      *                     numeric information must be processed               
      *                     through subroutine C00161 to set proper             
      *                     decimals and provide editing for output             
      *                     on the report.                                      
      *                                                                         
      *                     Date fields must be converted from their            
      *                     internal format of month, day and year or           
      *                     julian to the system format using program           
      *                     X0028.                                              
      *                                                                         
     CSR         S004      BEGSR                                                
      *          ----      -----                                                
      *----------------------------------------------------------------         
      *                                                                         
      *    Move to output - Document (Order #, Invoice, etc.)                   
      *                                                                         
     CSR                   MOVE *BLANK    #SINBR                                
     CSR                   MOVELSDDOCO    #SINBR                                
     CSR                   MOVE T@DOCO    #DTYP                                 
     CSR                   MOVE W@DOCO    #EWRD                                 
     CSR                   MOVE E@DOCO    #EC                                   
     CSR                   MOVE F@DOCO    #DSPD                                 
     CSR                   MOVE G@DOCO    #DATD                                 
     CSR                   MOVE J@DOCO    #ALR                                  
     CSR                   MOVE ' '       #ECOR                                 
     CSR                   MOVE ' '       #DCOR                                 
     CSR                   EXSR C00161                                          
      *                    ---- ------                                          
B1   CSR         #ALR      IFEQ 'L'                                             
     CSR                   MOVEL#SINBR    RRDOCO                                
X1   CSR                   ELSE                                                 
     CSR                   MOVE #SINBR    RRDOCO                                
E1   CSR                   ENDIF                                                
      *----------------------------------------------------------------         
      *                                                                         
      *    Move to output - Order Type                                          
      *                                                                         
+    C                     MOVELSDDCTO    RRDCTO                                
      *----------------------------------------------------------------         
      *                                                                         
      *    Move to output - Identify Kit Parent with '*'                        
      *                                                                         
     CSR         SDCOMM    IFEQ 'K'                                             
     CSR                   MOVEL'*'       VTX084                                
     CSR                   ELSE                                                 
     CSR                   MOVEL*BLANKS   VTX084                                
     CSR                   ENDIF                                                
      *----------------------------------------------------------------         
      *                                                                         
      *    Move to output - Description                                         
      *                                                                         
     CSR         $@IC      IFEQ '1'                                             
     CSR                   MOVE *BLANKS   PS@@                                  
     CSR                   MOVELSDITM     KY@@                                  
     CSR                   CALL 'XS4101LA'                                      
      *                    ---- ----------                                      
     CSR                   PARM           PS@@                                  
     CSR                   PARM           DS4101                                
     CSR                   PARM *ZEROS    PSDSC1 30                             
     CSR                   PARM *ZEROS    PSDSC2 30                             
     CSR                   PARM ABLNGP    #LNGP   2                             
     CSR                   MOVELIMDSC1    RRDSC1                                
S2102 *   RRRDSC is 27 long instead of 30                                       
S2102CSR                   MOVELIMDSC1    RRRDSC                                
     CSR                   ELSE                                                 
     CSR                   MOVELSDDSC1    RRDSC1                                
S2102 *   RRRDSC is 27 long instead of 30                                       
S2102CSR                   MOVELSDDSC1    RRRDSC                                
     CSR                   ENDIF                                                
      *----------------------------------------------------------------         
      *                                                                         
      *    Move to output - Item Number                                         
      *                                                                         
      *    If line type is non-stock, move the entered item number to           
      *    the item number to be printed on the invoice.                        
      *                                                                         
     CSR                   MOVE *BLANKS   RRUITM                                
SER  CSR                   MOVE *BLANKS   HRUITM                                
B1   CSR         LFIVI     IFEQ 'N'                                             
     CSR                   MOVE SDLITM    RRUITM                                
SER  CSR                   MOVELSDLITM    HRUITM                                
X1   CSR                   ELSE                                                 
B2   CSR         CISYM1    IFEQ ' '                                             
     CSR                   MOVE *BLANK    #SINBR                                
     CSR                   MOVE SDITM     #SINBR                                
     CSR                   MOVE T@ITM     #DTYP                                 
     CSR                   MOVE W@ITM     #EWRD                                 
     CSR                   MOVE E@ITM     #EC                                   
     CSR                   MOVE F@ITM     #DSPD                                 
     CSR                   MOVE G@ITM     #DATD                                 
     CSR                   MOVE J@ITM     #ALR                                  
     CSR                   MOVE ' '       #ECOR                                 
     CSR                   MOVE ' '       #DCOR                                 
     CSR                   EXSR C00161                                          
      *                    ---- ------                                          
B3   CSR         #ALR      IFEQ 'L'                                             
     CSR                   MOVEL#SINBR    RRUITM                                
SER  CSR                   MOVEL#SINBR    HRUITM                                
X3   CSR                   ELSE                                                 
     CSR                   MOVE #SINBR    RRUITM                                
SER  CSR                   MOVE #SINBR    HRUITM                                
E3   CSR                   ENDIF                                                
E2   CSR                   ENDIF                                                
      *                                                                         
B2   CSR         CISYM2    IFEQ ' '                                             
     CSR                   MOVE SDLITM    RRUITM                                
SER  CSR                   MOVELSDLITM    HRUITM                                
E2   CSR                   ENDIF                                                
      *                                                                         
B2   CSR         CISYM3    IFEQ ' '                                             
     CSR                   MOVE SDAITM    RRUITM                                
SER  CSR                   MOVELSDAITM    HRUITM                                
E2   CSR                   ENDIF                                                
E1   CSR                   ENDIF                                                
      *----------------------------------------------------------------         
      *                                                                         
      *    Move to output - Line Number                                         
      *                                                                         
     CSR                   MOVE *BLANK    #SINBR                                
     CSR                   MOVELSDLNID    #SINBR                                
     CSR                   MOVE T@LNID    #DTYP                                 
     CSR                   MOVE W@LNID    #EWRD                                 
     CSR                   MOVE E@LNID    #EC                                   
     CSR                   MOVE F@LNID    #DSPD                                 
     CSR                   MOVE G@LNID    #DATD                                 
     CSR                   MOVE J@LNID    #ALR                                  
     CSR                   MOVE ' '       #ECOR                                 
     CSR                   MOVE ' '       #DCOR                                 
     CSR                   EXSR C00161                                          
      *                    ---- ------                                          
B1   CSR         #ALR      IFEQ 'L'                                             
     CSR                   MOVEL#SINBR    RRLNID                                
X1   CSR                   ELSE                                                 
     CSR                   MOVE #SINBR    RRLNID                                
E1   CSR                   ENDIF                                                
      *----------------------------------------------------------------         
      *                                                                         
      *    Move to Output - Date - Requested (Julian)                           
      *                                                                         
      *    Don't fill requested date if the line is a text line.                
      *                                                                         
     CSR                   MOVE *BLANKS   RRDRQJ                                
B1   CSR         LFTXYN    IFNE 'Y'                                             
      *                                                                         
     CSR                   MOVE SDDRQJ    #SIDAT  6                             
     CSR                   MOVE *BLANK    #EDAT   8                             
     CSR                   MOVEL'*JUL    '#FFMT   7                             
     CSR                   MOVEL'*SYSVAL '#TFMT   7                             
     CSR                   MOVEL'*SYSVAL '#SEP    7                             
     CSR                   MOVE ' '       $ERTST  1                             
     CSR                   CALL 'X0028   '             81                       
      *                    ---- ----------                                      
     CSR                   PARM           #SIDAT                                
     CSR                   PARM           #EDAT                                 
     CSR                   PARM           #FFMT                                 
     CSR                   PARM           #TFMT                                 
     CSR                   PARM           #SEP                                  
     CSR                   PARM           $ERTST                                
     CSR                   MOVEL#EDAT     RRDRQJ                                
E1   CSR                   ENDIF                                                
      *----------------------------------------------------------------         
      *                                                                         
      *    Move to output - Unit of Measure                                     
      *                                                                         
     CSR                   MOVELSDUOM     RRUM                                  
      *----------------------------------------------------------------         
      *                                                                         
      *    Save previous Foreign Currency Display Decimals                      
      *                                                                         
     CSR                   EXSR S0042                                           
      *                    ---- -----                                           
      *----------------------------------------------------------------         
      *                                                                         
      *    Move to output - Amount - Price per Unit                             
      *                                                                         
     CSR                   MOVE *BLANK    #SINBR                                
     CSR                   MOVE *BLANK    RRUPRC                                
      *                                                                         
      *    Don't fill unit price if the line is a text line.                    
      *                                                                         
B1   CSR         LFTXYN    IFNE 'Y'                                             
      *                                                                         
      *    Display Foreign Amount                                               
      *                                                                         
B2   CSR         $@CNV     IFEQ '1'                                             
     CSR         $@CURR    ANDEQ'1'                                             
      *                                                                         
     CSR         $@IC      IFEQ '1'                                             
     CSR                   MOVE F@UNCS    #DSPD                                 
     CSR                   ELSE                                                 
     CSR                   MOVE F@FUP     #DSPD                                 
     CSR                   ENDIF                                                
      *                                                                         
     CSR                   MOVELSDFUP     #SINBR                                
     CSR                   MOVE T@FUP     #DTYP                                 
     CSR                   MOVE W@FUP     #EWRD                                 
     CSR                   MOVE E@FUP     #EC                                   
     CSR                   MOVE G@FUP     #DATD                                 
     CSR                   MOVE J@FUP     #ALR                                  
     CSR                   MOVE ' '       #ECOR                                 
     CSR                   MOVE ' '       #DCOR                                 
     CSR                   EXSR C00161                                          
      *                    ---- ------                                          
B3   CSR         #ALR      IFEQ 'L'                                             
     CSR                   MOVEL#SINBR    RRUPRC                                
X3   CSR                   ELSE                                                 
     CSR                   MOVE #SINBR    RRUPRC                                
E3   CSR                   ENDIF                                                
      *                                                                         
X2   CSR                   ELSE                                                 
      *                                                                         
     CSR                   MOVELSDUPRC    #SINBR                                
SER   ***                  MOVELSDUPRC    #SINBR                                
SER   ***SROLD      SDUPRC    DIV  10        HDUPRC 150                         
S3066 ***SR3162     SDUPRC    DIV  100       HDUPRC 150                         
S3162CSR         SDUPRC    DIV  1         HDUPRC 150                            
SER  CSR                   MOVELHDUPRC    #SINBR                                
     CSR                   MOVE T@UPRC    #DTYP                                 
     CSR                   MOVE W@UPRC    #EWRD                                 
     CSR                   MOVE E@UPRC    #EC                                   
SER   ***SROLD                MOVE '3'       #DSPD                              
S3066 ***SR3162               MOVE '2'       #DSPD                              
S3162CSR                   MOVE '4'       #DSPD                                 
SER   ***                  MOVE F@UPRC    #DSPD                                 
     CSR                   MOVE G@UPRC    #DATD                                 
     CSR                   MOVE J@UPRC    #ALR                                  
     CSR                   MOVE ' '       #ECOR                                 
     CSR                   MOVE ' '       #DCOR                                 
     CSR                   EXSR C00161                                          
      *                    ---- ------                                          
B3   CSR         #ALR      IFEQ 'L'                                             
     CSR                   MOVEL#SINBR    RRUPRC                                
X3   CSR                   ELSE                                                 
     CSR                   MOVE #SINBR    RRUPRC                                
E3   CSR                   ENDIF                                                
E2   CSR                   ENDIF                                                
E1   CSR                   ENDIF                                                
      *----------------------------------------------------------------         
      *                                                                         
      *    Move to output - Units - Quantity Shipped/Completed                  
      *                                                                         
     CSR                   MOVE *BLANK    RRSOQS                                
SER  CSR                   MOVE *BLANK    R2SOQS                                
B1   CSR         SDSOQS    IFNE *ZEROS                                          
     CSR                   MOVE *BLANK    #SINBR                                
     CSR                   MOVELSDSOQS    #SINBR                                
     CSR                   MOVE T@SOQS    #DTYP                                 
     CSR                   MOVE W@SOQS    #EWRD                                 
     CSR                   MOVE E@SOQS    #EC                                   
     CSR                   MOVE F@SOQS    #DSPD                                 
     CSR                   MOVE G@SOQS    #DATD                                 
     CSR                   MOVE J@SOQS    #ALR                                  
     CSR                   MOVE ' '       #ECOR                                 
     CSR                   MOVE ' '       #DCOR                                 
     CSR                   EXSR C00161                                          
      *                    ---- ------                                          
B2   CSR         #ALR      IFEQ 'L'                                             
     CSR                   MOVEL#SINBR    RRSOQS                                
SER  CSR                   MOVEL#SINBR    R2SOQS                                
X2   CSR                   ELSE                                                 
     CSR                   MOVE #SINBR    RRSOQS                                
SER  CSR                   MOVE #SINBR    R2SOQS                                
E2   CSR                   ENDIF                                                
SER   ***        VTX062    IFNE *BLANK                                          
SER   ***                  MOVELVTX062    RRSOQS                                
SER   ***                  ENDIF                                                
E1   CSR                   ENDIF                                                
      *----------------------------------------------------------------         
      *                                                                         
      *    Move to output - Units - Qty Backordered/Held                        
      *                                                                         
     CSR                   MOVEL*BLANKS   RRSOBK                                
     CSR                   MOVE ' '       $$BCFL  1                             
      *                                                                         
B1   CSR         SDSOBK    IFNE *ZEROS                                          
      *                                                                         
      *    Print backordered lines or print b/o and cancelled lines             
      *                                                                         
B2   CSR         $@BOCN    IFEQ '1'                                             
     CSR         $@BOCN    OREQ '3'                                             
     CSR         $@BOCN    OREQ ' '                                             
     CSR                   MOVE '1'       $$BCFL                                
E2   CSR                   ENDIF                                                
      *                                                                         
      *    Print b/o and cancelled lines only once                              
      *                                                                         
B2   CSR         $@BCPT    IFEQ '1'                                             
B3   CSR         SDRESL    IFNE '1'                                             
     CSR                   MOVE '1'       $$BCFL                                
X3   CSR                   ELSE                                                 
     CSR                   MOVE ' '       $$BCFL                                
E3   CSR                   ENDIF                                                
E2   CSR                   ENDIF                                                
      *                                                                         
B2   CSR         $$BCFL    IFEQ '1'                                             
     CSR                   MOVE *BLANK    #SINBR                                
     CSR                   MOVELSDSOBK    #SINBR                                
     CSR                   MOVE T@SOBK    #DTYP                                 
     CSR                   MOVE W@SOBK    #EWRD                                 
     CSR                   MOVE E@SOBK    #EC                                   
     CSR                   MOVE F@SOBK    #DSPD                                 
     CSR                   MOVE G@SOBK    #DATD                                 
     CSR                   MOVE J@SOBK    #ALR                                  
     CSR                   MOVE ' '       #ECOR                                 
     CSR                   MOVE ' '       #DCOR                                 
     CSR                   EXSR C00161                                          
      *                    ---- ------                                          
B3   CSR         #ALR      IFEQ 'L'                                             
     CSR                   MOVEL#SINBR    RRSOBK                                
X3   CSR                   ELSE                                                 
     CSR                   MOVE #SINBR    RRSOBK                                
E3   CSR                   ENDIF                                                
B3   CSR         VTX063    IFNE *BLANK                                          
     CSR                   MOVELVTX063    RRSOBK                                
E3   CSR                   ENDIF                                                
E2   CSR                   ENDIF                                                
E1   CSR                   ENDIF                                                
      *----------------------------------------------------------------         
      *                                                                         
      *    Move to output - Units - Quantity Canceled/Scrapped                  
      *                                                                         
     CSR                   MOVE *BLANKS   RRSOCN                                
     CSR                   MOVE ' '       $$BCFL  1                             
      *                                                                         
B1   CSR         SDSOCN    IFNE *ZEROS                                          
      *                                                                         
      *    Print cancelled lines or print b/o and cancelled lines               
      *                                                                         
B2   CSR         $@BOCN    IFEQ '2'                                             
     CSR         $@BOCN    OREQ '3'                                             
     CSR         $@BOCN    OREQ ' '                                             
     CSR                   MOVE '1'       $$BCFL                                
E2   CSR                   ENDIF                                                
      *                                                                         
      *    Print b/o and cancelled lines only once                              
      *                                                                         
B2   CSR         $@BCPT    IFEQ '1'                                             
B3   CSR         SDRESL    IFNE '1'                                             
     CSR                   MOVE '1'       $$BCFL                                
X3   CSR                   ELSE                                                 
     CSR                   MOVE ' '       $$BCFL                                
E3   CSR                   ENDIF                                                
E2   CSR                   ENDIF                                                
      *                                                                         
B2   CSR         $$BCFL    IFEQ '1'                                             
     CSR                   MOVE *BLANK    #SINBR                                
     CSR                   MOVELSDSOCN    #SINBR                                
     CSR                   MOVE T@SOCN    #DTYP                                 
     CSR                   MOVE W@SOCN    #EWRD                                 
     CSR                   MOVE E@SOCN    #EC                                   
     CSR                   MOVE F@SOCN    #DSPD                                 
     CSR                   MOVE G@SOCN    #DATD                                 
     CSR                   MOVE J@SOCN    #ALR                                  
     CSR                   MOVE ' '       #ECOR                                 
     CSR                   MOVE ' '       #DCOR                                 
     CSR                   EXSR C00161                                          
      *                    ---- ------                                          
B3   CSR         #ALR      IFEQ 'L'                                             
     CSR                   MOVEL#SINBR    RRSOCN                                
X3   CSR                   ELSE                                                 
     CSR                   MOVE #SINBR    RRSOCN                                
E3   CSR                   ENDIF                                                
B3   CSR         VTX064    IFNE *BLANKS                                         
     CSR                   MOVELVTX064    RRSOCN                                
E3   CSR                   ENDIF                                                
E2   CSR                   ENDIF                                                
E1   CSR                   ENDIF                                                
      *----------------------------------------------------------------         
      *                                                                         
      *    Move to output - Taxable (Y/N)                                       
      *                                                                         
      *    Don't fill the taxable flag if the line is a text line.              
      *                                                                         
     CSR                   MOVE *BLANKS   RRTX                                  
B1   CSR         LFTXYN    IFNE 'Y'                                             
     CSR                   MOVELSDTAX1    RRTX                                  
E1   CSR                   ENDIF                                                
      *----------------------------------------------------------------         
      *                                                                         
      *    If a kit component, don't extend price                               
      *                                                                         
B1   CSR         SDRLIT    IFNE *BLANKS                                         
     CSR                   MOVE *BLANKS   RRAEXP                                
SER  CSR                   MOVE *BLANKS   R2AEXP                                
X1   CSR                   ELSE                                                 
      *                                                                         
      *    Don't fill extended price if the line is a text line.                
      *                                                                         
     CSR                   MOVE *BLANKS   RRAEXP                                
SER  CSR                   MOVE *BLANKS   R2AEXP                                
B2   CSR         LFTXYN    IFNE 'Y'                                             
      *                                                                         
      *    If extended backorders requested, read item master                   
      *                                                                         
B3   CSR         $@EXBO    IFEQ '1'                                             
     CSR         SDSOBK    ANDNE0                                               
      *                                                                         
      *    Read Item Master File                                                
      *                                                                         
     CSR                   MOVE *BLANKS   PS@@                                  
     CSR                   MOVELSDITM     KY@@                                  
     CSR                   CALL 'XS4101LA'                                      
      *                    ---- ----------                                      
     CSR                   PARM           PS@@                                  
     CSR                   PARM           DS4101                                
      *----------------------------------------------------------------         
      *    Retrieve Branch Master.                                              
      *                                                                         
     CSR                   CLEARI4102                                           
     CSR         LFIVI     IFNE 'N'                                             
     CSR                   MOVE SDMCU     IBMCU                                 
     CSR                   Z-ADDSDITM     IBITM                                 
     CSR                   MOVEL'CHAIN'   @@OPER                                
     CSR                   MOVEL'IBKY01  '@@KLST                                
     CSR                   Z-ADD2         @@KNUM                                
     CSR                   MOVEL'A71'     @@FMT                                 
     CSR                   MOVE 'N'       @@LOCK                                
     CSR                   CALL 'XF4102 '                                       
      *                    ---- ---------                                       
     CSR                   PARM           PS@@1                                 
     CSR                   PARM           I4102                                 
     CSR                   END                                                  
E3   CSR                   ENDIF                                                
      *----------------------------------------------------------------         
      *                                                                         
      *    Move to output - Amount - Extended Price                             
      *                                                                         
     CSR                   MOVE *BLANK    #SINBR                                
      *                                                                         
      *    Display Foreign Amount                                               
      *                                                                         
B3   CSR         $@CNV     IFEQ '1'                                             
     CSR         $@CURR    ANDEQ'1'                                             
      *                                                                         
      *    If extended backorders requested, calculate extension                
      *                                                                         
B4   CSR         $@EXBO    IFEQ '1'                                             
     CSR         SDSOBK    ANDNE0                                               
      *                                                                         
     CSR         SDSOQS    ADD  SDSOBK    $WKQTY 150                            
      *                                                                         
      *    Convert quantity ordered to other units of measure                   
      *                                                                         
     CSR         $WKQTY    DIV  #@SOBK    #QTY      H                           
     CSR                   MOVE SDUOM     #UOM                                  
     CSR                   MOVE SDUOM4    #UOM1                                 
     CSR                   MOVELSDMCU     #MCU                                  
     CSR                   MOVE LFIVI     #IVI                                  
     CSR                   MOVE SDCOMM    #READ                                 
     CSR                   MOVE *BLANKS   #OT1Y                                 
     CSR                   Z-ADD*ZEROS    #STDP                                 
     CSR                   MOVEL*BLANKS   #LOTN                                 
      *                                                                         
     CSR                   CALL 'X41002  '             98                       
      *                    ---- ----------                                      
     CSR                   PARM           DS4101                                
     CSR                   PARM           DS@UOM                                
      *                                                                         
B5   CSR         #ERTST    IFEQ '1'                                             
     CSR                   Z-ADD1         #CNVP                                 
     CSR                   Z-ADD1         #CNVQ                                 
E5   CSR                   ENDIF                                                
      *                                                                         
     CSR         SDFUP     DIV  #@FUP     $WK299    H                           
     CSR                   DIV  #CNVP     $WK299    H                           
     CSR                   MULT #PQT      $WK299    H                           
     CSR         $WK299    MULT #@FDO     $WK150    H                           
     CSR                   Z-ADD$WK150    $#FEA                                 
     CSR                   MOVEL$WK150    #SINBR                                
DBN  CSR                   MOVEL$WK150    AG     150                            
X4   CSR                   ELSE                                                 
     CSR                   MOVELSDFEA     #SINBR                                
DBN  CSR                   MOVELSDFEA     AG     150                            
E4   CSR                   ENDIF                                                
     CSR                   MOVE T@FEA     #DTYP                                 
     CSR                   MOVE W@FEA     #EWRD                                 
     CSR                   MOVE E@FEA     #EC                                   
     CSR                   MOVE $FDO      #DSPD                                 
     CSR                   MOVE G@FEA     #DATD                                 
     CSR                   MOVE J@FEA     #ALR                                  
     CSR                   MOVE ' '       #ECOR                                 
     CSR                   MOVE ' '       #DCOR                                 
     CSR                   EXSR C00161                                          
      *                    ---- ------                                          
B4   CSR         #ALR      IFEQ 'L'                                             
     CSR                   MOVEL#SINBR    RRAEXP                                
SER  CSR                   MOVEL#SINBR    R2AEXP                                
X4   CSR                   ELSE                                                 
     CSR                   MOVE #SINBR    RRAEXP                                
SER  CSR                   MOVE #SINBR    R2AEXP                                
E4   CSR                   ENDIF                                                
X3   CSR                   ELSE                                                 
      *                                                                         
      *    Display Domestic Amount                                              
      *                                                                         
B4   CSR         $@CNV     IFEQ '1'                                             
     CSR         $@CURR    ANDEQ' '                                             
     CSR                   MOVE $CDO      #DSPD                                 
E4   CSR                   ENDIF                                                
      *                                                                         
      *    No Foreign Currency                                                  
      *                                                                         
B4   CSR         $@CNV     IFNE '1'                                             
     CSR                   MOVE F@AEXP    #DSPD                                 
E4   CSR                   ENDIF                                                
      *                                                                         
      *    If extended backorders requested, calculate extension                
      *                                                                         
B4   CSR         $@EXBO    IFEQ '1'                                             
     CSR         SDSOBK    ANDNE0                                               
     CSR         SDSOQS    ADD  SDSOBK    $WKQTY 150                            
      *                                                                         
      *    Convert quantity ordered to other units of measure                   
      *                                                                         
     CSR         $WKQTY    DIV  #@SOBK    #QTY      H                           
     CSR                   MOVE SDUOM     #UOM                                  
     CSR                   MOVE SDUOM4    #UOM1                                 
     CSR                   MOVELSDMCU     #MCU                                  
     CSR                   MOVE LFIVI     #IVI                                  
     CSR                   MOVE SDCOMM    #READ                                 
     CSR                   MOVE *BLANKS   #OT1Y                                 
     CSR                   Z-ADD*ZEROS    #STDP                                 
     CSR                   MOVEL*BLANKS   #LOTN                                 
      *                                                                         
     CSR                   CALL 'X41002  '             98                       
      *                    ---- ----------                                      
     CSR                   PARM           DS4101                                
     CSR                   PARM           DS@UOM                                
      *                                                                         
B5   CSR         #ERTST    IFEQ '1'                                             
     CSR                   Z-ADD1         #CNVP                                 
     CSR                   Z-ADD1         #CNVQ                                 
E5   CSR                   ENDIF                                                
      *                                                                         
     CSR         SDUPRC    DIV  #@UPRC    $WK299    H                           
     CSR                   DIV  #CNVP     $WK299    H                           
     CSR                   MULT #PQT      $WK299    H                           
     CSR         $WK299    MULT #@AEXP    $WK150    H                           
     CSR                   Z-ADD$WK150    $#AEXP                                
     CSR                   MOVEL$WK150    #SINBR                                
DBN  CSR                   MOVEL$WK150    AG     150                            
      *                                                                         
X4   CSR                   ELSE                                                 
      *                                                                         
     CSR                   MOVELSDAEXP    #SINBR                                
DBN  CSR                   MOVELSDAEXP    AG     150                            
E4   CSR                   ENDIF                                                
      *                                                                         
     CSR                   MOVE T@AEXP    #DTYP                                 
     CSR                   MOVE W@AEXP    #EWRD                                 
     CSR                   MOVE E@AEXP    #EC                                   
     CSR                   MOVE G@AEXP    #DATD                                 
     CSR                   MOVE J@AEXP    #ALR                                  
     CSR                   MOVE ' '       #ECOR                                 
     CSR                   MOVE ' '       #DCOR                                 
     CSR                   EXSR C00161                                          
      *                    ---- ------                                          
B4   CSR         #ALR      IFEQ 'L'                                             
     CSR                   MOVEL#SINBR    RRAEXP                                
SER  CSR                   MOVEL#SINBR    R2AEXP                                
X4   CSR                   ELSE                                                 
     CSR                   MOVE #SINBR    RRAEXP                                
SER  CSR                   MOVE #SINBR    R2AEXP                                
E4   CSR                   ENDIF                                                
E3   CSR                   ENDIF                                                
     CSR                   ELSE                                                 
     CSR                   Z-ADD*ZEROS    AG                                    
E2   CSR                   ENDIF                                                
E1   CSR                   ENDIF                                                
      *----------------------------------------------------------------         
      ****       $@CNV     IFEQ '1'                                             
      ****       $@CURR    ANDEQ'1'                                             
      ****                 ADD  AG        S3ACR                                 
      ****                 ADD  AG        S3FAP                                 
      ****                 ELSE                                                 
      ****                 ADD  AG        S3AG                                  
      ****                 ADD  AG        S3AAP                                 
      ****                 END                                                  
      *----------------------------------------------------------------         
      *                                                                         
      *    Move to output - Amount - Extended Cost                              
      *                                                                         
     CSR                   MOVE *BLANK    #SINBR                                
      *                                                                         
      *    Display Foreign Amount                                               
      *                                                                         
B1   CSR         $@CNV     IFEQ '1'                                             
     CSR         $@CURR    ANDEQ'1'                                             
      *                                                                         
      *    If extended backorders requested, calculate extension                
      *                                                                         
B2   CSR         $@EXBO    IFEQ '1'                                             
     CSR         SDSOBK    ANDNE0                                               
     CSR         SDSOQS    ADD  SDSOBK    $WKQTY 150                            
      *                                                                         
      *    Convert quantity ordered to other units of measure                   
      *                                                                         
     CSR         $WKQTY    DIV  #@SOBK    #QTY      H                           
     CSR                   MOVE SDUOM     #UOM                                  
     CSR                   MOVE SDUOM4    #UOM1                                 
     CSR                   MOVELSDMCU     #MCU                                  
     CSR                   MOVE LFIVI     #IVI                                  
     CSR                   MOVE SDCOMM    #READ                                 
     CSR                   MOVE *BLANKS   #OT1Y                                 
     CSR                   Z-ADD*ZEROS    #STDP                                 
     CSR                   MOVEL*BLANKS   #LOTN                                 
      *                                                                         
     CSR                   CALL 'X41002  '             98                       
      *                    ---- ----------                                      
     CSR                   PARM           DS4101                                
     CSR                   PARM           DS@UOM                                
      *                                                                         
B3   CSR         #ERTST    IFEQ '1'                                             
     CSR                   Z-ADD1         #CNVP                                 
     CSR                   Z-ADD1         #CNVQ                                 
E3   CSR                   ENDIF                                                
      *                                                                         
     CSR         SDFUC     DIV  #@FUC     $WK299    H                           
     CSR                   MULT #PQT      $WK299    H                           
     CSR         $WK299    MULT #@FDO     $WK150    H                           
     CSR                   MOVEL$WK150    #SINBR                                
X2   CSR                   ELSE                                                 
     CSR                   MOVELSDFEC     #SINBR                                
E2   CSR                   ENDIF                                                
     CSR                   MOVE T@FEC     #DTYP                                 
     CSR                   MOVE W@FEC     #EWRD                                 
     CSR                   MOVE E@FEC     #EC                                   
     CSR                   MOVE $FDO      #DSPD                                 
     CSR                   MOVE G@FEC     #DATD                                 
     CSR                   MOVE J@FEC     #ALR                                  
     CSR                   MOVE ' '       #ECOR                                 
     CSR                   MOVE ' '       #DCOR                                 
     CSR                   EXSR C00161                                          
      *                    ---- ------                                          
B2   CSR         #ALR      IFEQ 'L'                                             
     CSR                   MOVEL#SINBR    RRECST                                
X2   CSR                   ELSE                                                 
     CSR                   MOVE #SINBR    RRECST                                
E2   CSR                   ENDIF                                                
X1   CSR                   ELSE                                                 
      *                                                                         
      *    Display Domestic Amount                                              
      *                                                                         
B2   CSR         $@CNV     IFEQ '1'                                             
     CSR         $@CURR    ANDEQ' '                                             
     CSR                   MOVE $CDO      #DSPD                                 
E2   CSR                   ENDIF                                                
      *                                                                         
      *    No Foreign Currency                                                  
      *                                                                         
B2   CSR         $@CNV     IFNE '1'                                             
     CSR                   MOVE F@ECST    #DSPD                                 
E2   CSR                   ENDIF                                                
      *                                                                         
      *    If extended backorders requested, calculate extension                
      *                                                                         
B2   CSR         $@EXBO    IFEQ '1'                                             
     CSR         SDSOBK    ANDNE0                                               
     CSR         SDSOQS    ADD  SDSOBK    $WKQTY 150                            
      *                                                                         
      *    Convert quantity ordered to other units of measure                   
      *                                                                         
     CSR         $WKQTY    DIV  #@SOBK    #QTY      H                           
     CSR                   MOVE SDUOM     #UOM                                  
     CSR                   MOVE SDUOM4    #UOM1                                 
     CSR                   MOVELSDMCU     #MCU                                  
     CSR                   MOVE LFIVI     #IVI                                  
     CSR                   MOVE SDCOMM    #READ                                 
     CSR                   MOVE *BLANKS   #OT1Y                                 
     CSR                   Z-ADD*ZEROS    #STDP                                 
     CSR                   MOVEL*BLANKS   #LOTN                                 
      *                                                                         
     CSR                   CALL 'X41002  '             98                       
      *                    ---- ----------                                      
     CSR                   PARM           DS4101                                
     CSR                   PARM           DS@UOM                                
      *                                                                         
B3   CSR         #ERTST    IFEQ '1'                                             
     CSR                   Z-ADD1         #CNVP                                 
     CSR                   Z-ADD1         #CNVQ                                 
E3   CSR                   ENDIF                                                
      *                                                                         
     CSR         SDUNCS    DIV  #@UNCS    $WK299    H                           
     CSR                   MULT #PQT      $WK299    H                           
     CSR         $WK299    MULT #@ECST    $WK150    H                           
     CSR                   MOVEL$WK150    #SINBR                                
X2   CSR                   ELSE                                                 
     CSR                   MOVELSDECST    #SINBR                                
E2   CSR                   ENDIF                                                
     CSR                   MOVE T@ECST    #DTYP                                 
     CSR                   MOVE W@ECST    #EWRD                                 
     CSR                   MOVE E@ECST    #EC                                   
     CSR                   MOVE G@ECST    #DATD                                 
     CSR                   MOVE J@ECST    #ALR                                  
     CSR                   MOVE ' '       #ECOR                                 
     CSR                   MOVE ' '       #DCOR                                 
     CSR                   EXSR C00161                                          
      *                    ---- ------                                          
B2   CSR         #ALR      IFEQ 'L'                                             
     CSR                   MOVEL#SINBR    RRECST                                
X2   CSR                   ELSE                                                 
     CSR                   MOVE #SINBR    RRECST                                
E2   CSR                   ENDIF                                                
E1   CSR                   ENDIF                                                
      *----------------------------------------------------------------         
      *                                                                         
      *    Move to output - Percent Profit                                      
      *                                                                         
     CSR                   MOVE *ZEROS    $$WK95                                
     CSR                   MOVE *ZEROS    $#PFT                                 
     CSR                   MOVE *ZEROS    $$PCT                                 
      *                                                                         
      *    Display Foreign Amount                                               
      *                                                                         
B1   CSR         $@CNV     IFEQ '1'                                             
     CSR         $@CURR    ANDEQ'1'                                             
      *                                                                         
      *    If extended backorders requested, calculate extension                
      *                                                                         
B2   CSR         $@EXBO    IFEQ '1'                                             
     CSR         SDSOBK    ANDNE0                                               
     CSR         SDSOQS    ADD  SDSOBK    $WKQTY 150                            
      *                                                                         
      *    Convert quantity ordered to other units of measure                   
      *                                                                         
     CSR         $WKQTY    DIV  #@SOBK    #QTY      H                           
     CSR                   MOVE SDUOM     #UOM                                  
     CSR                   MOVE SDUOM4    #UOM1                                 
     CSR                   MOVELSDMCU     #MCU                                  
     CSR                   MOVE LFIVI     #IVI                                  
     CSR                   MOVE SDCOMM    #READ                                 
     CSR                   MOVE *BLANKS   #OT1Y                                 
     CSR                   Z-ADD*ZEROS    #STDP                                 
     CSR                   MOVEL*BLANKS   #LOTN                                 
      *                                                                         
     CSR                   CALL 'X41002  '             98                       
      *                    ---- ----------                                      
     CSR                   PARM           DS4101                                
     CSR                   PARM           DS@UOM                                
      *                                                                         
B3   CSR         #ERTST    IFEQ '1'                                             
     CSR                   Z-ADD1         #CNVP                                 
     CSR                   Z-ADD1         #CNVQ                                 
E3   CSR                   ENDIF                                                
      *                                                                         
     CSR         SDFUP     DIV  #@FUP     $WK299    H                           
     CSR                   DIV  #CNVP     $WK299    H                           
     CSR                   MULT #PQT      $WK299    H                           
     CSR         $WK299    MULT #@FDO     $BOEXT 150H                           
      *                                                                         
      *    Convert quantity ordered to other units of measure                   
      *                                                                         
     CSR         $WKQTY    DIV  #@SOBK    #QTY      H                           
     CSR                   MOVE SDUOM     #UOM                                  
     CSR                   MOVE SDUOM4    #UOM1                                 
     CSR                   MOVELSDMCU     #MCU                                  
     CSR                   MOVE LFIVI     #IVI                                  
     CSR                   MOVE SDCOMM    #READ                                 
     CSR                   MOVE *BLANKS   #OT1Y                                 
     CSR                   Z-ADD*ZEROS    #STDP                                 
     CSR                   MOVEL*BLANKS   #LOTN                                 
      *                                                                         
     CSR                   CALL 'X41002  '             98                       
      *                    ---- ----------                                      
     CSR                   PARM           DS4101                                
     CSR                   PARM           DS@UOM                                
      *                                                                         
B3   CSR         #ERTST    IFEQ '1'                                             
     CSR                   Z-ADD1         #CNVP                                 
     CSR                   Z-ADD1         #CNVQ                                 
E3   CSR                   ENDIF                                                
      *                                                                         
     CSR         SDFUC     DIV  #@FUC     $WK299    H                           
     CSR                   MULT #PQT      $WK299    H                           
     CSR         $WK299    MULT #@FDO     $BOCST 150H                           
     CSR         $BOEXT    SUB  $BOCST    $#PFT  299                            
B3   CSR         $BOEXT    IFNE *ZEROS                                          
     CSR         $#PFT     DIV  $BOEXT    $$WK95  95H                           
X3   CSR                   ELSE                                                 
     CSR                   Z-ADD1         $$WK95                                
E3   CSR                   ENDIF                                                
X2   CSR                   ELSE                                                 
     CSR         SDFEA     SUB  SDFEC     $#PFT  299                            
B3   CSR         SDFEA     IFNE *ZEROS                                          
     CSR         $#PFT     DIV  SDFEA     $$WK95  95H                           
X3   CSR                   ELSE                                                 
     CSR                   Z-ADD1         $$WK95                                
E3   CSR                   ENDIF                                                
E2   CSR                   ENDIF                                                
      *                                                                         
E1   CSR                   ENDIF                                                
      *                                                                         
      *    Display Domestic Amounts                                             
      *                                                                         
B1   CSR         $@CNV     IFEQ '1'                                             
     CSR         $@CURR    ANDEQ' '                                             
      *                                                                         
      *    If extended backorders requested, calculate extension                
      *                                                                         
B2   CSR         $@EXBO    IFEQ '1'                                             
     CSR         SDSOBK    ANDNE0                                               
     CSR         SDSOQS    ADD  SDSOBK    $WKQTY 150                            
      *                                                                         
      *    Convert quantity ordered to other units of measure                   
      *                                                                         
     CSR         $WKQTY    DIV  #@SOBK    #QTY      H                           
     CSR                   MOVE SDUOM     #UOM                                  
     CSR                   MOVE SDUOM4    #UOM1                                 
     CSR                   MOVELSDMCU     #MCU                                  
     CSR                   MOVE LFIVI     #IVI                                  
     CSR                   MOVE SDCOMM    #READ                                 
     CSR                   MOVE *BLANKS   #OT1Y                                 
     CSR                   Z-ADD*ZEROS    #STDP                                 
     CSR                   MOVEL*BLANKS   #LOTN                                 
      *                                                                         
     CSR                   CALL 'X41002  '             98                       
      *                    ---- ----------                                      
     CSR                   PARM           DS4101                                
     CSR                   PARM           DS@UOM                                
      *                                                                         
B3   CSR         #ERTST    IFEQ '1'                                             
     CSR                   Z-ADD1         #CNVP                                 
     CSR                   Z-ADD1         #CNVQ                                 
E3   CSR                   ENDIF                                                
      *                                                                         
     CSR         SDUPRC    DIV  #@UPRC    $WK299    H                           
     CSR                   DIV  #CNVP     $WK299    H                           
     CSR                   MULT #PQT      $WK299    H                           
     CSR         $WK299    MULT #@AEXP    $BOEXT 150H                           
      *                                                                         
      *    Convert quantity ordered to other units of measure                   
      *                                                                         
     CSR         $WKQTY    DIV  #@SOBK    #QTY      H                           
     CSR                   MOVE SDUOM     #UOM                                  
     CSR                   MOVE SDUOM4    #UOM1                                 
     CSR                   MOVELSDMCU     #MCU                                  
     CSR                   MOVE LFIVI     #IVI                                  
     CSR                   MOVE SDCOMM    #READ                                 
     CSR                   MOVE *BLANKS   #OT1Y                                 
     CSR                   Z-ADD*ZEROS    #STDP                                 
     CSR                   MOVEL*BLANKS   #LOTN                                 
     CSR                   MOVE SDCOMM    #READ                                 
     CSR                   MOVE *BLANKS   #OT1Y                                 
     CSR                   Z-ADD*ZEROS    #STDP                                 
     CSR                   MOVEL*BLANKS   #LOTN                                 
      *                                                                         
     CSR                   CALL 'X41002  '             98                       
      *                    ---- ----------                                      
     CSR                   PARM           DS4101                                
     CSR                   PARM           DS@UOM                                
      *                                                                         
B3   CSR         #ERTST    IFEQ '1'                                             
     CSR                   Z-ADD1         #CNVP                                 
     CSR                   Z-ADD1         #CNVQ                                 
E3   CSR                   ENDIF                                                
      *                                                                         
     CSR         SDUNCS    DIV  #@UNCS    $WK299    H                           
     CSR                   MULT #PQT      $WK299    H                           
     CSR         $WK299    MULT #@ECST    $BOCST 150H                           
     CSR         $BOEXT    SUB  $BOCST    $#PFT                                 
B3   CSR         $BOEXT    IFNE *ZEROS                                          
     CSR         $#PFT     DIV  $BOEXT    $$WK95  95H                           
X3   CSR                   ELSE                                                 
     CSR                   Z-ADD1         $$WK95                                
E3   CSR                   ENDIF                                                
X2   CSR                   ELSE                                                 
     CSR         SDAEXP    SUB  SDECST    $#PFT  299                            
B3   CSR         SDAEXP    IFNE *ZEROS                                          
     CSR         $#PFT     DIV  SDAEXP    $$WK95  95H                           
X3   CSR                   ELSE                                                 
     CSR                   Z-ADD1         $$WK95                                
E3   CSR                   ENDIF                                                
E2   CSR                   ENDIF                                                
      *                                                                         
E1   CSR                   ENDIF                                                
      *                                                                         
      *    No Foreign Currency                                                  
      *                                                                         
B1   CSR         $@CNV     IFNE '1'                                             
      *                                                                         
      *    If extended backorders requested, calculate extension                
      *                                                                         
B2   CSR         $@EXBO    IFEQ '1'                                             
     CSR         SDSOBK    ANDNE0                                               
     CSR         SDSOQS    ADD  SDSOBK    $WKQTY 150                            
      *                                                                         
      *    Convert quantity ordered to other units of measure                   
      *                                                                         
     CSR         $WKQTY    DIV  #@SOBK    #QTY      H                           
     CSR                   MOVE SDUOM     #UOM                                  
     CSR                   MOVE SDUOM4    #UOM1                                 
     CSR                   MOVELSDMCU     #MCU                                  
     CSR                   MOVE LFIVI     #IVI                                  
     CSR                   MOVE SDCOMM    #READ                                 
     CSR                   MOVE *BLANKS   #OT1Y                                 
     CSR                   Z-ADD*ZEROS    #STDP                                 
     CSR                   MOVEL*BLANKS   #LOTN                                 
      *                                                                         
     CSR                   CALL 'X41002  '             98                       
      *                    ---- ----------                                      
     CSR                   PARM           DS4101                                
     CSR                   PARM           DS@UOM                                
      *                                                                         
B3   CSR         #ERTST    IFEQ '1'                                             
     CSR                   Z-ADD1         #CNVP                                 
     CSR                   Z-ADD1         #CNVQ                                 
E3   CSR                   ENDIF                                                
      *                                                                         
     CSR         SDUPRC    DIV  #@UPRC    $WK299    H                           
     CSR                   DIV  #CNVP     $WK299    H                           
     CSR                   MULT #PQT      $WK299    H                           
     CSR         $WK299    MULT #@AEXP    $BOEXT 150H                           
      *                                                                         
      *    Convert quantity ordered to other units of measure                   
      *                                                                         
     CSR         $WKQTY    DIV  #@SOBK    #QTY      H                           
     CSR                   MOVE SDUOM     #UOM                                  
     CSR                   MOVE SDUOM4    #UOM1                                 
     CSR                   MOVELSDMCU     #MCU                                  
     CSR                   MOVE LFIVI     #IVI                                  
     CSR                   MOVE SDCOMM    #READ                                 
     CSR                   MOVE *BLANKS   #OT1Y                                 
     CSR                   Z-ADD*ZEROS    #STDP                                 
     CSR                   MOVEL*BLANKS   #LOTN                                 
      *                                                                         
     CSR                   CALL 'X41002  '             98                       
      *                    ---- ----------                                      
     CSR                   PARM           DS4101                                
     CSR                   PARM           DS@UOM                                
      *                                                                         
B3   CSR         #ERTST    IFEQ '1'                                             
     CSR                   Z-ADD1         #CNVP                                 
     CSR                   Z-ADD1         #CNVQ                                 
E3   CSR                   ENDIF                                                
      *                                                                         
     CSR         SDUNCS    DIV  #@UNCS    $WK299    H                           
     CSR                   MULT #PQT      $WK299    H                           
     CSR         $WK299    MULT #@ECST    $BOCST 150H                           
     CSR         $BOEXT    SUB  $BOCST    $#PFT  299                            
B3   CSR         $BOEXT    IFNE *ZEROS                                          
     CSR         $#PFT     DIV  $BOEXT    $$WK95  95H                           
X3   CSR                   ELSE                                                 
     CSR                   Z-ADD1         $$WK95                                
E3   CSR                   ENDIF                                                
X2   CSR                   ELSE                                                 
     CSR         SDAEXP    SUB  SDECST    $#PFT                                 
B3   CSR         SDAEXP    IFNE *ZEROS                                          
     CSR         $#PFT     DIV  SDAEXP    $$WK95  95H                           
X3   CSR                   ELSE                                                 
     CSR                   Z-ADD1         $$WK95                                
E3   CSR                   ENDIF                                                
E2   CSR                   ENDIF                                                
E1   CSR                   ENDIF                                                
      *                                                                         
     CSR         $$WK95    MULT 100       $$PCT   60                            
      *                                                                         
     CSR                   MOVE F@PCT     #DSPD                                 
     CSR                   MOVEL*BLANKS   RRPCT                                 
     CSR                   MOVE *BLANK    #SINBR                                
     CSR                   MOVE $$PCT     #SINBR                                
     CSR                   MOVE T@PCT     #DTYP                                 
     CSR                   MOVE W@PCT     #EWRD                                 
     CSR                   MOVE E@PCT     #EC                                   
     CSR                   MOVE G@PCT     #DATD                                 
     CSR                   MOVE J@PCT     #ALR                                  
     CSR                   MOVE 'M'       #ECOR                                 
     CSR                   MOVE ' '       #DCOR                                 
     CSR                   EXSR C00161                                          
      *                    ---- ------                                          
B1   CSR         #ALR      IFEQ 'L'                                             
     CSR                   MOVEL#SINBR    RRPCT                                 
X1   CSR                   ELSE                                                 
     CSR                   MOVE #SINBR    RRPCT                                 
E1   CSR                   ENDIF                                                
      *----------------------------------------------------------------         
      *                                                                         
      *    Move to output - Description - Line 2                                
      *                                                                         
     CSR         $@IC      IFEQ '1'                                             
     CSR                   MOVELIMDSC2    RRDSC2                                
     CSR                   ELSE                                                 
     CSR                   MOVELSDDSC2    RRDSC2                                
     CSR                   ENDIF                                                
      *----------------------------------------------------------------         
      *                                                                         
      *    Move to output - Unit of Measure - Pricing                           
      *                                                                         
      *    If a Freight Line, or Text Line                                      
      *    do not print Unit of Measure.                                        
      *                                                                         
     CSR                   MOVE '0'       *IN89                                 
B1   CSR         SDLNTY    IFEQ 'F '                                            
     CSR         LFTXYN    OREQ 'Y'                                             
     CSR                   MOVE *BLANKS   RRUOM4                                
     CSR                   MOVE '1'       *IN89                                 
X1   CSR                   ELSE                                                 
     CSR                   MOVELSDUOM4    RRUOM4                                
E1   CSR                   ENDIF                                                
      *----------------------------------------------------------------         
      *                                                                         
      *    If Line Type is not eligible for cash discount, load                 
      *    message to report.                                                   
      *                                                                         
     CSR         LFCDSC    IFEQ 'Y'                                             
     CSR                   MOVE *BLANKS   VC0001                                
     CSR                   ELSE                                                 
     CSR                   MOVELVTX086    VC0001                                
     CSR                   END                                                  
      *----------------------------------------------------------------         
      *                                                                         
      *    Read the Item Cross Reference file if the print                      
      *    our item# and the customer item# option is requested.                
      *                                                                         
B1   CSR         $@PCN     IFEQ '2'                                             
     CSR                   SETOF                     50                         
      *                                                                         
     CSR                   Z-ADDSDITM     PSITM   80                            
     CSR                   MOVEL*BLANK    PSSYM5  1                             
     CSR                   MOVEL$@XRT     PSXRT   2                             
     CSR                   Z-ADDSDAN8     PS#AN8  80                            
     CSR                   Z-ADDSDTRDJ    PSEXDJ  60                            
     CSR                   MOVEL*BLANKS   PSUITM 26                             
      *                                                                         
     CSR                   CALL 'X40104'                                        
      *                    -------------                                        
     CSR                   PARM           PSITM                                 
     CSR                   PARM           PSSYM5                                
     CSR                   PARM           PSXRT                                 
     CSR                   PARM           PS#AN8                                
     CSR                   PARM           PSEXDJ                                
     CSR                   PARM           PSUITM                                
      *                                                                         
     CSR                   MOVE *BLANKS   RRCITM                                
     CSR                   MOVELPSUITM    RRCITM                                
      *                                                                         
B2   CSR         RRCITM    IFEQ *BLANKS                                         
     CSR                   SETOF                     50                         
X2   CSR                   ELSE                                                 
     CSR                   SETON                     50                         
E2   CSR                   ENDIF                                                
E1   CSR                   ENDIF                                                
      *----------------------------------------------------------------         
      *                                                                         
      *    Load Grade/Potency Information                                       
      *                                                                         
     CSR                   EXSR S004A                                           
      *                    ---- -----                                           
      *                                                                         
     CSR         END004    ENDSR                                                
      ****************************************************************          
      *                                                                         
      *    SUBROUTINE S0042 - DISPLAY DECIMALS                                  
      *    ---------------------------------------                              
      *                                                                         
     CSR         S0042     BEGSR                                                
      *          -----     -----                                                
      *                                                                         
      *    Save previous Foreign Currency Display Decimals                      
      *                                                                         
     CSR                   MOVE $FDO      $$FDO   1                             
     CSR                   MOVE $CDO      $$CDO   1                             
     CSR                   Z-ADD#@FDO     $@FDO  110                            
     CSR                   Z-ADD#@CDO     $@CDO  110                            
      *                                                                         
      *    Currency - Retrieve Number of Display Decimals                       
      *                                                                         
     CSR                   MOVE *BLANKS   $FDO    1                             
     CSR                   MOVE *BLANKS   $CDO    1                             
      *                                                                         
B1   CSR         $@CNV     IFEQ '1'                                             
      *                                                                         
B2   CSR         $@CURR    IFEQ '1'                                             
      *                                                                         
      *    Retrieve display decimals - Foreign                                  
      *                                                                         
     CSR                   MOVE *BLANKS   PS@@                                  
     CSR         $@IC      IFEQ ' '                                             
     CSR                   MOVELSDCRCD    KY@@                                  
     CSR                   ELSE                                                 
     CSR                   MOVE *BLANKS   PS@@                                  
     CSR                   MOVELSHCO      KY@@                                  
     CSR                   CALL 'XS0010'               81                       
      *                    ---- --------                                        
     CSR                   PARM           PS@@                                  
     CSR                   PARM           DS0010                                
     CSR                   MOVELCCCRCD    KY@@                                  
     CSR                   ENDIF                                                
     CSR                   CALL 'XS0013'               81                       
      *                    ---- --------                                        
     CSR                   PARM           PS@@                                  
     CSR                   PARM           DS0013                                
B3   CSR         RT@@      IFNE 'N'                                             
     CSR         CVCDEC    ANDNE*BLANK                                          
     CSR                   MOVE CVCDEC    $FDO    1                             
     CSR         $FOR      IFEQ '1'                                             
     CSR                   MOVE CVCDEC    $CDO                                  
     CSR                   ENDIF                                                
E3   CSR                   ENDIF                                                
E2   CSR                   ENDIF                                                
      *                                                                         
B2   CSR         $@CURR    IFEQ ' '                                             
      *                                                                         
      *    Retrieve base company currency.                                      
      *                                                                         
     CSR                   MOVE *BLANKS   PS@@                                  
     CSR                   MOVELSHCO      KY@@                                  
     CSR                   CALL 'XS0010'               81                       
      *                    ---- --------                                        
     CSR                   PARM           PS@@                                  
     CSR                   PARM           DS0010                                
      *                                                                         
      *    Retrieve display decimals - Domestic                                 
      *                                                                         
     CSR                   MOVE *BLANKS   PS@@                                  
     CSR                   MOVELCCCRCD    KY@@                                  
     CSR         $@IC      IFEQ '1'                                             
     CSR                   MOVELUDCRCD    KY@@                                  
     CSR                   ENDIF                                                
     CSR                   CALL 'XS0013'               81                       
      *                    ---- --------                                        
     CSR                   PARM           PS@@                                  
     CSR                   PARM           DS0013                                
B3   CSR         RT@@      IFNE 'N'                                             
     CSR         CVCDEC    ANDNE*BLANK                                          
     CSR                   MOVE CVCDEC    $CDO    1                             
E3   CSR                   ENDIF                                                
E2   CSR                   ENDIF                                                
      *                                                                         
      *    - Foreign Divisor                                                    
      *                                                                         
     CSR                   Z-ADD1         #@FDO  110                            
     CSR                   MOVE $FDO      #A                                    
B2   CSR                   DO   #A                                              
     CSR                   MULT 10        #@FDO                                 
E2   CSR                   ENDDO                                                
      *                                                                         
      *    - Domestic Divisor                                                   
      *                                                                         
     CSR                   Z-ADD1         #@CDO  110                            
     CSR                   MOVE $CDO      #A                                    
B2   CSR                   DO   #A                                              
     CSR                   MULT 10        #@CDO                                 
E2   CSR                   ENDDO                                                
B2   CSR         $$FIR     IFEQ ' '                                             
     CSR                   MOVE $FDO      $$FDO                                 
     CSR                   MOVE $CDO      $$CDO                                 
     CSR                   Z-ADD#@FDO     $@FDO                                 
     CSR                   Z-ADD#@CDO     $@CDO                                 
     CSR                   MOVE '1'       $$FIR                                 
E2   CSR                   ENDIF                                                
      *                                                                         
E1   CSR                   ENDIF                                                
     CSR         END042    ENDSR                                                
      ****************************************************************          
      *                                                                         
      *    SUBROUTINE S0043 - Accumulate Detail Lines prior to invoice          
      *                       output in order to correct rounding problem       
      *    ----------------------------------------------------------           
      *                                                                         
     CSR         S0043     BEGSR                                                
      *          -----     -----                                                
      *                                                                         
     CSR                   Z-ADD*ZEROS    $DRND  299                            
     CSR                   Z-ADD#R        $R      30                            
      *                                                                         
     CSR         $@CNV     IFEQ '1'                                             
     CSR         $@CURR    IFEQ '1'                                             
     CSR         @TT,#R    MULT #@FDO     $WK150                                
     CSR                   ELSE                                                 
     CSR         @TT,#R    MULT #@CDO     $WK150                                
     CSR                   END                                                  
      *                                                                         
     CSR         $@CNV     IFNE '1'                                             
     CSR         @TT,#R    MULT #@STA1    $WK150                                
     CSR                   END                                                  
     CSR                   END                                                  
      *                                                                         
S1203CSR                   Z-ADD$WK150    $TRND  150                            
      *                                                                         
     CSR                   DO   $#LNCT                                          
      *                                                                         
     CSR                   ADD  1         $R                                    
     CSR                   MOVE @TR,$R    $WK153                                
      *                                                                         
     CSR         $RND      IFNE '1'                                             
     CSR                   Z-ADD@TT,$R    $WK152                                
     CSR                   ELSE                                                 
     CSR         $@CNV     IFEQ '1'                                             
     CSR         $@CURR    IFEQ '1'                                             
     CSR         @TM,$R    DIV  #@FDO     $WK152                                
     CSR                   ELSE                                                 
     CSR         @TM,$R    DIV  #@CDO     $WK152                                
     CSR                   END                                                  
     CSR                   END                                                  
      *                                                                         
     CSR         $@CNV     IFNE '1'                                             
     CSR         @TM,$R    DIV  #@STA1    $WK152                                
     CSR                   END                                                  
      *                                                                         
     CSR         $WK153    DIV  100       $W299  299H                           
     CSR         $WK152    MULT $W299     $WK152    H                           
     CSR                   END                                                  
      *                                                                         
     CSR         $@CNV     IFEQ '1'                                             
     CSR         $@CURR    ANDEQ'1'                                             
     CSR         $WK152    MULT #@FDO     $WK150    H                           
     CSR                   ELSE                                                 
     CSR         $@CNV     IFEQ '1'                                             
     CSR         $@CURR    ANDEQ' '                                             
     CSR         $WK152    MULT #@CDO     $WK150    H                           
     CSR                   END                                                  
      *                                                                         
     CSR         $@CNV     IFNE '1'                                             
     CSR         $WK152    MULT #@AEXP    $WK150    H                           
     CSR                   END                                                  
     CSR                   END                                                  
      *                                                                         
     CSR                   ADD  $WK150    $DRND                                 
      *                                                                         
     CSR                   ENDDO                                                
      *                                                                         
     CSR         END043    ENDSR                                                
      ****************************************************************          
      *                                                                         
      *    SUBROUTINE S004A - Load Grade/Potency Detail Information             
      *    --------------------------------------------------------             
      *                                                                         
     CSR         S004A     BEGSR                                                
      *          -----     -----                                                
      *                                                                         
      *    Indicators for Grades Potency                                        
      *                                                                         
      *       45 - Grade Range                                                  
      *       46 - Potency Range                                                
      *       47 - Lot Grade                                                    
      *       48 - Lot Potency                                                  
      *                                                                         
     CSR                   SETOF                     454647                     
     CSR                   SETOF                     48                         
     CSR                   MOVEL*BLANKS   RRFRGD                                
     CSR                   MOVEL*BLANKS   RRTHGD                                
     CSR                   MOVEL*BLANKS   RRFRMP                                
     CSR                   MOVEL*BLANKS   RRTHRP                                
     CSR                   MOVEL*BLANKS   RRLOTG                                
     CSR                   MOVEL*BLANKS   RRLOTP                                
      *                                                                         
      *    Retrieve Item Branch Information for Grade/Potency Flag              
      *                                                                         
     CSR                   MOVE SDMCU     IBMCU                                 
     CSR                   MOVE SDITM     IBITM                                 
      *                                                                         
     CSR                   MOVEL'CHAIN'   @@OPER                                
     CSR                   MOVEL'IBKY01  '@@KLST                                
     CSR                   Z-ADD2         @@KNUM                                
     CSR                   MOVEL'A71'     @@FMT                                 
     CSR                   MOVE 'N'       @@LOCK                                
     CSR                   CALL 'XF4102'                                        
      *                    ---- --------                                        
     CSR                   PARM           PS@@1                                 
     CSR                   PARM           I4102                                 
      *                                                                         
     CSR         *IN81     IFEQ '0'                                             
     CSR         @@IOR     ANDEQ*BLANKS                                         
      *                                                                         
      *    Print Grade Information                                              
      *                                                                         
     CSR         IBOT2Y    IFEQ '1'                                             
     CSR         IBOT2Y    OREQ 'Y'                                             
      *                                                                         
      *    Print Grade Range                                                    
      *                                                                         
     CSR         SDCOMM    IFEQ 'S'                                             
     CSR                   SETON                     45                         
     CSR                   MOVELSDFRGD    RRFRGD                                
     CSR                   MOVELSDTHGD    RRTHGD                                
     CSR                   ELSE                                                 
      *                                                                         
      *    Print Lot Grade                                                      
      *                                                                         
     CSR                   SETON                     47                         
      *                                                                         
     CSR                   MOVELSDLOTN    IOLOTN                                
     CSR                   Z-ADDSDITM     IOITM                                 
     CSR                   MOVELSDMCU     IOMCU                                 
     CSR                   MOVEL'A71     '@@FMT                                 
     CSR                   MOVE 'K'       @@ACCS                                
     CSR                   MOVEL'CHAIN   '@@OPER                                
     CSR                   MOVE 'N'       @@LOCK                                
     CSR                   MOVE 'N'       @@CHGR                                
     CSR                   MOVEL'IOKY00  '@@KLST                                
     CSR                   Z-ADD3         @@KNUM                                
     CSR                   CALL 'XF4108'               81                       
      *                    ---- --------                                        
     CSR                   PARM           PS@@1                                 
     CSR                   PARM           I4108                                 
      *                                                                         
     CSR         *IN81     IFEQ '0'                                             
     CSR         @@IOR     ANDEQ*BLANKS                                         
     CSR                   MOVELIOLOTG    RRLOTG                                
     CSR                   ENDIF                                                
     CSR                   ENDIF                                                
     CSR                   ENDIF                                                
      *                                                                         
      *    Print Potency Information                                            
      *                                                                         
     CSR         IBOT1Y    IFEQ '1'                                             
     CSR         IBOT1Y    OREQ 'Y'                                             
      *                                                                         
      *    Print Potency Range                                                  
      *                                                                         
     CSR         SDCOMM    IFEQ 'S'                                             
     CSR                   SETON                     46                         
      *                                                                         
      *    Move to output - From Lot Potency                                    
      *                                                                         
     CSR                   MOVE *BLANK    #SINBR                                
     CSR                   MOVELSDFRMP    #SINBR                                
     CSR                   MOVE T@FRMP    #DTYP                                 
     CSR                   MOVE W@FRMP    #EWRD                                 
     CSR                   MOVE E@FRMP    #EC                                   
     CSR                   MOVE F@FRMP    #DSPD                                 
     CSR                   MOVE G@FRMP    #DATD                                 
     CSR                   MOVE J@FRMP    #ALR                                  
     CSR                   MOVE ' '       #ECOR                                 
     CSR                   MOVE ' '       #DCOR                                 
     CSR                   EXSR C00161                                          
      *                    ---- ------                                          
     CSR         #ALR      IFEQ 'L'                                             
     CSR                   MOVEL#SINBR    RRFRMP                                
     CSR                   ELSE                                                 
     CSR                   MOVE #SINBR    RRFRMP                                
     CSR                   END                                                  
      *                                                                         
      *    Move to output - Thru Lot Potency                                    
      *                                                                         
     CSR                   MOVE *BLANK    #SINBR                                
     CSR                   MOVELSDTHRP    #SINBR                                
     CSR                   MOVE T@THRP    #DTYP                                 
     CSR                   MOVE W@THRP    #EWRD                                 
     CSR                   MOVE E@THRP    #EC                                   
     CSR                   MOVE F@THRP    #DSPD                                 
     CSR                   MOVE G@THRP    #DATD                                 
     CSR                   MOVE J@THRP    #ALR                                  
     CSR                   MOVE ' '       #ECOR                                 
     CSR                   MOVE ' '       #DCOR                                 
     CSR                   EXSR C00161                                          
      *                    ---- ------                                          
     CSR         #ALR      IFEQ 'L'                                             
     CSR                   MOVEL#SINBR    RRTHRP                                
     CSR                   ELSE                                                 
     CSR                   MOVE #SINBR    RRTHRP                                
     CSR                   END                                                  
      *                                                                         
     CSR                   ELSE                                                 
      *                                                                         
      *    Print Lot Potency                                                    
      *                                                                         
     CSR                   SETON                     48                         
      *                                                                         
     CSR                   MOVELSDLOTN    IOLOTN                                
     CSR                   Z-ADDSDITM     IOITM                                 
     CSR                   MOVELSDMCU     IOMCU                                 
     CSR                   MOVEL'A71     '@@FMT                                 
     CSR                   MOVE 'K'       @@ACCS                                
     CSR                   MOVEL'CHAIN   '@@OPER                                
     CSR                   MOVE 'N'       @@LOCK                                
     CSR                   MOVE 'N'       @@CHGR                                
     CSR                   MOVEL'IOKY00  '@@KLST                                
     CSR                   Z-ADD3         @@KNUM                                
     CSR                   CALL 'XF4108'               81                       
      *                    ---- --------                                        
     CSR                   PARM           PS@@1                                 
     CSR                   PARM           I4108                                 
      *                                                                         
     CSR         *IN81     IFEQ '0'                                             
     CSR         @@IOR     ANDEQ*BLANKS                                         
      *                                                                         
      *    Move to output - Lot Potency                                         
      *                                                                         
     CSR                   MOVE *BLANK    #SINBR                                
     CSR                   MOVELIOLOTP    #SINBR                                
     CSR                   MOVE T@LOTP    #DTYP                                 
     CSR                   MOVE W@LOTP    #EWRD                                 
     CSR                   MOVE E@LOTP    #EC                                   
     CSR                   MOVE F@LOTP    #DSPD                                 
     CSR                   MOVE G@LOTP    #DATD                                 
     CSR                   MOVE J@LOTP    #ALR                                  
     CSR                   MOVE ' '       #ECOR                                 
     CSR                   MOVE ' '       #DCOR                                 
     CSR                   EXSR C00161                                          
      *                    ---- ------                                          
     CSR         #ALR      IFEQ 'L'                                             
     CSR                   MOVEL#SINBR    RRLOTP                                
     CSR                   ELSE                                                 
     CSR                   MOVE #SINBR    RRLOTP                                
     CSR                   END                                                  
     CSR                   ENDIF                                                
     CSR                   ENDIF                                                
      *                                                                         
     CSR                   ENDIF                                                
     CSR                   ENDIF                                                
      *                                                                         
     CSR         EN004A    ENDSR                                                
      *****************************************************************         
      *                                                                         
      *    SUBROUTINE S0041 - User Index Interface                              
      *    ---------------------------------------                              
      *                                                                         
      *    Processing:  1. Used to add/change/delete User Index                 
      *                    information.  The User Index will contain            
      *                    Segment Value information.                           
      *                                                                         
      *    Prior to calling this routine, the following parameters              
      *    must be loaded:                                                      
      *                                                                         
      *          PACTN  -  Action Code (A,C,D,I)                                
      *          PRULE  -  Rule (EA,GT,LT,GE,LE)                                
      *          PKEY   -  Key Value                                            
      *                                                                         
     CSR         S0041     BEGSR                                                
      *          -----     -----                                                
      *                                                                         
     CSR                   CALL 'X00IDX'                                        
      *                    ---- --------                                        
     CSR                   PARM           DSIDX1                                
     CSR                   PARM           PACTN   1                             
     CSR                   PARM           PRULE   2                             
     CSR                   PARM           $IKYLN                                
     CSR                   PARM           PKEY  120                             
     CSR                   PARM           $IRCLN                                
     CSR                   PARM           DS$1                                  
     CSR                   PARM           PSTAT1  1                             
      *                                                                         
     CSR         END041    ENDSR                                                
      ****************************************************************          
      *                                                                         
      *    Copy Common Subroutine - Format Numeric Fields for Output with       
      *                                                                         
     C/COPY JDECPY,C00161                                                       
23256 *****************************************************************         
23256 *                                                                         
23256 *    SUBROUTINE S010F - Factura TXT File                                  
23256 *    -----------------------------------                                  
23256 *                                                                         
23256 *    Processing: 1.  Get next factura from NN 42 9                        
23256 *                                                                         
23256 *                2.  Write record to F55029 for each detail               
23256 *                    line in invoice.                                     
23256 *                                                                         
23256C           S010F     BEGSR                                                
23256 *                                                                         
23272 * if invoice found                                                        
23272 *   -delete data stage records                                            
23272 *   -reuse factura number                                                 
23272C                     MOVE SDDOC     $ADOC   8                             
23272C           $ADOC     SETLLF55029L2                                        
23272C                     READ F55029L2                 31                     
23272C           W9DOC     IFEQ $ADOC                                           
23256C           FACT      ANDNE'1'                        first pass           
23272C                     MOVE W9SERI    $$SERI                                
23272C                     MOVE W9FACT    $$FACT                                
23256C                     MOVE '1'       FACT                                  
23272C                     DELETI55029A                                         
23272C           *IN31     DOWNE*ON                                             
23272C                     READ F55029L2                 31                     
23272C           W9DOC     IFEQ $ADOC                                           
23272C           *IN31     ANDNE*ON                                             
23272C                     DELETI55029A                                         
23272C                     ENDIF                                                
23272C                     ENDDO                                                
      *                                                                         
23272C                     ELSE                                                 
23256 * get next factura number NN 42 9                                         
23256C           SDDCTO    IFNE 'SX'                       sample order         
23256C           FACT      ANDNE'1'                        first pass           
23256C                     MOVE '42  '    NNSY                                  
23256C           NNSY      CHAINF0002                34                         
23256C           *IN34     IFEQ *OFF                                            
23256C                     Z-ADDNNN009    #NUM    80                            
23256C                     ADD  1         NNN009                                
23256C                     UPDATI0002                                           
23256C                     UNLCKF0002                                           
23256C                     MOVE NNN009    $$FACT  8                             
23256C                     ENDIF                                                
23256C                     MOVE '1'       FACT    1                             
23256C                     ENDIF                                                
23256 * get series name                                                         
23256 * this will need to be expanded if billing in other than                  
23256 * USD - UDC 42 FS                                                         
23256C                     MOVE *BLANKS   DRKY                                  
23256C                     MOVE '42  '    DRSY                                  
23256C                     MOVE 'FS'      DRRT                                  
23256C                     MOVELSDDCT     DRKY                                  
23256C           DRKEY     CHAINF0005                31                         
23256C           *IN31     IFEQ *OFF                                            
23256C                     MOVELDRDL01    $$SERI  2                             
23256C                     ENDIF                                                
23256 *                                                                         
23272 * end of reprint                                                          
23272C                     ENDIF                                                
      *                                                                         
23256C                     CLEARI55029                     TXT work filt        
23256 * header stuff                                                            
23256C                     MOVE $$FACT    W9FACT           01 factura n         
23256C                     MOVEL$$SERI    W9SERI           02 series            
23256C                     MOVE SDDOC     W9DOC            48 inv no            
23256C                     MOVE SDDCT     W9DCT            49 type              
23256C                     MOVELABTAX     W9TAX            04 RFC               
23256 *----------------------------------------------------------------         
23256 * bill-to                                                                 
23256C                     MOVELSHAN8     W9AN8            32 bill-to           
23256C                     MOVELRRSLD1    W9SLD1           03 b/t name          
23256C           SDAN8     SETLLF0116                                           
23256C                     READ F0116                    31                     
23256C                     CLEARI0005U                                          
23256C                     MOVEL'00'      #USY                                  
23256C                     MOVE 'CN'      #URT                                  
23256C                     MOVE *BLANKS   #UKY3   3                             
23256C                     MOVELALCTR     #UKY3                                 
23256C                     MOVE #UKY3     #UKY                                  
23256C                     CALL 'X0005  '                                       
23256 *                    ---- ---------                                       
23256C                     PARM           I0005U                                
23256C                     MOVEL#UDL01    W9CTR            05 b/t cntry         
23256 *                                                                         
23256C                     CLEARI0005U                                          
23256C                     MOVEL'00'      #USY                                  
23256C                     MOVE 'S '      #URT                                  
23256C                     MOVE *BLANKS   #UKY3   3                             
23256C                     MOVEL#1CTR     #UKY3                                 
23256C                     MOVE ALADDS    #UKY                                  
23256C                     CALL 'X0005  '                                       
23256 *                    ---- ---------                                       
23256C                     PARM           I0005U                                
23256C                     MOVEL#UDL01    W9ADDS           06 b/t state         
23256C                     MOVELALCOUN    W9COUN           07 b/t count         
23256C                     MOVELALCTY1    W9CTY1           08 b/t city          
23256C                     Z-ADD1         R       30                            
23256C                     Z-ADD41        S       30                            
23256C                     MOVE *BLANK    R2      1                             
23256 *                                                                         
23256C           RRSLD2    IFGT *BLANK                                          
23256C           RRSLD3    ANDGT*BLANK                                          
23256C                     MOVEARRSLD2    @A,R             b/t address          
23256C                     ADD  40        R                                     
23256C                     ENDIF                                                
23256 *                                                                         
23256C           RRSLD3    IFGT *BLANK                                          
23256C           RRSLD4    ANDGT*BLANK                                          
23256C           RRSLD5    ANDGT*BLANK                                          
23256C                     MOVEARRSLD3    @A,R             b/t address          
23256C                     ADD  40        R                                     
23256C                     ENDIF                                                
23256 *                                                                         
23256C           RRSLD4    IFGT *BLANK                                          
23256C           RRSLD5    ANDGT*BLANK                                          
23256C           RRSLD6    ANDGT*BLANK                                          
23256C                     MOVEARRSLD4    @A,R             b/t address          
23256C                     ADD  40        R                                     
23256C                     ENDIF                                                
23256 *                                                                         
23256C                     MOVEA@A        W9ADD            09 b/t addr          
23256C                     MOVELALADDZ    W9ADDZ           13 b/t ZIP           
23256 *----------------------------------------------------------------         
23256 * ship-to                                                                 
23256C                     MOVELSHSHAN    W9SHAN           cus no               
23256C* 23292              MOVELRRSLD1    W9SHD1           name                 
23291C                     MOVELRRSHL1    W9SHD1           name                 
23256C           SDSHAN    SETLLF0116                                           
23256C                     READ F0116                    31                     
23256C                     CLEARI0005U                                          
23256C                     MOVEL'00'      #USY                                  
23256C                     MOVE 'CN'      #URT                                  
23256C                     MOVE *BLANKS   #UKY3   3                             
23256C                     MOVELALCTR     #UKY3                                 
23256C                     MOVE #UKY3     #UKY                                  
23256C                     CALL 'X0005  '                                       
23256 *                    ---- ---------                                       
23256C                     PARM           I0005U                                
23256C                     MOVEL#UDL01    W9CTR2           country              
23256 *                                                                         
23256C                     CLEARI0005U                                          
23256C                     MOVEL'00'      #USY                                  
23256C                     MOVE 'S '      #URT                                  
23256C                     MOVE *BLANKS   #UKY3   3                             
23256C                     MOVEL#1CTR     #UKY3                                 
23256C                     MOVE ALADDS    #UKY                                  
23256C                     CALL 'X0005  '                                       
23256 *                    ---- ---------                                       
23256C                     PARM           I0005U                                
23256C                     MOVEL#UDL01    W9ADD2           state                
23256C                     MOVELALCOUN    W9COU2           county               
23256C                     MOVELALCTY1    W9CTY2           city                 
23256C                     Z-ADD1         R       30                            
23256C                     Z-ADD41        S       30                            
23256C                     MOVE *BLANK    R2      1                             
23256 *                                                                         
23259C           RRSHL2    IFGT *BLANK                                          
23259C           RRSHL3    ANDGT*BLANK                                          
23259C           RRSHL4    ANDGT*BLANK                                          
23256C* 23279              MOVEARRSLD2    @A,R             addr line 1          
23279C                     MOVEARRSHL2    @A,R             addr line 1          
23256C                     ADD  40        R                                     
23256C                     ENDIF                                                
23256 *                                                                         
23259C           RRSHL3    IFGT *BLANK                                          
23259C           RRSHL4    ANDGT*BLANK                                          
23259C           RRSHL5    ANDGT*BLANK                                          
23256C* 23291              MOVEARRSLD3    @A,R             addr line 2          
23291C                     MOVEARRSHL3    @A,R             addr line 2          
23256C                     ADD  40        R                                     
23256C                     ENDIF                                                
23256 *                                                                         
23259C           RRSHL4    IFGT *BLANK                                          
23259C           RRSHL5    ANDGT*BLANK                                          
23259C           RRSHL6    ANDGT*BLANK                                          
23256C* 23292              MOVEARRSLD4    @A,R             addr line 3          
23292C                     MOVEARRSHL4    @A,R             addr line 3          
23256C                     ADD  40        R                                     
23256C                     ENDIF                                                
23256 *                                                                         
23256C                     MOVEA@A        W9SHD            35 s/t addr          
23256C                     MOVELALADDZ    W9ZIP2           37 s/t ZIP           
23256 *----------------------------------------------------------------         
23256 * notes - 25                                                              
23256C                     MOVE *BLANKS   $$YBYM 33                             
23256C                     MOVELPAYBYM    $$YBYM                                
23256C                     MOVE RR#DDM    $$YBYM                                
23256C                     MOVEL$$YBYM    W9NOTE           25 notes             
23256 *                                                                         
23256C           *IN59     IFEQ *ON                           USD               
23256C                     MOVEL'USD'     W9CRCD           26 currency          
23256C                     MOVEL'USD'     W9SIM            27 symbol            
23256C                     ELSE                               MXP               
23256C                     MOVEL'MXN'     W9CRCD           26 currency          
23256C                     MOVEL'MXN'     W9SIM            27 symbol            
23256C                     ENDIF                                                
23256 * assemble method of payment - 31                                         
23256C                     MOVEA*BLANK    @M                                    
23256C                     MOVEAMXWR0     @M,1                                  
23256C                     MOVEAMXWR1     @M,41                                 
23256C                     MOVEAMXWR2     @M,81                                 
23256C                     MOVEAMXWR3     @M,121                                
23256C                     MOVEAMXWR4     @M,161                                
23256C           *IN59     IFEQ *ON                           USD               
23256C                     MOVEAMXWR5U    @M,201                                
23256C                     MOVEAMXWR6U    @M,241                                
23256C                     ELSE                               MXP               
23256C                     MOVEAMXWR5P    @M,201                                
23256C                     MOVEAMXWR6P    @M,241                                
23256C                     ENDIF                                                
23256C                     MOVEAMXWR7     @M,281                                
23256C                     MOVEA@M        W9MPAG           31 pmt meth od       
23256 * exchange rate                                                           
23256C                     CLEARI0015                                           
23256C           CXKEY     KLIST                                                
23256C                     KFLD           CXCRDC                                
23256C                     KFLD           CXCRCD                                
23256C                     KFLD           CXEFT                                 
23256C                     MOVEL'MXP'     CXCRDC                                
23256C                     MOVEL'USD'     CXCRCD                                
23256C                     MOVEL'999999'  CXEFT                                 
23256C           CXKEY     SETLLF0015LC              31                         
23256C                     READ F0015LC                  31                     
23256C                     Z-ADDCXCRR     $$CRR  154                            
23256 * convert to text                                                e        
23256C                     MOVE $$CRR     #SINBR           edit data   e        
23256C                     MOVE 'P'       #DTYP            data type            
23256C                     MOVEL' '       #EWRD            edit word            
23256C                     MOVE ' '       #EC              edit code            
23256C                     MOVE '4'       #DSPD            dsp decimals         
23256C                     MOVE 'R'       #ALR             justify              
23256C                     MOVE ' '       #ECOR            ovr edt cd           
23256C                     MOVE ' '       #DCOR            ovr dsp dec          
23256C                     EXSR C00161                                          
23256C                     MOVE #SINBR    W9CRRD           28 exch rate         
23256 *                                                                         
23256C                     MOVELRRPTD     W9CPAG    P      30 pmt terms         
23256C                     MOVELSDDOCO    W9DOCO           38 order no          
23256C                     MOVELSHVR01    W9VR01           39 cust PO           
23256C                     MOVELSHDEL1    W9DEL1           40 del inst          
23256 *                                                                         
23256C                     MOVELSDMCU     W9MCU            shp whse             
23256C                     MOVELSDIVD     W9IVD            inv date             
23256 * detail line stuff                                                       
23256C                     MOVE RRUM      W9UOM1           15 u/m               
      * can't have negative numbers on facturas                                 
23256C           SDSOQS    IFLT 0                                               
23256C           SDSOQS    MULT -1        WRK15  150                            
23256C                     MOVE *BLANK    #SINBR                                
23256C                     MOVELWRK15     #SINBR                                
23256C                     MOVE T@SOQS    #DTYP                                 
23256C                     MOVE W@SOQS    #EWRD                                 
23256C                     MOVE E@SOQS    #EC                                   
23256C                     MOVE F@SOQS    #DSPD                                 
23256C                     MOVE G@SOQS    #DATD                                 
23256C                     MOVE J@SOQS    #ALR                                  
23256C                     MOVE ' '       #ECOR                                 
23256C                     MOVE ' '       #DCOR                                 
23256C                     EXSR C00161                                          
23256 *                    ---- ------                                          
23256C                     MOVE #SINBR    W9SOQS           16 qty shipd         
23256C                     ELSE                                                 
23256C                     MOVE R2SOQS    W9SOQS           16 qty shipd         
23256C                     ENDIF                                                
23256C                     MOVE RRUPRC    W9UPRC           17 price ea          
23256C                     MOVE RRRDSC    W9DSC1           18 desc              
23256 * tax rate (add rates from all five tax juisdictions)                     
23256C                     Z-ADD0         ##TRAT 153                            
23256C                     Z-ADD0         #WRK18 150                            
23256C                     ADD  #XTXR1    #WRK18                                
23256C                     ADD  #XTXR2    #WRK18                                
23256C                     ADD  #XTXR3    #WRK18                                
23256C                     ADD  #XTXR4    #WRK18                                
23256C                     ADD  #XTXR5    #WRK18                                
23256C           #WRK18    MULT .001      ##TRAT                                
23256 * convert to text                                                e        
23256C                     MOVE ##TRAT    #SINBR           edit data   e        
23256C                     MOVE 'P'       #DTYP            data type            
23256C                     MOVEL' '       #EWRD            edit word            
23256C                     MOVE ' '       #EC              edit code            
23256C                     MOVE '3'       #DSPD            dsp decimals         
23256C                     MOVE 'R'       #ALR             justify              
23256C                     MOVE ' '       #ECOR            ovr edt cd           
23256C                     MOVE ' '       #DCOR            ovr dsp dec          
23256C                     EXSR C00161                                          
23256C                     MOVE #SINBR    W9TRAT           19 tax rate          
23256 *                                                                         
23256C                     MOVE '1'       W9STAT           20 status            
23256C                     MOVE HRUITM    W9LITM           25 2nd itm           
      * can't have negative numbers on facturas                                 
23256C           SDAEXP    IFLT 0                                               
23256C           SDAEXP    MULT -1        WRK15  150                            
23256C                     MOVE *BLANK    #SINBR                                
23256C                     MOVELWRK15     #SINBR                                
23256C                     MOVE T@SOQS    #DTYP                                 
23256C                     MOVE W@SOQS    #EWRD                                 
23256C                     MOVE E@SOQS    #EC                                   
23256C                     MOVE F@SOQS    #DSPD                                 
23256C                     MOVE G@SOQS    #DATD                                 
23256C                     MOVE J@SOQS    #ALR                                  
23256C                     MOVE ' '       #ECOR                                 
23256C                     MOVE ' '       #DCOR                                 
23256C                     EXSR C00161                                          
23256 *                    ---- ------                                          
23256C                     MOVE #SINBR    W9AEXP           42 extended          
23256C                     ELSE                                                 
23256C                     MOVE R2AEXP    W9AEXP           42 extended          
23256C                     ENDIF                                                
23256 *                                                                         
23256C                     WRITEI55029                                          
23272 *                                                                         
23256C           E010F     ENDSR                                                
      *****************************************************************         
      *                                                                         
      *    SUBROUTINE S0100 - Report Print Control                              
      *    ---------------------------------------                              
      *                                                                         
      *    Processing:  1.  Print report totals.                                
      *                 2.  Print report detail.                                
      *                                                                         
     CSR         S010      BEGSR                                                
      *          ----      -----                                                
      *                                                                         
      *    If level break sensed, print report totals.                          
      *                                                                         
B1   CSR         $$L       IFGT 0                                               
     CSR                   MOVE 01        #G                                    
B2   CSR         #G        DOWLE$$L                                             
      *                                                                         
      *    Bypass printing if kit component line                                
      *                                                                         
B3   CSR         $SEL      IFNE '3'                                             
     CSR         @@OFLN    SUB  @@CLNO    $$DIFF  30                            
B4   CSR         *INOF     IFEQ '1'                                             
     CSR         $$DIFF    ORLE $TOTL                                           
     CSR                   Z-ADD$#PG      $$PGSV                                
     CSR                   Z-ADD##PGSV    $#PG                                  
     CSR                   EXSR S010H                                           
      *                    ---- -----                                           
     CSR                   Z-ADD$#PG      ##PGSV                                
     CSR                   Z-ADD$$PGSV    $#PG                                  
      *                                                                         
      *                                                                         
      *                                                                         
      *                                                                         
E4   CSR                   ENDIF                                                
E3   CSR                   ENDIF                                                
      *                                                                         
      *----------------------------------------------------------------         
      *                                                                         
      *    Print Detail Line                                                    
      *                                                                         
B3   CSR         #G        IFEQ $#SUMZ                                          
      *                                                                         
      *    Process Text Lines - Print Before detail line                        
      *                                                                         
      *----------------------------------------------------------------         
      *                                                                         
      *    Retrieve Preferences for Print Messages                              
      *                                                                         
     CSR                   MOVEA'1'       @PR,5                                 
     CSR                   MOVEA@PR       PSPRFR                                
     CSR                   MOVEL'S'       PSSYS                                 
      *                                                                         
     CSR         $@IC      IFEQ '1'                                             
     CSR                   MOVELSDAN8     $AN8                                  
     CSR                   MOVELSDSHAN    $SHAN                                 
     CSR                   MOVELSDPA8     $PA8                                  
     CSR                   MOVELUDIAN8    SDAN8                                 
     CSR                   MOVELUDIAN8    SDSHAN                                
     CSR                   MOVELUDIAN8    SDPA8                                 
     CSR                   END                                                  
      *                                                                         
DBN  CSR                   MOVELDS4211    PSRECP                                
      *                                                                         
     CSR                   CALL 'P40400  '             98                       
      *                    ---- ----------                                      
     CSR                   PARM 'P40400'  PSPID  10                             
     CSR                   PARM 'ZJDE0001'PSVERS 10                             
     CSR                   PARM           Z40300                                
     CSR                   PARM           PSRECP                                
     CSR                   PARM           PSSYS   1                             
     CSR                   PARM           PSPRFR 10                             
      *                                                                         
     CSR         $@IC      IFEQ '1'                                             
     CSR                   MOVEL$AN8      SDAN8                                 
     CSR                   MOVEL$SHAN     SDSHAN                                
     CSR                   MOVEL$PA8      SDPA8                                 
     CSR                   END                                                  
      *                                                                         
     C                     MOVE 'B'       $$TEXT  1                             
      *                                                                         
      *                                                                         
      *   Print Global message if one is entered in the Proc. Options           
      *    and the message is set to print before any detail lines              
      *                                                                         
     CSR         $PFLAG    IFEQ *BLANKS                                         
     CSR                   MOVEL$@INMG    PSINMG                                
     CSR                   MOVEL*ZEROS    PSITM                                 
     CSR                   EXSR S010T                                           
      *                    ---- -----                                           
      *                                                                         
     CSR         $PRT      IFEQ '1'                                             
     CSR                   MOVE '1'       $PFLAG  1                             
     CSR                   ENDIF                                                
     CSR                   ENDIF                                                
      *                                                                         
      *   Print Header level message if there is one and the message            
      *    is set to print before any detail lines.                             
      *                                                                         
     CSR         $HFLAG    IFEQ *BLANKS                                         
     CSR                   MOVELSHINMG    PSINMG                                
     CSR                   MOVEL*ZEROS    PSITM                                 
     CSR                   EXSR S010T                                           
      *                    ---- -----                                           
     CSR         $PRT      IFEQ '1'                                             
     CSR                   MOVEL'1'       $HFLAG                                
     CSR                   ENDIF                                                
     CSR                   ENDIF                                                
      *                                                                         
      *    Check for associated text to print before based on                   
      *      Processing Option                                                  
      *                                                                         
     CSR         $@ASTX    IFEQ '1'                                             
     CSR         $ATHR     ANDEQ*BLANKS                                         
     CSR                   MOVE SHDOCO    JMDOCO                                
     CSR                   MOVE SHDCTO    JMDCTO                                
     CSR                   MOVE SHKCOO    JMKCOO                                
     CSR                   Z-ADD*ZEROS    JMLNID                                
     CSR                   EXSR S010V                                           
      *                    ---- -----                                           
     CSR                   END                                                  
      *----------------------------------------------------------------         
      *                                                                         
      *    Print Item Note before line                                          
      *                                                                         
     CSR                   Z-ADDSDITM     PSITM                                 
     CSR                   MOVE *BLANKS   PSINMG                                
25920C  N76N77             EXSR S010T                                           
      *                    ---- -----                                           
      *                                                                         
      *   Print Detail level message if there is one and the message            
      *    is set to print before any detail lines.                             
      *                                                                         
     CSR                   MOVELSDINMG    PSINMG                                
     CSR                   MOVEL*ZEROS    PSITM                                 
25920C  N76N77             EXSR S010T                                           
      *                    ---- -----                                           
      *                                                                         
      *   Print Preference Print Messages for detail level and the msg          
      *    is set to print before any detail lines.                             
      *                                                                         
     CSR                   MOVEL*BLANKS   PREC                                  
     CSR                   MOVEL*BLANKS   DSPRNT                                
     CSR                   MOVEL'0'       PSTAT   1                             
     CSR                   Z-ADD#KYL2     PKEYL                                 
      *                                                                         
     CSR         PSTAT     DOWEQ'0'                                             
     CSR                   CALL 'X00IDX'                                        
      *                    ---- --------                                        
     CSR                   PARM           DS#IDX           index name           
     CSR                   PARM 'I'       PACTN   1        action               
     CSR                   PARM 'GT'      PRULE   2        rule                 
     CSR                   PARM           PKEYL   30       key length           
     CSR                   PARM DSPRNT    PKEY  120        key value            
     CSR                   PARM #RCL2     PRECL   30       record length        
     CSR                   PARM           PREC  210        record length        
     CSR                   PARM           PSTAT            record value         
      *                                                                         
     CSR         PSTAT     IFEQ '0'                                             
DBN  CSR                   MOVELPREC      DSPRNT                                
     CSR         DS#TYP    IFEQ 'D'                                             
     CSR                   MOVE DSINMG    PSINMG                                
     CSR                   MOVEL*ZEROS    PSITM                                 
25920C  N76N77             EXSR S010T                                           
      *                    ---- -----                                           
     CSR                   ELSE                                                 
     CSR                   MOVEL'1'       PSTAT                                 
     CSR                   END                                                  
     CSR                   END                                                  
      *                                                                         
     CSR                   Z-ADD#KYL3     PKEYL                                 
     CSR                   ENDDO                                                
      *                                                                         
      *    Check for associated text to print before based on                   
      *      Processing Option                                                  
      *                                                                         
B4   CSR         $@ASTX    IFEQ '1'                                             
     CSR                   MOVE SDDOCO    JMDOCO                                
     CSR                   MOVE SDDCTO    JMDCTO                                
     CSR                   MOVE SDKCOO    JMKCOO                                
     CSR                   Z-ADDSDLNID    JMLNID                                
27486 * this one really didn't control before notes for Facturas                
25920C  N76N77             EXSR S010V                                           
27486C*                    EXSR S010V                                           
      *                    ---- -----                                           
E4   CSR                   ENDIF                                                
      *                                                                         
      *    Update files                                                         
      *                                                                         
     CSR                   EXSR S010U                                           
      *                    ---- -----                                           
      *                                                                         
      *    Retreive Print Adjustment History                                    
      *                                                                         
     CSR                   EXSR S010PA                                          
      *                    ---- ------                                          
      *                                                                         
      *    Bypass printing if kit component line                                
      *                                                                         
B4   CSR         $SEL      IFNE '3'                                             
      *                                                                         
     CSR         $@EDI     IFNE '2'                                             
SER   *                                                                         
SER   * Make ship qty = B/O for backorder detail line                           
SER   *                                                                         
SER  CSR         SDSOBK    IFGT 0                                               
SER  CSR         SDLTTR    IFEQ '902'                                           
SER  CSR         SDLTTR    OREQ '904'                                           
SER  CSR                   CLEARR2SOQS                                          
SER  CSR                   MOVEL'B/O'     R2SOQS                                
SER  CSR                   CLEARR2AEXP                                          
SER  CSR                   ENDIF                                                
SER  CSR                   ENDIF                                                
SER   *                                                                         
SER   * Partial S010C routine to determine if sales tax exists for item         
SER   * Field needed to determine tax amount is #XSTAM                          
SER   *                                                                         
S1203C***                  EXSR S010CC                                          
S2498CSR                   EXSR S010CC                                          
SER   *                                                                         
SER  CSR         SHEXR1    IFEQ 'E '                                            
SER  CSR                   MOVE ' '       RRTX                                  
SER  CSR                   ENDIF                                                
SER  CSR         SHEXR1    IFEQ 'S '                                            
SER  CSR         #XSTAM    ANDEQ*ZERO                                           
SER  CSR                   MOVE ' '       RRTX                                  
SER  CSR                   ENDIF                                                
SER  CSR         RRTX      IFEQ 'N'                                             
SER  CSR         RRTX      OREQ 'O'                                             
SER  CSR                   MOVE ' '       RRTX                                  
SER  CSR                   ENDIF                                                
SER   *                                                                         
     CSR                   WRITEDETAIL1                OF                       
      *                    ------------                                         
S3560CSR         HLDAN8    IFEQ 33039624                                        
S3560CSR         RRUM      IFEQ '5G'                                            
S3560CSR         SDUPRC    DIV  10000     ISMCST  94                            
S3560CSR         ISMCST    DIV  5         ISMCST                                
      *                                                                         
S3560CSR                   MOVELISMCST    ISMCS1                                
      *                                                                         
S3560CSR                   MOVELPPG       PPG1                                  
S3560CSR                   WRITEDTL1                   OF                       
S3560CSR                   ENDIF                                                
S3560CSR         RRUM      IFEQ '55'                                            
S3560CSR         SDUPRC    DIV  10000     ISMCST                                
S3560CSR         ISMCST    DIV  55        ISMCST                                
S3560CSR                   MOVELISMCST    ISMCS1                                
S3560CSR                   MOVELPPG       PPG1                                  
S3560CSR                   WRITEDTL1                   OF                       
S3560CSR                   ENDIF                                                
S3560CSR                   ENDIF                                                
      *                    ------------                                         
S5717CSR                   Z-ADD*ZEROS    PRTLBS  20                            
S5717CSR         $5ING     IFGT *BLANKS                                         
S5717CSR         RRUM      IFEQ 'GL'                                            
S5717CSR         RRUM      OREQ 'QT'                                            
S5717CSR         RRUM      OREQ '5G'                                            
S5717CSR         RRUM      OREQ '4G'                                            
S5717CSR         RRUM      OREQ '30'                                            
S5717CSR         RRUM      OREQ '40'                                            
S5717CSR         RRUM      OREQ '50'                                            
S5717CSR         RRUM      OREQ '55'                                            
S5717CSR                   MOVEL'*INMG'   WAPP                                  
S5717CSR                   MOVEL$5ING     CKEY                                  
S5717CSR         A5KEY     CHAINF00163               88                         
S5717CSR         *IN88     IFEQ *OFF                                            
S5717CSR         C5SERK    SETLLF0016                                           
S5717CSR         C5SERK    READEF0016                    87                     
S5717CSR         *IN87     DOWEQ*OFF                                            
S5717CSR                   MOVELCYWTXT    TSTTXT  7                             
S5717CSR         TSTTXT    IFEQ '<<LBS>>'                                       
S5717CSR                   ADD  1         PRTLBS                                
S5717CSR                   ENDIF                                                
S5717CSR         C5SERK    READEF0016                    87                     
S5717CSR                   ENDDO                                                
S5717CSR         PRTLBS    IFGT *ZEROS                                          
S5717CSR                   MOVE *BLANKS   UMMCU                                 
S5717CSR                   Z-ADDSDITM     UMITM                                 
S5717CSR                   MOVELRRUM      UMUM                                  
S5717CSR                   MOVEL'LB'      UMRUM                                 
S5717CSR         UMKY01    CHAINF41002               53                         
S5717CSR         *IN53     IFEQ *OFF                                            
S5717CSR         UMCONV    DIV  10000000  HLDPND 114                            
S5717CSR         HLDPND    MULT SDSOQS    GALPND 114                            
S5717CSR         GALPND    DIV  100       GALPND                                
S5717CSR                   WRITEDTL2                   OF                       
S5717CSR                   ENDIF                                                
S5717CSR                   ENDIF                                                
S5717CSR                   ENDIF                                                
S5717CSR                   ENDIF                                                
S5717CSR                   ENDIF                                                
S5717C******  MD           ENDIF                                                
      *                                                                         
S2595CSR                   MOVELSVTXA1    SDTXA1                                
     CSR                   ENDIF                                                
      *                                                                         
     CSR                   MOVE '0'       *IN40                                 
      *                                                                         
      *    Write EDI Invoice Header, if Final mode.                             
      *                                                                         
     CSR         $@EDI     IFEQ '1'                                             
     CSR         $@EDI     OREQ '2'                                             
      *                                                                         
     CSR         $$EDIH    IFEQ ' '                                             
     CSR                   EXSR WRTHD1                                          
      *                    ---- ------                                          
     CSR                   ENDIF                                                
      *                                                                         
      *    Write EDI detail line                                                
      *                                                                         
     CSR                   EXSR WRTDT1                                          
      *                    ---- ------                                          
     CSR                   ENDIF                                                
      *                                                                         
      *    Add to number of records written field                               
      *                                                                         
     CSR                   ADD  1         $$RCD                                 
      *                                                                         
      *    Add line extension to total order amount                             
      *                                                                         
B5   CSR         $@EXBO    IFEQ '1'                                             
     CSR         SDSOBK    ANDNE0                                               
     CSR         SDRLIT    ANDEQ*BLANKS                                         
     CSR         SDSOQS    ADD  SDSOBK    $WKQTY 150                            
      *                                                                         
      *    Convert quantity ordered to other units of measure                   
      *                                                                         
     CSR         $WKQTY    DIV  #@SOBK    #QTY      H                           
     CSR                   MOVE SDUOM     #UOM                                  
     CSR                   MOVE SDUOM4    #UOM1                                 
     CSR                   MOVELSDMCU     #MCU                                  
     CSR                   MOVE LFIVI     #IVI                                  
     CSR                   MOVE SDCOMM    #READ                                 
     CSR                   MOVE *BLANKS   #OT1Y                                 
     CSR                   Z-ADD*ZEROS    #STDP                                 
     CSR                   MOVEL*BLANKS   #LOTN                                 
      *                                                                         
     CSR                   CALL 'X41002  '             98                       
      *                    ---- ----------                                      
     CSR                   PARM           DS4101                                
     CSR                   PARM           DS@UOM                                
      *                                                                         
B6   CSR         #ERTST    IFEQ '1'                                             
     CSR                   Z-ADD1         #CNVP                                 
     CSR                   Z-ADD1         #CNVQ                                 
E6   CSR                   ENDIF                                                
      *                                                                         
     CSR         SDFUP     DIV  #@FUP     $WK299    H                           
     CSR                   DIV  #CNVP     $WK299    H                           
     CSR                   MULT #PQT      $WK299    H                           
     CSR         $WK299    MULT #@FDO     $WK150    H                           
     CSR         SDSOQS    ADD  SDSOBK    $WKQTY 150                            
      *                                                                         
      *    Convert quantity ordered to other units of measure                   
      *                                                                         
     CSR         $WKQTY    DIV  #@SOBK    #QTY      H                           
     CSR                   MOVE SDUOM     #UOM                                  
     CSR                   MOVE SDUOM4    #UOM1                                 
     CSR                   MOVELSDMCU     #MCU                                  
     CSR                   MOVE LFIVI     #IVI                                  
     CSR                   MOVE SDCOMM    #READ                                 
     CSR                   MOVE *BLANKS   #OT1Y                                 
     CSR                   Z-ADD*ZEROS    #STDP                                 
     CSR                   MOVEL*BLANKS   #LOTN                                 
      *                                                                         
     CSR                   CALL 'X41002  '             98                       
      *                    ---- ----------                                      
     CSR                   PARM           DS4101                                
     CSR                   PARM           DS@UOM                                
      *                                                                         
B6   CSR         #ERTST    IFEQ '1'                                             
     CSR                   Z-ADD1         #CNVP                                 
     CSR                   Z-ADD1         #CNVQ                                 
E6   CSR                   ENDIF                                                
      *                                                                         
     CSR         SDUPRC    DIV  #@UPRC    $WK299    H                           
     CSR                   DIV  #CNVP     $WK299    H                           
     CSR                   MULT #PQT      $WK299    H                           
     CSR         $WK299    MULT #@AEXP    $WK150    H                           
X5   CSR                   ELSE                                                 
     CSR         $@IC      IFEQ ' '                                             
     CSR                   ADD  SDAEXP    $#ATO  150                            
     CSR                   ADD  SDFEA     $FTOTL 150                            
     CSR                   ELSE                                                 
     CSR                   ADD  SDAEXP    $#ATO                                 
     CSR                   ADD  SDFEA     $FTOTL                                
     CSR                   ENDIF                                                
E5   CSR                   ENDIF                                                
      *                                                                         
      *    Total Amounts Cash Discount                                          
      *                                                                         
B5   CSR         $@DISC    IFEQ '1'                                             
     CSR         LFCDSC    ANDEQ'Y'                                             
     CSR                   ADD  SDAEXP    $$CEXP                                
     CSR                   ADD  SDFEA     $FCEXP                                
      *                                                                         
     CSR         SDCADC    DIV  #@CADC    $$CD   153                            
     CSR                   DIV  100       $$CD                                  
      *                                                                         
     CSR         $$CD      MULT SDAEXP    $LCDIS 150                            
     CSR                   ADD  $LCDIS    $OCDIS 150                            
     CSR         $$CD      MULT SDFEA     $FLDIS 150                            
     CSR                   ADD  $FLDIS    $FODIS 150                            
E5   CSR                   ENDIF                                                
      *                                                                         
      *    Perform Tax Calculations.                                            
      *                                                                         
     CSR         $@IC      IFEQ ' '                                             
     CSR                   EXSR S010C                                           
      *                    ----------                                           
     CSR                   ENDIF                                                
      *                                                                         
      *    Create the EDI Tag Record                                            
      *                                                                         
     CSR         $@EDI     IFEQ '1'                                             
     CSR         $@EDI     OREQ '2'                                             
     CSR                   EXSR WRTDT2                                          
      *                    ---- ------                                          
     CSR                   ENDIF                                                
23271 * Mexico - write detail to Factura stage file                             
23271C           *IN76     IFEQ *ON                                             
23276C           $$USE     ANDEQ'ON'                                            
23256C                     EXSR S010F                                           
23256 *                    ---- ------                                          
23271C                     ENDIF                                                
      *                                                                         
      *    Print Adjustment History                                             
      *                                                                         
     CSR                   EXSR S010PR                                          
      *                    ---- ------                                          
      *                                                                         
      *    Print serial numbers based on processing option                      
      *                                                                         
B5   CSR         LFTXYN    IFNE 'Y'                                             
     CSR         LFIVI     ANDNE'N'                                             
     CSR         LFIVI     ANDNE'A'                                             
      *                                                                         
B6   CSR         $@SRL     IFEQ '1'                                             
     CSR                   EXSR S010S                                           
      *                    ---- -----                                           
E6   CSR                   ENDIF                                                
E5   CSR                   ENDIF                                                
E4   CSR                   ENDIF                                                
      *                                                                         
      *    Process Text Lines - Print after detail line                         
      *                                                                         
     CSR                   MOVE 'A'       $$TEXT  1                             
      *                                                                         
      *    Print Item Note after line                                           
      *                                                                         
     CSR                   Z-ADDSDITM     PSITM                                 
     CSR                   MOVE *BLANKS   PSINMG                                
25920C  N76N77             EXSR S010T                                           
      *                    ---- -----                                           
      *                                                                         
      *   Print Detail level message if there is one and the message            
      *    is set to print after any detail lines.                              
      *                                                                         
     CSR                   MOVELSDINMG    PSINMG                                
     CSR                   MOVEL*ZEROS    PSITM                                 
25920C  N76N77             EXSR S010T                                           
      *                    ---- -----                                           
      *                                                                         
      *   Print Preference Print Messages for detail level and the msg          
      *    is set to print after any detail lines.                              
      *                                                                         
     CSR                   MOVEL*BLANKS   PREC                                  
     CSR                   MOVEL*BLANKS   DSPRNT                                
     CSR                   MOVEL'0'       PSTAT                                 
     CSR                   Z-ADD#KYL2     PKEYL                                 
      *                                                                         
     CSR         PSTAT     DOWEQ'0'                                             
     CSR                   CALL 'X00IDX'                                        
      *                    ---- --------                                        
     CSR                   PARM           DS#IDX           index name           
     CSR                   PARM 'I'       PACTN   1        action               
     CSR                   PARM 'GT'      PRULE   2        rule                 
     CSR                   PARM           PKEYL   30       key length           
     CSR                   PARM DSPRNT    PKEY  120        key value            
     CSR                   PARM #RCL2     PRECL   30       record length        
     CSR                   PARM           PREC  210        record length        
     CSR                   PARM           PSTAT            record value         
      *                                                                         
     CSR         PSTAT     IFEQ '0'                                             
DBN  CSR                   MOVELPREC      DSPRNT                                
     CSR         DS#TYP    IFEQ 'D'                                             
     CSR                   MOVE DSINMG    PSINMG                                
     CSR                   MOVEL*ZEROS    PSITM                                 
25920C  N76N77             EXSR S010T                                           
      *                    ---- -----                                           
     CSR                   ELSE                                                 
     CSR                   MOVEL'1'       PSTAT                                 
     CSR                   END                                                  
     CSR                   END                                                  
      *                                                                         
     CSR                   Z-ADD#KYL3     PKEYL                                 
     CSR                   ENDDO                                                
      *                                                                         
      *    Check for associated text to print after based on                    
      *      Processing Option                                                  
      *                                                                         
B4   CSR         $@ASTX    IFEQ '1'                                             
S5927CSR         *INLR     ANDEQ*OFF                                            
     CSR                   MOVE SDDOCO    JMDOCO                                
     CSR                   MOVE SDDCTO    JMDCTO                                
     CSR                   MOVE SDKCOO    JMKCOO                                
     CSR                   Z-ADDSDLNID    JMLNID                                
27486 * this one really didn't control before notes for Facturas                
25920C  N76N77             EXSR S010V                                           
27486C*                    EXSR S010V                                           
      *                    ---- -----                                           
E4   CSR                   ENDIF                                                
      *                                                                         
      *                                                                         
      *    Print totals and first detail line                                   
      *                                                                         
X3   CSR                   ELSE                                                 
      *                                                                         
      *----------------------------------------------------------------         
      *                                                                         
      *    Save Current Foreign Currency Decimals                               
      *                                                                         
     CSR                   MOVE $FDO      $$FDO1  1                             
     CSR                   MOVE $CDO      $$CDO1  1                             
     CSR                   Z-ADD#@FDO     $@FDO1 110                            
     CSR                   Z-ADD#@CDO     $@CDO1 110                            
      *                                                                         
      *    Retreive Previous Foreign Currency Decimals                          
      *                                                                         
B4   CSR         *INLR     IFNE '1'                                             
     CSR                   MOVE $$FDO     $FDO                                  
     CSR                   MOVE $$CDO     $CDO                                  
     CSR                   Z-ADD$@FDO     #@FDO                                 
     CSR                   Z-ADD$@CDO     #@CDO                                 
E4   CSR                   ENDIF                                                
      *                                                                         
      *    Print tax summary subtotals                                          
      *                                                                         
B4   CSR         $@VAT     IFNE *BLANKS                                         
     CSR         $TAX      ANDEQ'Y'                                             
     CSR                   EXSR S010X                                           
      *                    ---- -----                                           
E4   CSR                   ENDIF                                                
      *                                                                         
     CSR         $RND      IFEQ '1'                                             
      *                                                                         
      *    Calculate Order Total Tax                                            
      *                                                                         
     CSR                   Z-ADD*ZEROS    $WK299 299                            
     CSR                   Z-ADD*ZEROS    $#ATT                                 
     CSR                   MOVE *BLANKS   DSKY$1                                
     CSR                   MOVEL*BLANKS   K1TXA1                                
     CSR                   Z-ADD*ZEROS    K1ITM                                 
     CSR                   MOVE *BLANKS   K1EXR1                                
     CSR                   MOVE 'I'       PACTN                                 
     CSR                   MOVE 'GE'      PRULE                                 
     CSR                   MOVE '0'       PSTAT1                                
      *                                                                         
     CSR         PSTAT1    DOWEQ'0'                                             
      *                                                                         
     CSR                   MOVE *BLANKS   PKEY                                  
DBN12CSR                   MOVELDSKY$1    PKEY                                  
      *                                                                         
     CSR                   EXSR S0041                                           
      *                    ---- -----                                           
      *                                                                         
     CSR         $1TXA1    IFEQ K1TXA1                                          
     CSR         $1ITM1    ANDEQK1ITM                                           
     CSR         $1EXR1    ANDEQK1EXR1                                          
     CSR         $1TAX1    ANDEQK1TAX1                                          
     CSR                   MOVE '1'       PSTAT1                                
     CSR                   END                                                  
      *                                                                         
     CSR         $1TXA1    IFNE K1TXA1                                          
     CSR         $1ITM1    ORNE K1ITM                                           
     CSR         $1EXR1    ORNE K1EXR1                                          
     CSR         PSTAT1    OREQ '1'                                             
     CSR                   Z-ADD$WK299    $WK150    H                           
     CSR                   ADD  $WK150    $#ATT                                 
S1203CSR                   Z-ADD*ZEROS    $WK299                                
     CSR                   END                                                  
      *                                                                         
     CSR         PSTAT1    IFEQ '0'                                             
      *                                                                         
     CSR         $1TAX1    IFNE 'N'                                             
     CSR                   ADD  $1UTAM    $WK299                                
     CSR                   END                                                  
      *                                                                         
     CSR                   MOVE *BLANKS   DSKY$1                                
     CSR                   MOVE $1TXA1    K1TXA1                                
     CSR                   MOVE $1ITM1    K1ITM                                 
     CSR                   MOVE $1EXR1    K1EXR1                                
     CSR                   MOVE $1TAX1    K1TAX1                                
     CSR                   MOVE 'GT'      PRULE                                 
      *                                                                         
     CSR                   END                                                  
     CSR                   END                                                  
      *                                                                         
      *    Clear user index.                                                    
      *                                                                         
     CSR                   Z-ADD1         PSKEYL  30                            
     CSR                   MOVE *BLANK    PKEY                                  
      *                                                                         
     CSR                   CALL 'X00IDX'                                        
      *                    ---- --------                                        
     CSR                   PARM           DSIDX1                                
     CSR                   PARM 'D'       PACTN                                 
     CSR                   PARM 'EQ'      PRULE                                 
     CSR                   PARM           PSKEYL                                
     CSR                   PARM           PKEY                                  
     CSR                   PARM           $IRCLN                                
     CSR                   PARM           DS$1                                  
     CSR                   PARM           PSTAT1                                
      *                                                                         
      *    Clear Rounding Summary flag.                                         
      *                                                                         
     C****                 MOVE ' '       $RND                                  
     CSR                   END                                                  
S7312 *                                                                         
S7312 *----------------------------------------------------------------         
S7312 *                                                                         
S7312 *    Move to report - Amount - Subtotal                                   
S7312 *                                                                         
S7312CSR         *IN76     IFEQ '1'                                             
S7312 *                                                                         
S7312CSR         $@CURR    IFEQ '1'                                             
S7312CSR                   Z-ADD$FTOTL    $WK150                                
S7312CSR                   ELSE                                                 
S7312CSR                   Z-ADD$#ATO     $WK150                                
S7312CSR                   ENDIF                                                
S7312 *                                                                         
S7312CSR                   MOVE *BLANK    #SINBR                                
S7312CSR                   MOVE $WK150    #SINBR                                
S7312CSR                   MOVE T@FEA     #DTYP                                 
S7312CSR                   MOVE W@FEA     #EWRD                                 
S7312CSR                   MOVE E@FEA     #EC                                   
S7312CSR                   MOVE F@FEA     #DSPD                                 
S7312CSR                   MOVE G@FEA     #DATD                                 
S7312CSR                   MOVE J@FEA     #ALR                                  
S7312CSR                   MOVE ' '       #ECOR                                 
S7312CSR                   MOVE ' '       #DCOR                                 
S7312CSR                   EXSR C00161                                          
S7312C*                    ---- ------                                          
S7312CSR         #ALR      IFEQ 'L'                                             
S7312CSR                   MOVEL#SINBR    RRSBT                                 
S7312CSR                   ELSE                                                 
S7312CSR                   MOVE #SINBR    RRSBT                                 
S7312CSR                   ENDIF                                                
S7312 *                                                                         
S7312CSR                   ENDIF                                                
      *                                                                         
      *----------------------------------------------------------------         
      *                                                                         
      *    Move to report - Amount - Total Order Price                          
      *                                                                         
B4   CSR         $@CNV     IFEQ '1'                                             
     CSR         $@CURR    ANDEQ'1'                                             
      *                                                                         
      *    Display Foreign Tax                                                  
      *                                                                         
     CSR                   Z-ADD$FTOTL    $WK150 150                            
     CSR                   ADD  $#ATT     $WK150                                
S7312CSR                   Z-ADD$WK150    $INTOT 150       Invoice Total        
      *                                                                         
     CSR                   MOVE *BLANK    #SINBR                                
     CSR                   MOVE $WK150    #SINBR                                
     CSR                   MOVE T@FEA     #DTYP                                 
     CSR                   MOVE W@FEA     #EWRD                                 
     CSR                   MOVE E@FEA     #EC                                   
     CSR                   MOVE $FDO      #DSPD                                 
     CSR                   MOVE G@FEA     #DATD                                 
     CSR                   MOVE J@FEA     #ALR                                  
     CSR                   MOVE ' '       #ECOR                                 
     CSR                   MOVE ' '       #DCOR                                 
     CSR                   EXSR C00161                                          
      *                    ---- ------                                          
B5   CSR         #ALR      IFEQ 'L'                                             
     CSR                   MOVEL#SINBR    RR#ATO                                
S7312CSR                   MOVEL#SINBR    RRMATO                                
X5   CSR                   ELSE                                                 
     CSR                   MOVE #SINBR    RR#ATO                                
S7312CSR                   MOVE #SINBR    RRMATO                                
E5   CSR                   ENDIF                                                
      *                                                                         
X4   CSR                   ELSE                                                 
      *                                                                         
      *    Display Domestic Tax                                                 
      *                                                                         
B5   CSR         $@CNV     IFEQ '1'                                             
     CSR         $@CURR    ANDEQ' '                                             
     CSR         $@IC      IFEQ ' '                                             
     CSR                   MOVE $CDO      #DSPD                                 
     CSR                   ELSE                                                 
     CSR                   MOVE $ICDO     #DSPD                                 
E5   CSR                   ENDIF                                                
E5   CSR                   ENDIF                                                
      *                                                                         
      *    No Foreign Currency                                                  
      *                                                                         
B5   CSR         $@CNV     IFNE '1'                                             
     CSR                   MOVE F@AEXP    #DSPD                                 
E5   CSR                   ENDIF                                                
      *                                                                         
     CSR                   Z-ADD$#ATO     $WK150                                
     CSR                   ADD  $#ATT     $WK150                                
S7312CSR                   Z-ADD$WK150    $INTOT 150       Invoice Total        
      *                                                                         
     CSR                   MOVE *BLANK    #SINBR                                
     CSR                   MOVE $WK150    #SINBR                                
     CSR                   MOVE T@AEXP    #DTYP                                 
     CSR                   MOVE W@AEXP    #EWRD                                 
     CSR                   MOVE E@AEXP    #EC                                   
     CSR                   MOVE G@AEXP    #DATD                                 
     CSR                   MOVE J@AEXP    #ALR                                  
     CSR                   MOVE ' '       #ECOR                                 
     CSR                   MOVE ' '       #DCOR                                 
     CSR                   EXSR C00161                                          
      *                    ---- ------                                          
B5   CSR         #ALR      IFEQ 'L'                                             
     CSR                   MOVEL#SINBR    RR#ATO                                
S7312CSR                   MOVEL#SINBR    RRMATO                                
X5   CSR                   ELSE                                                 
     CSR                   MOVE #SINBR    RR#ATO                                
S7312CSR                   MOVE #SINBR    RRMATO                                
E5   CSR                   ENDIF                                                
E4   CSR                   ENDIF                                                
      *-------------------------------------------------------------            
      *                                                                         
      *    Move to report - Amount - Total Sales Order Tax                      
      *                                                                         
     CSR                   MOVEL*BLANKS   RR#ATT                                
S7312CSR                   MOVEL*BLANKS   RRMATT                                
      *                                                                         
B4   CSR         $@CNV     IFEQ '1'                                             
     CSR         $@CURR    ANDEQ'1'                                             
      *                                                                         
      *    Display Foreign Tax                                                  
      *                                                                         
     CSR                   MOVE *BLANK    #SINBR                                
     CSR                   MOVEL$#ATT     #SINBR                                
     CSR                   MOVE T@FEA     #DTYP                                 
     CSR                   MOVE W@FEA     #EWRD                                 
     CSR                   MOVE E@FEA     #EC                                   
     CSR                   MOVE $FDO      #DSPD                                 
     CSR                   MOVE G@FEA     #DATD                                 
     CSR                   MOVE J@FEA     #ALR                                  
     CSR                   MOVE ' '       #ECOR                                 
     CSR                   MOVE ' '       #DCOR                                 
     CSR                   EXSR C00161                                          
      *                    ---- ------                                          
B5   CSR         #ALR      IFEQ 'L'                                             
     CSR                   MOVEL#SINBR    RR#ATT                                
S7312CSR                   MOVEL#SINBR    RRMATT                                
X5   CSR                   ELSE                                                 
     CSR                   MOVE #SINBR    RR#ATT                                
S7312CSR                   MOVE #SINBR    RRMATT                                
E5   CSR                   ENDIF                                                
      *                                                                         
X4   CSR                   ELSE                                                 
      *                                                                         
      *    Display Domestic Tax                                                 
      *                                                                         
B5   CSR         $@CNV     IFEQ '1'                                             
     CSR         $@CURR    ANDEQ' '                                             
     CSR                   MOVE $CDO      #DSPD                                 
E5   CSR                   ENDIF                                                
      *                                                                         
      *    No Foreign Currency                                                  
      *                                                                         
B5   CSR         $@CNV     IFNE '1'                                             
     CSR                   MOVE F@AEXP    #DSPD                                 
E5   CSR                   ENDIF                                                
      *                                                                         
     CSR                   MOVE *BLANK    #SINBR                                
     CSR                   MOVEL$#ATT     #SINBR                                
     CSR                   MOVE T@AEXP    #DTYP                                 
     CSR                   MOVE W@AEXP    #EWRD                                 
     CSR                   MOVE E@AEXP    #EC                                   
     CSR                   MOVE G@AEXP    #DATD                                 
     CSR                   MOVE J@AEXP    #ALR                                  
     CSR                   MOVE ' '       #ECOR                                 
     CSR                   MOVE ' '       #DCOR                                 
     CSR                   EXSR C00161                                          
      *                    ---- ------                                          
B5   CSR         #ALR      IFEQ 'L'                                             
     CSR                   MOVEL#SINBR    RR#ATT                                
S7312CSR                   MOVEL#SINBR    RRMATT                                
X5   CSR                   ELSE                                                 
     CSR                   MOVE #SINBR    RR#ATT                                
S7312CSR                   MOVE #SINBR    RRMATT                                
E5   CSR                   ENDIF                                                
      *                                                                         
E4   CSR                   ENDIF                                                
S5599 *----------------------------------------------------------------         
S5599 *                                                                         
S5599 *    List separate Tax Rates for Canadian invoices                        
S5599 *                                                                         
S5599C           *IN56     IFEQ *ON                        Canada               
S5599C           #XTXR1    IFNE 0                          #XTXR1               
S5599C           #XTXR1    DIV  1000      #R1     52                            
S5599C                     ENDIF                           #XTXR1               
S5599C           #XTXR2    IFNE 0                          #XTXR2               
S5599C           #XTXR2    DIV  1000      #R2     52                            
S5599C                     ENDIF                           #XTXR2               
S5599C           #XTXR3    IFNE 0                          #XTXR3               
S5599C           #XTXR3    DIV  1000      #R3     52                            
S5599C                     ENDIF                           #XTXR3               
S5599C           #XTXR4    IFNE 0                          #XTXR4               
S5599C           #XTXR4    DIV  1000      #R4     52                            
S5599C                     ENDIF                           #XTXR4               
S5599C                     ENDIF                           Canada               
      *----------------------------------------------------------------         
      *                                                                         
      *    Move to report - Total Area Tax Rate                                 
      *                                                                         
B4   CSR         $MLTTX    IFEQ ' '                                             
     CSR                   MOVE *BLANK    #SINBR                                
     CSR                   MOVEL$SVTAX    #SINBR                                
     CSR                   MOVE T@TRAT    #DTYP                                 
     CSR                   MOVE W@TRAT    #EWRD                                 
     CSR                   MOVE E@TRAT    #EC                                   
     CSR                   MOVE F@TRAT    #DSPD                                 
     CSR                   MOVE G@TRAT    #DATD                                 
     CSR                   MOVE J@TRAT    #ALR                                  
     CSR                   MOVE ' '       #ECOR                                 
     CSR                   MOVE ' '       #DCOR                                 
     CSR                   EXSR C00161                                          
      *                    ---- ------                                          
B5   CSR         #ALR      IFEQ 'L'                                             
     CSR                   MOVEL#SINBR    RRTRAT                                
X5   CSR                   ELSE                                                 
     CSR                   MOVE #SINBR    RRTRAT                                
E5   CSR                   ENDIF                                                
      *                                                                         
      *    If multiple taxes, move * N/A * to total area tax rate               
      *                                                                         
X4   CSR                   ELSE                                                 
     CSR                   MOVE *BLANK    RRTRAT                                
     CSR                   CLEAR@UA                                             
     CSR                   MOVEAVTX018    @UA                                   
     CSR                   Z-ADD7         #OUTLG                                
     CSR                   EXSR C9822                                           
      *                    ---- -----                                           
     CSR                   MOVEA@UB       RRTRAT                                
E4   CSR                   ENDIF                                                
S3162CSR                   MOVELVTX022    RRX022    P                           
S3162CSR         RRTRAT    IFEQ *BLANKS                                         
S3162CSR                   MOVE *BLANKS   RRX022                                
S3162CSR                   ENDIF                                                
      *                                                                         
      *----------------------------------------------------------------         
      *                                                                         
      *    Move to report - Discount Available                                  
      *                                                                         
     CSR                   MOVE *BLANKS   RRADSC                                
     CSR                   MOVE '0'       *IN30                                 
B4   CSR         $@DISC    IFEQ '1'                                             
      *                                                                         
      *    Add Cash Discount Amount                                             
      *                                                                         
     CSR                   ADD  $OCDIS    $$DAMT                                
     CSR                   ADD  $FODIS    $FDAMT                                
      *                                                                         
      *    Display Foreign Discount Available                                   
      *                                                                         
B5   CSR         $@CNV     IFEQ '1'                                             
     CSR         $@CURR    ANDEQ'1'                                             
     CSR                   MOVE *BLANK    #SINBR                                
     CSR                   MOVEL$FDAMT    #SINBR                                
     CSR                   MOVE T@CDS     #DTYP                                 
     CSR                   MOVE W@CDS     #EWRD                                 
     CSR                   MOVE E@CDS     #EC                                   
     CSR                   MOVE $FDO      #DSPD                                 
     CSR                   MOVE G@CDS     #DATD                                 
     CSR                   MOVE J@CDS     #ALR                                  
     CSR                   MOVE ' '       #ECOR                                 
     CSR                   MOVE ' '       #DCOR                                 
     CSR                   EXSR C00161                                          
      *                    ---- ------                                          
B6   CSR         #ALR      IFEQ 'L'                                             
     CSR                   MOVEL#SINBR    RRADSC                                
X6   CSR                   ELSE                                                 
     CSR                   MOVE #SINBR    RRADSC                                
E6   CSR                   ENDIF                                                
      *                                                                         
X5   CSR                   ELSE                                                 
      *                                                                         
      *    Display Domestic Discount Available                                  
      *                                                                         
B6   CSR         $@CNV     IFEQ '1'                                             
     CSR         $@CURR    ANDEQ' '                                             
     CSR                   MOVE $CDO      #DSPD                                 
E6   CSR                   ENDIF                                                
      *                                                                         
      *    No Foreign Currency                                                  
      *                                                                         
B6   CSR         $@CNV     IFNE '1'                                             
     CSR                   MOVE F@ADSC    #DSPD                                 
E6   CSR                   ENDIF                                                
      *                                                                         
     CSR                   MOVE *BLANK    #SINBR                                
     CSR                   MOVE $$DAMT    #SINBR                                
     CSR                   MOVE T@ADSC    #DTYP                                 
     CSR                   MOVE W@ADSC    #EWRD                                 
     CSR                   MOVE E@ADSC    #EC                                   
     CSR                   MOVE G@ADSC    #DATD                                 
     CSR                   MOVE J@ADSC    #ALR                                  
     CSR                   MOVE ' '       #ECOR                                 
     CSR                   MOVE ' '       #DCOR                                 
     CSR                   EXSR C00161                                          
      *                    ---- ------                                          
B6   CSR         #ALR      IFEQ 'L'                                             
     CSR                   MOVEL#SINBR    RRADSC                                
X6   CSR                   ELSE                                                 
     CSR                   MOVE #SINBR    RRADSC                                
E6   CSR                   ENDIF                                                
E5   CSR                   ENDIF                                                
      *                                                                         
      *    If discount available is blank, don't print text                     
      *                                                                         
     CSR                   MOVE '1'       *IN30                                 
B5   CSR         RRADSC    IFEQ *BLANKS                                         
     CSR                   MOVE '0'       *IN30                                 
E5   CSR                   ENDIF                                                
      *                                                                         
E4   CSR                   ENDIF                                                
      *----------------------------------------------------------------         
      *                                                                         
      *    Calculate difference between overflow line and current line          
      *    to determine if the heading should be printed before totals.         
      *                                                                         
     CSR         @@OFLN    SUB  @@CLNO    $$DIFF  30                            
B4   CSR         *INOF     IFEQ '1'                                             
     CSR         $$DIFF    ORLE $TOTL                                           
     CSR                   Z-ADD$#PG      $$PGSV  40                            
     CSR                   Z-ADD##PGSV    $#PG                                  
     CSR                   EXSR S010H                                           
      *                    ---- -----                                           
     CSR                   Z-ADD$#PG      ##PGSV                                
     CSR                   Z-ADD$$PGSV    $#PG                                  
E4   CSR                   ENDIF                                                
      *                                                                         
     CSR                   MOVE 'A'       $$TEXT  1                             
      *                                                                         
      *   Print Header level message if there is one and the message            
      *    is set to print after any detail lines.                              
      *                                                                         
     CSR                   MOVELSHINMG    $$INMG                                
     CSR                   MOVELSVINMG    SHINMG                                
      *                                                                         
     CSR         $HFLAG    IFEQ *BLANKS                                         
     CSR                   MOVELSHINMG    PSINMG                                
     CSR                   MOVEL*ZEROS    PSITM                                 
     CSR                   MOVEL'1'       $$HFLG  1                             
     CSR                   EXSR S010T                                           
      *                    ---- -----                                           
     CSR         $PRT      IFEQ '1'                                             
     CSR                   MOVEL'1'       $HFLAG                                
     CSR                   MOVEL' '       $$HFLG                                
     C*R                   MOVEL*BLANKS   SVINMG                                
     CSR                   ENDIF                                                
     CSR                   ENDIF                                                
      *                                                                         
     CSR                   MOVEL$$INMG    SHINMG                                
      *                                                                         
      *    Check for associated text to print after based on                    
      *      Processing Option                                                  
      *                                                                         
     CSR         $@ASTX    IFEQ '1'                                             
     CSR         $ATHR     ANDEQ*BLANKS                                         
     CSR                   MOVE SHDOCO    JMDOCO                                
     CSR                   MOVE SHDCTO    JMDCTO                                
     CSR                   MOVE SHKCOO    JMKCOO                                
     CSR                   Z-ADD*ZEROS    JMLNID                                
27486C                     EXSR S010V                                           
27486C* N76N77             EXSR S010V                                           
      *                    ---- -----                                           
     CSR                   END                                                  
      *                                                                         
      *   Print Global message if one is entered in the Proc. Options           
      *    and the message is set to print after any detail lines               
      *                                                                         
     CSR         $PFLAG    IFEQ *BLANKS                                         
     CSR                   MOVEL$@INMG    PSINMG                                
     CSR                   MOVEL*ZEROS    PSITM                                 
25920C  N76N77             EXSR S010T                                           
      *                    ---- -----                                           
      *                                                                         
     CSR         $PRT      IFEQ '1'                                             
     CSR                   MOVE '1'       $PFLAG  1                             
     CSR                   ENDIF                                                
     CSR                   ENDIF                                                
      *                                                                         
      *    Calculate difference between overflow line and number of             
      *    lines in the total.  If not at the bottom of the form,               
      *    write a blank line.                                                  
      *                                                                         
      *    Write order total                                                    
      *                                                                         
     CSR         $@EDI     IFNE '2'                                             
SER  CSR         RR#ATT    IFNE *BLANKS                                         
SER  CSR                   SETON                     44                         
SER  CSR                   ENDIF                                                
SER   *                                                                         
S5599 *----------------------------------------------------------------         
S5599 *    Print Currency Verbage on invoice based on Currency Code             
S5599 *        within Customer Master                                           
S6042C                     MOVE *OFF      *IN59            US $                 
S6042C* S7312              MOVE *OFF      *IN57            Canadian $           
S6042C* S7312              MOVE *OFF      *IN77            Mexican Peso         
S5599C* S7312    HLDAN8    CHAINF0301                99                         
S5599C* S6042    *IN99     IFEQ *OFF                                            
S5599C* S6042    A5CRCD    IFEQ 'CAD'                                           
S5599C* S6042              MOVE *ON       *IN57                                 
S5599C* S6042              ELSE                                                 
S5599C* S6042              MOVE *OFF      *IN57                                 
S5599C* S6042              ENDIF                                                
S5599C* S6042              ELSE                                                 
S5599C* S6042              MOVE *OFF      *IN57                                 
S5599C* S6042              ENDIF                                                
S6042C* S7312    *IN99     IFEQ *OFF                                            
S6042C* S7312    A5CRCD    IFEQ 'USD'                                           
S6042C* S7312              MOVE *ON       *IN59            US $                 
S6042C* S7312              ELSE                                                 
S6042C* S7312    A5CRCD    IFEQ 'CAD'                                           
S6042C* S7312              MOVE *ON       *IN57            Canadian $           
S6042C* S7312              ELSE                                                 
S6042C* S7312    A5CRCD    IFEQ 'MXP'                                           
S6042C* S7312              MOVE *ON       *IN77            Mexican Peso         
S6042C* S7312              ELSE                                                 
S6042C* S7312              MOVE *ON       *IN59            US $ default         
S6042C* S7312              ENDIF                                                
S6042C* S7312              ENDIF                                                
S6042C* S7312              ENDIF                                                
S6042C* S7312              ELSE                                                 
S6042C* S7312              MOVE *ON       *IN59            US $ default         
S6042C* S7312              ENDIF                                                
S5599 *                                                                         
S3486CSR         HLDAN8    IFEQ 33224278                   Mattel Malay         
S3486CSR         HLDAN8    OREQ 34001248                   Mattel Banko         
S3486CSR                   MOVE *ON       *IN55                                 
S3486CSR                   ELSE                                                 
S3486CSR                   MOVE *OFF      *IN55                                 
S3486CSR                   ENDIF                                                
S5651CSR         RRTRAT    IFGT *BLANKS                                         
S5651CSR         RR#ATT    ORGT *BLANKS                                         
S5651CSR                   MOVE *ON       *IN34                                 
S5651CSR                   ELSE                                                 
S5651CSR                   MOVE *OFF      *IN34                                 
S5651CSR                   ENDIF                                                
S5651C*** S7312  SVVERS    IFEQ CANVER                                          
S5651C*** S7312  SVVERS    OREQ USVER                                           
S5651C*** S7312  SVVERS    OREQ CMEMO                                           
S5651C*** S7312            MOVE *ON       *IN75                                 
S5651C*** S7312            ELSE                                                 
S5651C*** S7312            MOVE *OFF      *IN75                                 
S5651C*** S7312            ENDIF                                                
S7312 * check for reprint version                                               
S7312CSR         SVVERS    IFEQ USUSDR                                          
S7312CSR         SVVERS    OREQ USCADR                                          
S7312CSR         SVVERS    OREQ USMXPR                                          
S7312CSR         SVVERS    OREQ CNUSDR                                          
S7312CSR         SVVERS    OREQ CNCADR                                          
S7312CSR         SVVERS    OREQ CNMXPR                                          
S7312CSR         SVVERS    OREQ MXUSDR                                          
S7312CSR         SVVERS    OREQ MXCADR                                          
S7312CSR         SVVERS    OREQ MXMXPR                                          
27250CSR         SVVERS    OREQ USAUDR                                          
S7312CSR                   MOVE *ON       *IN75            "Reprint"            
S7312CSR                   ELSE                                                 
S7312CSR                   MOVE *OFF      *IN75                                 
S7312CSR                   ENDIF                                                
      *----------------------------------------------------------------         
      * print tracking numbers                                                  
27295C                     MOVE *ON       *IN68            tracking number      
27295C                     MOVE *OFF      *IN69                                 
S652 C           KEY01     SETLLF56255                                          
S6527C           KEY01     READEF56255                   67                     
      *                                                                         
S6527C           *IN67     DOWEQ*OFF                                            
27295 * save header fields                                                      
27295C                     MOVE HFDOC     CFDOC   8        invoice no           
27295C                     MOVE HFDCT     CFDCT   2        doc type             
27295C                     MOVE HFDOCO    CFDOCO  8        order no             
27295C                     MOVE HFAN8     CFAN8   8        billto               
27295C                     MOVE HFSHAN    CFSHAN  8        ship to              
27295C                     MOVE HFDATE    CFDATE  8        ship date            
27295C                     MOVE HFADDJ    CFADDJ  6        actual ship          
27295C                     MOVE HFMCU     CFMCU   3        ship whse            
27295 *                                                                         
S6527C           EODUPJ    IFEQ HFADDJ                                          
S6527C           HFMCU     ANDEQ'310'                                           
27295 * print heading if necessary                                              
27295C           @@OFLN    SUB  @@CLNO    $$DIFF  30                            
27295C           *INOF     IFEQ '1'                                             
27295C           $$DIFF    ORLE $TOTL                                           
27295C                     Z-ADD$#PG      $$PGSV  40                            
27295 * disclosure statement at bottom of page                                  
27295C                     WRITETOTAL6                 OF                       
27295C                     ADD  1         $#PG                                  
27472C                     MOVE *ON       *IN32                                 
27295 * save and put back some header fields                                    
27295C                     MOVE SDDOC     RFDOC   8        invoice              
27295C                     MOVE SDDCT     RFDCT   2        doc type             
27295C                     MOVE RRDOCO    RFDOCO  8        order no             
27295C                     MOVE SHAN8     RFAN8   8        bill to              
27295C                     MOVE SHSHAN    RFSHAN  8        ship to              
27295 *                                                                         
27295C                     MOVE CFDOC     SDDOC            invoice              
27295C                     MOVE CFDCT     SDDCT            doc type             
27295C                     MOVE CFDOCO    RRDOCO           order no             
27295C                     MOVE CFAN8     SHAN8            bill to              
27295C                     MOVE CFSHAN    SHSHAN           ship to              
27295C                     EXSR S010H                                           
27295 *                    ---- -----                                           
27295C                     Z-ADD$#PG      ##PGSV                                
27295C                     Z-ADD$$PGSV    $#PG                                  
27295C                     MOVE *ON       *IN68            tracking number      
27295C                     MOVE *OFF      *IN69            space before         
27295 * put back header fields                                                  
27295C                     MOVE RFDOC     SDDOC            invoice              
27295C                     MOVE RFDCT     SDDCT            doc type             
27295C                     MOVE RFDOCO    RRDOCO           order no             
27295C                     MOVE RFAN8     SHAN8            bill to              
27295C                     MOVE RFSHAN    SHSHAN           ship to              
27295 * restore tracking no key index                                           
27295C                     MOVE CFDATE    HFDATE                                
27295C                     MOVE CFADDJ    HFADDJ                                
27295C                     MOVE CFMCU     HFMCU                                 
27295C                     ENDIF                                                
27295 * blank line before first time                                            
27295C  N69                WRITEDETAIL3B               OF                       
27295 *                                                                         
27295C                     MOVELEODTRK    RRTRC1                                
27295C                     MOVELEODCAR    RRCAR1                                
27295C                     WRITEDETAIL11               OF                       
27295C                     ELSE                                                 
27295C                     GOTO NONE                                            
27295C                     ENDIF                                                
27295C                     MOVE *OFF      *IN68                                 
27295C                     MOVE *ON       *IN69                                 
S6527C           KEY01     READEF56255                   67                     
S6527C                     ENDDO                                                
27295 * blank line after                                                        
27295C                     WRITEDETAIL3B               OF                       
S6527C           NONE      TAG                                                  
      *---------------------------------------------------------------          
S7312 *                                                                         
 7312 *  Convert numeric amount into Spanish words for Mexico                   
S7312 *                  amount in words                                        
S7312C           *IN76     IFEQ *ON                        Mexico               
S7312 *                                                                         
23256 * create TXT file and FTP to Solucion Factible                            
23256 * exclude SX orders (11.14.2011)                                          
23256 * execute based on OFF/ON switchs in UDC (11.15.2011)                     
23276 * moved UDC lookup to S999 (04.05.2012)                                   
23276 *                                                                         
23256 * USD - UDC 42 FS                                                         
23256C*                    MOVE *BLANKS   DRKY                                  
23256C*                    MOVE *BLANKS   $$USE                                 
23256C*                    MOVE '42  '    DRSY                                  
23256C*                    MOVE 'FS'      DRRT                                  
23256C*                    MOVEL'USE'     DRKY                                  
23256C*          DRKEY     CHAINF0005                31                         
23256C*          *IN31     IFEQ *OFF                                            
23256C*                    MOVELDRDL01    $$USE   3                             
23256C*                    ENDIF                                                
      *                                                                         
23271 * FTP - UDC 42 FS (02.14.2012)                                            
23271C*                    MOVE *BLANKS   DRKY                                  
23271C*                    MOVE *BLANKS   $$FTP                                 
23271C*                    MOVE '42  '    DRSY                                  
23271C*                    MOVE 'FS'      DRRT                                  
23271C*                    MOVEL'FTP'     DRKY                                  
23271C*          DRKEY     CHAINF0005                31                         
23271C*          *IN31     IFEQ *OFF                                            
23271C*                    MOVELDRDL01    $$FTP   3                             
23271C*                    ENDIF                                                
      *                                                                         
23256C           SDDCTO    IFNE 'SX'                                            
23256C           $$USE     ANDEQ'ON'                                            
23273C                     CLOSEF55029L2                                        
23273C                     CLOSEF55029                                          
      *                                                                         
23256C                     CALL 'J55029'                                        
23256 *                    ---- --------                                        
23256C                     PARM           W9FACT                                
23256C                     PARM           W9SERI                                
23271C                     PARM           $$FTP                                 
23256C                     ENDIF                                                
      *                                                                         
S7312C           $INTOT    IFLT 0                                               
S7312C                     MULT -1        $INTOT                                
S7312C                     ENDIF                                                
S7312 *                                                                         
S7312C                     CALL AMTWRD                 81                       
S7312 *                    ---- ------                                          
S7312CSR                   PARM           $INTOT                                
S7312CSR                   PARM           @L                                    
S7312 *                                                                         
S7312 *    If dollar amount in words is too large to fit on line                
S7312 *    of translation program does not exist or is in error,                
S7312 *    put in numeric check amount                                          
S7312 *                                                                         
S7312CSR         @L,84     IFNE '*'                                             
S7312CSR         *IN81     OREQ '1'                                             
S7312CSR                   MOVE '*'       @L                                    
S7312CSR                   MOVEA'    '    @L,1                                  
S7312CSR                   MOVEA'$'       @L,5                                  
S7312CSR                   MOVEARRMATO    @L,6                                  
S7312CSR                   ENDIF                                                
S7312 *                                                                         
S7312 *    If dollar amount in words is too large to fit on line                
S7312 *    put in numeric check amount                                          
S7312 *                                                                         
S7312CSR         $INTOT    IFGT 999999999                                       
S7312CSR                   MOVE '*'       @L                                    
S7312CSR                   MOVEA'    '    @L,1                                  
S7312CSR                   MOVEA'$'       @L,5                                  
S7312CSR                   MOVEARRMATO    @L,6                                  
S7312CSR                   ENDIF                                                
S7312 *                                                                         
S7312CSR                   MOVEA@L        RRWRDS                                
27836 * add USD to amount in words for Factura                                  
27836C           '*'       CHEKRRRWRDS    POS     30     35                     
27836C           *IN35     IFEQ *ON                                             
27836C                     ADD  1         POS                                   
27836C                     MOVEA'USD'     @L,POS                                
27836C                     MOVEA@L        RRWRDS                                
27836C                     ENDIF                                                
27836 *                                                                         
S7312C                     ELSE                                                 
S7312CSR                   MOVE *BLANKS   RRWRDS                                
S7312C                     ENDIF                                                
S7312 *                                                                         
S5651CSR                   WRITETOTAL5                 OF                       
S5651CSR                   WRITETOTAL6                 OF                       
S5651CSR                   SETON                     32                         
S5651CSR                   SETOF                     44                         
     CSR                   ENDIF                                                
      *                                                                         
      *    Write Additional Header Record                                       
      *                                                                         
     CSR         $@EDI     IFEQ '1'                                             
     CSR         $@EDI     OREQ '2'                                             
     CSR                   EXSR WRTHD2                                          
      *                    -----------                                          
     CSR                   ENDIF                                                
      *                                                                         
      *    Print draft                                                          
      *                                                                         
     CSR                   EXSR S010D                                           
      *                    ---- -----                                           
      *                                                                         
     CSR                   MOVE *ZEROS    $$RCD  150                            
     CSR                   MOVE *ZEROS    $#ATO                                 
     CSR                   MOVE *ZEROS    $#ATT                                 
     CSR                   MOVE *ZEROS    $FTOTL                                
     CSR                   MOVE *ZEROS    $SVTAX                                
     CSR                   MOVE *ZEROS    $SVITM                                
     CSR                   MOVE *ZEROS    $$TTAX                                
     CSR                   MOVE *BLANKS   $MLTTX  1                             
     CSR                   MOVE *BLANKS   $SVTX                                 
     CSR                   MOVE *BLANKS   $SVTXA                                
     CSR                   Z-ADD*ZEROS    $STTAX                                
     CSR                   MOVE *ZEROS    $$CEXP 150                            
     CSR                   MOVE *ZEROS    $FCEXP 150                            
     CSR                   MOVE *ZEROS    $OCDIS                                
     CSR                   MOVE *ZEROS    $FODIS                                
     CSR                   MOVE *ZEROS    $$DAMT                                
     CSR                   MOVE *ZEROS    $FDAMT                                
     CSR                   MOVE '1'       *IN02                                 
     CSR                   MOVE ' '       $PFLAG  1                             
     CSR                   MOVE ' '       $HFLAG  1                             
     CSR                   MOVE ' '       $ATHR                                 
     CSR                   MOVE *BLANKS   $PDOCO                                
     CSR                   MOVE *BLANKS   $PDCTO                                
     CSR                   MOVE *BLANKS   $PKCOO                                
     CSR                   MOVE ' '       $RND                                  
      *                                                                         
      *    Process break routine - Read Order Header File                       
      *                                                                         
B4   CSR         *INLR     IFEQ '0'                                             
     CSR                   EXSR S010B                                           
      *                    ---- -----                                           
E4   CSR                   ENDIF                                                
     CSR                   ADD  01        #G                                    
      *                                                                         
      *    Restore Current Foreign Currency Decimals                            
      *                                                                         
     CSR                   MOVE $$FDO1    $FDO                                  
     CSR                   MOVE $$CDO1    $CDO                                  
     CSR                   Z-ADD$@FDO1    #@FDO                                 
     CSR                   Z-ADD$@CDO1    #@CDO                                 
E3   CSR                   ENDIF                                                
E2   CSR                   ENDDO                                                
      *                                                                         
      *    Bypass printing the next record if the order is on hold,             
      *    or if no header record exists.                                       
      *                                                                         
     CSR         $#HDR     CABEQ'N'       END010                                
      *                    -----          ------                                
     CSR         SHHOLD    CABNE*BLANKS   END010                                
      *                    -----          ------                                
      *----------------------------------------------------------------         
E1   CSR                   ENDIF                                                
      *                                                                         
     CSR         *INLR     CABEQ'1'       END010                                
      *                    -----          ------                                
      *----------------------------------------------------------------         
      *                                                                         
      *    If page skip, set over flow indicator.                               
      *                                                                         
B1   CSR         $$PAGE    IFEQ '1'                                             
      *                                                                         
      *    If not breaking for totals and not last record, load                 
      *    header fields to report                                              
      *                                                                         
     CSR         $$L       IFEQ 0                                               
     CSR         *INLR     ANDEQ'0'                                             
     CSR                   EXSR S010B                                           
      *                    ---- -----                                           
     CSR                   ENDIF                                                
      *                                                                         
     CSR                   MOVE '1'       *INOF                                 
     CSR                   MOVE ' '       $$PAGE                                
     CSR                   MOVE '1'       *IN02                                 
     CSR                   MOVE ' '       $PFLAG  1                             
     CSR                   MOVE ' '       $HFLAG  1                             
     CSR                   MOVE ' '       $ATHR                                 
      *----------------------------------------------------------------         
      *                                                                         
      *    Move to output - A/R Invoice Number                                  
      *                                                                         
     CSR                   MOVEL*BLANKS   RR#DOC                                
     CSR                   MOVEL*BLANKS   RRDCT                                 
      *                                                                         
      *    If payment terms break - use the same document number.               
      *                                                                         
B2   CSR         $PTC      IFEQ '1'                                             
     CSR                   MOVE SVDOC     SDDOC                                 
     CSR                   MOVE SVDCT     SDDCT                                 
     CSR                   MOVE SVKCO     SDKCO                                 
E2   CSR                   ENDIF                                                
      *                                                                         
      *    Only save off invoice number if not running in proof mode            
      *                                                                         
     CSR         $@PRF     IFEQ ' '                                             
      *                                                                         
      *    Do not retrieve new number if one already exists.                    
      *                                                                         
     CSR                   MOVE SDDOC     SVDOC                                 
     CSR                   MOVE SDDCT     SVDCT                                 
     CSR                   MOVELSDKCO     SVKCO                                 
      *                                                                         
     CSR                   ENDIF                                                
      *                                                                         
B2   CSR         SDDOC     IFEQ *ZEROS                                          
     CSR         $PTC      ANDEQ' '                                             
     CSR         $@PRF     ANDEQ' '                                             
      *                                                                         
     CSR                   MOVELSHKCOO    SVKCO                                 
     CSR                   MOVELSHKCOO    SDKCO                                 
      *                                                                         
     CSR                   SETOF                     9899                       
      *                                                                         
      *    Edit julian date - Date - Order/Transaction                          
      *                                                                         
     CSR                   MOVE SHTRDJ    #SIDAT  6                             
     CSR                   MOVE *BLANK    #EDAT   8                             
     CSR                   MOVEL'*JUL    '#FFMT   7                             
     CSR                   MOVEL'*MDY    '#TFMT   7                             
     CSR                   MOVEL'*NONE   '#SEP    7                             
     CSR                   MOVEL' '       $ERTST  1                             
     CSR                   CALL 'X0028   '             99                       
      *                    ---- ----------                                      
     CSR                   PARM           #SIDAT                                
     CSR                   PARM           #EDAT                                 
     CSR                   PARM           #FFMT                                 
     CSR                   PARM           #TFMT                                 
     CSR                   PARM           #SEP                                  
     CSR                   PARM           $ERTST                                
     CSR                   MOVEL#SIDAT    $NBR6   6                             
      *                                                                         
      *    Edit julian date - Date - INVOICE DATE                               
      *                                                                         
     CSR                   MOVE $UDATE    #SIDAT  6                             
     CSR                   MOVE *BLANK    #EDAT   8                             
     CSR                   MOVEL'*JUL    '#FFMT   7                             
     CSR                   MOVEL'*MDY    '#TFMT   7                             
     CSR                   MOVEL'*NONE   '#SEP    7                             
     CSR                   MOVEL' '       $ERTST  1                             
     CSR                   CALL 'X0028   '             99                       
      *                    ---- ----------                                      
     CSR                   PARM           #SIDAT                                
     CSR                   PARM           #EDAT                                 
     CSR                   PARM           #FFMT                                 
     CSR                   PARM           #TFMT                                 
     CSR                   PARM           #SEP                                  
     CSR                   PARM           $ERTST                                
     CSR                   MOVEL#SIDAT    $INVDT  6                             
      *                                                                         
      *    Calculate Fiscal Year based on the invoice date.                     
      *                                                                         
     CSR                   MOVE '1'       #CALC                                 
     CSR                   MOVE SHKCOO    #CO                                   
     CSR                   MOVE $INVDT    #DG                                   
     CSR                   CALL 'X09031'                                        
      *                    ---- --------                                        
     CSR                   PARM           #CALC   1                             
     CSR                   PARM           #CO     5                             
     CSR                   PARM           #DG     60                            
     CSR                   PARM           #PN     20                            
     CSR                   PARM           #FY     20                            
     CSR                   PARM           #CTRY   20                            
     CSR                   PARM           #EDT    1                             
     CSR                   PARM ' '       #DGSY   1                             
     CSR                   PARM ' '       #JFLG   1                             
      *                                                                         
B3   CSR         *IN98     DOWEQ'0'                                             
      *                                                                         
      *    Automatic Next Number for - Document Number                          
      *       Next Numbers Table  :  03                                         
      *       Index to Table      :  $ARIN                                      
      *                                                                         
     CSR                   MOVE CCCRCD    $$CRCD  3                             
     CSR                   MOVE $ARIN     $$ARIN  2                             
     CSR                   MOVE *BLANKS   PSKCOO                                
     CSR                   MOVE SDKCO     PSKCOO                                
     CSR         $@IC      IFEQ '1'                                             
     CSR                   MOVE SDCO      PSKCOO                                
     CSR                   ENDIF                                                
     CSR                   CALL 'X0010'                82                       
      *                    ---- -------                                         
     CSR                   PARM '03'      PSSY    4                             
     CSR                   PARM $$ARIN    PSIDX   2                             
     CSR                   PARM *ZERO     #NXTNO  80                            
     CSR                   PARM $@DCT     PSDCTO  2                             
     CSR                   PARM *BLANKS   PSINQ   1                             
     CSR                   PARM           PSKCOO                                
     CSR                   PARM #CTRY     PSCTRY  20                            
     CSR                   PARM #FY       PSFY    20                            
     CSR                   MOVE $@DCT     SVDCT                                 
     CSR                   MOVE $@DCT     SDDCT                                 
     CSR                   MOVE #NXTNO    SVDOC                                 
     CSR                   MOVE #NXTNO    SDDOC                                 
      *                                                                         
      *  Access the F0311 through a server call                                 
     C****       RPKY01    CHAINI0311D               9899                       
     CSR                   MOVELSDDOC     RPDOC                                 
     CSR                   MOVEL$@DCT     RPDCT                                 
     CSR                   MOVELSDKCO     RPKCO                                 
      *                                                                         
     CSR                   MOVE 'K'       @@ACCS                                
     CSR                   MOVEL'CHAIN'   @@OPER                                
     CSR                   MOVEL'N'       @@LOCK                                
     CSR                   MOVEL'RPKY04'  @@KLST                                
     CSR                   Z-ADD3         @@KNUM                                
     CSR                   CALL 'XF0311'                                        
      *                    ---- --------                                        
     CSR                   PARM           PS@@1                                 
     CSR                   PARM           AR01                                  
      *                                                                         
      *    Set indicators based on I/O file server return value.                
      *                                                                         
B3   CSR         @@IOR     IFEQ 'NF '                                           
     CSR                   SETON                     98                         
E3   CSR                   ENDIF                                                
      *                                                                         
B3   CSR         @@ERR     IFNE *BLANKS                                         
     CSR         @@IOR     OREQ 'RL'                                            
     CSR                   SETON                     99                         
E3   CSR                   ENDIF                                                
      *                                                                         
E3   CSR                   ENDDO                                                
E2   CSR                   ENDIF                                                
      *                                                                         
      * If InterCompany invoice, use default document type                      
      *                                                                         
     CSR         $@IC      IFEQ '1'                                             
     CSR                   MOVE $@DCT     SDDCT                                 
     CSR                   ENDIF                                                
      *                                                                         
B2   CSR         SDDOC     IFNE *ZERO                                           
     CSR         $@PRF     ANDEQ' '                                             
      *                                                                         
     CSR                   MOVELSDDCT     RRDCT                                 
      *                                                                         
     CSR                   MOVE *BLANK    #SINBR                                
     CSR                   MOVELSDDOC     #SINBR                                
     CSR                   MOVE T@DOC     #DTYP                                 
     CSR                   MOVE W@DOC     #EWRD                                 
     CSR                   MOVE E@DOC     #EC                                   
     CSR                   MOVE F@DOC     #DSPD                                 
     CSR                   MOVE G@DOC     #DATD                                 
     CSR                   MOVE J@DOC     #ALR                                  
     CSR                   MOVE ' '       #ECOR                                 
     CSR                   MOVE ' '       #DCOR                                 
     CSR                   EXSR C00161                                          
      *                    ---- ------                                          
B3   CSR         #ALR      IFEQ 'L'                                             
     CSR                   MOVEL#SINBR    RR#DOC                                
X3   CSR                   ELSE                                                 
     CSR                   MOVE #SINBR    RR#DOC                                
E3   CSR                   ENDIF                                                
E2   CSR                   ENDIF                                                
E1   CSR                   ENDIF                                                
      *                                                                         
      *    Print report detail.                                                 
      *                                                                         
DBY30CSR                   CLEAR@UA                                             
     CSR                   MOVEAVC1PTL    @UA                                   
     CSR                   Z-ADD30        #OUTLG                                
     CSR                   EXSR C9822                                           
      *                    ---- -----                                           
     CSR                   MOVEA@UB       VC0PTL 30                             
     CSR         @@OFLN    SUB  @@CLNO    $$DIFF  30                            
B1   CSR         *INOF     IFEQ '1'                                             
     CSR         $$DIFF    ORLE $TOTL                                           
     CSR                   EXSR S010H                                           
      *                    ---- -----                                           
E1   CSR                   ENDIF                                                
      *----------------------------------------------------------------         
      *                                                                         
      *    Print detail line                                                    
      *                                                                         
B1   CSR         $#SUMZ    IFLE *ZERO                                           
      *----------------------------------------------------------------         
      *                                                                         
      *    Retrieve Preferences for Print Messages                              
      *                                                                         
     CSR                   MOVEA'1'       @PR,5                                 
     CSR                   MOVEA@PR       PSPRFR                                
     CSR                   MOVEL'S'       PSSYS                                 
      *                                                                         
     CSR         $@IC      IFEQ '1'                                             
     CSR                   MOVELSDAN8     $AN8                                  
     CSR                   MOVELSDSHAN    $SHAN                                 
     CSR                   MOVELSDPA8     $PA8                                  
     CSR                   MOVELUDIAN8    SDAN8                                 
     CSR                   MOVELUDIAN8    SDSHAN                                
     CSR                   MOVELUDIAN8    SDPA8                                 
     CSR                   END                                                  
      *                                                                         
DBN  CSR                   MOVELDS4211    PSRECP                                
      *                                                                         
     CSR                   CALL 'P40400  '             98                       
      *                    ---- ----------                                      
     CSR                   PARM 'P40400'  PSPID  10                             
     CSR                   PARM 'ZJDE0001'PSVERS 10                             
     CSR                   PARM           Z40300                                
     CSR                   PARM           PSRECP                                
     CSR                   PARM           PSSYS   1                             
     CSR                   PARM           PSPRFR 10                             
      *                                                                         
     CSR         $@IC      IFEQ '1'                                             
     CSR                   MOVEL$AN8      SDAN8                                 
     CSR                   MOVEL$SHAN     SDSHAN                                
     CSR                   MOVEL$PA8      SDPA8                                 
     CSR                   END                                                  
      *----------------------------------------------------------------         
      *                                                                         
      *    Process Text Lines - Print before detail line                        
      *                                                                         
     CSR                   MOVE 'B'       $$TEXT  1                             
      *                                                                         
      *   Print Global message if one is entered in the Proc. Options           
      *    and the message is set to print before any detail lines              
      *                                                                         
     CSR         $PFLAG    IFEQ *BLANKS                                         
     CSR                   MOVEL$@INMG    PSINMG                                
     CSR                   MOVEL*ZEROS    PSITM                                 
25920C  N76N77             EXSR S010T                                           
      *                    ---- -----                                           
      *                                                                         
     CSR         $PRT      IFEQ '1'                                             
     CSR                   MOVE '1'       $PFLAG  1                             
     CSR                   ENDIF                                                
     CSR                   ENDIF                                                
      *                                                                         
      *   Print Header level message if there is one and the message            
      *    is set to print before any detail lines.                             
      *                                                                         
      *                                                                         
     CSR         $HFLAG    IFEQ *BLANKS                                         
     CSR                   MOVELSHINMG    PSINMG                                
     CSR                   MOVEL*ZEROS    PSITM                                 
25920C  N76N77             EXSR S010T                                           
      *                    ---- -----                                           
     CSR         $PRT      IFEQ '1'                                             
     CSR                   MOVEL'1'       $HFLAG                                
     CSR                   ENDIF                                                
     CSR                   ENDIF                                                
      *                                                                         
      *    Check for associated text to print before based on                   
      *      Processing Option                                                  
      *                                                                         
     CSR         $@ASTX    IFEQ '1'                                             
     CSR         $ATHR     ANDEQ*BLANKS                                         
     CSR                   MOVE SHDOCO    JMDOCO                                
     CSR                   MOVE SHDCTO    JMDCTO                                
     CSR                   MOVE SHKCOO    JMKCOO                                
     CSR                   Z-ADD*ZEROS    JMLNID                                
27486 * this one seemed to control before notes on Facturas                     
25920C* N76N77             EXSR S010V                                           
27486C                     EXSR S010V                                           
      *                    ---- -----                                           
     CSR                   END                                                  
      *----------------------------------------------------------------         
      *                                                                         
      *    Print Item Note before line                                          
      *                                                                         
     CSR                   Z-ADDSDITM     PSITM                                 
     CSR                   MOVE *BLANKS   PSINMG                                
25920C  N76N77             EXSR S010T                                           
      *                    ---- -----                                           
      *                                                                         
      *   Print Detail level message if there is one and the message            
      *    is set to print before any detail lines.                             
      *                                                                         
     CSR                   MOVELSDINMG    PSINMG                                
     CSR                   MOVEL*ZEROS    PSITM                                 
25920C  N76N77             EXSR S010T                                           
      *                    ---- -----                                           
      *                                                                         
      *   Print Preference Print Messages for detail level and the msg          
      *    is set to print before any detail lines.                             
      *                                                                         
     CSR                   MOVEL*BLANKS   PREC                                  
     CSR                   MOVEL*BLANKS   DSPRNT                                
     CSR                   MOVEL'0'       PSTAT                                 
     CSR                   Z-ADD#KYL2     PKEYL                                 
      *                                                                         
     CSR         PSTAT     DOWEQ'0'                                             
     CSR                   CALL 'X00IDX'                                        
      *                    ---- --------                                        
     CSR                   PARM           DS#IDX           index name           
     CSR                   PARM 'I'       PACTN   1        action               
     CSR                   PARM 'GT'      PRULE   2        rule                 
     CSR                   PARM           PKEYL   30       key length           
     CSR                   PARM DSPRNT    PKEY  120        key value            
     CSR                   PARM #RCL2     PRECL   30       record length        
     CSR                   PARM           PREC  210        record length        
     CSR                   PARM           PSTAT            record value         
      *                                                                         
     CSR         PSTAT     IFEQ '0'                                             
DBN  CSR                   MOVELPREC      DSPRNT                                
     CSR         DS#TYP    IFEQ 'D'                                             
     CSR                   MOVE DSINMG    PSINMG                                
     CSR                   MOVEL*ZEROS    PSITM                                 
25920C  N76N77             EXSR S010T                                           
      *                    ---- -----                                           
     CSR                   ELSE                                                 
     CSR                   MOVEL'1'       PSTAT                                 
     CSR                   END                                                  
     CSR                   END                                                  
      *                                                                         
     CSR                   Z-ADD#KYL3     PKEYL                                 
     CSR                   ENDDO                                                
      *                                                                         
      *    Check for associated text to print before based on                   
      *      Processing Option                                                  
      *                                                                         
B2   CSR         $@ASTX    IFEQ '1'                                             
     CSR                   MOVE SDDOCO    JMDOCO                                
     CSR                   MOVE SDDCTO    JMDCTO                                
     CSR                   MOVE SDKCOO    JMKCOO                                
     CSR                   Z-ADDSDLNID    JMLNID                                
27486 * this one really didn't control before notes for Facturas                
25920C  N76N77             EXSR S010V                                           
27486C*                    EXSR S010V                                           
      *                    ---- -----                                           
E2   CSR                   ENDIF                                                
      *                                                                         
      *    Update files                                                         
      *                                                                         
     CSR                   EXSR S010U                                           
      *                    ---- -----                                           
      *                                                                         
      *    Retreive Print Adjustment History                                    
      *                                                                         
     CSR                   EXSR S010PA                                          
      *                    ---- ------                                          
      *                                                                         
      *    Bypass printing if kit component line                                
      *                                                                         
B2   CSR         $SEL      IFNE '3'                                             
      *                                                                         
     CSR         $@EDI     IFNE '2'                                             
SER   *                                                                         
SER   * Make ship qty = B/O for backorder detail line                           
SER   *                                                                         
SER  CSR         SDSOBK    IFGT 0                                               
SER  CSR         SDLTTR    IFEQ '902'                                           
SER  CSR         SDLTTR    OREQ '904'                                           
SER  CSR                   CLEARR2SOQS                                          
SER  CSR                   MOVEL'B/O'     R2SOQS                                
SER  CSR                   CLEARR2AEXP                                          
SER  CSR                   ENDIF                                                
SER  CSR                   ENDIF                                                
SER   *                                                                         
SER   * Partial S010C routine to determine if sales tax exists for item         
SER   * Field needed to determine tax amount is #XSTAM                          
SER   *                                                                         
S1203C***                  EXSR S010CC                                          
S2498CSR                   EXSR S010CC                                          
SER   *                                                                         
SER  CSR         SHEXR1    IFEQ 'E '                                            
SER  CSR                   MOVE ' '       RRTX                                  
SER  CSR                   ENDIF                                                
SER  CSR         SHEXR1    IFEQ 'S '                                            
SER  CSR         #XSTAM    ANDEQ*ZERO                                           
SER  CSR                   MOVE ' '       RRTX                                  
SER  CSR                   ENDIF                                                
SER  CSR         RRTX      IFEQ 'N'                                             
SER  CSR         RRTX      OREQ 'O'                                             
SER  CSR                   MOVE ' '       RRTX                                  
SER  CSR                   ENDIF                                                
SER   *                                                                         
     CSR                   WRITEDETAIL1                OF                       
      *                    ------------                                         
S3560CSR         HLDAN8    IFEQ 33039624                                        
S3560CSR         RRUM      IFEQ '5G'                                            
S3560CSR         SDUPRC    DIV  10000     ISMCST                                
S3560CSR         ISMCST    DIV  5         ISMCST                                
S3560CSR                   MOVELPPG       PPG1                                  
S3560CSR                   WRITEDTL1                   OF                       
S3560CSR                   ENDIF                                                
S3560CSR         RRUM      IFEQ '55'                                            
S3560CSR         SDUPRC    DIV  10000     ISMCST                                
S3560CSR         ISMCST    DIV  55        ISMCST                                
S3560CSR                   MOVELPPG       PPG1                                  
S3560CSR                   WRITEDTL1                   OF                       
S3560CSR                   ENDIF                                                
S3560CSR                   ENDIF                                                
      *                                                                         
S5717CSR                   Z-ADD*ZEROS    PRTLBS  20                            
S5717CSR         $5ING     IFGT *BLANKS                                         
S5717CSR         RRUM      IFEQ 'GL'                                            
S5717CSR         RRUM      OREQ 'QT'                                            
S5717CSR         RRUM      OREQ '5G'                                            
S5717CSR         RRUM      OREQ '4G'                                            
S5717CSR         RRUM      OREQ '30'                                            
S5717CSR         RRUM      OREQ '40'                                            
S5717CSR         RRUM      OREQ '50'                                            
S5717CSR         RRUM      OREQ '55'                                            
S5717CSR                   MOVEL'*INMG'   WAPP                                  
S5717CSR                   MOVEL$5ING     CKEY                                  
S5717CSR         A5KEY     CHAINF00163               88                         
S5717CSR         *IN88     IFEQ *OFF                                            
S5717CSR         C5SERK    SETLLF0016                                           
S5717CSR         C5SERK    READEF0016                    87                     
S5717CSR         *IN87     DOWEQ*OFF                                            
S5717CSR                   MOVELCYWTXT    TSTTXT  7                             
S5717CSR         TSTTXT    IFEQ '<<LBS>>'                                       
S5717CSR                   ADD  1         PRTLBS                                
S5717CSR                   ENDIF                                                
S5717CSR         C5SERK    READEF0016                    87                     
S5717CSR                   ENDDO                                                
S5717CSR         PRTLBS    IFGT *ZEROS                                          
S5717CSR                   MOVE *BLANKS   UMMCU                                 
S5717CSR                   Z-ADDSDITM     UMITM                                 
S5717CSR                   MOVELRRUM      UMUM                                  
S5717CSR                   MOVEL'LB'      UMRUM                                 
S5717CSR         UMKY01    CHAINF41002               53                         
S5717CSR         *IN53     IFEQ *OFF                                            
S5717CSR         UMCONV    DIV  10000000  HLDPND 114                            
S5717CSR         HLDPND    MULT SDSOQS    GALPND                                
S5717CSR         GALPND    DIV  100       GALPND                                
S5717CSR                   WRITEDTL2                   OF                       
S5717CSR                   ENDIF                                                
S5717CSR                   ENDIF                                                
S5717CSR                   ENDIF                                                
S5717CSR                   ENDIF                                                
S5717CSR                   ENDIF                                                
S5717C******  MD           ENDIF                                                
      *                                                                         
S2595CSR                   MOVELSVTXA1    SDTXA1                                
S1144 *                                                                         
S1144 *    Calculate difference between overflow line and current line          
S1144 *    to determine if the heading should be printed before totals.         
S1144 *                                                                         
S1144CSR         @@OFLN    SUB  @@CLNO    $$DIFF  30                            
S1144CSR         *INOF     IFEQ '1'                                             
S1144CSR         $$DIFF    ORLE $TOTL                                           
S1144CSR                   Z-ADD$#PG      $$PGSV  40                            
S1144CSR                   Z-ADD##PGSV    $#PG                                  
S1144CSR                   EXSR S010H                                           
S1144 *                    ---- -----                                           
S1144CSR                   Z-ADD$#PG      ##PGSV                                
S1144CSR                   Z-ADD##PGSV    $#PG                                  
S1144 *R                   Z-ADD$$PGSV    $#PG                                  
S1144CSR                   ENDIF                                                
S1144 *                                                                         
     CSR                   ENDIF                                                
      *                                                                         
     CSR                   MOVE '0'       *IN40                                 
      *                                                                         
      *    Write EDI Invoice Header, if final mode                              
      *                                                                         
     CSR         $@EDI     IFEQ '1'                                             
     CSR         $@EDI     OREQ '2'                                             
      *                                                                         
     CSR         $$EDIH    IFEQ ' '                                             
     CSR                   EXSR WRTHD1                                          
      *                    ---- ------                                          
     CSR                   ENDIF                                                
      *                                                                         
      *    Write EDI detail line                                                
      *                                                                         
     CSR                   EXSR WRTDT1                                          
      *                    ---- ------                                          
     CSR                   ENDIF                                                
      *                                                                         
      *    Add to number of records written field                               
      *                                                                         
     CSR                   ADD  1         $$RCD                                 
      *                                                                         
      *    Add line extension to total order amount                             
      *                                                                         
B3   CSR         $@EXBO    IFEQ '1'                                             
     CSR         SDSOBK    ANDNE0                                               
     CSR         SDRLIT    ANDEQ*BLANKS                                         
     CSR         SDSOQS    ADD  SDSOBK    $WKQTY 150                            
      *                                                                         
      *    Convert quantity ordered to other units of measure                   
      *                                                                         
     CSR         $WKQTY    DIV  #@SOBK    #QTY      H                           
     CSR                   MOVE SDUOM     #UOM                                  
     CSR                   MOVE SDUOM4    #UOM1                                 
     CSR                   MOVELSDMCU     #MCU                                  
     CSR                   MOVE LFIVI     #IVI                                  
     CSR                   MOVE SDCOMM    #READ                                 
     CSR                   MOVE *BLANKS   #OT1Y                                 
     CSR                   Z-ADD*ZEROS    #STDP                                 
     CSR                   MOVEL*BLANKS   #LOTN                                 
      *                                                                         
     CSR                   CALL 'X41002  '             98                       
      *                    ---- ----------                                      
     CSR                   PARM           DS4101                                
     CSR                   PARM           DS@UOM                                
      *                                                                         
B4   CSR         #ERTST    IFEQ '1'                                             
     CSR                   Z-ADD1         #CNVP                                 
     CSR                   Z-ADD1         #CNVQ                                 
E4   CSR                   ENDIF                                                
      *                                                                         
     CSR         SDFUP     DIV  #@FUP     $WK299    H                           
     CSR                   DIV  #CNVP     $WK299    H                           
     CSR                   MULT #PQT      $WK299    H                           
     CSR         $WK299    MULT #@FDO     $WK150    H                           
     CSR                   ADD  $WK150    $FTOTL 150                            
     CSR         SDSOQS    ADD  SDSOBK    $WKQTY 150                            
      *                                                                         
      *    Convert quantity ordered to other units of measure                   
      *                                                                         
     CSR         $WKQTY    DIV  #@SOBK    #QTY      H                           
     CSR                   MOVE SDUOM     #UOM                                  
     CSR                   MOVE SDUOM4    #UOM1                                 
     CSR                   MOVELSDMCU     #MCU                                  
     CSR                   MOVE LFIVI     #IVI                                  
     CSR                   MOVE SDCOMM    #READ                                 
     CSR                   MOVE *BLANKS   #OT1Y                                 
     CSR                   Z-ADD*ZEROS    #STDP                                 
     CSR                   MOVEL*BLANKS   #LOTN                                 
      *                                                                         
     CSR                   CALL 'X41002  '             98                       
      *                    ---- ----------                                      
     CSR                   PARM           DS4101                                
     CSR                   PARM           DS@UOM                                
      *                                                                         
B4   CSR         #ERTST    IFEQ '1'                                             
     CSR                   Z-ADD1         #CNVP                                 
     CSR                   Z-ADD1         #CNVQ                                 
E4   CSR                   ENDIF                                                
      *                                                                         
     CSR         SDUPRC    DIV  #@UPRC    $WK299    H                           
     CSR                   DIV  #CNVP     $WK299    H                           
     CSR                   MULT #PQT      $WK299    H                           
     CSR         $WK299    MULT #@AEXP    $WK150    H                           
     CSR                   ADD  $WK150    $#ATO  150                            
X3   CSR                   ELSE                                                 
     CSR         $@IC      IFEQ ' '                                             
     CSR                   ADD  SDAEXP    $#ATO  150                            
     CSR                   ADD  SDFEA     $FTOTL 150                            
     CSR                   ELSE                                                 
     CSR                   ADD  SDAEXP    $#ATO                                 
     CSR                   ADD  SDFEA     $FTOTL                                
     CSR                   ENDIF                                                
E3   CSR                   ENDIF                                                
      *                                                                         
      *    Total Amounts Cash Discount                                          
      *                                                                         
B3   CSR         $@DISC    IFEQ '1'                                             
     CSR         LFCDSC    ANDEQ'Y'                                             
     CSR                   ADD  SDAEXP    $$CEXP                                
     CSR                   ADD  SDFEA     $FCEXP                                
      *                                                                         
     CSR         SDCADC    DIV  #@CADC    $$CD   153                            
     CSR                   DIV  100       $$CD                                  
      *                                                                         
     CSR         $$CD      MULT SDAEXP    $LCDIS 150                            
     CSR                   ADD  $LCDIS    $OCDIS 150                            
     CSR         $$CD      MULT SDFEA     $FLDIS 150                            
     CSR                   ADD  $FLDIS    $FODIS 150                            
E3   CSR                   ENDIF                                                
      *                                                                         
      *    Perform tax calculations                                             
      *                                                                         
     CSR         $@IC      IFEQ ' '                                             
     CSR                   EXSR S010C                                           
      *                    ----------                                           
     CSR                   ENDIF                                                
      *                                                                         
      *    Create the EDI Tag Record                                            
      *                                                                         
     CSR         $@EDI     IFEQ '1'                                             
     CSR         $@EDI     OREQ '2'                                             
     CSR                   EXSR WRTDT2                                          
      *                    ---- ------                                          
     CSR                   ENDIF                                                
23271 * Mexico - write detail to Factura stage file                             
23271C           *IN76     IFEQ *ON                                             
23276C           $$USE     ANDEQ'ON'                                            
23256C                     EXSR S010F                                           
23256 *                    ---- -----                                           
23271C                     ENDIF                                                
      *                                                                         
      *    Print Adjustment History                                             
      *                                                                         
     CSR                   EXSR S010PR                                          
      *                    ---- ------                                          
      *                                                                         
      *    Print serial numbers based on processing option                      
      *                                                                         
B3   CSR         LFTXYN    IFNE 'Y'                                             
     CSR         LFIVI     ANDNE'N'                                             
     CSR         LFIVI     ANDNE'A'                                             
      *                                                                         
B4   CSR         $@SRL     IFEQ '1'                                             
     CSR                   EXSR S010S                                           
      *                    ---- -----                                           
E4   CSR                   ENDIF                                                
E3   CSR                   ENDIF                                                
      *                                                                         
      *    Process Text Lines - Print after text line                           
      *                                                                         
     CSR                   MOVE 'A'       $$TEXT  1                             
      *                                                                         
      *    Print Item Note after line                                           
      *                                                                         
     CSR                   Z-ADDSDITM     PSITM                                 
     CSR                   MOVE *BLANKS   PSINMG                                
25920C  N76N77             EXSR S010T                                           
      *                    ---- -----                                           
      *                                                                         
      *   Print Detail level message if there is one and the message            
      *    is set to print after any detail lines.                              
      *                                                                         
     CSR                   MOVELSDINMG    PSINMG                                
     CSR                   MOVEL*ZEROS    PSITM                                 
25920C  N76N77             EXSR S010T                                           
      *                    ---- -----                                           
      *                                                                         
      *   Print Preference Print Messages for detail level and the msg          
      *    is set to print after any detail lines.                              
      *                                                                         
     CSR                   MOVEL*BLANKS   PREC                                  
     CSR                   MOVEL*BLANKS   DSPRNT                                
     CSR                   MOVEL'0'       PSTAT                                 
     CSR                   Z-ADD#KYL2     PKEYL                                 
      *                                                                         
     CSR         PSTAT     DOWEQ'0'                                             
     CSR                   CALL 'X00IDX'                                        
      *                    ---- --------                                        
     CSR                   PARM           DS#IDX           index name           
     CSR                   PARM 'I'       PACTN   1        action               
     CSR                   PARM 'GT'      PRULE   2        rule                 
     CSR                   PARM           PKEYL   30       key length           
     CSR                   PARM DSPRNT    PKEY  120        key value            
     CSR                   PARM #RCL2     PRECL   30       record length        
     CSR                   PARM           PREC  210        record length        
     CSR                   PARM           PSTAT            record value         
      *                                                                         
     CSR         PSTAT     IFEQ '0'                                             
DBN  CSR                   MOVELPREC      DSPRNT                                
     CSR         DS#TYP    IFEQ 'D'                                             
     CSR                   MOVE DSINMG    PSINMG                                
     CSR                   MOVEL*ZEROS    PSITM                                 
25920C  N76N77             EXSR S010T                                           
      *                    ---- -----                                           
     CSR                   ELSE                                                 
     CSR                   MOVEL'1'       PSTAT                                 
     CSR                   END                                                  
     CSR                   END                                                  
      *                                                                         
     CSR                   Z-ADD#KYL3     PKEYL                                 
     CSR                   ENDDO                                                
      *                                                                         
      *    Check for associated text to print after based on                    
      *      Processing Option                                                  
      *                                                                         
      *                                                                         
B3   CSR         $@ASTX    IFEQ '1'                                             
     CSR                   MOVE SDDOCO    JMDOCO                                
     CSR                   MOVE SDDCTO    JMDCTO                                
     CSR                   MOVE SDKCOO    JMKCOO                                
     CSR                   Z-ADDSDLNID    JMLNID                                
27486 * this one really didn't control before notes for Facturas                
27486C  N76N77             EXSR S010V                                           
27486C*                    EXSR S010V                                           
      *                    ---- -----                                           
E3   CSR                   ENDIF                                                
      *                                                                         
E2   CSR                   ENDIF                                                
E1   CSR                   ENDIF                                                
      *----------------------------------------------------------------         
      *                                                                         
      *    Clear work fields                                                    
      *                                                                         
     CSR                   MOVEA@L@       @T@                                   
     CSR                   MOVEA@V@       @TV                                   
     CSR                   MOVE *ZERO     $$PGLV  10                            
      *----------------------------------------------------------------         
     CSR         END010    ENDSR                                                
      *****************************************************************         
      *                                                                         
      *    SUBROUTINE S010H - Print Invoice Header                              
      *    ---------------------------------------                              
      *                                                                         
      *    Processing:  1.  Increment page number counter.                      
      *                 2.  Print the invoice header on a page break.           
      *                                                                         
     CSR         S010H     BEGSR                                                
      *          -----     -----                                                
      *                                                                         
      *    Suppress ship-to print at top if intercompany branch                 
      *                                                                         
     CSR         $@IC      IFEQ '1'                                             
     CSR                   MOVE '1'       *IN40                                 
     CSR                   ENDIF                                                
      *                                                                         
      *    Move to output - Page Number                                         
      *                                                                         
     CSR                   ADD  1         $#PG                                  
      *                                                                         
     CSR                   MOVE *BLANK    #SINBR                                
     CSR                   MOVEL$#PG      #SINBR                                
     CSR                   MOVE T@#PG     #DTYP                                 
     CSR                   MOVE W@#PG     #EWRD                                 
     CSR                   MOVE E@#PG     #EC                                   
     CSR                   MOVE F@#PG     #DSPD                                 
     CSR                   MOVE G@#PG     #DATD                                 
     CSR                   MOVE J@#PG     #ALR                                  
     CSR                   MOVE ' '       #ECOR                                 
     CSR                   MOVE ' '       #DCOR                                 
     CSR                   EXSR C00161                                          
      *                    ---- ------                                          
B1   CSR         #ALR      IFEQ 'L'                                             
     CSR                   MOVEL#SINBR    RR#PG                                 
X1   CSR                   ELSE                                                 
     CSR                   MOVE #SINBR    RR#PG                                 
E1   CSR                   ENDIF                                                
      *                                                                         
B1   CSR         $@EDI     IFNE '2'                                             
SER   *                                                                         
SER   * If credit memo (Proc opt 40) = ' ', clear alt heading flds              
SER   *                                                                         
SER  CSR         ALTFLG    IFEQ 'N'                                             
SER  CSR                   CLEARRRTTL@                                          
SER  CSR                   CLEARRRTTL2                                          
SER  CSR                   ENDIF                                                
S3486CSR                   Z-ADD*ZEROS    HLDAN8  80                            
S3486CSR                   Z-ADDSHAN8     HLDAN8                                
S5599 *----------------------------------------------------------------         
S5599 *    For Canadian Invoices, print the English/French clause for           
S5599 *    Quebec customers. The $TOTL fields controls the number of            
S5599 *    detail lines on the invoice. It stores the number of lines           
S5599 *    reserved for Totals.                                                 
S5599 *                                                                         
S5599C           *IN56     IFEQ *ON                        B 56 ON     0        
S5599C           SHAN8     CHAINI0116S               99                         
S5599C           *IN99     IFEQ *OFF                       B 99 OFF             
S5599C           ALADDS    IFEQ 'QU '                      B QU                 
S6042 *                    Z-ADD26        $TOTL   20                            
27295C* CC27472            Z-ADD10        $TOTL   20                            
27472C                     Z-ADD16        $TOTL   20                            
S5599C                     ELSE                            X QU                 
S6042 *                    Z-ADD30        $TOTL                                 
S6042 *                    Z-ADD26        $TOTL                                 
27295C* CC27472            Z-ADD10        $TOTL   20                            
27472C                     Z-ADD16        $TOTL   20                            
S5599C                     ENDIF                           E QU                 
S5599C                     ELSE                            X 99 OFF             
S6042 *                    Z-ADD30        $TOTL                                 
S6042 *                    Z-ADD26        $TOTL                                 
27295C* CC27472            Z-ADD10        $TOTL   20                            
27472C                     Z-ADD16        $TOTL   20                            
S5599C                     ENDIF                           E 99 OFF             
S5599C                     ELSE                            X 56 ON              
S6042 *                    Z-ADD30        $TOTL                                 
S6042 *                    Z-ADD26        $TOTL                                 
27295C* CC27472            Z-ADD10        $TOTL   20                            
27472C                     Z-ADD16        $TOTL   20                            
S5599C                     ENDIF                           E 56 ON              
S8251 *                                                                         
S8251 *    For Mexico Invoices, print more detail lines.                        
S8251C           *IN76     IFEQ *ON                        Mexico               
25920 *** amendment        Z-ADD20        $TOTL                                 
25920 *                    Z-ADD23        $TOTL                                 
25920C                     Z-ADD7         $TOTL                                 
S8251C                     ENDIF                                                
      *                                                                         
S7312 *  ---------------------------------------------------------              
S7312 *                                                                         
S7312 *  -----------   US VERSION         ------------------                    
S7312 *                                                                         
S7312C           *IN58     IFEQ *ON                                             
S7312C                     MOVELUS1       RADR1     P                           
S7312C                     MOVELINVHDR    RINVH     P                           
S7312C                     MOVELUS2       RADR2     P                           
S7312C                     MOVELUS3       RADR3     P                           
S7312C                     MOVELDTEHDR    RDTEH     P                           
S7312C                     MOVELUS4       RADR4     P                           
S7312C* CC27954            MOVE *BLANKS   RADR5     P                           
27954C                     MOVE US5       RADR5     P                           
S7312C                     MOVELORDHDR    RORDH     P                           
S7312C                     MOVE *BLANKS   RADR6     P                           
S7312C                     MOVELPGEHDR    RPAGH     P                           
S7312C                     MOVELBILLTO    RBILH     P                           
S7312C                     MOVELSHIPTO    RSHPH     P                           
S7312C                     MOVELPOHDR     RPOH      P                           
S7312C                     MOVELSHPHDR    RCARH     P                           
S7312C                     MOVELTRMHDR    RTRMH     P                           
S7312C                     MOVELQTYHDR    RQTYH     P                           
S7312C                     MOVELUMHDR     RUMH      P                           
S7312C                     MOVELPRDHDR    RPRDH     P                           
S7312C                     MOVELDESHDR    RDSCH     P                           
S7312C                     MOVELECHHDR    RECHH     P                           
S7312C                     MOVELEXTHDR    REXTH     P                           
S7312C                     MOVELTAXHDR    RTAXH     P                           
S7312 * ??   Sales Tax                                                          
S7312C                     MOVELSTXHDR    RSTX      P                           
S7312C                     MOVELPAYBY     RPAYB     P                           
S7312C           *IN59     IFEQ *ON                        US$                  
S7312C                     MOVELUS$       RCUR$     P                           
S7312C                     ELSE                                                 
S7312C           *IN57     IFEQ *ON                        CAD                  
S7312C                     MOVELCAN$      RCUR$     P                           
S7312C                     ELSE                                                 
S7312C           *IN77     IFEQ *ON                        MXP                  
S7312C                     MOVELMEXMX$    RCUR$     P                           
27250C                     ELSE                                                 
27250C           *IN54     IFEQ *ON                        AUD                  
27250C                     MOVELAUD$      RCUR$     P                           
27250C                     ENDIF                                                
S7312C                     ENDIF                                                
S7312C                     ENDIF                                                
S7312C                     ENDIF                                                
S7312C                     MOVELSHPFRM    RWHSH     P                           
S7312C                     MOVELUSRM1     RRM1      P                           
S7312C                     MOVELWR1       RWR1      P                           
S7312C                     MOVELUSRM2     RRM2      P                           
S7312C                     MOVELWR2       RWR2      P                           
S7312C                     MOVELUSRM3     RRM3      P                           
S7312C                     MOVELUSWR3     RWR3      P                           
S7312C                     MOVELUSRM4     RRM4      P                           
S7312C                     MOVELUSWR4     RWR4      P                           
S7312C                     MOVE *BLANKS   RRM5                                  
S7312C                     MOVELUSWR5     RWR5      P                           
S7312C                     MOVE *BLANKS   RRM6                                  
S7312C                     MOVELUSWR6     RWR6      P                           
S7312C                     MOVE *BLANKS   RWR7                                  
S7312C                     MOVELTAXITM    RTAX      P                           
      * terms and conditions of sale                                            
27295C           *IN76     IFEQ *ON                                             
27295C           *IN77     OREQ *ON                                             
27295C                     MOVELDISCM1    RDSC1     P                           
27295C                     MOVELDISCM2    RDSC2     P                           
27295C                     ELSE                                                 
S7312C                     MOVELDISCL1    RDSC1     P                           
S7312C                     MOVELDISCL2    RDSC2     P                           
S7312C                     MOVELDISCL3    RDSC3     P                           
27295C                     ENDIF                                                
      *                                                                         
12724C                     MOVELUSCH1     RCH1      P                           
12724C                     MOVELUSCH2     RCH2      P                           
12724C                     MOVELUSCH3     RCH3      P                           
12724C                     MOVELUSCH4     RCH4      P                           
12724C                     MOVELUSCH5     RCH5      P                           
12724C                     MOVELUSCH6     RCH6      P                           
S7312C                     ENDIF                           *IN58                
S7312 *                                                                         
S7312 *  -----------   CANADIAN VERSION   ------------------                    
S7312 *                                                                         
S7312C           *IN56     IFEQ *ON                        Canada               
S7312C                     MOVELCANAD1    RADR1     P                           
S7312C                     MOVELINVHDR    RINVH     P                           
S7312C                     MOVELCANAD2    RADR2     P                           
S7312C                     MOVELCANAD3    RADR3     P                           
S7312C                     MOVELDTEHDR    RDTEH     P                           
S7312C                     MOVELCANAD4    RADR4     P                           
S7312C                     MOVELCANAD5    RADR5     P                           
S7312C                     MOVELORDHDR    RORDH     P                           
S7312C                     MOVELCANAD6    RADR6     P                           
S7312C                     MOVELPGEHDR    RPAGH     P                           
S7312C                     MOVELBILLTO    RBILH     P                           
S7312C                     MOVELSHIPTO    RSHPH     P                           
S7312C                     MOVELPOHDR     RPOH      P                           
S7312C                     MOVELSHPHDR    RCARH     P                           
S7312C                     MOVELTRMHDR    RTRMH     P                           
S7312C                     MOVELQTYHDR    RQTYH     P                           
S7312C                     MOVELUMHDR     RUMH      P                           
S7312C                     MOVELPRDHDR    RPRDH     P                           
S7312C                     MOVELDESHDR    RDSCH     P                           
S7312C                     MOVELECHHDR    RECHH     P                           
S7312C                     MOVELEXTHDR    REXTH     P                           
S7312C                     MOVELTAXHDR    RTAXH     P                           
S7312 *      Sales Tax                                                          
S7312C                     MOVELSTXHDR    RSTX      P                           
S7312C                     MOVELPAYBY     RPAYB     P                           
S7312C           *IN59     IFEQ *ON                        US$                  
S7312C                     MOVELUS$       RCUR$     P                           
S7312C                     ELSE                                                 
S7312C           *IN57     IFEQ *ON                        CAD                  
S7312C                     MOVELCAN$      RCUR$     P                           
S7312C                     ELSE                                                 
S7312C           *IN77     IFEQ *ON                        MXP                  
S7312C                     MOVELMEXMX$    RCUR$     P                           
27250C                     ELSE                                                 
27250C           *IN54     IFEQ *ON                        AUD                  
27250C                     MOVELAUD$      RCUR$     P                           
27250C                     ENDIF                                                
S7312C                     ENDIF                                                
S7312C                     ENDIF                                                
S7312C                     ENDIF                                                
S7312C                     MOVELSHPFRM    RWHSH     P                           
S7312C                     MOVELCANRM1    RRM1      P                           
S7312C                     MOVELWR1       RWR1      P                           
S7312C           *IN59     IFEQ *ON                        US$                  
27250C           *IN54     OREQ *ON                        AUD                  
S7312C                     MOVELCUSRM2    RRM2      P                           
S7312C                     ELSE                                                 
S7312C           *IN57     IFEQ *ON                        CAD                  
S7312C                     MOVELCCDRM2    RRM2      P                           
S7312C                     ENDIF                                                
S7312C                     ENDIF                                                
S7312C                     MOVELWR2       RWR2      P                           
S7312C                     MOVELCANRM3    RRM3      P                           
S7312C                     MOVELCNWR3     RWR3      P                           
S7312C                     MOVELCANRM4    RRM4      P                           
S7312C                     MOVELCNWR4     RWR4      P                           
S7312C                     MOVELCANRM5    RRM5      P                           
S7312C                     MOVELCNWR5     RWR5      P                           
S7312C                     MOVELCANRM6    RRM6      P                           
S7312C           *IN59     IFEQ *ON                        US$                  
27250C           *IN54     OREQ *ON                        AUD                  
S7312C                     MOVELCUSWR6    RWR6      P                           
S7312C                     ELSE                                                 
S7312C           *IN57     IFEQ *ON                        CAD                  
S7312C                     MOVELCCDWR6    RWR6      P                           
S7312C                     ENDIF                                                
S7312C                     ENDIF                                                
S7312C                     MOVELTAXITM    RTAX      P                           
      * terms and conditions of sale                                            
27295C           *IN76     IFEQ *ON                                             
27295C           *IN77     OREQ *ON                                             
27295C                     MOVELDISCM1    RDSC1     P                           
27295C                     MOVELDISCM2    RDSC2     P                           
27295C                     ELSE                                                 
S7312C                     MOVELDISCL1    RDSC1     P                           
S7312C                     MOVELDISCL2    RDSC2     P                           
S7312C                     MOVELDISCL3    RDSC3     P                           
27295C                     ENDIF                                                
      *                                                                         
S7312C                     ENDIF                           *IN56                
S7312 *                                                                         
S7312 *  ----------    MEXICAN VERSION    ------------------                    
S7312 *                                                                         
S7312C           *IN76     IFEQ *ON                        Mexico               
S7312C                     MOVE *BLANKS   RADR1                                 
S7312C                     MOVE *BLANKS   RINVH                                 
S7312C                     MOVELREFHDR    RREFH                                 
S7312C                     Z-ADDSDDOC     RREF                                  
S7312C                     MOVE SDDCT     RREFT                                 
S7312C                     MOVE *BLANKS   RADR2                                 
S7312C                     MOVE *BLANKS   RADR3                                 
S7312C                     MOVE *BLANKS   RDTEH                                 
13399C                     MOVE RRDIM     RRDI             inv date             
13399C                     MOVE RR#DDM    RR#DD            due date             
S7312C                     MOVE *BLANKS   RADR4                                 
S7312C                     MOVE *BLANKS   RADR5                                 
S7312C                     MOVE *BLANKS   RORDH                                 
S7312C                     MOVE *BLANKS   RADR6                                 
S7312C                     MOVE *BLANKS   RPAGH                                 
S7312C                     MOVE *BLANKS   RBILH                                 
S7312C                     MOVE *BLANKS   RSHPH                                 
S7312C                     MOVE *BLANKS   RPOH                                  
S7312C                     MOVE *BLANKS   RCARH                                 
S7312C                     MOVE *BLANKS   RTRMH                                 
S7312C                     MOVE *BLANKS   RQTYH                                 
S7312C                     MOVE *BLANKS   RUMH                                  
S7312C                     MOVE *BLANKS   RPRDH                                 
S7312C                     MOVE *BLANKS   RDSCH                                 
S7312C                     MOVE *BLANKS   RECHH                                 
S7312C                     MOVE *BLANKS   REXTH                                 
S7312C                     MOVE *BLANKS   RTAXH                                 
S7312 *      Sales Tax                                                          
S7312C***                  MOVELIVAHDR    RSTX      P                           
S7312C                     MOVELPAYBYM    RPAYB     P                           
S7312C           *IN59     IFEQ *ON                        US$                  
S7312C                     MOVELMEXUS$    RCUR$     P                           
S6042C*** S8307            MOVELMEXUS$    RWR7      P                           
S7312C                     ELSE                                                 
S7312C           *IN57     IFEQ *ON                        CAD                  
S7312C                     MOVELCAN$      RCUR$     P                           
S7312C                     ELSE                                                 
S7312C           *IN77     IFEQ *ON                        MXP                  
S7312C                     MOVELMEXMX$    RCUR$     P                           
S6042C*** S8307            MOVELMEXMX$    RWR7      P                           
S7312C                     ENDIF                                                
S7312C                     ENDIF                                                
S7312C                     ENDIF                                                
S8307C                     MOVELMXWR0     RWR0      P                           
S7312C                     MOVE *BLANKS   RWHSH                                 
S7312C                     MOVE *BLANKS   RRM1                                  
S7312C                     MOVELMXWR1     RWR1      P                           
S7312C                     MOVE *BLANKS   RRM2                                  
S7312C                     MOVELMXWR2     RWR2      P                           
S7312C                     MOVE *BLANKS   RRM3                                  
S7312C                     MOVELMXWR3     RWR3      P                           
S7312C                     MOVE *BLANKS   RRM4                                  
S7312C                     MOVELMXWR4     RWR4      P                           
S7312C                     MOVE *BLANKS   RRM5                                  
S6042C           *IN59     IFEQ *ON                        US$                  
S6042C                     MOVELMXWR5U    RWR5      P                           
S6042C                     ELSE                                                 
S6042C           *IN77     IFEQ *ON                        MXP                  
S6042C                     MOVELMXWR5P    RWR5      P                           
S6042C                     ENDIF                                                
S6042C                     ENDIF                                                
S7312C                     MOVE *BLANKS   RRM6                                  
S6042C           *IN59     IFEQ *ON                        US$                  
S6042C                     MOVELMXWR6U    RWR6      P                           
S6042C                     ELSE                                                 
S6042C           *IN77     IFEQ *ON                        MXP                  
S6042C                     MOVELMXWR6P    RWR6      P                           
S6042C                     ENDIF                                                
S6042C                     ENDIF                                                
S8307C                     MOVELMXWR7     RWR7      P                           
S7312C                     ENDIF                           *IN76                
      *                                                                         
27099 *  company 00310 bill-to FCAN 34009735 ---------------------              
  |   *                                                                         
  |  C           SHKCOO    IFEQ '00310'                                         
  |  C           SHAN8     ANDEQ34009735                                        
  |   * remit                                                                   
  |  C                     MOVE *BLANKS   RRM1                                  
  |  C                     MOVE *BLANKS   RRM2                                  
  |  C                     MOVE *BLANKS   RRM3                                  
  |  C                     MOVE *BLANKS   RRM4                                  
  |  C                     MOVE *BLANKS   RRM5                                  
  |  C                     MOVE *BLANKS   RRM6                                  
  |   *                                                                         
  |   * wire                                                                    
  |  C                     MOVE FCANW2    RWR2                                  
  |  C                     MOVE FCANW3    RWR3                                  
  |  C                     MOVE FCANW4    RWR4                                  
  |  C                     MOVE FCANW5    RWR5                                  
  |  C                     MOVE FCANW6    RWR6                                  
  |  C                     MOVE *BLANKS   RWR7                                  
  |   *                                                                         
  |  C                     MOVE *BLANKS   RCH1                                  
  |  C                     MOVE *BLANKS   RCH2                                  
  |  C                     MOVE *BLANKS   RCH3                                  
  |  C                     MOVE *BLANKS   RCH4                                  
  |  C                     MOVE *BLANKS   RCH5                                  
  |  C                     MOVE *BLANKS   RCH6                                  
  |   *                                                                         
  |  C                     ENDIF                                                
  |   *                                                                         
27099 *  ---------------------------------------------------------              
      *                                                                         
S6363CSR         $#PG      IFGT 1                                               
S6363CSR         *IN32     ANDEQ*OFF                                            
S6363CSR                   WRITETOTAL6                 OF                       
S6363CSR                   ENDIF                                                
      *                                                                         
S5651CSR                   Z-ADD$#PG      PAG1                                  
27295 *                                                                         
27295 * mark beginning of a page group                                          
27295 *                                                                         
27295C           $#PG      IFEQ 1                                               
27295C   74                WRITETOTAL7                                          
27295C   74                CLOSER5542565                                        
27295C                     MOVE *BLANKS   INVVOC                                
27587C                     MOVE *BLANKS   $$VVOC 17                             
27295 * CC27587            MOVE SDDOC     INVVOC           invoice              
27587C                     MOVE SDDOC     $$VVOC           invoice              
27295C                     MOVELRRDOCO    INVV1   9        order no             
27295C                     MOVE '-'       INVV1                                 
27295 * CC27587            MOVELINVV1     INVVOC                                
27587C                     MOVELINVV1     $$VVOC                                
27587C                     MOVEL$$VVOC    INVVOC                                
27587C                     MOVE SDDCT     INVVOC           doc type             
27295C                     OPEN R5542565                                        
27295C                     WRITESTRPAG                                          
27295C                     MOVE *ON       *IN74                                 
27295C                     ENDIF                                                
      *                                                                         
     CSR                   WRITEHEADING1               OF                       
      *                    -------------                                        
27942 *                                                                         
27942 *   Print Global message at top of US invoice                             
27942 *   for name change or address change.                                    
27942 *                                                                         
27942C           *IN58     IFEQ *ON                                             
27942C           $PFLG2    IFEQ *BLANKS                                         
27942C                     MOVE *BLANKS   PSINMG                                
27942C                     MOVEL'INVOICE' PSINMG                                
27942C                     MOVEL*ZEROS    PSITM                                 
27942C                     MOVE 'B'       $$TEXT  1                             
27942C                     EXSR S010T                                           
27942 *                    ---- -----                                           
27942 *                                                                         
27972C*                    Z-ADD1         X1      10                            
27972C*                    Z-ADD0         X2      10                            
27972C*          X1        DIV  X2        X1                                    
27972 *                                                                         
27942 *                                                                         
27942 * no text found if FIRST1 = *BLANK                                        
27942C           FIRST1    IFEQ 'N'                                             
27942C                     WRITEDETAIL3B               OF                       
27942C                     ENDIF                                                
27942C                     MOVE '1'       $PFLG2  1                             
27942C                     MOVE *BLANKS   PSINMG                                
27942C                     ENDIF                                                
27942C                     ENDIF                                                
      *                                                                         
27295C                     MOVE SDDOC     HFDOC   8        invoice              
27295C                     MOVE SDDCT     HFDCT   2        doc type             
27295C                     MOVE SHAN8     HFAN8   8        bill to              
27295C                     MOVE SHSHAN    HFSHAN  8        ship to              
     C                     MOVELRRDOCO    HFDOCO  8        order no             
     C                     MOVELRRDCTO    HFDCTO  2                             
     C                     MOVELRRDI      HFMM    2                             
     C                     MOVE RRDI      HFHLD   5                             
     C                     MOVELHFHLD     HFDD    2                             
     C                     MOVE RRDI      HFYR2   2                             
     C                     MOVE '20'      HFYR1   2                             
     C                     MOVELHFYR1     HFYR3   4                             
     C                     MOVE HFYR2     HFYR3   4                             
     C                     MOVELHFMM      HFDTE   4                             
     C                     MOVE HFDD      HFDTE   4                             
     C                     MOVELHFYR3     HFDATE  8                             
     C                     MOVE HFDTE     HFDATE                                
     C                     Z-ADDSDADDJ    HFADDJ  60                            
     C                     MOVE SDMCU     HFMCU   3                             
      *                                                                         
27472C           *IN76     IFNE *ON                        Mexico               
S5651 **CSR                   ADD  1         T       10                         
S5651 **CSR                   MOVE '1'       FRSHDG  1                          
S5651 **CSR                   MOVE '1'       TRMHDG  1                          
S5651 **CSR                   Z-ADD*ZEROS    PAG1                               
27472C                     MOVE *OFF      *IN32                                 
27472C                     ENDIF                           *IN76                
SER   *                                                                         
SER   * If orig order # (Proc opt 41) = '1', print orig ord# text line          
SER   *                                                                         
SER  CSR         ORGFLG    IFEQ 'Y'                                             
SER  CSR                   MOVELSHOORN    RROORN  8                             
SER  C                     MOVELSHOCTO    RROCTO                                
SER  CSR                   WRITEDETAIL9                OF                       
SER   *                    -------------                                        
SER  CSR                   CLEARRROORN                                          
SER  CSR                   CLEARRROCTO                                          
SER  CSR                   ENDIF                                                
E1   CSR                   ENDIF                                                
      *                                                                         
     CSR                   SETOF                     OF02                       
     CSR                   Z-ADD$#PG      ##PGSV                                
      *                                                                         
     CSR         END10H    ENDSR                                                
      *****************************************************************         
      *                                                                         
      *    SUBROUTINE S010A - Report Print Control                              
      *    ---------------------------------------                              
      *                                                                         
      *    Processing:  1.  Print report totals.                                
      *                 2.  Print report detail.                                
      *                                                                         
     CSR         S010A     BEGSR                                                
      *          -----     -----                                                
      *                                                                         
      *    If not at total time - update files                                  
      *                                                                         
B1   CSR         $$TOT     IFEQ ' '                                             
      *                                                                         
      *    If page skip, set over flow indicator.                               
      *                                                                         
B2   CSR         $$PAGE    IFEQ '1'                                             
     CSR         *INLR     ANDEQ'0'                                             
     CSR                   EXSR S010B                                           
      *                    ---- -----                                           
     CSR                   MOVE '1'       *INOF                                 
     CSR                   MOVE ' '       $$PAGE                                
     CSR                   MOVE '1'       *IN02                                 
     CSR                   MOVE ' '       $PFLAG  1                             
     CSR                   MOVE ' '       $HFLAG  1                             
     CSR                   MOVE ' '       $ATHR                                 
      *----------------------------------------------------------------         
      *                                                                         
      *    Move to output - A/R Invoice Number                                  
      *                                                                         
      *    If payment terms break - use the same document number.               
      *                                                                         
B3   CSR         $PTC      IFEQ '1'                                             
     CSR                   MOVE SVDOC     SDDOC                                 
     CSR                   MOVE SVDCT     SDDCT                                 
     CSR                   MOVELSVKCO     SDKCO                                 
E3   CSR                   ENDIF                                                
      *                                                                         
      *    Do not retrieve new number if one already exists.                    
      *                                                                         
     CSR                   MOVE SDDOC     SVDOC                                 
     CSR                   MOVE SDDCT     SVDCT                                 
     CSR                   MOVELSDKCO     SVKCO                                 
B3   CSR         SDDOC     IFEQ *ZEROS                                          
     CSR         $PTC      ANDEQ' '                                             
     CSR         $@PRF     ANDEQ' '                                             
      *                                                                         
     CSR                   MOVELSHKCOO    SVKCO                                 
     CSR                   MOVELSHKCOO    SDKCO                                 
      *                                                                         
     CSR                   SETOF                     9899                       
      *                                                                         
      *    Edit julian date - Date - Order/Transaction                          
      *                                                                         
     CSR                   MOVE SHTRDJ    #SIDAT  6                             
     CSR                   MOVE *BLANK    #EDAT   8                             
     CSR                   MOVEL'*JUL    '#FFMT   7                             
     CSR                   MOVEL'*MDY    '#TFMT   7                             
     CSR                   MOVEL'*NONE   '#SEP    7                             
     CSR                   MOVEL' '       $ERTST  1                             
     CSR                   CALL 'X0028   '             99                       
      *                    ---- ----------                                      
     CSR                   PARM           #SIDAT                                
     CSR                   PARM           #EDAT                                 
     CSR                   PARM           #FFMT                                 
     CSR                   PARM           #TFMT                                 
     CSR                   PARM           #SEP                                  
     CSR                   PARM           $ERTST                                
     CSR                   MOVEL#SIDAT    $NBR6   6                             
      *                                                                         
      *    Edit julian date - Date - INVOICE DATE                               
      *                                                                         
     CSR                   MOVE $UDATE    #SIDAT  6                             
     CSR                   MOVE *BLANK    #EDAT   8                             
     CSR                   MOVEL'*JUL    '#FFMT   7                             
     CSR                   MOVEL'*MDY    '#TFMT   7                             
     CSR                   MOVEL'*NONE   '#SEP    7                             
     CSR                   MOVEL' '       $ERTST  1                             
     CSR                   CALL 'X0028   '             99                       
      *                    ---- ----------                                      
     CSR                   PARM           #SIDAT                                
     CSR                   PARM           #EDAT                                 
     CSR                   PARM           #FFMT                                 
     CSR                   PARM           #TFMT                                 
     CSR                   PARM           #SEP                                  
     CSR                   PARM           $ERTST                                
     CSR                   MOVEL#SIDAT    $INVDT  6                             
      *                                                                         
      *    Calculate Fiscal Year based on the invoice date.                     
      *                                                                         
     CSR                   MOVE '1'       #CALC                                 
     CSR                   MOVE SHKCOO    #CO                                   
     CSR                   MOVE $INVDT    #DG                                   
     CSR                   CALL 'X09031'                                        
      *                    ---- --------                                        
     CSR                   PARM           #CALC   1                             
     CSR                   PARM           #CO     5                             
     CSR                   PARM           #DG     60                            
     CSR                   PARM           #PN     20                            
     CSR                   PARM           #FY     20                            
     CSR                   PARM           #CTRY   20                            
     CSR                   PARM           #EDT    1                             
     CSR                   PARM ' '       #DGSY   1                             
     CSR                   PARM ' '       #JFLG   1                             
      *                                                                         
B4   CSR         *IN98     DOWEQ'0'                                             
      *                                                                         
      *    Automatic Next Number for - Document Number                          
      *       Next Numbers Table  :  03                                         
      *       Index to Table      :  $ARIN                                      
      *                                                                         
     CSR                   MOVE CCCRCD    $$CRCD                                
     CSR                   MOVE $ARIN     $$ARIN                                
     CSR                   CALL 'X0010'                82                       
      *                    ---- -------                                         
     CSR                   PARM '03'      PSSY                                  
     CSR                   PARM $$ARIN    PSIDX                                 
     CSR                   PARM *ZERO     #NXTNO                                
     CSR                   PARM $@DCT     PSDCTO                                
     CSR                   PARM *BLANKS   PSINQ                                 
     CSR                   PARM SDKCO     PSKCOO                                
     CSR                   PARM #CTRY     PSCTRY                                
     CSR                   PARM #FY       PSFY                                  
      *                                                                         
     CSR         SDDOC     IFNE *ZEROS                                          
     CSR                   MOVE SDDOC     $PDOC                                 
     CSR                   MOVE SDDCT     $PDCT                                 
     CSR                   MOVE SDKCO     $PKCO                                 
     CSR                   ELSE                                                 
     CSR                   MOVE #NXTNO    $PDOC                                 
     CSR                   MOVE $@DCT     $PDCT                                 
     CSR                   MOVE SDKCO     $PKCO                                 
     CSR                   ENDIF                                                
      *                                                                         
     CSR                   MOVE $@DCT     SVDCT                                 
     CSR                   MOVE $@DCT     SDDCT                                 
     CSR                   MOVE #NXTNO    SVDOC                                 
     CSR                   MOVE #NXTNO    SDDOC                                 
      *                                                                         
      *   Access F0311 through server call                                      
     C****       RPKY01    CHAINI0311D               9899                       
     CSR                   MOVELSDDOC     RPDOC                                 
     CSR                   MOVEL$@DCT     RPDCT                                 
     CSR                   MOVELSDKCO     RPKCO                                 
      *                                                                         
     CSR                   MOVE 'K'       @@ACCS                                
     CSR                   MOVEL'CHAIN'   @@OPER                                
     CSR                   MOVEL'N'       @@LOCK                                
     CSR                   MOVEL'RPKY04'  @@KLST                                
     CSR                   Z-ADD3         @@KNUM                                
     CSR                   CALL 'XF0311'                                        
      *                    ---- --------                                        
     CSR                   PARM           PS@@1                                 
     CSR                   PARM           AR01                                  
      *                                                                         
      *    Set indicators based on I/O file server return value.                
      *                                                                         
B5   CSR         @@IOR     IFEQ 'NF '                                           
     CSR                   SETON                     98                         
E5   CSR                   ENDIF                                                
      *                                                                         
B5   CSR         @@ERR     IFNE *BLANKS                                         
     CSR         @@IOR     OREQ 'RL '                                           
     CSR                   SETON                     99                         
E5   CSR                   ENDIF                                                
      *                                                                         
E4   CSR                   ENDDO                                                
E3   CSR                   ENDIF                                                
      *                                                                         
B3   CSR         SDDOC     IFNE *ZERO                                           
     CSR         $@PRF     ANDEQ' '                                             
      *                                                                         
     CSR                   MOVELSDDCT     RRDCT                                 
      *                                                                         
     CSR                   MOVE *BLANK    #SINBR                                
     CSR                   MOVELSDDOC     #SINBR                                
     CSR                   MOVE T@DOC     #DTYP                                 
     CSR                   MOVE W@DOC     #EWRD                                 
     CSR                   MOVE E@DOC     #EC                                   
     CSR                   MOVE F@DOC     #DSPD                                 
     CSR                   MOVE G@DOC     #DATD                                 
     CSR                   MOVE J@DOC     #ALR                                  
     CSR                   MOVE ' '       #ECOR                                 
     CSR                   MOVE ' '       #DCOR                                 
     CSR                   EXSR C00161                                          
      *                    ---- ------                                          
B4   CSR         #ALR      IFEQ 'L'                                             
     CSR                   MOVEL#SINBR    RR#DOC                                
X4   CSR                   ELSE                                                 
     CSR                   MOVE #SINBR    RR#DOC                                
E4   CSR                   ENDIF                                                
E3   CSR                   ENDIF                                                
E2   CSR                   ENDIF                                                
      *                                                                         
     CSR                   EXSR S010U                                           
      *                    ---- -----                                           
E1   CSR                   ENDIF                                                
DBY30CSR                   CLEAR@UA                                             
     CSR                   MOVEAVC1PTL    @UA                                   
     CSR                   Z-ADD30        #OUTLG                                
     CSR                   EXSR C9822                                           
      *                    ---- -----                                           
     CSR                   MOVEA@UB       VC0PTL 30                             
      *                                                                         
      *    Perform tax calculations                                             
      *                                                                         
     CSR         *INLR     IFNE '1'                                             
B1   CSR         $$FITM    ANDEQ' '                                             
     CSR         $$LNID    ANDEQ' '                                             
     CSR         $@IC      ANDEQ' '                                             
     CSR                   EXSR S0042                                           
      *                    ---- -----                                           
     CSR                   EXSR S010C                                           
      *                    ---- -----                                           
     CSR                   ENDIF                                                
      *                                                                         
      *    If line or item break, process this routine.                         
      *                                                                         
B1   CSR         $$FITM    IFEQ '1'                                             
     CSR         $$LNID    OREQ '1'                                             
      *                                                                         
      *    Move current record values to saved fields.                          
      *                                                                         
     CSR                   MOVE SVRESL    SDRESL                                
DBN  CSR                   MOVELDS4211    PR4211                                
      *                                                                         
      *    Move accumulated fields back to data fields                          
      *                                                                         
DBN  CSR                   MOVELSV4211    DS4211                                
     CSR                   MOVEL$PDOC     SDDOC                                 
     CSR                   MOVEL$PDCT     SDDCT                                 
     CSR                   MOVEL$PKCO     SDKCO                                 
     CSR                   Z-ADD$SOQS     SDSOQS                                
     CSR                   Z-ADD$SOBK     SDSOBK                                
     CSR                   Z-ADD$SOCN     SDSOCN                                
     CSR                   Z-ADD$AEXP     SDAEXP                                
     CSR                   Z-ADD$FEA      SDFEA                                 
     CSR                   Z-ADD$ECST     SDECST                                
     CSR                   Z-ADD$FEC      SDFEC                                 
     CSR                   Z-ADD$PQOR     SDPQOR                                
     CSR                   Z-ADD$UORG     SDUORG                                
      *                                                                         
     CSR         @@OFLN    SUB  @@CLNO    $$DIFF  30                            
B2   CSR         *INOF     IFEQ '1'                                             
     CSR         $$DIFF    ORLE $TOTL                                           
     CSR                   EXSR S010H                                           
      *                    ---- -----                                           
E2   CSR                   ENDIF                                                
      *----------------------------------------------------------------         
      *                                                                         
      *    Retrieve Preferences for Print Messages                              
      *                                                                         
     CSR                   MOVEA'1'       @PR,5                                 
     CSR                   MOVEA@PR       PSPRFR                                
     CSR                   MOVEL'S'       PSSYS                                 
      *                                                                         
     CSR         $@IC      IFEQ '1'                                             
     CSR                   MOVELSDAN8     $AN8                                  
     CSR                   MOVELSDSHAN    $SHAN                                 
     CSR                   MOVELSDPA8     $PA8                                  
     CSR                   MOVELUDIAN8    SDAN8                                 
     CSR                   MOVELUDIAN8    SDSHAN                                
     CSR                   MOVELUDIAN8    SDPA8                                 
     CSR                   END                                                  
      *                                                                         
DBN  CSR                   MOVELDS4211    PSRECP                                
      *                                                                         
     CSR                   CALL 'P40400  '             98                       
      *                    ---- ----------                                      
     CSR                   PARM 'P40400'  PSPID  10                             
     CSR                   PARM 'ZJDE0001'PSVERS 10                             
     CSR                   PARM           Z40300                                
     CSR                   PARM           PSRECP                                
     CSR                   PARM           PSSYS   1                             
     CSR                   PARM           PSPRFR 10                             
      *                                                                         
     CSR         $@IC      IFEQ '1'                                             
     CSR                   MOVEL$AN8      SDAN8                                 
     CSR                   MOVEL$SHAN     SDSHAN                                
     CSR                   MOVEL$PA8      SDPA8                                 
     CSR                   END                                                  
      *                                                                         
      *----------------------------------------------------------------         
      *                                                                         
      *    Process Text Lines - Print before detail line                        
      *                                                                         
     CSR                   MOVE 'B'       $$TEXT  1                             
      *                                                                         
      *   Print Global message if one is entered in the Proc. Options           
      *    and the message is set to print before any detail lines              
      *                                                                         
     CSR         $PFLAG    IFEQ *BLANKS                                         
     CSR                   MOVEL$@INMG    PSINMG                                
     CSR                   MOVEL*ZEROS    PSITM                                 
     CSR                   MOVEL'Y'       $GFLAG  1                             
     CSR                   EXSR S010T                                           
      *                    ---- -----                                           
      *                                                                         
     CSR                   MOVEL' '       $GFLAG                                
     CSR         $PRT      IFEQ '1'                                             
     CSR                   MOVE '1'       $PFLAG  1                             
     CSR                   ENDIF                                                
     CSR                   ENDIF                                                
      *                                                                         
      *   Print Header level message if there is one and the message            
      *    is set to print before any detail lines.                             
      *                                                                         
     CSR                   MOVELSHINMG    $$INMG                                
     CSR                   MOVELSVINMG    SHINMG                                
      *                                                                         
     CSR         $HFLAG    IFEQ *BLANKS                                         
     CSR                   MOVELSHINMG    PSINMG                                
     CSR                   MOVEL*ZEROS    PSITM                                 
     CSR                   EXSR S010T                                           
      *                    ---- -----                                           
     CSR         $PRT      IFEQ '1'                                             
     CSR                   MOVEL'1'       $HFLAG                                
     C*R                   MOVEL*BLANKS   SVINMG                                
     CSR                   ENDIF                                                
     CSR                   ENDIF                                                
      *                                                                         
     CSR                   MOVEL$$INMG    SHINMG                                
      *                                                                         
      *    Check for associated text to print before based on                   
      *      Processing Option                                                  
      *                                                                         
     CSR         $@ASTX    IFEQ '1'                                             
     CSR         $ATHR     ANDEQ*BLANKS                                         
     CSR                   MOVE SHDOCO    JMDOCO                                
     CSR                   MOVE SHDCTO    JMDCTO                                
     CSR                   MOVE SHKCOO    JMKCOO                                
     CSR                   Z-ADD*ZEROS    JMLNID                                
     CSR                   EXSR S010V                                           
      *                    ---- -----                                           
     CSR                   END                                                  
      *----------------------------------------------------------------         
      *                                                                         
      *    Print Item Note before line                                          
      *                                                                         
     CSR                   Z-ADDSDITM     PSITM                                 
     CSR                   MOVE *BLANKS   PSINMG                                
     CSR                   EXSR S010T                                           
      *                    ---- -----                                           
      *                                                                         
      *   Print Detail level message if there is one and the message            
      *    is set to print before any detail lines.                             
      *                                                                         
     CSR                   MOVELSDINMG    PSINMG                                
     CSR                   MOVEL*ZEROS    PSITM                                 
     CSR                   EXSR S010T                                           
      *                    ---- -----                                           
      *                                                                         
      *   Print Preference Print Messages for detail level and the msg          
      *    is set to print before any detail lines.                             
      *                                                                         
     CSR                   MOVEL*BLANKS   PREC                                  
     CSR                   MOVEL*BLANKS   DSPRNT                                
     CSR                   MOVEL'0'       PSTAT                                 
     CSR                   Z-ADD#KYL2     PKEYL                                 
      *                                                                         
     CSR         PSTAT     DOWEQ'0'                                             
     CSR                   CALL 'X00IDX'                                        
      *                    ---- --------                                        
     CSR                   PARM           DS#IDX           index name           
     CSR                   PARM 'I'       PACTN   1        action               
     CSR                   PARM 'GT'      PRULE   2        rule                 
     CSR                   PARM           PKEYL   30       key length           
     CSR                   PARM DSPRNT    PKEY  120        key value            
     CSR                   PARM #RCL2     PRECL   30       record length        
     CSR                   PARM           PREC  210        record length        
     CSR                   PARM           PSTAT            record value         
      *                                                                         
     CSR         PSTAT     IFEQ '0'                                             
DBN  CSR                   MOVELPREC      DSPRNT                                
     CSR         DS#TYP    IFEQ 'D'                                             
     CSR                   MOVE DSINMG    PSINMG                                
     CSR                   MOVEL*ZEROS    PSITM                                 
     CSR                   EXSR S010T                                           
      *                    ---- -----                                           
     CSR                   ELSE                                                 
     CSR                   MOVEL'1'       PSTAT                                 
     CSR                   END                                                  
     CSR                   END                                                  
      *                                                                         
     CSR                   Z-ADD#KYL3     PKEYL                                 
     CSR                   ENDDO                                                
      *                                                                         
      *    Check for associated text to print before based on                   
      *      Processing Option                                                  
      *                                                                         
B2   CSR         $@ASTX    IFEQ '1'                                             
     CSR                   MOVE SDDOCO    JMDOCO                                
     CSR                   MOVE SDDCTO    JMDCTO                                
     CSR                   MOVE SDKCOO    JMKCOO                                
     CSR                   Z-ADDSDLNID    JMLNID                                
     CSR                   EXSR S010V                                           
      *                    ---- -----                                           
E2   CSR                   ENDIF                                                
      *                                                                         
      *                                                                         
      *    Read Line Type Constants                                             
      *                                                                         
     CSR                   MOVE ' '       LFTXYN                                
     CSR                   MOVE *BLANKS   PS@@                                  
     CSR                   MOVELSDLNTY    KY@@                                  
     CSR                   CALL 'XS40205'                                       
      *                    ---- ---------                                       
     CSR                   PARM           PS@@                                  
     CSR                   PARM           DS4020                                
      *                                                                         
      *    Move fields to report fields                                         
      *                                                                         
B2   CSR         $@KITS    IFNE *BLANKS                                         
     CSR         SDRLIT    OREQ *BLANKS                                         
     CSR                   EXSR S004                                            
      *                    ---- ----                                            
      *                                                                         
      *    Retreive Print Adjustment History                                    
      *                                                                         
     CSR                   EXSR S010PA                                          
      *                    ---- ------                                          
      *                                                                         
B3   CSR         $@EDI     IFNE '2'                                             
SER   *                                                                         
SER   * Make ship qty = B/O for backorder detail line                           
SER   *                                                                         
SER  CSR         SDSOBK    IFGT 0                                               
SER  CSR         SDLTTR    IFEQ '902'                                           
SER  CSR         SDLTTR    OREQ '904'                                           
SER  CSR                   CLEARR2SOQS                                          
SER  CSR                   MOVEL'B/O'     R2SOQS                                
SER  CSR                   CLEARR2AEXP                                          
SER  CSR                   ENDIF                                                
SER  CSR                   ENDIF                                                
SER   *                                                                         
SER  C           SHEXR1    IFEQ 'E '                                            
SER  C                     MOVE ' '       RRTX                                  
SER  C                     ENDIF                                                
SER  C           SHEXR1    IFEQ 'S '                                            
SER  C           #XSTAM    ANDEQ*ZERO                                           
SER  C                     MOVE ' '       RRTX                                  
SER  C                     ENDIF                                                
SER  C           RRTX      IFEQ 'N'                                             
SER  C           RRTX      OREQ 'O'                                             
SER  C                     MOVE ' '       RRTX                                  
SER  C                     ENDIF                                                
SER   *                                                                         
     CSR                   WRITEDETAIL1                OF                       
      *                    ------------                                         
S3560CSR         HLDAN8    IFEQ 33039624                   In Store Media       
S3560CSR         RRUM      IFEQ '5G'                                            
S3560CSR         SDUPRC    DIV  10000     ISMCST                                
S3560CSR         ISMCST    DIV  5         ISMCST                                
S3560CSR                   MOVELPPG       PPG1                                  
S3560CSR                   WRITEDTL1                   OF                       
S3560CSR                   ENDIF                                                
S3560CSR         RRUM      IFEQ '55'                                            
S3560CSR         SDUPRC    DIV  10000     ISMCST                                
S3560CSR         ISMCST    DIV  55        ISMCST                                
S3560CSR                   MOVELPPG       PPG1                                  
S3560CSR                   WRITEDTL1                   OF                       
S3560CSR                   ENDIF                                                
S3560CSR                   ENDIF                                                
      *                                                                         
S5717CSR                   Z-ADD*ZEROS    PRTLBS  20                            
S5717CSR         $5ING     IFGT *BLANKS                                         
S5717CSR         RRUM      IFEQ 'GL'                                            
S5717CSR         RRUM      OREQ 'QT'                                            
S5717CSR         RRUM      OREQ '5G'                                            
S5717CSR         RRUM      OREQ '4G'                                            
S5717CSR         RRUM      OREQ '30'                                            
S5717CSR         RRUM      OREQ '40'                                            
S5717CSR         RRUM      OREQ '50'                                            
S5717CSR         RRUM      OREQ '55'                                            
S5717CSR                   MOVEL'*INMG'   WAPP                                  
S5717CSR                   MOVEL$5ING     CKEY                                  
S5717CSR         A5KEY     CHAINF00163               88                         
S5717CSR         *IN88     IFEQ *OFF                                            
S5717CSR         C5SERK    SETLLF0016                                           
S5717CSR         C5SERK    READEF0016                    87                     
S5717CSR         *IN87     DOWEQ*OFF                                            
S5717CSR                   MOVELCYWTXT    TSTTXT  7                             
S5717CSR         TSTTXT    IFEQ '<<LBS>>'                                       
S5717CSR                   ADD  1         PRTLBS                                
S5717CSR                   ENDIF                                                
S5717CSR         C5SERK    READEF0016                    87                     
S5717CSR                   ENDDO                                                
S5717CSR         PRTLBS    IFGT *ZEROS                                          
S5717CSR                   MOVE *BLANKS   UMMCU                                 
S5717CSR                   Z-ADDSDITM     UMITM                                 
S5717CSR                   MOVELRRUM      UMUM                                  
S5717CSR                   MOVEL'LB'      UMRUM                                 
S5717CSR         UMKY01    CHAINF41002               53                         
S5717CSR         *IN53     IFEQ *OFF                                            
S5717CSR         UMCONV    DIV  10000000  HLDPND 114                            
S5717CSR         HLDPND    MULT SDSOQS    GALPND                                
S5717CSR         GALPND    DIV  100       GALPND                                
S5717CSR                   WRITEDTL2                   OF                       
S5717CSR                   ENDIF                                                
S5717CSR                   ENDIF                                                
S5717CSR                   ENDIF                                                
S5717CSR                   ENDIF                                                
S5717CSR                   ENDIF                                                
S5717 ****** MD            ENDIF                                                
      *                                                                         
E2   CSR                   ENDIF                                                
      *                                                                         
     CSR                   MOVE '0'       *IN40                                 
E2   CSR                   ENDIF                                                
      *                                                                         
      *    Write EDI Invoice Header                                             
      *                                                                         
     CSR         $@EDI     IFEQ '1'                                             
     CSR         $@EDI     OREQ '2'                                             
      *                                                                         
     CSR         $$EDIH    IFEQ ' '                                             
DBN61CSR                   MOVELD42019    PR4201                                
DBN  CSR                   MOVELSV4201    D42019                                
     CSR                   EXSR WRTHD1                                          
DBN  CSR                   MOVELPR4201    D42019                                
      *                    ---- ------                                          
     CSR                   ENDIF                                                
      *                                                                         
      *    Write EDI detail line                                                
      *                                                                         
     CSR                   EXSR WRTDT1                                          
      *                    ---- ------                                          
      *                                                                         
      *    Create the EDI Tag Record                                            
      *                                                                         
     CSR                   EXSR WRTDT2                                          
      *                    ---- ------                                          
     CSR                   ENDIF                                                
23271 * Mexico - write detail to Factura stage file                             
23271C           *IN76     IFEQ *ON                                             
23276C           $$USE     ANDEQ'ON'                                            
23256C                     EXSR S010F                                           
23256 *                    ---- -----                                           
23271C                     ENDIF                                                
      *                                                                         
      *    Add line extension to total order amount                             
      *                                                                         
B2   CSR         $@EXBO    IFEQ '1'                                             
     CSR         SDSOBK    ANDNE0                                               
     CSR         SDRLIT    ANDEQ*BLANKS                                         
     CSR         SDSOQS    ADD  SDSOBK    $WKQTY 150                            
      *                                                                         
      *    Convert quantity ordered to other units of measure                   
      *                                                                         
     CSR         $WKQTY    DIV  #@SOBK    #QTY      H                           
     CSR                   MOVE SDUOM     #UOM                                  
     CSR                   MOVE SDUOM4    #UOM1                                 
     CSR                   MOVELSDMCU     #MCU                                  
     CSR                   MOVE LFIVI     #IVI                                  
     CSR                   MOVE SDCOMM    #READ                                 
     CSR                   MOVE *BLANKS   #OT1Y                                 
     CSR                   Z-ADD*ZEROS    #STDP                                 
     CSR                   MOVEL*BLANKS   #LOTN                                 
      *                                                                         
     CSR                   CALL 'X41002  '             98                       
      *                    ---- ----------                                      
     CSR                   PARM           DS4101                                
     CSR                   PARM           DS@UOM                                
      *                                                                         
B3   CSR         #ERTST    IFEQ '1'                                             
     CSR                   Z-ADD1         #CNVP                                 
     CSR                   Z-ADD1         #CNVQ                                 
E3   CSR                   ENDIF                                                
      *                                                                         
     CSR         SDFUP     DIV  #@FUP     $WK299    H                           
     CSR                   DIV  #CNVP     $WK299    H                           
     CSR                   MULT #PQT      $WK299    H                           
     CSR         $WK299    MULT #@FDO     $WK150    H                           
     CSR                   ADD  $WK150    $FTOTL 150                            
     CSR         SDSOQS    ADD  SDSOBK    $WKQTY 150                            
      *                                                                         
      *    Convert quantity ordered to other units of measure                   
      *                                                                         
     CSR         $WKQTY    DIV  #@SOBK    #QTY      H                           
     CSR                   MOVE SDUOM     #UOM                                  
     CSR                   MOVE SDUOM4    #UOM1                                 
     CSR                   MOVELSDMCU     #MCU                                  
     CSR                   MOVE LFIVI     #IVI                                  
     CSR                   MOVE SDCOMM    #READ                                 
     CSR                   MOVE *BLANKS   #OT1Y                                 
     CSR                   Z-ADD*ZEROS    #STDP                                 
     CSR                   MOVEL*BLANKS   #LOTN                                 
      *                                                                         
     CSR                   CALL 'X41002  '             98                       
      *                    ---- ----------                                      
     CSR                   PARM           DS4101                                
     CSR                   PARM           DS@UOM                                
      *                                                                         
B3   CSR         #ERTST    IFEQ '1'                                             
     CSR                   Z-ADD1         #CNVP                                 
     CSR                   Z-ADD1         #CNVQ                                 
E3   CSR                   ENDIF                                                
      *                                                                         
     CSR         SDUPRC    DIV  #@UPRC    $WK299    H                           
     CSR                   DIV  #CNVP     $WK299    H                           
     CSR                   MULT #PQT      $WK299    H                           
     CSR         $WK299    MULT #@AEXP    $WK150    H                           
     CSR                   ADD  $WK150    $#ATO  150                            
X2   CSR                   ELSE                                                 
     CSR         $@IC      IFEQ ' '                                             
     CSR                   ADD  SDAEXP    $#ATO  150                            
     CSR                   ADD  SDFEA     $FTOTL 150                            
     CSR                   ELSE                                                 
     CSR                   ADD  SDAEXP    $#ATO                                 
     CSR                   ADD  SDFEA     $FTOTL                                
     CSR                   ENDIF                                                
E2   CSR                   ENDIF                                                
      *                                                                         
      *    Total Amounts Cash Discount                                          
      *                                                                         
B2   CSR         LFCDSC    IFEQ 'Y'                                             
     CSR                   ADD  SDAEXP    $$CEXP                                
     CSR                   ADD  SDFEA     $FCEXP                                
      *                                                                         
     CSR         SDCADC    DIV  #@CADC    $$CD   153                            
     CSR                   DIV  100       $$CD                                  
      *                                                                         
     CSR         $$CD      MULT SDAEXP    $LCDIS 150                            
     CSR                   ADD  $LCDIS    $OCDIS 150                            
     CSR         $$CD      MULT SDFEA     $FLDIS 150                            
     CSR                   ADD  $FLDIS    $FODIS 150                            
E2   CSR                   ENDIF                                                
      *                                                                         
      *    Print Adjustment History                                             
      *                                                                         
     CSR                   EXSR S010PR                                          
      *                    ---- ------                                          
      *                                                                         
      *    Print serial numbers based on processing option                      
      *                                                                         
B2   CSR         LFTXYN    IFNE 'Y'                                             
     CSR         LFIVI     ANDNE'N'                                             
     CSR         LFIVI     ANDNE'A'                                             
      *                                                                         
B3   CSR         $@SRL     IFEQ '1'                                             
     CSR                   EXSR S010S                                           
      *                    ---- -----                                           
E3   CSR                   ENDIF                                                
E2   CSR                   ENDIF                                                
      *                                                                         
      *    Process Text Lines - Print after detail line                         
      *                                                                         
     CSR                   MOVE 'A'       $$TEXT  1                             
      *                                                                         
      *    Print Item Note after line                                           
      *                                                                         
     CSR                   Z-ADDSDITM     PSITM                                 
     CSR                   MOVE *BLANKS   PSINMG                                
     CSR                   EXSR S010T                                           
      *                    ---- -----                                           
      *                                                                         
      *   Print Detail level message if there is one and the message            
      *    is set to print after any detail lines.                              
      *                                                                         
     CSR                   MOVELSDINMG    PSINMG                                
     CSR                   MOVEL*ZEROS    PSITM                                 
     CSR                   EXSR S010T                                           
      *                    ---- -----                                           
      *                                                                         
      *   Print Preference Print Messages for detail level and the msg          
      *    is set to print after any detail lines.                              
      *                                                                         
     CSR                   MOVEL*BLANKS   PREC                                  
     CSR                   MOVEL*BLANKS   DSPRNT                                
     CSR                   MOVEL'0'       PSTAT                                 
     CSR                   Z-ADD#KYL2     PKEYL                                 
      *                                                                         
     CSR         PSTAT     DOWEQ'0'                                             
     CSR                   CALL 'X00IDX'                                        
      *                    ---- --------                                        
     CSR                   PARM           DS#IDX           index name           
     CSR                   PARM 'I'       PACTN   1        action               
     CSR                   PARM 'GT'      PRULE   2        rule                 
     CSR                   PARM           PKEYL   30       key length           
     CSR                   PARM DSPRNT    PKEY  120        key value            
     CSR                   PARM #RCL2     PRECL   30       record length        
     CSR                   PARM           PREC  210        record length        
     CSR                   PARM           PSTAT            record value         
      *                                                                         
     CSR         PSTAT     IFEQ '0'                                             
DBN  CSR                   MOVELPREC      DSPRNT                                
     CSR         DS#TYP    IFEQ 'D'                                             
     CSR                   MOVE DSINMG    PSINMG                                
     CSR                   MOVEL*ZEROS    PSITM                                 
     CSR                   EXSR S010T                                           
      *                    ---- -----                                           
     CSR                   ELSE                                                 
     CSR                   MOVEL'1'       PSTAT                                 
     CSR                   END                                                  
     CSR                   END                                                  
      *                                                                         
     CSR                   Z-ADD#KYL3     PKEYL                                 
     CSR                   ENDDO                                                
      *                                                                         
      *    Check for associated text to print after based on                    
      *      Processing Option                                                  
      *                                                                         
B2   CSR         $@ASTX    IFEQ '1'                                             
     CSR                   MOVE SDDOCO    JMDOCO                                
     CSR                   MOVE SDDCTO    JMDCTO                                
     CSR                   MOVE SDKCOO    JMKCOO                                
     CSR                   Z-ADDSDLNID    JMLNID                                
27486 * this didn't control after text for Facturas                             
27486C                     EXSR S010V                                           
      *                    ---- -----                                           
E2   CSR                   ENDIF                                                
      *                                                                         
      *    If Totals are to be printed.                                         
      *                                                                         
B2   CSR         $$TOT     IFEQ '1'                                             
     CSR         *INLR     OREQ '1'                                             
      *                                                                         
      *    Print tax summary subtotals                                          
      *                                                                         
B3   CSR         $@VAT     IFNE *BLANKS                                         
     CSR         $TAX      ANDEQ'Y'                                             
     CSR                   EXSR S010X                                           
      *                    ---- -----                                           
E3   CSR                   ENDIF                                                
      *                                                                         
     CSR         $RND      IFEQ '1'                                             
      *                                                                         
      *    Calculate Order Total Tax                                            
      *                                                                         
     CSR                   Z-ADD*ZEROS    $WK299 299                            
     CSR                   Z-ADD*ZEROS    $#ATT                                 
     CSR                   MOVE *BLANKS   DSKY$1                                
     CSR                   MOVEL*BLANKS   K1TXA1                                
     CSR                   Z-ADD*ZEROS    K1ITM                                 
     CSR                   MOVE *BLANKS   K1EXR1                                
     CSR                   MOVE 'I'       PACTN                                 
     CSR                   MOVE 'GE'      PRULE                                 
     CSR                   MOVE '0'       PSTAT1                                
      *                                                                         
     CSR         PSTAT1    DOWEQ'0'                                             
      *                                                                         
     CSR                   MOVE *BLANKS   PKEY                                  
DBN12CSR                   MOVELDSKY$1    PKEY                                  
      *                                                                         
     CSR                   EXSR S0041                                           
      *                    ---- -----                                           
      *                                                                         
     CSR         $1TXA1    IFEQ K1TXA1                                          
     CSR         $1ITM1    ANDEQK1ITM                                           
     CSR         $1EXR1    ANDEQK1EXR1                                          
     CSR         $1TAX1    ANDEQK1TAX1                                          
     CSR                   MOVE '1'       PSTAT1                                
     CSR                   END                                                  
      *                                                                         
     CSR         $1TXA1    IFNE K1TXA1                                          
     CSR         $1ITM1    ORNE K1ITM                                           
     CSR         $1EXR1    ORNE K1EXR1                                          
     CSR         PSTAT1    OREQ '1'                                             
     CSR                   Z-ADD$WK299    $WK150    H                           
     CSR                   ADD  $WK150    $#ATT                                 
S1203CSR                   Z-ADD*ZEROS    $WK299                                
     CSR                   END                                                  
      *                                                                         
     CSR         PSTAT1    IFEQ '0'                                             
      *                                                                         
     CSR         $1TAX1    IFNE 'N'                                             
     CSR                   ADD  $1UTAM    $WK299                                
     CSR                   END                                                  
      *                                                                         
     CSR                   MOVE *BLANKS   DSKY$1                                
     CSR                   MOVE $1TXA1    K1TXA1                                
     CSR                   MOVE $1ITM1    K1ITM                                 
     CSR                   MOVE $1EXR1    K1EXR1                                
     CSR                   MOVE $1TAX1    K1TAX1                                
     CSR                   MOVE 'GT'      PRULE                                 
      *                                                                         
     CSR                   END                                                  
     CSR                   END                                                  
      *                                                                         
      *    Clear user index.                                                    
      *                                                                         
     CSR                   Z-ADD1         PSKEYL  30                            
     CSR                   MOVE *BLANK    PKEY                                  
      *                                                                         
     CSR                   CALL 'X00IDX'                                        
      *                    ---- --------                                        
     CSR                   PARM           DSIDX1                                
     CSR                   PARM 'D'       PACTN                                 
     CSR                   PARM 'EQ'      PRULE                                 
     CSR                   PARM           PSKEYL                                
     CSR                   PARM           PKEY                                  
     CSR                   PARM           $IRCLN                                
     CSR                   PARM           DS$1                                  
     CSR                   PARM           PSTAT1                                
      *                                                                         
      *    Clear Rounding Summary flag.                                         
      *                                                                         
     C*****                MOVE ' '       $RND                                  
     CSR                   END                                                  
      *                                                                         
      *----------------------------------------------------------------         
      *                                                                         
      *    Move to report - Amount - Total Order Price                          
      *                                                                         
B3   CSR         $@CNV     IFEQ '1'                                             
     CSR         $@CURR    ANDEQ'1'                                             
      *                                                                         
      *    Display Foreign Tax                                                  
      *                                                                         
     CSR                   Z-ADD$FTOTL    $WK150 150                            
     CSR                   ADD  $#ATT     $WK150                                
S7312CSR                   Z-ADD$WK150    $INTOT           Invoice Total        
      *                                                                         
     CSR                   MOVE *BLANK    #SINBR                                
     CSR                   MOVE $WK150    #SINBR                                
     CSR                   MOVE T@FEA     #DTYP                                 
     CSR                   MOVE W@FEA     #EWRD                                 
     CSR                   MOVE E@FEA     #EC                                   
     CSR                   MOVE $FDO      #DSPD                                 
     CSR                   MOVE G@FEA     #DATD                                 
     CSR                   MOVE J@FEA     #ALR                                  
     CSR                   MOVE ' '       #ECOR                                 
     CSR                   MOVE ' '       #DCOR                                 
     CSR                   EXSR C00161                                          
      *                    ---- ------                                          
B4   CSR         #ALR      IFEQ 'L'                                             
     CSR                   MOVEL#SINBR    RR#ATO                                
S7312CSR                   MOVEL#SINBR    RRMATO                                
X4   CSR                   ELSE                                                 
     CSR                   MOVE #SINBR    RR#ATO                                
S7312CSR                   MOVE #SINBR    RRMATO                                
E4   CSR                   ENDIF                                                
      *                                                                         
X3   CSR                   ELSE                                                 
      *                                                                         
      *    Display Domestic Tax                                                 
      *                                                                         
B4   CSR         $@CNV     IFEQ '1'                                             
     CSR         $@CURR    ANDEQ' '                                             
     CSR                   MOVE $CDO      #DSPD                                 
E4   CSR                   ENDIF                                                
      *                                                                         
      *    No Foreign Currency                                                  
      *                                                                         
B4   CSR         $@CNV     IFNE '1'                                             
     CSR                   MOVE F@AEXP    #DSPD                                 
E4   CSR                   ENDIF                                                
      *                                                                         
     CSR                   Z-ADD$#ATO     $WK150                                
     CSR                   ADD  $#ATT     $WK150                                
S7312CSR                   Z-ADD$WK150    $INTOT 150       Invoice Total        
      *                                                                         
     CSR                   MOVE *BLANK    #SINBR                                
     CSR                   MOVE $WK150    #SINBR                                
     CSR                   MOVE T@AEXP    #DTYP                                 
     CSR                   MOVE W@AEXP    #EWRD                                 
     CSR                   MOVE E@AEXP    #EC                                   
     CSR                   MOVE G@AEXP    #DATD                                 
     CSR                   MOVE J@AEXP    #ALR                                  
     CSR                   MOVE ' '       #ECOR                                 
     CSR                   MOVE ' '       #DCOR                                 
     CSR                   EXSR C00161                                          
      *                    ---- ------                                          
B4   CSR         #ALR      IFEQ 'L'                                             
     CSR                   MOVEL#SINBR    RR#ATO                                
S7312CSR                   MOVEL#SINBR    RRMATO                                
X4   CSR                   ELSE                                                 
     CSR                   MOVE #SINBR    RR#ATO                                
S7312CSR                   MOVE #SINBR    RRMATO                                
E4   CSR                   ENDIF                                                
E3   CSR                   ENDIF                                                
      *-------------------------------------------------------------            
      *                                                                         
      *    Move to report - Amount - Total Sales Order Tax                      
      *                                                                         
     CSR                   MOVEL*BLANKS   RR#ATT                                
S7312CSR                   MOVEL*BLANKS   RRMATT                                
      *                                                                         
B3   CSR         $@CNV     IFEQ '1'                                             
     CSR         $@CURR    ANDEQ'1'                                             
      *                                                                         
      *    Display Foreign Tax                                                  
      *                                                                         
     CSR                   MOVE *BLANK    #SINBR                                
     CSR                   MOVEL$#ATT     #SINBR                                
     CSR                   MOVE T@#ATT    #DTYP                                 
     CSR                   MOVE W@#ATT    #EWRD                                 
     CSR                   MOVE E@#ATT    #EC                                   
     CSR                   MOVE $FDO      #DSPD                                 
     CSR                   MOVE G@#ATT    #DATD                                 
     CSR                   MOVE J@#ATT    #ALR                                  
     CSR                   MOVE ' '       #ECOR                                 
     CSR                   MOVE ' '       #DCOR                                 
     CSR                   EXSR C00161                                          
      *                    ---- ------                                          
B4   CSR         #ALR      IFEQ 'L'                                             
     CSR                   MOVEL#SINBR    RR#ATT                                
S7312CSR                   MOVEL#SINBR    RRMATT                                
X4   CSR                   ELSE                                                 
     CSR                   MOVE #SINBR    RR#ATT                                
S7312CSR                   MOVE #SINBR    RRMATT                                
E4   CSR                   ENDIF                                                
      *                                                                         
X3   CSR                   ELSE                                                 
      *                                                                         
      *    Display Domestic Tax                                                 
      *                                                                         
B4   CSR         $@CNV     IFEQ '1'                                             
     CSR         $@CURR    ANDEQ' '                                             
     CSR                   MOVE $CDO      #DSPD                                 
E4   CSR                   ENDIF                                                
      *                                                                         
      *    No Foreign Currency                                                  
      *                                                                         
B4   CSR         $@CNV     IFNE '1'                                             
     CSR                   MOVE F@#ATT    #DSPD                                 
E4   CSR                   ENDIF                                                
      *                                                                         
     CSR                   MOVE *BLANK    #SINBR                                
     CSR                   MOVEL$#ATT     #SINBR                                
     CSR                   MOVE T@#ATT    #DTYP                                 
     CSR                   MOVE W@#ATT    #EWRD                                 
     CSR                   MOVE E@#ATT    #EC                                   
     CSR                   MOVE G@#ATT    #DATD                                 
     CSR                   MOVE J@#ATT    #ALR                                  
     CSR                   MOVE ' '       #ECOR                                 
     CSR                   MOVE ' '       #DCOR                                 
     CSR                   EXSR C00161                                          
      *                    ---- ------                                          
B4   CSR         #ALR      IFEQ 'L'                                             
     CSR                   MOVEL#SINBR    RR#ATT                                
S7312CSR                   MOVEL#SINBR    RRMATT                                
X4   CSR                   ELSE                                                 
     CSR                   MOVE #SINBR    RR#ATT                                
S7312CSR                   MOVE #SINBR    RRMATT                                
E4   CSR                   ENDIF                                                
      *                                                                         
E3   CSR                   ENDIF                                                
      *----------------------------------------------------------------         
      *                                                                         
      *    Move to report - Total Area Tax Rate                                 
      *                                                                         
B3   CSR         $MLTTX    IFEQ ' '                                             
     CSR                   MOVE *BLANK    #SINBR                                
     CSR                   MOVEL$SVTAX    #SINBR                                
     CSR                   MOVE T@TRAT    #DTYP                                 
     CSR                   MOVE W@TRAT    #EWRD                                 
     CSR                   MOVE E@TRAT    #EC                                   
     CSR                   MOVE F@TRAT    #DSPD                                 
     CSR                   MOVE G@TRAT    #DATD                                 
     CSR                   MOVE J@TRAT    #ALR                                  
     CSR                   MOVE ' '       #ECOR                                 
     CSR                   MOVE ' '       #DCOR                                 
     CSR                   EXSR C00161                                          
      *                    ---- ------                                          
B4   CSR         #ALR      IFEQ 'L'                                             
     CSR                   MOVEL#SINBR    RRTRAT                                
X4   CSR                   ELSE                                                 
     CSR                   MOVE #SINBR    RRTRAT                                
E4   CSR                   ENDIF                                                
      *                                                                         
      *    If multiple taxes, move * N/A * to total area tax rate               
      *                                                                         
X3   CSR                   ELSE                                                 
     CSR                   MOVE *BLANK    RRTRAT                                
     CSR                   CLEAR@UA                                             
     CSR                   MOVEAVTX018    @UA                                   
     CSR                   Z-ADD7         #OUTLG                                
     CSR                   EXSR C9822                                           
      *                    ---- -----                                           
     CSR                   MOVEA@UB       RRTRAT                                
E3   CSR                   ENDIF                                                
      *                                                                         
      *----------------------------------------------------------------         
      *                                                                         
      *    Move to report - Discount Available                                  
      *                                                                         
     CSR                   MOVE *BLANKS   RRADSC                                
     CSR                   MOVE '0'       *IN30                                 
B3   CSR         $@DISC    IFEQ '1'                                             
      *                                                                         
      *    Add Cash Discount Amount                                             
      *                                                                         
     CSR                   ADD  $OCDIS    $$DAMT                                
     CSR                   ADD  $FODIS    $FDAMT                                
      *                                                                         
      *    Display Foreign Discount Available                                   
      *                                                                         
B4   CSR         $@CNV     IFEQ '1'                                             
     CSR         $@CURR    ANDEQ'1'                                             
     CSR                   MOVE *BLANK    #SINBR                                
     CSR                   MOVEL$FDAMT    #SINBR                                
     CSR                   MOVE T@CDS     #DTYP                                 
     CSR                   MOVE W@CDS     #EWRD                                 
     CSR                   MOVE E@CDS     #EC                                   
     CSR                   MOVE $FDO      #DSPD                                 
     CSR                   MOVE G@CDS     #DATD                                 
     CSR                   MOVE J@CDS     #ALR                                  
     CSR                   MOVE ' '       #ECOR                                 
     CSR                   MOVE ' '       #DCOR                                 
     CSR                   EXSR C00161                                          
      *                    ---- ------                                          
B5   CSR         #ALR      IFEQ 'L'                                             
     CSR                   MOVEL#SINBR    RRADSC                                
X5   CSR                   ELSE                                                 
     CSR                   MOVE #SINBR    RRADSC                                
E5   CSR                   ENDIF                                                
      *                                                                         
X4   CSR                   ELSE                                                 
      *                                                                         
      *    Display Domestic Discount Available                                  
      *                                                                         
B5   CSR         $@CNV     IFEQ '1'                                             
     CSR         $@CURR    ANDEQ' '                                             
     CSR                   MOVE $CDO      #DSPD                                 
E5   CSR                   ENDIF                                                
      *                                                                         
      *    No Foreign Currency                                                  
      *                                                                         
B5   CSR         $@CNV     IFNE '1'                                             
     CSR                   MOVE F@ADSC    #DSPD                                 
E5   CSR                   ENDIF                                                
      *                                                                         
     CSR                   MOVE *BLANK    #SINBR                                
     CSR                   MOVE $$DAMT    #SINBR                                
     CSR                   MOVE T@ADSC    #DTYP                                 
     CSR                   MOVE W@ADSC    #EWRD                                 
     CSR                   MOVE E@ADSC    #EC                                   
     CSR                   MOVE G@ADSC    #DATD                                 
     CSR                   MOVE J@ADSC    #ALR                                  
     CSR                   MOVE ' '       #ECOR                                 
     CSR                   MOVE ' '       #DCOR                                 
     CSR                   EXSR C00161                                          
      *                    ---- ------                                          
B5   CSR         #ALR      IFEQ 'L'                                             
     CSR                   MOVEL#SINBR    RRADSC                                
X5   CSR                   ELSE                                                 
     CSR                   MOVE #SINBR    RRADSC                                
E5   CSR                   ENDIF                                                
E4   CSR                   ENDIF                                                
      *                                                                         
      *    If discount available is blank, don't print text                     
      *                                                                         
     CSR                   MOVE '1'       *IN30                                 
B4   CSR         RRADSC    IFEQ *BLANKS                                         
     CSR                   MOVE '0'       *IN30                                 
E4   CSR                   ENDIF                                                
      *                                                                         
E3   CSR                   ENDIF                                                
      *----------------------------------------------------------------         
      *                                                                         
      *    Calculate difference between overflow line and current line          
      *    to determine if the heading should be printed before totals.         
      *                                                                         
     CSR         @@OFLN    SUB  @@CLNO    $$DIFF  30                            
B3   CSR         *INOF     IFEQ '1'                                             
     CSR         $$DIFF    ORLE $TOTL                                           
     CSR                   Z-ADD$#PG      $$PGSV                                
     CSR                   Z-ADD##PGSV    $#PG                                  
     CSR                   EXSR S010H                                           
      *                    ---- -----                                           
     CSR                   Z-ADD$#PG      ##PGSV                                
     CSR                   Z-ADD$$PGSV    $#PG                                  
E3   CSR                   ENDIF                                                
      *----------------------------------------------------------------         
      *                                                                         
     CSR                   MOVE 'A'       $$TEXT  1                             
      *                                                                         
      *                                                                         
      *   Print Header level message if there is one and the message            
      *    is set to print after any detail lines.                              
      *                                                                         
     CSR                   MOVELSHINMG    $$INMG                                
     CSR                   MOVELSVINMG    SHINMG                                
      *                                                                         
     CSR         $HFLAG    IFEQ *BLANKS                                         
     CSR                   MOVELSHINMG    PSINMG                                
     CSR                   MOVEL*ZEROS    PSITM                                 
     CSR                   MOVEL'1'       $$HFLG                                
     CSR                   EXSR S010T                                           
      *                    ---- -----                                           
     CSR         $PRT      IFEQ '1'                                             
     CSR                   MOVEL'1'       $HFLAG                                
     CSR                   MOVEL' '       $$HFLG                                
     C*R                   MOVEL*BLANKS   SVINMG                                
     CSR                   ENDIF                                                
     CSR                   ENDIF                                                
      *                                                                         
     CSR                   MOVEL$$INMG    SHINMG                                
      *                                                                         
      *    Check for associated text to print before based on                   
      *      Processing Option                                                  
      *                                                                         
     CSR         $@ASTX    IFEQ '1'                                             
     CSR         $ATHR     ANDEQ*BLANKS                                         
     CSR                   MOVE SHDOCO    JMDOCO                                
     CSR                   MOVE SHDCTO    JMDCTO                                
     CSR                   MOVE SHKCOO    JMKCOO                                
     CSR                   Z-ADD*ZEROS    JMLNID                                
     CSR                   EXSR S010V                                           
      *                    ---- -----                                           
     CSR                   END                                                  
      *                                                                         
      *   Print Global message if one is entered in the Proc. Options           
      *    and the message is set to print before any detail lines              
      *                                                                         
     CSR         $PFLAG    IFEQ *BLANKS                                         
     CSR                   MOVEL$@INMG    PSINMG                                
     CSR                   MOVEL*ZEROS    PSITM                                 
     CSR                   MOVEL'Y'       $GFLAG                                
     CSR                   EXSR S010T                                           
      *                    ---- -----                                           
      *                                                                         
     CSR                   MOVEL' '       $GFLAG                                
     CSR         $PRT      IFEQ '1'                                             
     CSR                   MOVE '1'       $PFLAG  1                             
     CSR                   ENDIF                                                
     CSR                   ENDIF                                                
      *                                                                         
      *    Calculate difference between overflow line and number of             
      *    lines in the total.  If not at the bottom of the form,               
      *    write a blank line.                                                  
      *                                                                         
     C*SR         @@OFLN    SUB  $TOTL     $$OFLN  30                           
B3   C*SR         @@CLNO    IFLT $$OFLN                                         
B4   C*SR         $$OFLN    DOUEQ@@CLNO                                         
     C*SR                   WRITEBLANKS                 OF                      
      *                    -----------                                          
E4   C*SR                   ENDDO                                               
E3   C*SR                   ENDIF                                               
      *                                                                         
      *    Write order total                                                    
      *                                                                         
     CSR         $@EDI     IFNE '2'                                             
SER  CSR         RR#ATT    IFNE *BLANKS                                         
SER  CSR                   SETON                     44                         
SER  CSR                   ENDIF                                                
SER   *                                                                         
S5599C*----------------------------------------------------------------         
S5599C*    Print Currency Verbage on invoice based on Customer Master           
S5599C*                                                                         
S6042C* S7312              MOVE *OFF      *IN59            US $                 
S6042C* S7312              MOVE *OFF      *IN57            Canadian $           
S6042C* S7312              MOVE *OFF      *IN77            Mexican Peso         
S5599C* S7312    HLDAN8    CHAINF0301                99                         
S5599C* S6042    *IN99     IFEQ *OFF                                            
S5599C* S6042    A5CRCD    IFEQ 'CAD'                                           
S5599C* S6042              MOVE *ON       *IN57                                 
S5599C* S6042              ELSE                                                 
S5599C* S6042              MOVE *OFF      *IN57                                 
S5599C* S6042              ENDIF                                                
S5599C* S6042              ELSE                                                 
S5599C* S6042              MOVE *OFF      *IN57                                 
S5599C* S6042              ENDIF                                                
S6042C* S7312    *IN99     IFEQ *OFF                                            
S6042C* S7312    A5CRCD    IFEQ 'USD'                                           
S6042C* S7312              MOVE *ON       *IN59            US $                 
S6042C* S7312              ELSE                                                 
S6042C* S7312    A5CRCD    IFEQ 'CAD'                                           
S6042C* S7312              MOVE *ON       *IN57            Canadian $           
S6042C* S7312              ELSE                                                 
S6042C* S7312    A5CRCD    IFEQ 'MXP'                                           
S6042C* S7312              MOVE *ON       *IN77            Mexican Peso         
S6042C* S7312              ELSE                                                 
S6042C* S7312              MOVE *ON       *IN59            US $ default         
S6042C* S7312              ENDIF                                                
S6042C* S7312              ENDIF                                                
S6042C* S7312              ENDIF                                                
S6042C* S7312              ELSE                                                 
S6042C* S7312              MOVE *ON       *IN59            US $ default         
S6042C* S7312              ENDIF                                                
S5599C*                                                                         
S3486CSR         HLDAN8    IFEQ 33224278                   Mattel Malay         
S3486CSR         HLDAN8    OREQ 34001248                   Mattel Banko         
S3486CSR                   MOVE *ON       *IN55                                 
S3486CSR                   ELSE                                                 
S3486CSR                   MOVE *OFF      *IN55                                 
S3486CSR                   ENDIF                                                
S7312 *                                                                         
S7312CSR         SVVERS    IFEQ USUSDR                                          
S7312CSR         SVVERS    OREQ USCADR                                          
S7312CSR         SVVERS    OREQ USMXPR                                          
S7312CSR         SVVERS    OREQ CNUSDR                                          
S7312CSR         SVVERS    OREQ CNCADR                                          
S7312CSR         SVVERS    OREQ CNMXPR                                          
S7312CSR         SVVERS    OREQ MXUSDR                                          
S7312CSR         SVVERS    OREQ MXCADR                                          
S7312CSR         SVVERS    OREQ MXMXPR                                          
27250CSR         SVVERS    OREQ USAUDR                                          
S7312CSR                   MOVE *ON       *IN75            "Reprint"            
S7312CSR                   ELSE                                                 
S7312CSR                   MOVE *OFF      *IN75                                 
S7312CSR                   ENDIF                                                
      *----------------------------------------------------------------         
      * print tracking numbers                                                  
27295C                     MOVE *ON       *IN68            tracking number      
27295C                     MOVE *OFF      *IN69                                 
S652 C           KEY01     SETLLF56255                                          
S6527C           KEY01     READEF56255                   67                     
      *                                                                         
S6527C           *IN67     DOWEQ*OFF                                            
27295 * save header fields                                                      
27295C                     MOVE HFDOC     CFDOC   8        invoice no           
27295C                     MOVE HFDCT     CFDCT   2        doc type             
27295C                     MOVE HFDOCO    CFDOCO  8        order no             
27295C                     MOVE HFAN8     CFAN8   8        billto               
27295C                     MOVE HFSHAN    CFSHAN  8        ship to              
27295C                     MOVE HFDATE    CFDATE  8        ship date            
27295C                     MOVE HFADDJ    CFADDJ  6        actual ship          
27295C                     MOVE HFMCU     CFMCU   3        ship whse            
27295 *                                                                         
S6527C           EODUPJ    IFEQ HFADDJ                                          
S6527C           HFMCU     ANDEQ'310'                                           
27295 * print heading if necessary                                              
27295C           @@OFLN    SUB  @@CLNO    $$DIFF  30                            
27295C           *INOF     IFEQ '1'                                             
27295C           $$DIFF    ORLE $TOTL                                           
27295C                     Z-ADD$#PG      $$PGSV  40                            
27295C                     ADD  1         $#PG                                  
27295 * save and put back some header fields                                    
27295C                     MOVE SDDOC     RFDOC   8        invoice              
27295C                     MOVE SDDCT     RFDCT   2        doc type             
27295C                     MOVE RRDOCO    RFDOCO  8        order no             
27295C                     MOVE SHAN8     RFAN8   8        bill to              
27295C                     MOVE SHSHAN    RFSHAN  8        ship to              
27295 *                                                                         
27295C                     MOVE CFDOC     SDDOC            invoice              
27295C                     MOVE CFDCT     SDDCT            doc type             
27295C                     MOVE CFDOCO    RRDOCO           order no             
27295C                     MOVE CFAN8     SHAN8            bill to              
27295C                     MOVE CFSHAN    SHSHAN           ship to              
27295C                     EXSR S010H                                           
27295 *                    ---- -----                                           
27295C                     Z-ADD$#PG      ##PGSV                                
27295C                     Z-ADD$$PGSV    $#PG                                  
27295C                     MOVE *ON       *IN68            tracking number      
27295C                     MOVE *OFF      *IN69            space before         
27295 * put back header fields                                                  
27295C                     MOVE RFDOC     SDDOC            invoice              
27295C                     MOVE RFDCT     SDDCT            doc type             
27295C                     MOVE RFDOCO    RRDOCO           order no             
27295C                     MOVE RFAN8     SHAN8            bill to              
27295C                     MOVE RFSHAN    SHSHAN           ship to              
27295 * restore tracking no key index                                           
27295C                     MOVE CFDATE    HFDATE                                
27295C                     MOVE CFADDJ    HFADDJ                                
27295C                     MOVE CFMCU     HFMCU                                 
27295C                     ENDIF                                                
27295 * blank line before first time                                            
27295C  N69                WRITEDETAIL3B               OF                       
27295 *                                                                         
27295C                     MOVELEODTRK    RRTRC1                                
27295C                     MOVELEODCAR    RRCAR1                                
27295C                     WRITEDETAIL11               OF                       
27295C                     ELSE                                                 
27295C                     GOTO NONE2                                           
27295C                     ENDIF                                                
27295C                     MOVE *OFF      *IN68                                 
27295C                     MOVE *ON       *IN69                                 
S6527C           KEY01     READEF56255                   67                     
S6527C                     ENDDO                                                
27295 * blank line after                                                        
27295C                     WRITEDETAIL3B               OF                       
S6527C           NONE2     TAG                                                  
      *---------------------------------------------------------------          
S7312 *                                                                         
S7312 *  Convert numeric amount into Spanish words for Mexico                   
S7312C           *IN76     IFEQ *ON                        Mexico               
S7312 *                                                                         
S7312C           $INTOT    IFLT 0                                               
S7312C                     MULT -1        $INTOT                                
S7312C                     ENDIF                                                
S7312 *                                                                         
S7312C                     CALL AMTWRD                 81                       
S7312 *                    ---- ------                                          
S7312CSR                   PARM           $INTOT                                
S7312CSR                   PARM           @L                                    
S7312 *                                                                         
S7312 *    If dollar amount in words is too large to fit on line                
S7312 *    of translation program does not exist or is in error,                
S7312 *    put in numeric check amount                                          
S7312 *                                                                         
S7312CSR         @L,84     IFNE '*'                                             
S7312CSR         *IN81     OREQ '1'                                             
S7312CSR                   MOVE '*'       @L                                    
S7312CSR                   MOVEA'    '    @L,1                                  
S7312CSR                   MOVEA'$'       @L,5                                  
S7312CSR                   MOVEARRMATO    @L,6                                  
S7312CSR                   ENDIF                                                
S7312 *                                                                         
S7312 *    If dollar amount in words is too large to fit on line                
S7312 *    put in numeric check amount                                          
S7312 *                                                                         
S7312CSR         $INTOT    IFGT 999999999                                       
S7312CSR                   MOVE '*'       @L                                    
S7312CSR                   MOVEA'    '    @L,1                                  
S7312CSR                   MOVEA'$'       @L,5                                  
S7312CSR                   MOVEARRMATO    @L,6                                  
S7312CSR                   ENDIF                                                
S7312 *                                                                         
S7312CSR                   MOVEA@L        RRWRDS                                
27836 * add USD to amount in words for Factura                                  
27836C           '*'       CHEKRRRWRDS    POS     30     35                     
27836C           *IN35     IFEQ *ON                                             
27836C                     ADD  1         POS                                   
27836C                     MOVEA'USD'     @L,POS                                
27836C                     MOVEA@L        RRWRDS                                
27836C                     ENDIF                                                
S7312C                     ELSE                                                 
S7312CSR                   MOVE *BLANKS   RRWRDS                                
S7312C                     ENDIF                                                
S7312 *                                                                         
S5651CSR                   WRITETOTAL5                 OF                       
S5651CSR                   WRITETOTAL6                 OF                       
S5651CSR                   SETOF                     44                         
26294 *                    WRITETRMPG2                 OF                       
  |  C* S6042    *IN57     IFEQ *OFF                                            
  |  C* S6042              MOVELUS        RMT                                   
  |  C* S6042              ELSE                                                 
  |  C* S6042              MOVELCAN1      RMT                                   
  |  C* S6042              ENDIF                                                
S6042C* S7312    *IN59     IFEQ *ON                                             
S6042C* S7312              MOVELUS$       RMT              US $                 
S6042C* S7312              ELSE                                                 
S6042C* S7312    *IN57     IFEQ *ON                                             
S6042C* S7312              MOVELCAN$      RMT              Canadian $           
S6042C* S7312              ELSE                                                 
S6042C* S7312    *IN77     IFEQ *ON                                             
S6042C* S7312              MOVELMEX$      RMT              Mexican Peso         
S6042C* S7312              ELSE                                                 
S6042C* S7312              MOVELUS$       RMT              US $ default         
S6042C* S7312              ENDIF                                                
S6042C* S7312              ENDIF                                                
S6042C* S7312              ENDIF                                                
     CSR                   ENDIF                                                
      *                                                                         
      *    Write Additional EDI Header Record                                   
      *                                                                         
     CSR         $@EDI     IFEQ '1'                                             
     CSR         $@EDI     OREQ '2'                                             
     CSR                   EXSR WRTHD2                                          
      *                    -----------                                          
     CSR                   ENDIF                                                
      *                                                                         
      *    Print draft                                                          
      *                                                                         
     CSR                   EXSR S010D                                           
      *                    ---- -----                                           
      *                                                                         
     CSR                   MOVE *ZEROS    $$RCD  150                            
     CSR                   MOVE *ZEROS    $#ATO                                 
     CSR                   MOVE *ZEROS    $#ATT                                 
     CSR                   MOVE *ZEROS    $FTOTL                                
     CSR                   MOVE *ZEROS    $SVTAX                                
     CSR                   MOVE *ZEROS    $SVITM                                
     CSR                   MOVE *ZEROS    $$TTAX                                
     CSR                   MOVE *BLANKS   $MLTTX  1                             
     CSR                   MOVE *BLANKS   $$TOT   1                             
     CSR                   MOVE *BLANKS   $SVTX                                 
     CSR                   MOVE *BLANKS   $SVTXA                                
     CSR                   Z-ADD*ZEROS    $STTAX                                
     CSR                   MOVE *ZEROS    $$CEXP                                
     CSR                   MOVE *ZEROS    $FCEXP                                
     CSR                   MOVE *ZEROS    $OCDIS                                
     CSR                   MOVE *ZEROS    $FODIS                                
     CSR                   MOVE *ZEROS    $$DAMT                                
     CSR                   MOVE *ZEROS    $FDAMT                                
     CSR                   MOVE '1'       *IN02                                 
     CSR                   MOVE ' '       $PFLAG  1                             
     CSR                   MOVE ' '       $HFLAG  1                             
     CSR                   MOVE ' '       $ATHR                                 
     CSR                   MOVE ' '       $RND                                  
      *                                                                         
      *    Process break routine - Read Order Header File                       
      *                                                                         
B3   CSR         *INLR     IFEQ '0'                                             
      *                                                                         
      *    Move saved fields back to data fields                                
      *                                                                         
DBN  CSR                   MOVELPR4211    DS4211                                
      *                                                                         
      *    Move to output - A/R Invoice Number                                  
      *                                                                         
      *    If payment terms break - use the same document number.               
      *                                                                         
B4   CSR         $PTC      IFEQ '1'                                             
     CSR                   MOVE SVDOC     SDDOC                                 
     CSR                   MOVE SVDCT     SDDCT                                 
     CSR                   MOVELSVKCO     SDKCO                                 
E4   CSR                   ENDIF                                                
      *                                                                         
      *    Do not retrieve new number if one already exists.                    
      *                                                                         
     CSR                   MOVE SDDOC     SVDOC                                 
     CSR                   MOVE SDDCT     SVDCT                                 
     CSR                   MOVELSDKCO     SVKCO                                 
B4   CSR         SDDOC     IFEQ *ZEROS                                          
     CSR         $PTC      ANDEQ' '                                             
     CSR         $@PRF     ANDEQ' '                                             
      *                                                                         
     CSR                   MOVELSHKCOO    SVKCO                                 
     CSR                   MOVELSHKCOO    SDKCO                                 
      *                                                                         
      *    Edit julian date - Date - Order/Transaction                          
      *                                                                         
     CSR                   MOVE SHTRDJ    #SIDAT  6                             
     CSR                   MOVE *BLANK    #EDAT   8                             
     CSR                   MOVEL'*JUL    '#FFMT   7                             
     CSR                   MOVEL'*MDY    '#TFMT   7                             
     CSR                   MOVEL'*NONE   '#SEP    7                             
     CSR                   MOVEL' '       $ERTST  1                             
     CSR                   CALL 'X0028   '             99                       
      *                    ---- ----------                                      
     CSR                   PARM           #SIDAT                                
     CSR                   PARM           #EDAT                                 
     CSR                   PARM           #FFMT                                 
     CSR                   PARM           #TFMT                                 
     CSR                   PARM           #SEP                                  
     CSR                   PARM           $ERTST                                
     CSR                   MOVEL#SIDAT    $NBR6   6                             
      *                                                                         
     CSR                   SETOF                     9899                       
      *                                                                         
      *    Edit julian date - Date - INVOICE DATE                               
      *                                                                         
     CSR                   MOVE $UDATE    #SIDAT  6                             
     CSR                   MOVE *BLANK    #EDAT   8                             
     CSR                   MOVEL'*JUL    '#FFMT   7                             
     CSR                   MOVEL'*MDY    '#TFMT   7                             
     CSR                   MOVEL'*NONE   '#SEP    7                             
     CSR                   MOVEL' '       $ERTST  1                             
     CSR                   CALL 'X0028   '             99                       
      *                    ---- ----------                                      
     CSR                   PARM           #SIDAT                                
     CSR                   PARM           #EDAT                                 
     CSR                   PARM           #FFMT                                 
     CSR                   PARM           #TFMT                                 
     CSR                   PARM           #SEP                                  
     CSR                   PARM           $ERTST                                
     CSR                   MOVEL#SIDAT    $INVDT  6                             
      *                                                                         
      *    Calculate Fiscal Year based on the invoice date.                     
      *                                                                         
     CSR                   MOVE '1'       #CALC                                 
     CSR                   MOVE SHKCOO    #CO                                   
     CSR                   MOVE $INVDT    #DG                                   
     CSR                   CALL 'X09031'                                        
      *                    ---- --------                                        
     CSR                   PARM           #CALC   1                             
     CSR                   PARM           #CO     5                             
     CSR                   PARM           #DG     60                            
     CSR                   PARM           #PN     20                            
     CSR                   PARM           #FY     20                            
     CSR                   PARM           #CTRY   20                            
     CSR                   PARM           #EDT    1                             
     CSR                   PARM ' '       #DGSY   1                             
     CSR                   PARM ' '       #JFLG   1                             
      *                                                                         
B5   CSR         *IN98     DOWEQ'0'                                             
      *                                                                         
      *    Automatic Next Number for - Document Number                          
      *       Next Numbers Table  :  03                                         
      *       Index to Table      :  $ARIN                                      
      *                                                                         
     CSR                   MOVE CCCRCD    $$CRCD                                
     CSR                   MOVE $ARIN     $$ARIN                                
     CSR                   CALL 'X0010'                82                       
      *                    ---- -------                                         
     CSR                   PARM '03'      PSSY                                  
     CSR                   PARM $$ARIN    PSIDX                                 
     CSR                   PARM *ZERO     #NXTNO                                
     CSR                   PARM $@DCT     PSDCTO                                
     CSR                   PARM *BLANKS   PSINQ                                 
     CSR                   PARM SDKCO     PSKCOO                                
     CSR                   PARM #CTRY     PSCTRY                                
     CSR                   PARM #FY       PSFY                                  
      *                                                                         
     CSR         SDDOC     IFNE *ZEROS                                          
     CSR                   MOVE SDDOC     $PDOC                                 
     CSR                   MOVE SDDCT     $PDCT                                 
     CSR                   MOVE SDKCO     $PKCO                                 
     CSR                   ELSE                                                 
     CSR                   MOVE #NXTNO    $PDOC                                 
     CSR                   MOVE $@DCT     $PDCT                                 
     CSR                   MOVE SDKCO     $PKCO                                 
     CSR                   ENDIF                                                
      *                                                                         
     CSR                   MOVE $@DCT     SVDCT                                 
     CSR                   MOVE $@DCT     SDDCT                                 
     CSR                   MOVE #NXTNO    SVDOC                                 
     CSR                   MOVE #NXTNO    SDDOC                                 
      *                                                                         
      *   Access F0311 through server call                                      
     C****       RPKY01    CHAINI0311D               9899                       
     CSR                   MOVELSDDOC     RPDOC                                 
     CSR                   MOVEL$@DCT     RPDCT                                 
     CSR                   MOVELSDKCO     RPKCO                                 
      *                                                                         
     CSR                   MOVE 'K'       @@ACCS                                
     CSR                   MOVEL'CHAIN'   @@OPER                                
     CSR                   MOVEL'N'       @@LOCK                                
     CSR                   MOVEL'RPKY04'  @@KLST                                
     CSR                   Z-ADD3         @@KNUM                                
     CSR                   CALL 'XF0311'                                        
      *                    ---- --------                                        
     CSR                   PARM           PS@@1                                 
     CSR                   PARM           AR01                                  
      *                                                                         
      *    Set indicators based on I/O file server return value.                
      *                                                                         
B3   CSR         @@IOR     IFEQ 'NF '                                           
     CSR                   SETON                     98                         
E3   CSR                   ENDIF                                                
      *                                                                         
B3   CSR         @@ERR     IFNE *BLANKS                                         
B3   CSR         @@IOR     OREQ 'RL '                                           
     CSR                   SETON                     99                         
E3   CSR                   ENDIF                                                
      *                                                                         
E5   CSR                   ENDDO                                                
E4   CSR                   ENDIF                                                
      *                                                                         
B4   CSR         SDDOC     IFNE *ZERO                                           
     CSR         $@PRF     ANDEQ' '                                             
      *                                                                         
     CSR                   MOVELSDDCT     RRDCT                                 
      *                                                                         
     CSR                   MOVE *BLANK    #SINBR                                
     CSR                   MOVELSDDOC     #SINBR                                
     CSR                   MOVE T@DOC     #DTYP                                 
     CSR                   MOVE W@DOC     #EWRD                                 
     CSR                   MOVE E@DOC     #EC                                   
     CSR                   MOVE F@DOC     #DSPD                                 
     CSR                   MOVE G@DOC     #DATD                                 
     CSR                   MOVE J@DOC     #ALR                                  
     CSR                   MOVE ' '       #ECOR                                 
     CSR                   MOVE ' '       #DCOR                                 
     CSR                   EXSR C00161                                          
      *                    ---- ------                                          
B5   CSR         #ALR      IFEQ 'L'                                             
     CSR                   MOVEL#SINBR    RR#DOC                                
X5   CSR                   ELSE                                                 
     CSR                   MOVE #SINBR    RR#DOC                                
E5   CSR                   ENDIF                                                
E4   CSR                   ENDIF                                                
      *                                                                         
     CSR                   EXSR S010B                                           
      *                    ---- -----                                           
      *                                                                         
      *    Update files                                                         
      *                                                                         
     CSR                   EXSR S010U                                           
      *                    ---- -----                                           
E3   CSR                   ENDIF                                                
E2   CSR                   ENDIF                                                
      *                                                                         
      *    Bypass printing the next record if the order is on hold,             
      *    or if no header record exists.                                       
      *                                                                         
     CSR         $#HDR     CABEQ'N'       END10A                                
      *                    -----          ------                                
     CSR         SHHOLD    CABNE*BLANKS   END10A                                
      *                    -----          ------                                
      *----------------------------------------------------------------         
      *                                                                         
     CSR         *INLR     CABEQ'1'       END10A                                
      *                    -----          ------                                
      *                                                                         
      *    If page skip, set over flow indicator.                               
      *                                                                         
B2   CSR         $$PAGE    IFEQ '1'                                             
     CSR         *INLR     ANDEQ'0'                                             
     CSR         $$TOT     ANDEQ' '                                             
     CSR                   MOVE '1'       *INOF                                 
     CSR                   MOVE ' '       $$PAGE                                
     CSR                   MOVE '1'       *IN02                                 
     CSR                   MOVE ' '       $PFLAG  1                             
     CSR                   MOVE ' '       $HFLAG  1                             
     CSR                   MOVE ' '       $ATHR                                 
E2   CSR                   ENDIF                                                
      *                                                                         
      *    Print report detail.                                                 
      *                                                                         
     CSR         @@OFLN    SUB  @@CLNO    $$DIFF  30                            
B2   CSR         *INOF     IFEQ '1'                                             
     CSR         $$DIFF    ORLE $TOTL                                           
     CSR                   EXSR S010H                                           
      *                    ---- -----                                           
E2   CSR                   ENDIF                                                
      *----------------------------------------------------------------         
      *                                                                         
      *    Clear work fields                                                    
      *                                                                         
     CSR                   MOVEA@L@       @T@                                   
     CSR                   MOVEA@V@       @TV                                   
     CSR                   MOVE *ZERO     $$PGLV  10                            
      *                                                                         
      *    Move saved fields back to data fields                                
      *                                                                         
DBN  CSR                   MOVELPR4211    DS4211                                
      *                                                                         
      *    Initialize accumulative fields                                       
      *                                                                         
     CSR                   MOVE *ZEROS    $SOQS                                 
     CSR                   MOVE *ZEROS    $SOBK                                 
     CSR                   MOVE *ZEROS    $SOCN                                 
     CSR                   MOVE *ZEROS    $AEXP                                 
     CSR                   MOVE *ZEROS    $FEA                                  
     CSR                   MOVE *ZEROS    $ECST                                 
     CSR                   MOVE *ZEROS    $FEC                                  
     CSR                   MOVE *ZEROS    $PQOR                                 
     CSR                   MOVE *ZEROS    $UORG                                 
     CSR                   MOVE *ZEROS    $$RCD                                 
     CSR                   MOVE ' '       $$FITM                                
     CSR                   MOVE ' '       $$LNID                                
      *                                                                         
      *    Initialize accumulative fields with data fields                      
      *                                                                         
B2   CSR         $@SUMZ    IFEQ '1'                                             
DBN  CSR                   MOVELDS4211    SV4211                                
     CSR                   MOVELSHINMG    SVINMG                                
     CSR                   MOVELSHDOCO    $PDOCO                                
     CSR                   MOVELSHDCTO    $PDCTO                                
     CSR                   MOVELSHKCOO    $PKCOO                                
     CSR                   Z-ADDSDSOQS    $SOQS                                 
     CSR                   Z-ADDSDSOBK    $SOBK                                 
     CSR                   Z-ADDSDSOCN    $SOCN                                 
     CSR                   Z-ADDSDAEXP    $AEXP                                 
     CSR                   Z-ADDSDFEA     $FEA                                  
     CSR                   Z-ADDSDECST    $ECST                                 
     CSR                   Z-ADDSDFEC     $FEC                                  
     CSR                   Z-ADDSDPQOR    $PQOR                                 
     CSR                   Z-ADDSDUORG    $UORG                                 
     CSR                   Z-ADD1         $$RCD                                 
E2   CSR                   ENDIF                                                
     CSR                   Z-ADDSDDOCO    $#DOCO                                
     CSR                   MOVE SDDCTO    $#DCTO                                
     CSR                   MOVELSDKCOO    $#KCOO                                
S5599C                     MOVE SDMCU     $#MCU                                 
     CSR                   Z-ADDSDAN8     $#AN8                                 
     CSR                   MOVELSDCRCD    $#CRCD                                
     CSR                   MOVELSDCRR     $#CRR                                 
     CSR                   MOVE SDPTC     $#PTC                                 
      *                                                                         
      *    Read Line Type Constants                                             
      *                                                                         
     C                     MOVE ' '       LFTXYN                                
     C                     MOVE *BLANKS   PS@@                                  
     C                     MOVELSDLNTY    KY@@                                  
     C                     CALL 'XS40205'                                       
      *                    ---- ---------                                       
     C                     PARM           PS@@                                  
     C                     PARM           DS4020                                
      *                                                                         
      *    Move new item, price, and line number to saved fields                
      *                                                                         
B2   CSR         LFTXYN    IFEQ 'Y'                                             
     CSR                   MOVE *HIVAL    $SLITM                                
X2   CSR                   ELSE                                                 
     CSR                   MOVE SDLITM    $SLITM                                
E2   CSR                   ENDIF                                                
     CSR                   MOVE SDUPRC    $SUPRC                                
     CSR                   MOVE SDUOM     $SUOM                                 
     CSR                   MOVE $LNID     $SLNID                                
     CSR                   MOVE SDLNTY    $SLNTY                                
      *                                                                         
     CSR                   EXSR S0042                                           
      *                    ---- -----                                           
     CSR         $@IC      IFEQ ' '                                             
     CSR                   EXSR S010C                                           
      *                    ---- -----                                           
     CSR                   ENDIF                                                
      *                                                                         
E1   CSR                   ENDIF                                                
B1   CSR         $@SUMZ    IFEQ '2'                                             
B2   CSR         $$REM     IFEQ 0                                               
     CSR         $$RCD     OREQ 0                                               
DBN  CSR                   MOVELDS4211    SV4211                                
     CSR                   MOVELSHINMG    SVINMG                                
     CSR                   Z-ADDSDSOQS    $SOQS                                 
     CSR                   Z-ADDSDSOBK    $SOBK                                 
     CSR                   Z-ADDSDSOCN    $SOCN                                 
     CSR                   Z-ADDSDAEXP    $AEXP                                 
     CSR                   Z-ADDSDFEA     $FEA                                  
     CSR                   Z-ADDSDECST    $ECST                                 
     CSR                   Z-ADDSDFEC     $FEC                                  
     CSR                   Z-ADDSDPQOR    $PQOR                                 
     CSR                   Z-ADDSDUORG    $UORG                                 
     CSR                   Z-ADD1         $$RCD                                 
E2   CSR                   ENDIF                                                
E1   CSR                   ENDIF                                                
      *----------------------------------------------------------------         
      *                                                                         
      *  Write to Serial # index if summarizing                                 
      *                                                                         
     CSR         $@SUMZ    IFNE *BLANKS                                         
     CSR         $@SRL     ANDEQ'1'                                             
      *                                                                         
     CSR                   Z-ADDSDDOCO    $2DOCO                                
     CSR                   MOVELSDDCTO    $2DCTO                                
     CSR                   MOVELSDKCOO    $2KCOO                                
     CSR                   Z-ADDSDLNID    $2LNID                                
     CSR                   MOVELSDSFXO    $2SFXO                                
     CSR                   MOVELSDLOTN    $2LOTN                                
      *                                                                         
     CSR                   Z-ADD$2KYLN    $IKYLN  30                            
     CSR                   Z-ADD$2RCLN    $IRCLN  30                            
      *                                                                         
     CSR                   CALL 'X00IDX'                                        
      *                    ---- --------                                        
     CSR                   PARM           DSIDX2                                
     CSR                   PARM 'A'       PACTN   1                             
     CSR                   PARM           PRULE   2                             
     CSR                   PARM           $IKYLN                                
     CSR                   PARM           PKEY  120                             
     CSR                   PARM           $IRCLN                                
     CSR                   PARM           DS$2                                  
     CSR                   PARM           PSTAT   1                             
      *                                                                         
     CSR                   ENDIF                                                
      *----------------------------------------------------------------         
     CSR         END10A    ENDSR                                                
      *****************************************************************         
     C*                                                                         
     C*    SUBROUTINE S010B - Process Report Level Breaks                       
     C*    ----------------------------------------------                       
     C*                                                                         
     C*    Processing:  1.  Read heading files.                                 
     C*                 2.  Move heading fields to report.                      
     C*                                                                         
     CSR         S010B     BEGSR                                                
     C*          -----     -----                                                
     C*                                                                         
     C*    Check for page skip requested                                        
     C*                                                                         
B1   CSR         $$PAGE    IFEQ '1'                                             
     C*----------------------------------------------------------------         
     C*                                                                         
     C*    Move to output - A/R Invoice Number                                  
     C*                                                                         
27942C                     MOVE *BLANKS   $PFLG2                                
     CSR                   MOVEL*BLANKS   RR#DOC                                
     CSR                   MOVEL*BLANKS   RRDCT                                 
B2   CSR         SDDOC     IFNE *ZERO                                           
     CSR         $@PRF     ANDEQ' '                                             
     C*                                                                         
     CSR                   MOVELSDDCT     RRDCT                                 
     C*                                                                         
     CSR                   MOVE *BLANK    #SINBR                                
     CSR                   MOVELSDDOC     #SINBR                                
     CSR                   MOVE T@DOC     #DTYP                                 
     CSR                   MOVE W@DOC     #EWRD                                 
     CSR                   MOVE E@DOC     #EC                                   
     CSR                   MOVE F@DOC     #DSPD                                 
     CSR                   MOVE G@DOC     #DATD                                 
     CSR                   MOVE J@DOC     #ALR                                  
     CSR                   MOVE ' '       #ECOR                                 
     CSR                   MOVE ' '       #DCOR                                 
     CSR                   EXSR C00161                                          
     C*                    ---- ------                                          
B3   CSR         #ALR      IFEQ 'L'                                             
     CSR                   MOVEL#SINBR    RR#DOC                                
X3   CSR                   ELSE                                                 
     CSR                   MOVE #SINBR    RR#DOC                                
E3   CSR                   ENDIF                                                
E2   CSR                   ENDIF                                                
     C*----------------------------------------------------------------         
     C*                                                                         
     C*    Retrieve Sales Order Header                                          
     C*                                                                         
     CSR                   MOVE SDDOCO    SHDOCO                                
     CSR                   MOVE SDDCTO    SHDCTO                                
     CSR                   MOVE SDKCOO    SHKCOO                                
     C*                                                                         
     C*    Read F4201 for heading information first. If no records are          
     C*    found, read the History file for the heading information.            
     C*                                                                         
DBN61C                     MOVELD42019    SV4201                                
     C*                                                                         
     CSR         SHKY0A    CHAINI4201A               9898                       
     CSR         $@IC      IFEQ '1'                                             
     CSR                   Z-ADDUDIAN8    SHAN8                                 
     CSR                   ENDIF                                                
     C*                                                                         
     C*    Retrieve Sales History Header from F42019 if the Based-              
     C*    On file is the History file (F42119). ('$$HIST'='Y')                 
     C*                                                                         
B2   CSR         *IN98     IFEQ '1'                                             
     CSR         $$HIST    ANDEQ'Y'                                             
     CSR                   SETOF                       98                       
     CSR                   MOVEL'A61     '@@FMT                                 
     CSR                   MOVE 'K'       @@ACCS                                
     CSR                   MOVEL'CHAIN   '@@OPER                                
     CSR                   MOVE 'N'       @@LOCK                                
     CSR                   MOVE 'N'       @@CHGR                                
     CSR                   MOVEL'SHK1A2  '@@KLST                                
     CSR                   Z-ADD2         @@KNUM                                
     CSR                   CALL 'XF42019 '                                      
     C*                    ---- ----------                                      
     CSR                   PARM           PS@@1                                 
     CSR                   PARM           D42019                                
     C*                                                                         
     C*    Set indicators based on I/O file server return value.                
     C*                                                                         
B3   CSR         @@IOR     IFEQ 'NF '                                           
     CSR                   SETON                     98                         
E3   CSR                   ENDIF                                                
     C*                                                                         
B3   CSR         @@IOR     IFEQ 'RL '                                           
     CSR                   SETON                     99                         
E3   CSR                   ENDIF                                                
     C*                                                                         
B3   CSR         @@ERR     IFNE *BLANKS                                         
     CSR                   SETON                     98                         
E3   CSR                   ENDIF                                                
     C*                                                                         
E2   CSR                   ENDIF                                                
     C*                                                                         
     C*    Set Header flag if no record found                                   
     C*                                                                         
     CSR                   MOVE ' '       $#HDR   1                             
B2   CSR         *IN98     IFEQ '1'                                             
     CSR                   MOVE 'N'       $#HDR                                 
     CSR                   GOTO END10B                                          
     C*                    ---- ------                                          
E2   CSR                   ENDIF                                                
     C*                                                                         
     C*    Bypass remaining logic if order is on hold                           
     C*                                                                         
B2   CSR         SHHOLD    IFNE *BLANK                                          
     CSR                   GOTO END10B                                          
     C*                    ---- ------                                          
E2   CSR                   ENDIF                                                
     C*----------------------------------------------------------------         
     CSR                   Z-ADDSHTRDJ    $$TRDJ                                
     C*----------------------------------------------------------------         
     C*                                                                         
     C*    Move to output - Document (Order #, Invoice, etc.)                   
     C*                                                                         
     CSR                   MOVE *BLANK    #SINBR                                
     CSR                   MOVELSHDOCO    #SINBR                                
     CSR                   MOVE T@DOCO    #DTYP                                 
     CSR                   MOVE W@DOCO    #EWRD                                 
     CSR                   MOVE E@DOCO    #EC                                   
     CSR                   MOVE F@DOCO    #DSPD                                 
     CSR                   MOVE G@DOCO    #DATD                                 
     CSR                   MOVE J@DOCO    #ALR                                  
     CSR                   MOVE ' '       #ECOR                                 
     CSR                   MOVE ' '       #DCOR                                 
     CSR                   EXSR C00161                                          
     C*                    ---- ------                                          
B2   CSR         #ALR      IFEQ 'L'                                             
DBN  CSR                   MOVEL#SINBR    RRDOC#                                
X2   CSR                   ELSE                                                 
DBN  CSR                   MOVE #SINBR    RRDOC#                                
E2   CSR                   ENDIF                                                
     C*----------------------------------------------------------------         
     C*                                                                         
     C*    Move to output - Order Type                                          
     C*                                                                         
     CSR                   MOVELSHDCTO    RRDCT#                                
     C*----------------------------------------------------------------         
     C*                                                                         
     C*    If Sold to has changed recheck language preference.                  
     C*                                                                         
     CSR         $@IC      IFEQ '1'                                             
     CSR                   MOVE UDIAN8    SHAN8                                 
     CSR                   ENDIF                                                
     C*                                                                         
B2   CSR         SHAN8     IFNE $SAN8                                           
     CSR                   MOVE SHAN8     $SAN8   80                            
     CSR                   MOVE SHAN8     $SVAN8  80                            
B3   CSR         SHAN8     IFNE ABAN8                                           
     C*                                                                         
     CSR                   Z-ADDSHAN8     ABAN8                                 
     CSR                   MOVEL'A71     '@@FMT                                 
     CSR                   MOVE 'K'       @@ACCS                                
     CSR                   MOVEL'CHAIN   '@@OPER                                
     CSR                   MOVE 'N'       @@LOCK                                
     CSR                   MOVE 'N'       @@CHGR                                
     CSR                   MOVEL'ABKY01  '@@KLST                                
     CSR                   Z-ADD1         @@KNUM                                
     CSR                   CALL 'XF0101'               81                       
     C*                    ---- --------                                        
     CSR                   PARM           PS@@1                                 
     CSR                   PARM           I0101                                 
E3   CSR                   ENDIF                                                
     C*                                                                         
B3   CSR         *IN81     IFEQ '0'                                             
     CSR         @@IOR     ANDEQ*BLANK                                          
     C*                                                                         
     C*    Load VTX fields for language preference.                             
     C*                                                                         
B4   CSR         ABLNGP    CASNE$$LNGP    S010B1                                
     C*                    -----          ------                                
E4   CSR                   ENDCS                                                
E3   CSR                   ENDIF                                                
E2   CSR                   ENDIF                                                
     C*----------------------------------------------------------------         
     C*                                                                         
     C*    If an invoice date was already assigned -                            
     C*       load the printed invoice date,                                    
     C*       load the net due date,                                            
     C*     & load the julian invoice date.                                     
     C*                                                                         
B2   CSR         SDIVD     IFNE *ZEROS                                          
     CSR                   MOVELSDIVD     #SIDAT  6                             
     CSR                   MOVE *BLANK    #EDAT   8                             
     CSR                   MOVEL'*JUL    '#FFMT   7                             
     CSR                   MOVEL'*SYSVAL '#TFMT   7                             
     CSR                   MOVEL'*SYSVAL '#SEP    7                             
     CSR                   MOVEL' '       $ERTST  1                             
     CSR                   CALL 'X0028   '             81                       
     C*                    ---- ---------                                       
     CSR                   PARM           #SIDAT                                
     CSR                   PARM           #EDAT                                 
     CSR                   PARM           #FFMT                                 
     CSR                   PARM           #TFMT                                 
     CSR                   PARM           #SEP                                  
     CSR                   PARM           $ERTST                                
     CSR                   MOVEL#EDAT     RRDI                                  
13399 *                                                                         
13399CSR                   MOVELSDIVD     #SIDAT  6                             
13399CSR                   MOVE *BLANK    #EDAT   8                             
13399CSR                   MOVEL'*JUL    '#FFMT   7                             
13399CSR                   MOVEL'*DMY    '#TFMT   7                             
13399CSR                   MOVEL'*SYSVAL '#SEP    7                             
13399CSR                   MOVEL' '       $ERTST  1                             
13399CSR                   CALL 'X0028   '             81                       
13399C*                    ---- ---------                                       
13399CSR                   PARM           #SIDAT                                
13399CSR                   PARM           #EDAT                                 
13399CSR                   PARM           #FFMT                                 
13399CSR                   PARM           #TFMT                                 
13399CSR                   PARM           #SEP                                  
13399CSR                   PARM           $ERTST                                
13399CSR                   MOVEL#EDAT     RRDIM   8                             
     C*                                                                         
     C*    Net due date                                                         
     C*                                                                         
     CSR                   MOVE *BLANKS   $@NDD   6                             
     CSR                   MOVELSDIVD     $@NDD   6                             
     C*                                                                         
     C*    Julian invoice date                                                  
     C*                                                                         
     CSR                   MOVELSDIVD     #SIDAT  6                             
     CSR                   MOVE *BLANK    #EDAT   8                             
     CSR                   MOVEL'*JUL    '#FFMT   7                             
     CSR                   MOVEL'*JUL    '#TFMT   7                             
     CSR                   MOVEL'*NONE   '#SEP    7                             
     CSR                   MOVEL' '       $ERTST  1                             
     CSR                   CALL 'X0028   '             81                       
     C*                    ---- ---------                                       
     CSR                   PARM           #SIDAT                                
     CSR                   PARM           #EDAT                                 
     CSR                   PARM           #FFMT                                 
     CSR                   PARM           #TFMT                                 
     CSR                   PARM           #SEP                                  
     CSR                   PARM           $ERTST                                
     CSR                   MOVEL#SIDAT    $UDATE                                
     C*                                                                         
X2   CSR                   ELSE                                                 
     C*                                                                         
     C*    If a date was entered from the processing option -                   
     C*       load the printed invoice date,                                    
     C*       load the net due date,                                            
     C*     & load the julian invoice date.                                     
     C*                                                                         
     C*    Printed invoice date                                                 
     C*                                                                         
B3   CSR         $IVD      IFNE *ZEROS                                          
     CSR                   MOVEL$IVD      #SIDAT  6                             
     CSR                   MOVE *BLANK    #EDAT   8                             
     CSR                   MOVEL'*MDY    '#FFMT   7                             
     CSR                   MOVEL'*SYSVAL '#TFMT   7                             
     CSR                   MOVEL'*SYSVAL '#SEP    7                             
     CSR                   MOVEL' '       $ERTST  1                             
     CSR                   CALL 'X0028   '             81                       
     C*                    ---- ---------                                       
     CSR                   PARM           #SIDAT                                
     CSR                   PARM           #EDAT                                 
     CSR                   PARM           #FFMT                                 
     CSR                   PARM           #TFMT                                 
     CSR                   PARM           #SEP                                  
     CSR                   PARM           $ERTST                                
     CSR                   MOVEL#EDAT     RRDI                                  
13399 *                                                                         
13399CSR                   MOVEL$IVD      #SIDAT  6                             
13399CSR                   MOVE *BLANK    #EDAT   8                             
13399CSR                   MOVEL'*MDY    '#FFMT   7                             
13399CSR                   MOVEL'*DMY    '#TFMT   7                             
13399CSR                   MOVEL'*SYSVAL '#SEP    7                             
13399CSR                   MOVEL' '       $ERTST  1                             
13399CSR                   CALL 'X0028   '             81                       
13399C*                    ---- ---------                                       
13399CSR                   PARM           #SIDAT                                
13399CSR                   PARM           #EDAT                                 
13399CSR                   PARM           #FFMT                                 
13399CSR                   PARM           #TFMT                                 
13399CSR                   PARM           #SEP                                  
13399CSR                   PARM           $ERTST                                
13399CSR                   MOVEL#EDAT     RRDIM                                 
     C*                                                                         
     C*    Net due date                                                         
     C*                                                                         
     CSR                   MOVE *BLANKS   $@NDD   6                             
     CSR                   MOVEL$IVD      #SIDAT  6                             
     CSR                   MOVE *BLANK    #EDAT   8                             
     CSR                   MOVEL'*MDY    '#FFMT   7                             
     CSR                   MOVEL'*JUL    '#TFMT   7                             
     CSR                   MOVEL'*NONE   '#SEP    7                             
     CSR                   MOVEL' '       $ERTST  1                             
     CSR                   CALL 'X0028   '             81                       
     C*                    ---- ---------                                       
     CSR                   PARM           #SIDAT                                
     CSR                   PARM           #EDAT                                 
     CSR                   PARM           #FFMT                                 
     CSR                   PARM           #TFMT                                 
     CSR                   PARM           #SEP                                  
     CSR                   PARM           $ERTST                                
     CSR                   MOVEL#SIDAT    $@NDD                                 
     C*                                                                         
     C*    Julian invoice date                                                  
     C*                                                                         
     CSR                   MOVEL$IVD      #SIDAT  6                             
     CSR                   MOVE *BLANK    #EDAT   8                             
     CSR                   MOVEL'*MDY    '#FFMT   7                             
     CSR                   MOVEL'*JUL    '#TFMT   7                             
     CSR                   MOVEL'*NONE   '#SEP    7                             
     CSR                   MOVEL' '       $ERTST  1                             
     CSR                   CALL 'X0028   '             81                       
     C*                    ---- ---------                                       
     CSR                   PARM           #SIDAT                                
     CSR                   PARM           #EDAT                                 
     CSR                   PARM           #FFMT                                 
     CSR                   PARM           #TFMT                                 
     CSR                   PARM           #SEP                                  
     CSR                   PARM           $ERTST                                
     CSR                   MOVEL#SIDAT    $UDATE                                
     C*                                                                         
X3   CSR                   ELSE                                                 
     C*                                                                         
     C*    If no date was entered use the system date to -                      
     C*       load the printed invoice date,                                    
     C*       load the net due date,                                            
     C*     & load the julian invoice date.                                     
     C*                                                                         
     C*    Printed invoice date                                                 
     C*                                                                         
     CSR                   MOVE $$EDT     #SIDAT  6                             
     CSR                   MOVE *BLANK    #EDAT   8                             
     CSR                   MOVEL'*SYSVAL '#FFMT   7                             
     CSR                   MOVEL'*SYSVAL '#TFMT   7                             
     CSR                   MOVEL'*SYSVAL '#SEP    7                             
     CSR                   MOVEL' '       $ERTST  1                             
     CSR                   CALL 'X0028   '             81                       
     C*                    ---- ------                                          
     CSR                   PARM           #SIDAT                                
     CSR                   PARM           #EDAT                                 
     CSR                   PARM           #FFMT                                 
     CSR                   PARM           #TFMT                                 
     CSR                   PARM           #SEP                                  
     CSR                   PARM           $ERTST                                
     CSR                   MOVEL#EDAT     RRDI                                  
13399 *                                                                         
13399CSR                   MOVE $$EDT     #SIDAT  6                             
13399CSR                   MOVE *BLANK    #EDAT   8                             
13399CSR                   MOVEL'*SYSVAL '#FFMT   7                             
13399CSR                   MOVEL'*DMY    '#TFMT   7                             
13399CSR                   MOVEL'*SYSVAL '#SEP    7                             
13399CSR                   MOVEL' '       $ERTST  1                             
13399CSR                   CALL 'X0028   '             81                       
13399C*                    ---- ---------                                       
13399CSR                   PARM           #SIDAT                                
13399CSR                   PARM           #EDAT                                 
13399CSR                   PARM           #FFMT                                 
13399CSR                   PARM           #TFMT                                 
13399CSR                   PARM           #SEP                                  
13399CSR                   PARM           $ERTST                                
13399CSR                   MOVEL#EDAT     RRDIM                                 
     C*                                                                         
     C*    Net due date                                                         
     C*                                                                         
     CSR                   MOVE $$EDT     #SIDAT  6                             
     CSR                   MOVE *BLANK    #EDAT   8                             
     CSR                   MOVEL'*SYSVAL '#FFMT   7                             
     CSR                   MOVEL'*JUL    '#TFMT   7                             
     CSR                   MOVEL'*NONE   '#SEP    7                             
     CSR                   MOVEL' '       $ERTST  1                             
     CSR                   CALL 'X0028   '             81                       
     C*                    ---- ---------                                       
     CSR                   PARM           #SIDAT                                
     CSR                   PARM           #EDAT                                 
     CSR                   PARM           #FFMT                                 
     CSR                   PARM           #TFMT                                 
     CSR                   PARM           #SEP                                  
     CSR                   PARM           $ERTST                                
     CSR                   MOVEL#SIDAT    $@NDD   6                             
     C*                                                                         
     C*    Julian invoice date                                                  
     C*                                                                         
     CSR                   MOVEL$$EDT     #SIDAT  6                             
     CSR                   MOVE *BLANK    #EDAT   8                             
     CSR                   MOVEL'*SYSVAL '#FFMT   7                             
     CSR                   MOVEL'*JUL    '#TFMT   7                             
     CSR                   MOVEL'*NONE   '#SEP    7                             
     CSR                   MOVEL' '       $ERTST  1                             
     CSR                   CALL 'X0028   '             81                       
     C*                    ---- ---------                                       
     CSR                   PARM           #SIDAT                                
     CSR                   PARM           #EDAT                                 
     CSR                   PARM           #FFMT                                 
     CSR                   PARM           #TFMT                                 
     CSR                   PARM           #SEP                                  
     CSR                   PARM           $ERTST                                
     CSR                   MOVEL#SIDAT    $UDATE                                
E3   CSR                   ENDIF                                                
E2   CSR                   ENDIF                                                
     C*----------------------------------------------------------------         
     C*                                                                         
     C*    Move to output - Address Number                                      
     C*                                                                         
     CSR                   MOVE *BLANK    #SINBR                                
     CSR                   MOVELSHAN8     #SINBR                                
     CSR                   MOVE T@AN8     #DTYP                                 
     CSR                   MOVE W@AN8     #EWRD                                 
     CSR                   MOVE E@AN8     #EC                                   
     CSR                   MOVE F@AN8     #DSPD                                 
     CSR                   MOVE G@AN8     #DATD                                 
     CSR                   MOVE J@AN8     #ALR                                  
     CSR                   MOVE ' '       #ECOR                                 
     CSR                   MOVE ' '       #DCOR                                 
     CSR                   EXSR C00161                                          
     C*                    ---- ------                                          
B2   CSR         #ALR      IFEQ 'L'                                             
     CSR                   MOVEL#SINBR    RRAN8                                 
X2   CSR                   ELSE                                                 
     CSR                   MOVE #SINBR    RRAN8                                 
E2   CSR                   ENDIF                                                
     C*----------------------------------------------------------------         
     C*                                                                         
     C*    Retrieve Payment Terms                                               
     C*                                                                         
     CSR         SDPTC     CHAINI0014                98                         
B2   CSR         *IN98     IFEQ '1'                                             
     CSR                   MOVE *BLANKS   PNPTD                                 
     CSR                   MOVE *BLANKS   PNDCP                                 
E2   CSR                   ENDIF                                                
     CSR                   MOVE PNDCP     $$DCP   55                            
     C*                                                                         
     C*    Move to output - Description - Payment Terms                        
S7312CSR         *IN76     IFEQ *ON                        Mexico               
S7312CSR         SDPTC     IFEQ 'HFC'                                           
S7312CSR                   MOVELMEXHFC    PNPTD     P                           
S7312CSR                   ENDIF                                                
S7312CSR         SDPTC     IFEQ 'N/C'                                           
S7312CSR                   MOVELMEXNC     PNPTD     P                           
S7312CSR                   ENDIF                                                
S7312CSR         SDPTC     IFEQ 'NET'                                           
S7312CSR                   MOVELMEXNET    PNPTD     P                           
S7312CSR                   ENDIF                                                
S7312CSR         SDPTC     IFEQ 'N00'                                           
S7312CSR                   MOVELMEXN00    PNPTD     P                           
S7312CSR                   ENDIF                                                
S7312CSR         SDPTC     IFEQ 'N10'                                           
S7312CSR                   MOVELMEXN10    PNPTD     P                           
S7312CSR                   ENDIF                                                
S7312CSR         SDPTC     IFEQ 'N15'                                           
S7312CSR                   MOVELMEXN15    PNPTD     P                           
S7312CSR                   ENDIF                                                
S7312CSR         SDPTC     IFEQ 'N30'                                           
S7312CSR                   MOVELMEXN30    PNPTD     P                           
S7312CSR                   ENDIF                                                
S7312CSR         SDPTC     IFEQ 'N40'                                           
S7312CSR                   MOVELMEXN40    PNPTD     P                           
S7312CSR                   ENDIF                                                
S7312CSR         SDPTC     IFEQ 'N45'                                           
S7312CSR                   MOVELMEXN45    PNPTD     P                           
S7312CSR                   ENDIF                                                
S7312CSR         SDPTC     IFEQ 'N52'                                           
S7312CSR                   MOVELMEXN52    PNPTD     P                           
S7312CSR                   ENDIF                                                
S7312CSR         SDPTC     IFEQ 'N60'                                           
S7312CSR                   MOVELMEXN60    PNPTD     P                           
S7312CSR                   ENDIF                                                
S7312CSR         SDPTC     IFEQ 'N75'                                           
S7312CSR                   MOVELMEXN75    PNPTD     P                           
S7312CSR                   ENDIF                                                
S7312CSR         SDPTC     IFEQ 'N90'                                           
S7312CSR                   MOVELMEXN90    PNPTD     P                           
S7312CSR                   ENDIF                                                
S7312CSR         SDPTC     IFEQ '120'                                           
S7312CSR                   MOVELMEX120    PNPTD     P                           
S7312CSR                   ENDIF                                                
S7312CSR         SDPTC     IFEQ '302'                                           
S7312CSR                   MOVELMEX302    PNPTD     P                           
S7312CSR                   ENDIF                                                
S7312CSR         SDPTC     IFEQ '303'                                           
S7312CSR                   MOVELMEX303    PNPTD     P                           
S7312CSR                   ENDIF                                                
S7312CSR         SDPTC     IFEQ '305'                                           
S7312CSR                   MOVELMEX305    PNPTD     P                           
S7312CSR                   ENDIF                                                
S7312CSR         SDPTC     IFEQ '309'                                           
S7312CSR                   MOVELMEX309    PNPTD     P                           
S7312CSR                   ENDIF                                                
S7312CSR         SDPTC     IFEQ '320'                                           
S7312CSR                   MOVELMEX320    PNPTD     P                           
S7312CSR                   ENDIF                                                
S7312CSR         SDPTC     IFEQ '321'                                           
S7312CSR                   MOVELMEX321    PNPTD     P                           
S7312CSR                   ENDIF                                                
S7312CSR         SDPTC     IFEQ '322'                                           
S7312CSR                   MOVELMEX322    PNPTD     P                           
S7312CSR                   ENDIF                                                
S7312CSR         SDPTC     IFEQ '323'                                           
S7312CSR                   MOVELMEX323    PNPTD     P                           
S7312CSR                   ENDIF                                                
S7312CSR         SDPTC     IFEQ '324'                                           
S7312CSR                   MOVELMEX324    PNPTD     P                           
S7312CSR                   ENDIF                                                
S7312CSR         SDPTC     IFEQ '325'                                           
S7312CSR                   MOVELMEX325    PNPTD     P                           
S7312CSR                   ENDIF                                                
S7312CSR                   ENDIF                                                
     C*                                                                         
     CSR                   CLEAR@UA                                             
     CSR                   MOVEAPNPTD     @UA                                   
     CSR                   Z-ADD25        #OUTLG                                
     CSR                   EXSR C9822                                           
     C*                    ---- -----                                           
     CSR                   MOVEA@UB       RRPTD                                 
SER  C*----------------------------------------------------------------         
SER  C*                                                                         
S3056CSR                   MOVE *BLANKS   RRCARD                                
SER  C*    Retrieve Ship Via Description                                        
S0356C           SHDEL1    IFNE *BLANKS                                         
S3056CSR                   MOVELSHDEL1    RRCARD    P                           
S3056C*                                                                         
S3056CSR                   ELSE                                                 
SER  CSR         SHSHAN    CHAINF0301                99                         
SER  CSR         *IN99     IFEQ *OFF                                            
SER  C*                                                                         
SER  CSR                   Z-ADDA5CARS    ABAN8                                 
SER  CSR                   MOVE *BLANKS   PS@@1                                 
SER  CSR                   MOVEL'A71     '@@FMT                                 
SER  CSR                   MOVE 'K'       @@ACCS                                
SER  CSR                   MOVEL'CHAIN   '@@OPER                                
SER  CSR                   MOVE 'N'       @@LOCK                                
SER  CSR                   MOVE 'N'       @@CHGR                                
SER  CSR                   MOVEL'ABKY01  '@@KLST                                
SER  CSR                   Z-ADD1         @@KNUM                                
SER  CSR                   CALL 'XF0101'               81                       
SER  C*                    ---- --------                                        
SER  CSR                   PARM           PS@@1                                 
SER  CSR                   PARM           I0101                                 
SER  CSR         *IN81     IFEQ '0'                                             
SER  CSR         @@IOR     ANDEQ*BLANK                                          
SER  CSR                   CLEAR@UA                                             
SER  CSR                   MOVEAABALPH    @UA                                   
SER  CSR                   Z-ADD30        #OUTLG                                
SER  CSR                   EXSR C9822                                           
SER  C*                    ---- -----                                           
SER  CSR                   MOVEA@UB       HDCARD 30                             
SER  CSR                   ELSE                                                 
SER  CSR                   MOVE *BLANKS   HDCARD                                
SER  CSR                   END                                                  
SER  CSR                   MOVELHDCARD    RRCARD                                
SER  CSR                   END                                                  
SER  C*                                                                         
S3056CSR                   ENDIF                           -SHDEL1 <> " "       
S3056C*                                                                         
     C*----------------------------------------------------------------         
     C*                                                                         
     C*    Move to output - Related PO/SO/WO Number                             
     C*                                                                         
     CSR                   MOVE *BLANK    #SINBR                                
     CSR                   MOVELSDRORN    #SINBR                                
     CSR                   MOVE T@RORN    #DTYP                                 
     CSR                   MOVE W@RORN    #EWRD                                 
     CSR                   MOVE E@RORN    #EC                                   
     CSR                   MOVE F@RORN    #DSPD                                 
     CSR                   MOVE G@RORN    #DATD                                 
     CSR                   MOVE J@RORN    #ALR                                  
     CSR                   MOVE ' '       #ECOR                                 
     CSR                   MOVE ' '       #DCOR                                 
     CSR                   EXSR C00161                                          
     C*                    ---- ------                                          
B2   CSR         #ALR      IFEQ 'L'                                             
     CSR                   MOVEL#SINBR    RRRORN                                
X2   CSR                   ELSE                                                 
     CSR                   MOVE #SINBR    RRRORN                                
E2   CSR                   ENDIF                                                
     C*----------------------------------------------------------------         
     C*                                                                         
     C*    Move to output - Currency Codes.                                     
     C*                                                                         
     CSR                   MOVE *BLANKS   VC0007                                
B2   CSR         $@CURR    IFEQ '1'                                             
B3   CSR         $@IC      IFEQ '1'                                             
     CSR                   MOVELCCCRCD    VC0007                                
E2   CSR                   ELSE                                                 
     CSR                   MOVE SHCRCD    VC0007                                
X3   CSR                   ENDIF                                                
X3   CSR                   ENDIF                                                
     C*----------------------------------------------------------------         
     C*                                                                         
     C*    Move to output - Tax Id for Sold To Address                          
     C*                                                                         
     CSR                   MOVE *BLANKS   VC0003                                
B2   CSR         ABTAX     IFNE *BLANKS                                         
     C*                                                                         
     C*    Determine if tax id is person or corporation format                  
     C*                                                                         
B3   CSR         ABTAXC    IFEQ 'P'                                             
DBY20CSR                   CLEAR@UA                                             
     CSR                   MOVEAABTAX     @UA                                   
     CSR                   Z-ADD20        #OUTLG                                
     CSR                   EXSR C9822                                           
     C*                    ---- -----                                           
     CSR                   MOVEA@UB       $WKITX                                
     CSR                   MOVE $WKI2     $WKO2                                 
     CSR                   MOVE $WKI3     $WKO3                                 
DBN15CSR                   MOVEL$WKI4     $WKO4                                 
     CSR                   MOVE '-'       $DSH1                                 
     CSR                   MOVEL'-'       $DSH2                                 
     CSR                   MOVEL$WKOTX    VC0003                                
X3   CSR                   ELSE                                                 
DBY20CSR                   CLEAR@UA                                             
     CSR                   MOVEAABTAX     @UA                                   
     CSR                   Z-ADD20        #OUTLG                                
     CSR                   EXSR C9822                                           
     C*                    ---- -----                                           
     CSR                   MOVEA@UB       WRK20  20                             
DBN2 CSR                   MOVELWRK20     $WK2    2                             
DBN18CSR                   MOVE WRK20     $WK18  18                             
     CSR         $WK2      CAT  '-':0     VC0003                                
     CSR                   CAT  $WK18:0   VC0003                                
E3   CSR                   ENDIF                                                
E2   CSR                   ENDIF                                                
     C*----------------------------------------------------------------         
     C*                                                                         
     C*    Read Billing Instructions File for Sold To                           
     C*                                                                         
     CSR                   Z-ADDSHAN8     A5AN8                                 
     C*                                                                         
     CSR                   MOVEL'A71     '@@FMT                                 
     CSR                   MOVE 'K'       @@ACCS                                
     CSR                   MOVEL'CHAIN   '@@OPER                                
     CSR                   MOVE 'N'       @@LOCK                                
     CSR                   MOVEL'A5KY00  '@@KLST                                
     CSR                   Z-ADD1         @@KNUM                                
     CSR                   CALL 'XF0301'                                        
     C*                    ---- --------                                        
     CSR                   PARM           PS@@1                                 
     CSR                   PARM           I0301                                 
     C*                                                                         
     C*    Save values for later processing.                                    
     C*                                                                         
     CSR                   MOVE A5ICON    $5ICON                                
     CSR                   MOVE A5DSPA    $5DSPA                                
     C*                                                                         
     C*    If consolidated invoices requested, set on indicator.                
     C*                                                                         
     CSR                   MOVE '0'       *IN03                                 
B2   CSR         $5ICON    IFEQ 'Y'                                             
     CSR                   MOVE '1'       *IN03                                 
     CSR                   MOVE '1'       *IN60                                 
E2   CSR                   ENDIF                                                
B2   CSR         $@SUMZ    IFNE *BLANKS                                         
     CSR                   MOVE '0'       *IN60                                 
E2   CSR                   ENDIF                                                
     C*                                                                         
     C*    Read Address Book File for Ship To                                   
     C*                                                                         
     CSR                   Z-ADDSDSHAN    ABAN8                                 
     CSR                   MOVEL'A71     '@@FMT                                 
     CSR                   MOVE 'K'       @@ACCS                                
     CSR                   MOVEL'CHAIN   '@@OPER                                
     CSR                   MOVE 'N'       @@LOCK                                
     CSR                   MOVE 'N'       @@CHGR                                
     CSR                   MOVEL'ABKY01  '@@KLST                                
     CSR                   Z-ADD1         @@KNUM                                
     CSR                   CALL 'XF0101'               81                       
     C*                    ---- --------                                        
     CSR                   PARM           PS@@1                                 
     CSR                   PARM           I0101                                 
     C*                                                                         
     C*    Move to output - Tax Id for Ship To                                  
     C*                                                                         
     CSR                   MOVE *BLANKS   VC0004                                
B2   CSR         ABTAX     IFNE *BLANKS                                         
     C*                                                                         
     C*    Determine if tax id is person or corporation format                  
     C*                                                                         
B3   CSR         ABTAXC    IFEQ 'P'                                             
DBY20CSR                   CLEAR@UA                                             
     CSR                   MOVEAABTAX     @UA                                   
     CSR                   Z-ADD20        #OUTLG                                
     CSR                   EXSR C9822                                           
     C*                    ---- -----                                           
     CSR                   MOVEA@UB       $WKITX                                
     CSR                   MOVE $WKI2     $WKO2                                 
     CSR                   MOVE $WKI3     $WKO3                                 
DBN15CSR                   MOVEL$WKI4     $WKO4                                 
     CSR                   MOVE '-'       $DSH1                                 
     CSR                   MOVEL'-'       $DSH2                                 
     CSR                   MOVEL$WKOTX    VC0004                                
X3   CSR                   ELSE                                                 
DBY20CSR                   CLEAR@UA                                             
     CSR                   MOVEAABTAX     @UA                                   
     CSR                   Z-ADD20        #OUTLG                                
     CSR                   EXSR C9822                                           
     C*                    ---- -----                                           
     CSR                   MOVEA@UB       WRK20  20                             
DBN2 CSR                   MOVELWRK20     $WK2    2                             
DBN18CSR                   MOVE WRK20     $WK18  18                             
     CSR         $WK2      CAT  '-':0     VC0004                                
     CSR                   CAT  $WK18:0   VC0004                                
E3   CSR                   ENDIF                                                
E2   CSR                   ENDIF                                                
     C*----------------------------------------------------------------         
     C*                                                                         
     C*    Move to output - Certificate, Tax Exemption                          
     C*                                                                         
     CSR                   MOVELSHTXCT    RRTXCT                                
     C*----------------------------------------------------------------         
     C*                                                                         
     C*    Move to output - Delivery Instructions Line 1                       
     C*                                                                         
     CSR                   MOVELSHDEL1    RRDEL1                                
     C*--------------------------------------------------------------           
     C*                                                                         
     C*    Move to output - Delivery Instructions Line 2                        
     C*                                                                         
     CSR                   MOVELSHDEL2    RRDEL2                                
     C*----------------------------------------------------------------         
     C*                                                                         
     C*    Read Address Book file for Sold To Address set up in                 
     C*    the Billing Instructions.                                            
     C*                                                                         
     CSR         $@IC      IFNE '1'                                             
     CSR                   MOVE SHAN8     $SVAN8  80                            
     CSR                   ELSE                                                 
     CSR                   MOVE UDIAN8    $SVAN8  80                            
     CSR                   ENDIF                                                
     C*                                                                         
     CSR                   Z-ADDSHAN8     ABAN8                                 
     CSR                   MOVEL'A71     '@@FMT                                 
     CSR                   MOVE 'K'       @@ACCS                                
     CSR                   MOVEL'CHAIN   '@@OPER                                
     CSR                   MOVE 'N'       @@LOCK                                
     CSR                   MOVE 'N'       @@CHGR                                
     CSR                   MOVEL'ABKY01  '@@KLST                                
     CSR                   Z-ADD1         @@KNUM                                
     CSR                   CALL 'XF0101'               81                       
     C*                    ---- --------                                        
     CSR                   PARM           PS@@1                                 
     CSR                   PARM           I0101                                 
     C*                                                                         
     CSR                   Z-ADDSHAN8     A5AN8                                 
     CSR                   MOVEL'A71     '@@FMT                                 
     CSR                   MOVE 'K'       @@ACCS                                
     CSR                   MOVEL'CHAIN   '@@OPER                                
     CSR                   MOVE 'N'       @@LOCK                                
     CSR                   MOVE 'N'       @@CHGR                                
     CSR                   MOVEL'A5KY00  '@@KLST                                
     CSR                   Z-ADD1         @@KNUM                                
     CSR                   CALL 'XF0301'               81                       
     C*                    ---- --------                                        
     CSR                   PARM           PS@@1                                 
     CSR                   PARM           I0301                                 
     C*                                                                         
     C*----------------------------------------------------------------         
     C*                                                                         
     C*    Save values for later processing.                                    
     C*                                                                         
     CSR                   MOVE A5RYIN    $BPYIN                                
     CSR                   Z-ADDA5AN8     $BAN8                                 
     CSR                   MOVELA5INMG    $5ING                                 
     CSR                   MOVE A5ICON    $5ICON                                
     CSR                   MOVE A5DSPA    $5DSPA                                
     C*----------------------------------------------------------------         
     C*                                                                         
     C*    Clear saved send to invoice code                                     
     C*                                                                         
     CSR                   MOVE ' '       $$SITO  1                             
     C*                                                                         
     C*    If send invoice code is set to 'P' -                                 
     C*    Read the Address Book File for the parent address number             
     C*                                                                         
B2   CSR         A5SITO    IFEQ 'P'                                             
     C*SR                   MOVE A5PA8     $SVAN8  80                           
     CSR                   MOVE SHPA8     $SVAN8  80                            
     CSR                   MOVE A5SITO    $$SITO                                
     C*                                                                         
     C*SR                   Z-ADDA5PA8     ABAN8                                
     CSR                   Z-ADDSHPA8     ABAN8                                 
     CSR                   MOVEL'A71     '@@FMT                                 
     CSR                   MOVE 'K'       @@ACCS                                
     CSR                   MOVEL'CHAIN   '@@OPER                                
     CSR                   MOVE 'N'       @@LOCK                                
     CSR                   MOVE 'N'       @@CHGR                                
     CSR                   MOVEL'ABKY01  '@@KLST                                
     CSR                   Z-ADD1         @@KNUM                                
     CSR                   CALL 'XF0101'               81                       
     C*                    ---- --------                                        
     CSR                   PARM           PS@@1                                 
     CSR                   PARM           I0101                                 
E2   CSR                   ENDIF                                                
     C*                                                                         
     C*    If send invoice code is set to '1' -                                 
     C*    Read the Address Book File for the related address number 1          
     C*                                                                         
B2   CSR         A5SITO    IFEQ '1'                                             
     CSR                   MOVE ABAN81    $SVAN8  80                            
     CSR                   MOVE A5SITO    $$SITO                                
     C*                                                                         
     CSR                   Z-ADDABAN81    ABAN8                                 
     CSR                   MOVEL'A71     '@@FMT                                 
     CSR                   MOVE 'K'       @@ACCS                                
     CSR                   MOVEL'CHAIN   '@@OPER                                
     CSR                   MOVE 'N'       @@LOCK                                
     CSR                   MOVE 'N'       @@CHGR                                
     CSR                   MOVEL'ABKY01  '@@KLST                                
     CSR                   Z-ADD1         @@KNUM                                
     CSR                   CALL 'XF0101'               81                       
     C*                    ---- --------                                        
     CSR                   PARM           PS@@1                                 
     CSR                   PARM           I0101                                 
E2   CSR                   ENDIF                                                
     C*                                                                         
     C*    If send invoice code is set to '2' -                                 
     C*    Read the Address Book File for the related address number 2          
     C*                                                                         
B2   CSR         A5SITO    IFEQ '2'                                             
     CSR                   MOVE ABAN82    $SVAN8  80                            
     CSR                   MOVE A5SITO    $$SITO                                
     C*                                                                         
     CSR                   Z-ADDABAN82    ABAN8                                 
     CSR                   MOVEL'A71     '@@FMT                                 
     CSR                   MOVE 'K'       @@ACCS                                
     CSR                   MOVEL'CHAIN   '@@OPER                                
     CSR                   MOVE 'N'       @@LOCK                                
     CSR                   MOVE 'N'       @@CHGR                                
     CSR                   MOVEL'ABKY01  '@@KLST                                
     CSR                   Z-ADD1         @@KNUM                                
     CSR                   CALL 'XF0101'               81                       
     C*                    ---- --------                                        
     CSR                   PARM           PS@@1                                 
     CSR                   PARM           I0101                                 
E2   CSR                   ENDIF                                                
     C*                                                                         
     C*    If send invoice code is set to '3' -                                 
     C*    Read the Address Book File for the related address number 3          
     C*                                                                         
B2   CSR         A5SITO    IFEQ '3'                                             
     CSR                   MOVE ABAN83    $SVAN8  80                            
     CSR                   MOVE A5SITO    $$SITO                                
     C*                                                                         
     CSR                   Z-ADDABAN83    ABAN8                                 
     CSR                   MOVEL'A71     '@@FMT                                 
     CSR                   MOVE 'K'       @@ACCS                                
     CSR                   MOVEL'CHAIN   '@@OPER                                
     CSR                   MOVE 'N'       @@LOCK                                
     CSR                   MOVE 'N'       @@CHGR                                
     CSR                   MOVEL'ABKY01  '@@KLST                                
     CSR                   Z-ADD1         @@KNUM                                
     CSR                   CALL 'XF0101'               81                       
     C*                    ---- --------                                        
     CSR                   PARM           PS@@1                                 
     CSR                   PARM           I0101                                 
E2   CSR                   ENDIF                                                
     C*                                                                         
     C*    If send invoice code is set to '4' -                                 
     C*    Read the Address Book File for the related address number 4          
     C*                                                                         
B2   CSR         A5SITO    IFEQ '4'                                             
     CSR                   MOVE ABAN84    $SVAN8  80                            
     CSR                   MOVE A5SITO    $$SITO                                
     C*                                                                         
     CSR                   Z-ADDABAN84    ABAN8                                 
     CSR                   MOVEL'A71     '@@FMT                                 
     CSR                   MOVE 'K'       @@ACCS                                
     CSR                   MOVEL'CHAIN   '@@OPER                                
     CSR                   MOVE 'N'       @@LOCK                                
     CSR                   MOVE 'N'       @@CHGR                                
     CSR                   MOVEL'ABKY01  '@@KLST                                
     CSR                   Z-ADD1         @@KNUM                                
     CSR                   CALL 'XF0101'               81                       
     C*                    ---- --------                                        
     CSR                   PARM           PS@@1                                 
     CSR                   PARM           I0101                                 
E2   CSR                   ENDIF                                                
     C*                                                                         
     C*    If send invoice code is set to '5' -                                 
     C*    Read the Address Book File for the related address number 5          
     C*                                                                         
B2   CSR         A5SITO    IFEQ '5'                                             
     CSR                   MOVE ABAN86    $SVAN8  80                            
     CSR                   MOVE A5SITO    $$SITO                                
     C*                                                                         
     CSR                   Z-ADDABAN86    ABAN8                                 
     CSR                   MOVEL'A71     '@@FMT                                 
     CSR                   MOVE 'K'       @@ACCS                                
     CSR                   MOVEL'CHAIN   '@@OPER                                
     CSR                   MOVE 'N'       @@LOCK                                
     CSR                   MOVE 'N'       @@CHGR                                
     CSR                   MOVEL'ABKY01  '@@KLST                                
     CSR                   Z-ADD1         @@KNUM                                
     CSR                   CALL 'XF0101'               81                       
     C*                    ---- --------                                        
     CSR                   PARM           PS@@1                                 
     CSR                   PARM           I0101                                 
E2   CSR                   ENDIF                                                
     C*                                                                         
     C*    If send invoice code is set to '6' -                                 
     C*    Read the Address Book File for the related address number 6          
     C*                                                                         
B2   CSR         A5SITO    IFEQ '6'                                             
     CSR                   MOVE ABAN85    $SVAN8  80                            
     CSR                   MOVE A5SITO    $$SITO                                
     C*                                                                         
     CSR                   Z-ADDABAN85    ABAN8                                 
     CSR                   MOVEL'A71     '@@FMT                                 
     CSR                   MOVE 'K'       @@ACCS                                
     CSR                   MOVEL'CHAIN   '@@OPER                                
     CSR                   MOVE 'N'       @@LOCK                                
     CSR                   MOVE 'N'       @@CHGR                                
     CSR                   MOVEL'ABKY01  '@@KLST                                
     CSR                   Z-ADD1         @@KNUM                                
     CSR                   CALL 'XF0101'               81                       
     C*                    ---- --------                                        
     CSR                   PARM           PS@@1                                 
     CSR                   PARM           I0101                                 
E2   CSR                   ENDIF                                                
     C*                                                                         
     C*    Move to output - Sold To Address                                     
     C*                                                                         
B2   CSR         $$SITO    IFEQ 'P'                                             
     CSR         $$SITO    OREQ '1'                                             
     CSR         $$SITO    OREQ '2'                                             
     CSR         $$SITO    OREQ '3'                                             
     CSR         $$SITO    OREQ '4'                                             
     CSR         $$SITO    OREQ '5'                                             
     CSR         $$SITO    OREQ '6'                                             
     C*                                                                         
     C*    Move to output - Tax Id for Sold To Address                          
     C*                                                                         
     CSR                   MOVE *BLANKS   VC0003                                
B3   CSR         ABTAX     IFNE *BLANKS                                         
     C*                                                                         
     C*    Determine if tax id is person or corporation format                  
     C*                                                                         
B4   CSR         ABTAXC    IFEQ 'P'                                             
DBY20CSR                   CLEAR@UA                                             
     CSR                   MOVEAABTAX     @UA                                   
     CSR                   Z-ADD20        #OUTLG                                
     CSR                   EXSR C9822                                           
     C*                    ---- -----                                           
     CSR                   MOVEA@UB       $WKITX                                
     CSR                   MOVE $WKI2     $WKO2                                 
     CSR                   MOVE $WKI3     $WKO3                                 
DBN15CSR                   MOVEL$WKI4     $WKO4                                 
     CSR                   MOVE '-'       $DSH1                                 
     CSR                   MOVEL'-'       $DSH2                                 
     CSR                   MOVEL$WKOTX    VC0003                                
X4   CSR                   ELSE                                                 
DBY20CSR                   CLEAR@UA                                             
     CSR                   MOVEAABTAX     @UA                                   
     CSR                   Z-ADD20        #OUTLG                                
     CSR                   EXSR C9822                                           
     C*                    ---- -----                                           
     CSR                   MOVEA@UB       WRK20  20                             
DBN2 CSR                   MOVELWRK20     $WK2    2                             
DBN18CSR                   MOVE WRK20     $WK18  18                             
     CSR         $WK2      CAT  '-':0     VC0003                                
     CSR                   CAT  $WK18:0   VC0003                                
E4   CSR                   ENDIF                                                
E3   CSR                   ENDIF                                                
E2   CSR                   ENDIF                                                
     C*                                                                         
     C*    If tax id is the same, don't print the ship to tax id                
     C*                                                                         
B2   CSR         VC0003    IFEQ VC0004                                          
     CSR                   SETOF                     35                         
X2   CSR                   ELSE                                                 
     CSR                   SETON                     35                         
E2   CSR                   ENDIF                                                
     C*----------------------------------------------------------------         
     C*                                                                         
     C*    Clear Address Lines                                                  
     C*                                                                         
     CSR                   MOVE *BLANKS   RRALPH 40                             
     C*                                                                         
     CSR                   MOVE *BLANKS   RRSLD1                                
     CSR                   MOVE *BLANKS   RRSLD2                                
     CSR                   MOVE *BLANKS   RRSLD3                                
     CSR                   MOVE *BLANKS   RRSLD4                                
     CSR                   MOVE *BLANKS   RRSLD5                                
     CSR                   MOVE *BLANKS   RRSLD6                                
     CSR                   MOVE *BLANKS   RR#A17                                
     CSR                   MOVE *BLANKS   RR#A11                                
     CSR                   MOVE *BLANKS   RR#A37                                
     C*                                                                         
     CSR                   MOVE *BLANKS   RRSHL1                                
     CSR                   MOVE *BLANKS   RRSHL2                                
     CSR                   MOVE *BLANKS   RRSHL3                                
     CSR                   MOVE *BLANKS   RRSHL4                                
     CSR                   MOVE *BLANKS   RRSHL5                                
     CSR                   MOVE *BLANKS   RRSHL6                                
     CSR                   MOVE *BLANKS   RR#S27                                
     CSR                   MOVE *BLANKS   RR#A12                                
     C*----------------------------------------------------------------         
     C*                                                                         
     C*    Sold to address -                                                    
     C*                                                                         
     C*    Store in array sold to address                                       
     C*                                                                         
     CSR                   MOVE *BLANKS   @AD                                   
     C*                                                                         
     C*    Retrieve order address information - Sold-to                         
     C*                                                                         
     CSR                   CLEARDS4006                                          
     CSR                   CLEARDS1100                                          
     CSR                   MOVELSHDOCO    $ADOCO                                
     CSR                   MOVELSHDCTO    $ADCTO                                
     CSR                   MOVELSHKCOO    $AKCOO                                
     CSR                   MOVEL$SVAN8    $AAN8                                 
     CSR                   MOVELSHTRDJ    #1EFTB                                
     C*                                                                         
     CSR                   CALL 'X4006'                98                       
     C*                    ---- -------                                         
     CSR                   PARM           DS4006                                
     CSR                   PARM           DS1100                                
     CSR                   PARM           @AD                                   
     C*                                                                         
     C*    Format the address based on the country constants.                   
     C*                                                                         
SER  C***                  MOVEL$SVAN8    #1WWAN                                
SER  C***                  MOVE 'B'       #1WWC                                 
SER  C***                  MOVE '1'       #1WWT                                 
     CSR                   MOVE SHTRDJ    #1EFTB                                
     CSR                   CALL 'X01100'               98                       
     C*                    ---- --------                                        
     CSR                   PARM           DS1100                                
     CSR                   PARM           @AD                                   
     C*                                                                         
     C*    Move Address to output field array.                                  
     C*                                                                         
     CSR                   MOVEA@AD       @SL                                   
      *                                                                         
     C*----------------------------------------------------------------         
     C*                                                                         
     C*    Ship to address -                                                    
     C*                                                                         
     C*    Store in array ship to address                                       
     C*                                                                         
     CSR                   MOVE *BLANKS   @AD                                   
     CSR                   Z-ADDSHSHAN    $#SHAN                                
     C*                                                                         
     C*    Retrieve order address information - Ship-to                         
     C*                                                                         
     CSR                   CLEARDS4006                                          
     CSR                   CLEARDS1100                                          
     CSR                   MOVELSHDOCO    $ADOCO                                
     CSR                   MOVELSHDCTO    $ADCTO                                
     CSR                   MOVELSHKCOO    $AKCOO                                
S1170CSR                   MOVELSHSHAN    $ASHAN                                
S1170C***        SDSHAN    IFEQ *ZEROS                                          
S1170C***                  MOVELSHSHAN    $ASHAN                                
S1170C***                  ELSE                                                 
S1170C***                  MOVELSDSHAN    $ASHAN                                
S1170C***                  ENDIF                                                
     CSR                   MOVELSHTRDJ    #1EFTB                                
     C*                                                                         
     CSR                   CALL 'X4006'                98                       
     C*                    ---- -------                                         
     CSR                   PARM           DS4006                                
     CSR                   PARM           DS1100                                
     CSR                   PARM           @AD                                   
     C*                                                                         
     C*    Format the address based on the country constants.                   
     C*                                                                         
     CSR                   CALL 'X01100'               98                       
     C*                    ---- --------                                        
     CSR                   PARM           DS1100                                
     CSR                   PARM           @AD                                   
     C*                                                                         
     C*    Move Address to output field array.                                  
     C*                                                                         
DBN  CSR                   MOVEA@AD       @SH                                   
     C*----------------------------------------------------------------         
     C*                                                                         
     C*    Move to Output - Date - Order/Transaction                            
     C*                                                                         
     CSR                   MOVE SHDRQJ    #SIDAT  6                             
     CSR                   MOVE *BLANK    #EDAT   8                             
     CSR                   MOVEL'*JUL    '#FFMT   7                             
     CSR                   MOVEL'*SYSVAL '#TFMT   7                             
     CSR                   MOVEL'*SYSVAL '#SEP    7                             
     CSR                   MOVE ' '       $ERTST  1                             
     CSR                   CALL 'X0028   '             81                       
     C*                    ---- ----------                                      
     CSR                   PARM           #SIDAT                                
     CSR                   PARM           #EDAT                                 
     CSR                   PARM           #FFMT                                 
     CSR                   PARM           #TFMT                                 
     CSR                   PARM           #SEP                                  
     CSR                   PARM           $ERTST                                
     CSR                   MOVEL#EDAT     RRTRDJ                                
     C*--------------------------------------------------------------           
     C*                                                                         
     C*    Move to output - Freight Handling Code                               
     C*                                                                         
     CSR                   CLEARI0005U                                          
     CSR                   MOVELS@FRTH    #USY                                  
     CSR                   MOVE R@FRTH    #URT                                  
     CSR                   MOVE SHFRTH    #UKY                                  
     CSR                   CALL 'X0005 '               81                       
     C*                    ---- --------                                        
     CSR                   PARM           I0005U                                
     CSR                   MOVE *BLANK    RRFRTH                                
B2   CSR         #UERR     IFNE '1'                                             
     CSR                   MOVEL#UDL01    RRFRTH                                
E2   CSR                   ENDIF                                                
     C*----------------------------------------------------------------         
     C*                                                                         
     C*    Move to output - Cost Center                                         
     C*                                                                         
SER  CSR                   MOVELSDMCU     PSMCU                                 
     CSR         $@IC      IFEQ '1'                                             
     CSR                   MOVELSDMCU     PSMCU                                 
     CSR                   ENDIF                                                
     CSR                   MOVE *BLANK    PSERR#                                
     CSR                   CALL 'X0006'                                         
     C*                    ---- -------                                         
     CSR                   PARM ' '       PSOMOD  1                             
     CSR                   PARM '1'       PSIMOD  1                             
     CSR                   PARM           PSMCU  12                             
     CSR                   PARM           PSERR#  4                             
     CSR                   MOVE PSMCU     RRMCU                                 
      *                                                                         
10153CSR         PSMCU     CHAINF0006                22                         
10153CSR         *IN22     IFEQ *OFF                                            
10153CSR                   MOVEL'00'      DRK1                                  
10153CSR                   MOVEL'05'      DRK2                                  
10153CSR                   MOVE PSMCU     DRK3                                  
10153CSR         KEY02     CHAINF0005                23                         
10153CSR         *IN23     IFEQ *OFF                                            
      *                                                                         
10153CSR         MCRP17    IFEQ '1'                                             
10153CSR         MCRP17    OREQ '2'                                             
10153CSR                   MOVELDRDL01    RRLOCN                                
10153CSR                   ENDIF                                                
      *                                                                         
10153CSR         MCRP17    IFEQ '3'                                             
10153CSR         MCRP17    OREQ '4'                                             
10153CSR                   MOVELDRDL02    RRLOCN                                
10153CSR                   ENDIF                                                
      *                                                                         
10153CSR         MCRP17    IFEQ ' '                                             
10153CSR                   MOVE *BLANKS   RRLOCN                                
10153CSR                   ENDIF                                                
      *                                                                         
10153CSR                   ENDIF                                                
10153CSR                   ENDIF                                                
     C*----------------------------------------------------------------         
     C*                                                                         
     C*    Move to output - Reference                                           
     C*                                                                         
     CSR                   MOVELSHVR01    RRVR01                                
     C*----------------------------------------------------------------         
     C*                                                                         
     C*    Retrieve - Branch Constants                                          
     C*                                                                         
     CSR                   MOVE *BLANKS   PS@@                                  
     CSR                   MOVE SHMCU     KY@@                                  
     CSR         $@IC      IFEQ '1'                                             
     CSR                   MOVE SDMCU     KY@@                                  
     CSR                   ENDIF                                                
     CSR                   CALL 'XS41001'              81                       
     C*                    ---- ---------                                       
     CSR                   PARM           PS@@                                  
     CSR                   PARM           DSINVC                                
     C*                                                                         
     CSR                   Z-ADDSDDOCO    $#DOCO                                
     CSR                   MOVE SDDCTO    $#DCTO                                
     CSR                   MOVELSDKCOO    $#KCOO                                
S5599C                     MOVE SDMCU     $#MCU                                 
     CSR                   Z-ADDSDAN8     $#AN8                                 
     CSR                   MOVELSDCRCD    $#CRCD                                
     CSR                   MOVELSDCRR     $#CRR                                 
     CSR                   MOVE SDPTC     $#PTC                                 
E1   CSR                   ENDIF                                                
     C*----------------------------------------------------------------         
     C*                                                                         
     C*    Check if number of invoice copies has changed.                       
     C*    If so, close the print file and open with the number of              
     C*    copies requested.                                                    
     C*                                                                         
B1   CSR         $@EDI     IFNE '2'                                             
     C*                                                                         
B1   CSR         SHINVC    IFEQ 00                                              
     CSR                   MOVE 01        SHINVC                                
E1   CSR                   ENDIF                                                
B1   CSR         SHINVC    IFNE $COPY                                           
     CSR                   MOVE *BLANKS   $COVER  1                             
     CSR                   MOVE SHINVC    $COPY   20                            
     C*                                                                         
SER  CSR                   CLOSER5542565               89                       
SER  C*                    -------------                                        
27482C                     MOVE *OFF      *IN74                                 
     C*                                                                         
     C*    Number of invoice copies.                                            
     C*                                                                         
     CSR                   MOVE $COPY     DPCOPY  2                             
B2   CSR         DPCOPY    IFEQ *BLANKS                                         
     CSR         DPCOPY    OREQ '00'                                            
     CSR                   MOVEL'01'      DPCOPY                                
E2   CSR                   ENDIF                                                
     C*                                                                         
     C*    Override printer file.                                               
     C*                                                                         
SER  CSR                   MOVEADQOUTQ    @O,29                                 
SER  CSR                   MOVEADPFMTP    @O,62                                 
DBN  CSR                   MOVEA$PHLDQ    @O,86                                 
DBN  CSR                   MOVEADPLPI     @O,108                                
DBN  CSR                   MOVEADPCPI     @O,117                                
DBN  CSR                   MOVEADPCOPY    @O,130                                
     CSR                   Z-ADD160       PSLEN  155                            
     C*                                                                         
SER  CSR                   MOVEA'R5542565'@O,14                                 
     CSR                   CALL 'QCMDEXC'              98                       
     C*                    ---- ---------                                       
     CSR                   PARM           @O                                    
     CSR                   PARM           PSLEN                                 
     C*                                                                         
     C*    Open report file if necessary.                                       
     C*                                                                         
27295C*                    OPEN R5542565               81                       
     C*                                                                         
     CSR                   ELSE                                                 
     C*                                                                         
     C*                                                                         
27295C*                    OPEN R5542565               81                       
     C*                                                                         
E1   CSR                   ENDIF                                                
     C*                                                                         
     C*    If print cover page requested, print cover page.                     
     C*                                                                         
     CSR         $COVER    IFEQ ' '                                             
B2   CSR         DEPTSP    IFEQ '1'                                             
     CSR                   CALL 'P98COVER'             81                       
     C*                    ---- ---------                                       
     CSR                   PARM           ##PID                                 
     CSR                   PARM           ##VERS                                
E2   CSR                   ENDIF                                                
     C*                                                                         
     C*    If print help instructions requested, print help.                    
     C*                                                                         
B2   CSR         DEPTIN    IFEQ '1'                                             
     CSR                   CALL 'P98RPTH'              81                       
     C*                    ---- ----------                                      
     CSR                   PARM           ##PID                                 
E2   CSR                   ENDIF                                                
     CSR                   MOVE '1'       $COVER                                
     CSR                   ENDIF                                                
     C*                                                                         
E1   CSR                   ENDIF                                                
     C*----------------------------------------------------------------         
     C*                                                                         
     C*    Move to output - Net Date Due                                        
     C*                                                                         
     CSR                   MOVEL*BLANKS   RR#DD                                 
     CSR                   SETOF                       37                       
B1   CSR         *IN98     IFEQ '0'                                             
     CSR                   MOVEL$@NDD     PSDD             transaction dat      
     CSR                   CALL 'X0302'                                         
     C*                    ---- -------                                         
     CSR                   PARM           PSDD    6        due date             
     CSR                   PARM *ZEROS    PSDDD   6        discount date        
     CSR                   PARM PNPTC     PSPTC            payment term         
     CSR                   PARM *BLANKS   PSERRM  4                             
     C*                                                                         
     C*    Insert Separators in Due Date and Move to output.                    
     C*                                                                         
     CSR                   MOVE PSDD      #SIDAT  6                             
     CSR                   MOVE *BLANK    #EDAT   8                             
     CSR                   MOVEL'*JUL    '#FFMT   7                             
     CSR                   MOVEL'*SYSVAL '#TFMT   7                             
     CSR                   MOVEL'*SYSVAL '#SEP    7                             
     CSR                   MOVEL' '       $ERTST  1                             
     CSR                   CALL 'X0028   '             81                       
     C*                    ----  -----                                          
     CSR                   PARM           #SIDAT                                
     CSR                   PARM           #EDAT                                 
     CSR                   PARM           #FFMT                                 
     CSR                   PARM           #TFMT                                 
     CSR                   PARM           #SEP                                  
     CSR                   PARM           $ERTST                                
     CSR                   MOVEL#EDAT     RR#DD                                 
13399 *                                                                         
13399CSR                   MOVE PSDD      #SIDAT  6                             
13399CSR                   MOVE *BLANK    #EDAT   8                             
13399CSR                   MOVEL'*JUL    '#FFMT   7                             
13399CSR                   MOVEL'*DMY    '#TFMT   7                             
13399CSR                   MOVEL'*SYSVAL '#SEP    7                             
13399CSR                   MOVEL' '       $ERTST  1                             
13399CSR                   CALL 'X0028   '             81                       
13399C*                    ----  -----                                          
13399CSR                   PARM           #SIDAT                                
13399CSR                   PARM           #EDAT                                 
13399CSR                   PARM           #FFMT                                 
13399CSR                   PARM           #TFMT                                 
13399CSR                   PARM           #SEP                                  
13399CSR                   PARM           $ERTST                                
13399CSR                   MOVEL#EDAT     RR#DDM  8                             
     C*                                                                         
     C*    Calculate next date if a split payment is requested.                 
     C*                                                                         
B2   CSR         PNDTPA    IFNE 0                                               
     CSR                   MOVE *BLANKS   PSIDIF                                
     CSR                   MOVE PNDTPA    PSIDIF                                
     CSR                   MOVE PSDD      PSIDA1                                
     CSR                   CALL 'X0035   '                                      
     C*                    ---- ----------                                      
     CSR                   PARM           PSIDA1  6                             
     CSR                   PARM *BLANK    PSIDA2  6                             
     CSR                   PARM '*JUL    'PSIFM1  7                             
     CSR                   PARM '*SYSVAL 'PSIFM2  7                             
     CSR                   PARM *BLANK    PSICAL  1                             
     CSR                   PARM *BLANK    PSERR   1                             
     CSR                   PARM           PSIDIF  9                             
     C*                                                                         
B3   CSR         PSIDA2    IFNE *BLANKS                                         
     CSR                   SETON                     37                         
     C*                                                                         
     C*    Insert Separators in Due Date and Move to output.                    
     C*                                                                         
     CSR                   MOVE PSIDA2    #SIDAT  6                             
     CSR                   MOVE *BLANK    #EDAT   8                             
     CSR                   MOVEL'*SYSVAL '#FFMT   7                             
     CSR                   MOVEL'*SYSVAL '#TFMT   7                             
     CSR                   MOVEL'*SYSVAL '#SEP    7                             
     CSR                   MOVEL' '       $ERTST  1                             
     CSR                   CALL 'X0028   '             81                       
     C*                    ----  -----                                          
     CSR                   PARM           #SIDAT                                
     CSR                   PARM           #EDAT                                 
     CSR                   PARM           #FFMT                                 
     CSR                   PARM           #TFMT                                 
     CSR                   PARM           #SEP                                  
     CSR                   PARM           $ERTST                                
     CSR                   MOVEL#EDAT     $$#DD                                 
E3   CSR                   ENDIF                                                
E2   CSR                   ENDIF                                                
     C*                                                                         
E1   CSR                   ENDIF                                                
     C*----------------------------------------------------------------         
     CSR         END10B    ENDSR                                                
     C****************************************************************          
     C*                                                                         
     C*    SUBROUTINE S010C - Perform Tax Calculations                          
     C*    -------------------------------------------                          
     C*                                                                         
     CSR         S010C     BEGSR                                                
     C*          -----     -----                                                
     C*                                                                         
     C*    Move extended amount to work field                                   
     C*                                                                         
     C*    If extended backorders requested, read item master                   
     C*                                                                         
B1   CSR         $@EXBO    IFEQ '1'                                             
     CSR         SDSOBK    ANDNE0                                               
     C*                                                                         
     C*    Read Item Master File                                                
     C*                                                                         
     CSR                   MOVE *BLANKS   PS@@                                  
     CSR                   MOVELSDITM     KY@@                                  
     CSR                   CALL 'XS4101LA'                                      
     C*                    ---- ----------                                      
     CSR                   PARM           PS@@                                  
     CSR                   PARM           DS4101                                
     C*                                                                         
     CSR         SDSOQS    ADD  SDSOBK    $WKQTY 150                            
     C*                                                                         
     C*    Convert quantity ordered to other units of measure                   
     C*                                                                         
     CSR         $WKQTY    DIV  #@SOBK    #QTY      H                           
     CSR                   MOVE SDUOM     #UOM                                  
     CSR                   MOVE SDUOM4    #UOM1                                 
     CSR                   MOVELSDMCU     #MCU                                  
     CSR                   MOVE LFIVI     #IVI                                  
     CSR                   MOVE SDCOMM    #READ                                 
     CSR                   MOVE *BLANKS   #OT1Y                                 
     CSR                   Z-ADD*ZEROS    #STDP                                 
     CSR                   MOVEL*BLANKS   #LOTN                                 
     C*                                                                         
     CSR                   CALL 'X41002  '             98                       
     C*                    ---- ----------                                      
     CSR                   PARM           DS4101                                
     CSR                   PARM           DS@UOM                                
     C*                                                                         
B2   CSR         #ERTST    IFEQ '1'                                             
     CSR                   Z-ADD1         #CNVP                                 
     CSR                   Z-ADD1         #CNVQ                                 
E2   CSR                   ENDIF                                                
E1   CSR                   ENDIF                                                
     C*----------------------------------------------------------------         
     C*                                                                         
     C*    Display Foreign Amount                                               
     C*                                                                         
B1   CSR         $@CNV     IFEQ '1'                                             
B2   CSR         $@CURR    IFEQ '1'                                             
     C*                                                                         
     C*    If extended backorders requested, calculate extension                
     C*                                                                         
B3   CSR         $@EXBO    IFEQ '1'                                             
     CSR         SDSOBK    ANDNE0                                               
     C*                                                                         
     CSR         SDFUP     DIV  #@FUP     $WK299    H                           
     CSR                   DIV  #CNVP     $WK299    H                           
     CSR                   MULT #PQT      $WK299    H                           
     CSR         $WK299    MULT #@FDO     $XAEXP    H                           
     CSR                   MOVEL$WK150    #SINBR                                
X3   CSR                   ELSE                                                 
     CSR                   Z-ADDSDFEA     $XAEXP 150                            
E3   CSR                   ENDIF                                                
     C*                                                                         
     C*    Display Domestic Amount                                              
     C*                                                                         
X2   CSR                   ELSE                                                 
     C*                                                                         
     C*    If extended backorders requested, calculate extension                
     C*                                                                         
B3   CSR         $@EXBO    IFEQ '1'                                             
     CSR         SDSOBK    ANDNE0                                               
     C*                                                                         
     CSR         SDUPRC    DIV  #@UPRC    $WK299    H                           
     CSR                   DIV  #CNVP     $WK299    H                           
     CSR                   MULT #PQT      $WK299    H                           
     CSR         $WK299    MULT #@AEXP    $XAEXP    H                           
X3   CSR                   ELSE                                                 
     CSR                   Z-ADDSDAEXP    $XAEXP 150                            
E3   CSR                   ENDIF                                                
E2   CSR                   ENDIF                                                
     C*                                                                         
X1   CSR                   ELSE                                                 
     C*                                                                         
     C*    No Foreign Currency                                                  
     C*                                                                         
     C*    If extended backorders requested, calculate extension                
     C*                                                                         
B2   CSR         $@EXBO    IFEQ '1'                                             
     CSR         SDSOBK    ANDNE0                                               
     C*                                                                         
     CSR         SDUPRC    DIV  #@UPRC    $WK299    H                           
     CSR                   DIV  #CNVP     $WK299    H                           
     CSR                   MULT #PQT      $WK299    H                           
     CSR         $WK299    MULT #@AEXP    $XAEXP    H                           
X2   CSR                   ELSE                                                 
     CSR                   Z-ADDSDAEXP    $XAEXP 150                            
E2   CSR                   ENDIF                                                
E1   CSR                   ENDIF                                                
     C*                                                                         
     C*----------------------------------------------------------------         
     C*                                                                         
     C*    If taxable flag is 3-8 use 3-8 for item number                       
     C*    If taxable flag is Y use short item number                           
     C*    If anything else, use zeros                                          
     C*    Item number is passed to tax calculator program                      
     C*                                                                         
B1   CSR         SDTAX1    IFGE '3'                                             
     CSR         SDTAX1    ANDLE'8'                                             
     CSR                   MOVE SDTAX1    $$TX    10                            
     CSR                   Z-ADD$$TX      $$ITM   80                            
X1   CSR                   ELSE                                                 
B2   CSR         SDTAX1    IFEQ 'Y'                                             
     CSR                   Z-ADDSDITM     $$ITM                                 
X2   CSR                   ELSE                                                 
     CSR                   Z-ADD0         $$ITM                                 
     CSR                   Z-ADD0         $XAEXP                                
E2   CSR                   ENDIF                                                
E1   CSR                   ENDIF                                                
     C*----------------------------------------------------------------         
     C*                                                                         
     C*    Set up parameters for tax program                                    
     C*                                                                         
     CSR                   CLEARDS#TAX                                          
     CSR                   MOVELSDEXR1    #XEXR1           Tax exempt rsn 1     
     CSR                   MOVE SDTXA1    #XTXA1           Tax Area 1           
     CSR                   MOVE SDTRDJ    #XTRDJ           Service Date         
     CSR                   MOVE SDCO      #XCO             Company              
     CSR                   MOVE '1'       #XTXSY           Sys Code flg         
     CSR                   Z-ADD$$ITM     #XITM            Item number          
     CSR                   Z-ADDSDPQOR    #XQTY            Quantity             
     CSR                   Z-ADD$XAEXP    #XNET            Net Amount           
     C*                                                                         
     CSR         LFCDSC    IFEQ 'Y'                                             
     CSR                   MOVE $$DCP     #XDCP            Disc/Terms %         
     CSR                   END                                                  
     C*                                                                        V
     C*    If Vertex Geocode entered, calculate in Vertex mode                  
     C*                                                                         
     CSR         $1$VTX    IFEQ 'Y'                                            V
     CSR                   MOVELSDEXR1    $$EXR9  2                            V
     CSR                   MOVELSDTXA1    $$TXA9 10                            V
     CSR                   MOVE '0'       $$EDT9  1                            V
     CSR                   EXSR C73010                                          
     C*                    ---- ------                                          
     CSR                   ELSE                                                V
     CSR                   MOVE '0'       $$GEOC                               V
     CSR                   MOVE '0'       $$ERRC                               V
     CSR                   END                                                 V
     C*                                                                        V
     CSR         $$GEOC    IFEQ '1'                                            V
     C*                                                                        V
     C*    Extended Price (Net Amount) on which Tax is to be Calculated        V
     C*                                                                        V
     CSR         $XAEXP    DIV  #@AEXP    $$RO08    H                          V
     C*                                                                        V
     C*    Call Vertex Tax Data Structure Loading Module                       V
     C*                                                                        V
     CSR                   MOVELI0101     $V0101                               V
     CSR                   EXSR C73020                                         V
     C*                    ---- ------                                         V
DBN  CSR                   MOVEL$V0101    I0101                                V
     C*                                                                        V
     C*    Call Tax Calculator with vertex parms                               V
     C*                                                                        V
     CSR                   CALL 'X4008C  '             99                      V
     C*                    ---- ----------                                     V
     CSR                   PARM           DS#TAX                               V
     CSR                   PARM           DS7301                               V
     CSR                   PARM           DSVTS1                               V
     CSR                   PARM           DSVTS2                               V
     CSR                   PARM           DSVTS3                               V
     C*                                                                        V
     C*    Load applicable Tax Authorithy                                      V
     C*      Taxed GeoCode Indicator (LTRN01):                                 V
     C*          T = Ship-To Location                                          V
     C*          F = Ship-From Location                                        V
     C*          O = Order Acceptance Location                                 V
     C*                                                                        V
     CSR                   SELEC                                               V
     CSR         LTRN01    WHEQ 'T'                                            V
     CSR                   MOVEL$$TTX1    SDTXA1                               V
     CSR         LTRN01    WHEQ 'F'                                            V
     CSR                   MOVEL$$TTX2    SDTXA1                               V
     CSR         LTRN01    WHEQ 'O'                                            V
     CSR                   MOVEL$$TTX3    SDTXA1                               V
     CSR                   ENDSL                                               V
     C*                                                                        V
     CSR                   ELSE                                                V
     C*                                                                         
     C*    Call program to calculate tax                                        
     C*                                                                         
     CSR                   CALL 'X4008C  '             99                       
     C*                    ---- ----------                                      
     CSR                   PARM           DS#TAX                                
     C*                                                                        V
     CSR                   END                                                 V
     C*---------------------------------------------------------                
     C*    Accumulate Tax totals for EDI processing                             
     C                     ADD  #XSTAM    $$STAM                                
     C                     ADD  #XATXA    $$ATXA                                
     C                     ADD  #XATXN    $$ATXN                                
     C                     ADD  #XADSC    $$ADSC                                
     C                     ADD  #XUTAM    $$UTAM                                
     C                     ADD  #XAMT1    $$AMT1                                
     C                     ADD  #XAMT2    $$AMT2                                
     C                     ADD  #XAMT3    $$AMT3                                
     C                     ADD  #XAMT4    $$AMT4                                
     C                     ADD  #XAMT5    $$AMT5                                
     C*                                                                         
     C           SDTAX1    IFEQ 'N'                                             
     C                     ADD  SDFEA     $$FEA                                 
     C                     ADD  SDAEXP    $$AEXP                                
     C                     ENDIF                                                
     C*                                                                         
     C*---------------------------------------------------------                
     C*                                                                         
     C*    If tax summarization is specified, accumulate taxes in               
     C*       user index.                                                       
     C*                                                                         
     CSR         #XTAXL    IFEQ 'Y'                                             
     CSR         SDTAX1    ANDNE'N'                                            V
     CSR                   MOVE '1'       $RND    1                             
     C*                                                                         
     CSR                   MOVE *BLANKS   DSKY$1                                
     CSR                   MOVE SDTXA1    K1TXA1                                
     CSR                   MOVE SDEXR1    K1EXR1                                
     CSR                   MOVE #XITM     K1ITM                                 
     CSR                   MOVE SDTAX1    K1TAX1                                
     CSR                   MOVE *BLANKS   PKEY                                  
DBN12CSR                   MOVELDSKY$1    PKEY                                  
     C*                                                                         
     CSR                   MOVE 'I'       PACTN                                 
     CSR                   MOVE 'EQ'      PRULE                                 
     CSR                   EXSR S0041                                           
     C*                    ---- -----                                           
     C*                                                                         
     CSR         PSTAT1    IFEQ '0'                                             
     C*                                                                         
     CSR                   ADD  #XSTAM    $1STAM                                
     CSR                   ADD  #XUTAM    $1UTAM                                
     C*                                                                         
     CSR                   MOVE 'C'       PACTN                                 
     CSR                   MOVE 'EQ'      PRULE                                 
     CSR                   EXSR S0041                                           
     C*                    ---- -----                                           
     C*                                                                         
     CSR                   ELSE                                                 
     C*                                                                         
     C*    Add record to Tax Summary Value user index                           
     C*                                                                         
     CSR                   MOVE SDTXA1    $1TXA1                                
     CSR                   MOVE SDEXR1    $1EXR1                                
     CSR                   MOVE #XITM     $1ITM1                                
     CSR                   MOVE SDTAX1    $1TAX1                                
     CSR                   Z-ADD#XSTAM    $1STAM                                
     CSR                   Z-ADD#XUTAM    $1UTAM                                
     CSR                   MOVE 'A'       PACTN                                 
     CSR                   EXSR S0041                                           
     C*                    ---- -----                                           
     CSR                   ENDIF                                                
     CSR                   ENDIF                                                
     C*                                                                         
     C*    Load work field with tax amount                                      
     C*                                                                         
B1   CSR         SDTAX1    IFNE 'N'                                             
     CSR                   ADD  #XSTAM    $#ATT  150                            
     CSR                   ADD  #XSTAM    $#GRX  150                            
     CSR                   ADD  #XATXA    $#TAX  150                            
E1   CSR                   ENDIF                                                
     C*                                                                        V
     C*    If Vertex GeoCode, use combined tax Rate                            V
     C*                                                                        V
     CSR         $$GEOC    IFEQ '1'                                            V
     C*                                                                        V
     C*    If taxed amount is zero, flag line overidden                        V
     C*                                                                        V
     CSR         LINV04    IFEQ *ZEROS                                         V
     CSR                   MOVE 'O'       RRTX                                 V
     CSR                   MOVE 'N'       SDTAX1                               V
     CSR                   ELSE                                                V
     CSR                   Z-ADD#XTXR5    $SVTAX                               V
     CSR                   END                                                 V
     C*                                                                        V
     CSR                   Z-ADD*ZEROS    #XTXR5                               V
     CSR                   ELSE                                                V
     C*                                                                         
     C*    Add up the tax rates.                                                
     C*                                                                         
     CSR                   MOVE *ZEROS    $SVTAX 150                            
B1   CSR         #XTXTX    IFNE 'Y'                                             
     CSR                   ADD  #XTXR1    $SVTAX                                
     CSR                   ADD  #XTXR2    $SVTAX                                
     CSR                   ADD  #XTXR3    $SVTAX                                
     CSR                   ADD  #XTXR4    $SVTAX                                
     CSR                   ADD  #XTXR5    $SVTAX                                
E1   CSR                   ENDIF                                                
     C*                                                                        V
     CSR                   END                                                 V
     C*                                                                         
     C*    Add up the tax rates.                                                
     C*                                                                         
     CSR                   ADD  #XADSC    $$DAMT 150                            
     CSR                   ADD  #XADSC    $FDAMT 150                            
     C*                                                                         
     C*    If line is non-taxable but discount is available,                    
     C*    calculate the discount available.                                    
     C*                                                                         
B1   CSR         $$DCP     IFNE *ZEROS                                          
     CSR         LFCDSC    ANDEQ'Y'                                             
B2   CSR         SDTAX1    IFEQ 'N'                                             
     CSR         SDEXR1    OREQ *BLANKS                                         
     CSR         SDTXA1    ANDEQ*BLANKS                                         
     C****       SDAEXP    MULT $$DCP     $WK150    H                           
     CSR         $#AEXP    MULT $$DCP     $WK150    H                           
     CSR                   ADD  $WK150    $$DAMT                                
     C****       SDFEA     MULT $$DCP     $WK150    H                           
     CSR         $#FEA     MULT $$DCP     $WK150    H                           
     CSR                   ADD  $WK150    $FDAMT                                
E2   CSR                   ENDIF                                                
E1   CSR                   ENDIF                                                
     C*                                                                         
     C*----------------------------------------------------------------         
     C*                                                                         
     C*    Retrieve the description for the tax group summary                   
     C*                                                                         
B1   CSR         SDTXA1    IFNE *BLANKS                                         
     CSR                   MOVE SDTXA1    TATXA1                                
     CSR                   Z-ADD$$ITM     TAITM                                 
     C*                                                                        V
     C*    If Vertex Geocode entered, process in Vertex mode                   V
     C*                                                                        V
     CSR         $$GEOC    IFEQ '1'                                            V
     CSR                   EXSR C73013                                         V
     C*                    ---- ------                                         V
     CSR         $$ITM     IFNE *ZEROS                                         V
     CSR                   MOVE '1'       $1ITM   1                            V
     CSR                   END                                                 V
     C*                                                                        V
     CSR                   ELSE                                                V
     CSR                   CLEAR$XTA1                                          V
     CSR                   CLEAR$XTA2                                          V
     CSR                   CLEAR$XTA3                                          V
     CSR                   CLEAR$XTA4                                          V
     CSR                   CLEAR$XTA5                                          V
     C*                                                                         
     C*    Read Tax Area Master using tax area and item number                  
     C*                                                                         
     C****       TAKY01    CHAINI4008                81                         
     C           TAKY01    SETLLI4008                                           
     C*                                                                         
     C           TAKY11    READEI4008                  9981                     
     CSR                   MOVE *BLANKS   $1ITM                                 
     CSR                   MOVE *BLANKS   $1TAXA                                
B2   CSR         *IN81     IFEQ '0'                                             
     CSR                   MOVELTATAXA    $1TAXA 30                             
     CSR                   SETON                     79                         
B3   CSR         $$ITM     IFNE *ZEROS                                          
     CSR                   MOVE '1'       $1ITM   1                             
E3   CSR                   ENDIF                                                
     C*                                                                         
X2   CSR                   ELSE                                                 
     C*                                                                         
     C*    Read Tax Area Master using tax area only                             
     C*                                                                         
     CSR         SDTXA1    SETLLI4008                    82                     
B3   CSR         *IN82     IFEQ '1'                                             
     CSR         SDTXA1    READEI4008                    82                     
     CSR         *IN82     DOWEQ'0'                                             
     CSR         SDTRDJ    IFGE TAEFTJ                                          
     CSR         SDTRDJ    ANDLETAEFDJ                                          
     CSR                   SETON                     82                         
     CSR                   MOVELTATAXA    $1TAXA 30                             
     CSR                   ELSE                                                 
     CSR         SDTXA1    READEI4008                    82                     
     CSR                   ENDIF                                                
     CSR                   ENDDO                                                
     CSR                   ENDIF                                                
E2   CSR                   ENDIF                                                
     C*                                                                        V
     CSR                   END                                                 V
     C*                                                                        V
B2   CSR         #XTXTX    IFEQ 'Y'                                             
     CSR         TATXR1    ADD  TATXR2    $WK63  150                            
     CSR                   Z-ADDTATXR2    $WKPST 150                            
B3   CSR         TATT3     IFEQ *BLANK                                          
     CSR                   ADD  TATXR3    $WKPST                                
     CSR                   ADD  TATXR3    $WK63                                 
E3   CSR                   ENDIF                                                
B3   CSR         TATT4     IFEQ *BLANK                                          
     CSR                   ADD  TATXR4    $WKPST                                
     CSR                   ADD  TATXR4    $WK63                                 
E3   CSR                   ENDIF                                                
B3   CSR         TATT5     IFEQ *BLANK                                          
     CSR                   ADD  TATXR5    $WKPST                                
     CSR                   ADD  TATXR5    $WK63                                 
E3   CSR                   ENDIF                                                
     CSR         TATXR1    MULT $WKPST    $WKTXT 150                            
     CSR                   DIV  100000    $WKTXT                                
     CSR         $WK63     ADD  $WKTXT    $SVTAX                                
E2   CSR                   ENDIF                                                
     CSR                   Z-ADD$SVTAX    $$TTAX 150                            
E1   CSR                   ENDIF                                                
     C*----------------------------------------------------------------         
     C*                                                                         
     C*    Check for multiple Tax Areas and Rates.                              
     C*                                                                         
     C*    If taxable amount flag has changed,                                  
     C*    flag the multiple tax flag to print ** N/A **                        
     C*                                                                         
B1   CSR         SDTAX1    IFNE 'N'                                             
B2   CSR         $SVTX     IFEQ *BLANKS                                         
     CSR                   MOVE SDTAX1    $SVTX   1                             
E2   CSR                   ENDIF                                                
     C*                                                                         
B2   CSR         $SVTX     IFNE SDTAX1                                          
     CSR                   MOVE '2'       $MLTTX                                
     CSR                   MOVE SDTAX1    $SVTX                                 
E2   CSR                   ENDIF                                                
     C*                                                                         
     C*    If taxable area has changed,                                         
     C*    flag the multiple tax flag to print ** N/A **                        
     C*                                                                         
B2   CSR         $SVTXA    IFEQ *BLANKS                                         
     CSR                   MOVE SDTXA1    $SVTXA 10                             
E2   CSR                   ENDIF                                                
     C*                                                                         
B2   CSR         $SVTXA    IFNE SDTXA1                                          
     CSR                   MOVE '2'       $MLTTX                                
     CSR                   MOVE SDTXA1    $SVTXA                                
E2   CSR                   ENDIF                                                
     C*                                                                         
     C*    If taxable rate has changed,                                         
     C*    flag the multiple tax flag to print ** N/A **                        
     C*                                                                         
B2   CSR         $STTAX    IFEQ *ZEROS                                          
     CSR                   Z-ADD$$TTAX    $STTAX 150                            
E2   CSR                   ENDIF                                                
     C*                                                                         
B2   CSR         $$TTAX    IFNE $STTAX                                          
     CSR                   MOVE '2'       $MLTTX                                
     CSR                   Z-ADD$$TTAX    $STTAX                                
E2   CSR                   ENDIF                                                
E1   CSR                   ENDIF                                                
     C*                                                                         
     C*    If used Item Number to chain to F4008 to get Tax Rate                
     C*    check Item Number to see if changed.                                 
     C*                                                                         
B1   CSR         $SVITM    IFEQ *ZERO                                           
     CSR         *IN79     ANDEQ'1'                                             
     CSR                   Z-ADDTAITM     $SVITM  80                            
E1   CSR                   ENDIF                                                
     C*                                                                         
B1   CSR         $SVITM    IFNE *ZERO                                           
B2   CSR         $SVTX     IFEQ SDTAX1                                          
     CSR         $SVTXA    ANDEQSDTXA1                                          
     CSR         $SVITM    ANDNETAITM                                           
     CSR                   MOVE '2'       $MLTTX                                
     CSR                   MOVE TAITM     $SVITM                                
E2   CSR                   ENDIF                                                
E1   CSR                   ENDIF                                                
     C*                                                                         
     CSR                   SETOF                     79                         
     C*----------------------------------------------------------------         
     C*                                                                         
     C*    Process Tax Summary based on the following:                          
     C*    - The total of all tax rates is not zero                             
     C*    - The tax processing option is not blank                             
     C*    - The item taxable field is not blank                                
     C*                                                                         
     CSR                   SETOF                     85                         
B1   CSR         $$TTAX    IFNE *ZEROS                                          
     CSR         $@VAT     ANDNE*BLANKS                                         
     CSR         SDTAX1    ANDNE' '                                             
     C*----------------------------------------------------------------         
     C*                                                                         
     C*    Tax Summary - by Tax Group                                           
     C*                                                                         
B2   CSR         $@VAT     IFEQ '1'                                             
     C*                                                                         
     C*    Set array index to correct value based on taxable field.             
     C*                                                                         
B3   CSR         SDTAX1    IFEQ 'Y'                                             
     CSR                   Z-ADD1         #R                                    
E3   CSR                   ENDIF                                                
B3   CSR         SDTAX1    IFEQ 'N'                                             
     CSR                   Z-ADD2         #R                                    
E3   CSR                   ENDIF                                                
B3   CSR         SDTAX1    IFEQ '3'                                             
     CSR                   Z-ADD3         #R                                    
E3   CSR                   ENDIF                                                
B3   CSR         SDTAX1    IFEQ '4'                                             
     CSR                   Z-ADD4         #R                                    
E3   CSR                   ENDIF                                                
B3   CSR         SDTAX1    IFEQ '5'                                             
     CSR                   Z-ADD5         #R                                    
E3   CSR                   ENDIF                                                
B3   CSR         SDTAX1    IFEQ '6'                                             
     CSR                   Z-ADD6         #R                                    
E3   CSR                   ENDIF                                                
B3   CSR         SDTAX1    IFEQ '7'                                             
     CSR                   Z-ADD7         #R                                    
E3   CSR                   ENDIF                                                
B3   CSR         SDTAX1    IFEQ '8'                                             
     CSR                   Z-ADD8         #R                                    
E3   CSR                   ENDIF                                                
     C*                                                                         
B3   CSR         SDTXA1    IFNE *BLANKS                                         
     C*                                                                         
     C*    Look for Tax Area already existing in array.                         
     C*                                                                         
     CSR                   MOVELSDTXA1    $$TXA1 30                             
     CSR                   Z-ADD1         #Q                                    
     CSR         $$TXA1    LOKUP@TD,#Q                   85                     
B4   CSR         *IN85     IFEQ '0'                                             
     C*                                                                         
     C*    Load arrays for Group Summary output                                 
     C*                                                                         
     C*    Load in tax table summary arrays the tax type ($ or %)               
     C*                                                                         
     CSR                   MOVELTAFVTY    @TF,#R                                
     C*----------------------------------------------------------------         
     C*                                                                         
     C*    Load in tax table summary arrays the taxable amount                  
     C*    for the group.                                                       
     C*                                                                         
     CSR                   ADD  #XATXA    @TM,#R                                
B5   CSR         #XATXA    IFEQ 0                                               
     CSR                   SUB  1         #R                                    
     CSR                   GOTO END10C                                          
X5   CSR                   ELSE                                                 
     CSR                   MOVE 'Y'       $TAX                                  
E5   CSR                   ENDIF                                                
     C*----------------------------------------------------------------         
     C*                                                                         
     C*    Load in tax table summary arrays the tax rate the group              
     C*                                                                         
     CSR                   Z-ADD$$TTAX    @TR,#R                                
     C*----------------------------------------------------------------         
     C*                                                                         
     C*    Load in tax table summary arrays - tax amount for the group          
     C*                                                                         
B5   CSR         $@CNV     IFEQ '1'                                             
     C*                                                                         
B6   CSR         $@CURR    IFEQ '1'                                             
     CSR         $#GRX     DIV  #@FDO     $WK299                                
X6   CSR                   ELSE                                                 
     CSR         $#GRX     DIV  #@CDO     $WK299                                
E6   CSR                   ENDIF                                                
     C*                                                                         
E5   CSR                   ENDIF                                                
     C*                                                                         
B5   CSR         $@CNV     IFNE '1'                                             
     CSR         $#GRX     DIV  #@STA1    $WK299                                
E5   CSR                   ENDIF                                                
     C*                                                                         
     C*    Load in tax table summary arrays the tax description                 
     C*                                                                         
     CSR                   ADD  $WK299    @TT,#R                                
B5   CSR         SDTAX1    IFEQ 'N'                                             
     CSR                   MOVELVTX074    @TD,#R                                
X5   CSR                   ELSE                                                 
B6   CSR         SDTAX1    IFEQ 'Y'                                             
     CSR                   MOVELVTX077    @TD,#R                                
X6   CSR                   ELSE                                                 
     CSR                   MOVEL$1TAXA    @TD,#R                                
E6   CSR                   ENDIF                                                
E5   CSR                   ENDIF                                                
E4   CSR                   ENDIF                                                
E3   CSR                   ENDIF                                                
E2   CSR                   ENDIF                                                
     C*----------------------------------------------------------------         
     C*                                                                         
     C*    Tax Summary - by Tax Area or Authority                               
     C*                                                                         
B2   CSR         SDTXA1    IFNE *BLANKS                                         
B3   CSR         $@VAT     IFEQ '2'                                             
     CSR         $@VAT     OREQ '3'                                             
     C*                                                                         
     C*    Look for Tax Area already existing in array.                         
     C*                                                                         
     CSR                   MOVELSDTXA1    $$TXA1 30                             
     CSR                   Z-ADD1         #Q                                    
     CSR         $$TXA1    LOKUP@TD,#Q                   85                     
     C*----------------------------------------------------------------         
     C*                                                                         
     C*    If tax area found, find the correct tax percent                      
     C*                                                                         
B4   CSR         *IN85     IFEQ '1'                                             
     CSR         @IT,#Q    ANDNE$$ITM                                           
     CSR                   Z-ADD*ZEROS    ##ITM  150                            
B5   CSR         $1ITM     IFEQ '1'                                             
     CSR                   Z-ADD$$ITM     ##ITM                                 
E5   CSR                   ENDIF                                                
     CSR         ##ITM     LOKUP@IT,#Q                   85                     
B5   CSR         $$TXA1    IFNE @TA,#Q                                          
     CSR                   SETOF                         85                     
E5   CSR                   ENDIF                                                
E4   CSR                   ENDIF                                                
     C*----------------------------------------------------------------         
     C*                                                                         
     C*    If Tax Area found, add to Taxable Amount and Amount of Tax.          
     C*                                                                         
B4   CSR         *IN85     IFEQ '1'                                             
     CSR                   Z-ADD#Q        #R                                    
     C*----------------------------------------------------------------         
     C*                                                                         
     C*    Load in tax table summary arrays the taxable amount                  
     C*    for the group.                                                       
     C*                                                                         
     CSR                   ADD  #XATXA    @TM,#R                                
B5   CSR         #XATXA    IFEQ 0                                               
     CSR                   SUB  1         #R                                    
     CSR                   GOTO END10C                                          
X5   CSR                   ELSE                                                 
     CSR                   MOVE 'Y'       $TAX                                  
E5   CSR                   ENDIF                                                
     C*----------------------------------------------------------------         
     C*                                                                         
     C*    Load in tax table summary arrays - tax amount for the group          
     C*                                                                         
B5   CSR         $@CNV     IFEQ '1'                                             
     C*                                                                         
B6   CSR         $@CURR    IFEQ '1'                                             
     CSR         $#GRX     DIV  #@FDO     $WK299 299                            
X6   CSR                   ELSE                                                 
     CSR         $#GRX     DIV  #@CDO     $WK299                                
E6   CSR                   ENDIF                                                
     C*                                                                         
E5   CSR                   ENDIF                                                
     C*                                                                         
B5   CSR         $@CNV     IFNE '1'                                             
     CSR         $#GRX     DIV  #@STA1    $WK299                                
E5   CSR                   ENDIF                                                
     C*                                                                         
     CSR                   ADD  $WK299    @TT,#R                                
     C*----------------------------------------------------------------         
     C*                                                                         
     C*    Tax Summary - by Tax Authority                                       
     C*                                                                         
B5   CSR         $@VAT     IFEQ '3'                                             
     C**SR       #XTXTX    ANDNE'Y'                                             
     C*                                                                         
     C*    Move current index to save index for tax amount                      
     C*    calculations.                                                        
     C*                                                                         
     CSR                   Z-ADD#R        #S                                    
     C*----------------------------------------------------------------         
     C*                                                                         
     C*    Calculate Taxable Amount for Tax Rate 1                              
     C*                                                                         
B6   CSR         TATXR1    IFNE *ZERO                                           
     CSR                   MOVE '1'       $TXR1   1                             
     CSR                   ADD  1         #R                                    
     CSR                   EXSR S010C2                                          
     C*                    ---- ------                                          
     CSR                   MOVE ' '       $TXR1                                 
E6   CSR                   ENDIF                                                
     C*                                                                         
     C*    Calculate Taxable Amount for Tax Rate 2                              
     C*                                                                         
B6   CSR         TATXR2    IFNE *ZERO                                           
     CSR                   MOVE '1'       $TXR2   1                             
     CSR                   ADD  1         #R                                    
     CSR                   EXSR S010C2                                          
     C*                    ---- ------                                          
     CSR                   MOVE ' '       $TXR2                                 
E6   CSR                   ENDIF                                                
     C*                                                                         
     C*    Calculate Taxable Amount for Tax Rate 3                              
     C*                                                                         
B6   CSR         TATXR3    IFNE *ZERO                                           
     CSR         TATT3     ANDEQ*BLANK                                          
     CSR                   ADD  1         #R                                    
     CSR                   EXSR S010C2                                          
     C*                    ---- ------                                          
E6   CSR                   ENDIF                                                
     C*                                                                         
     C*    Calculate Taxable Amount for Tax Rate 4                              
     C*                                                                         
B6   CSR         TATXR4    IFNE *ZERO                                           
     CSR         TATT4     ANDEQ*BLANK                                          
     CSR                   ADD  1         #R                                    
     CSR                   EXSR S010C2                                          
     C*                    ---- ------                                          
E6   CSR                   ENDIF                                                
     C*                                                                         
     C*    Calculate Taxable Amount for Tax Rate 5                              
     C*                                                                         
B6   CSR         TATXR5    IFNE *ZERO                                           
     CSR         TATT5     ANDEQ*BLANK                                          
     CSR                   ADD  1         #R                                    
     CSR                   EXSR S010C2                                          
     C*                    ---- ------                                          
E6   CSR                   ENDIF                                                
     C*                                                                         
E5   CSR                   ENDIF                                                
     C*                                                                         
     C*----------------------------------------------------------------         
     C*                                                                         
     C*    If Tax Area does not already exist in array,                         
     C*    write record to all tax arrays.                                      
     C*                                                                         
X4   CSR                   ELSE                                                 
     C*                                                                         
     C*    Reset array index with saved index.                                  
     C*                                                                         
B5   CSR         $SVTXA    IFEQ *BLANKS                                         
     CSR                   Z-ADD1         #R                                    
     C*                                                                         
X5   CSR                   ELSE                                                 
     CSR                   MOVEL*BLANKS   $$TXA1 30                             
     CSR                   Z-ADD1         #R                                    
     CSR         $$TXA1    LOKUP@TD,#R                   85                     
E5   CSR                   ENDIF                                                
     C*                                                                         
B5   CSR         #R        IFEQ 0                                               
     CSR                   Z-ADD1         #R                                    
E5   CSR                   ENDIF                                                
     C*                                                                         
     C*    Prevent overwriting of array elements.                               
     C*                                                                         
B5   CSR         @TD,#R    IFNE *BLANKS                                         
     CSR                   ADD  1         #R                                    
E5   CSR                   ENDIF                                                
     C*----------------------------------------------------------------         
     C*                                                                         
     C*    Load arrays for Group Summary output                                 
     C*                                                                         
     C*    Load in tax table summary arrays the tax type ($ or %)               
     C*                                                                         
     CSR                   MOVELTAFVTY    @TF,#R                                
     C*----------------------------------------------------------------         
     C*                                                                         
     C*    Load in tax table summary arrays the taxable amount                  
     C*    for the group.                                                       
     C*                                                                         
     CSR                   ADD  #XATXA    @TM,#R                                
B5   CSR         #XATXA    IFEQ 0                                               
     CSR                   SUB  1         #R                                    
     CSR                   GOTO END10C                                          
X5   CSR                   ELSE                                                 
     CSR                   MOVE 'Y'       $TAX                                  
E5   CSR                   ENDIF                                                
     C*----------------------------------------------------------------         
     C*                                                                         
     C*    Load in tax table summary arrays the tax rate the group              
     C*                                                                         
     CSR                   Z-ADD$$TTAX    @TR,#R                                
     C*----------------------------------------------------------------         
     C*                                                                         
     C*    Load in tax table summary arrays the tax item for the group          
     C*                                                                         
B5   CSR         $1ITM     IFEQ '1'                                             
     CSR                   Z-ADD$$ITM     @IT,#R                                
E5   CSR                   ENDIF                                                
     C*----------------------------------------------------------------         
     C*                                                                         
     C*    Load in tax table summary arrays the tax area for the group          
     C*                                                                         
     CSR                   MOVELSDTXA1    @TA,#R                                
     C*----------------------------------------------------------------         
     C*                                                                         
     C*    Load in tax table summary arrays - tax amount for the group          
     C*                                                                         
B5   CSR         $@CNV     IFEQ '1'                                             
     C*                                                                         
B6   CSR         $@CURR    IFEQ '1'                                             
     CSR         $#GRX     DIV  #@FDO     $WK299                                
X6   CSR                   ELSE                                                 
     CSR         $#GRX     DIV  #@CDO     $WK299                                
E6   CSR                   ENDIF                                                
     C*                                                                         
E5   CSR                   ENDIF                                                
     C*                                                                         
B5   CSR         $@CNV     IFNE '1'                                             
     CSR         $#GRX     DIV  #@STA1    $WK299                                
E5   CSR                   ENDIF                                                
     C*                                                                         
     CSR                   ADD  $WK299    @TT,#R                                
     C*----------------------------------------------------------------         
     C*                                                                         
     C*    Load in tax table summary arrays the tax description                 
     C*                                                                         
B5   CSR         $@VAT     IFEQ '2'                                             
     CSR         $@VAT     OREQ '3'                                             
     CSR                   MOVELSDTXA1    @TD,#R                                
X5   CSR                   ELSE                                                 
B6   CSR         SDTAX1    IFEQ 'N'                                             
     CSR                   MOVELVTX074    @TD,#R                                
X6   CSR                   ELSE                                                 
B7   CSR         SDTAX1    IFEQ 'Y'                                             
     CSR                   MOVELVTX077    @TD,#R                                
X7   CSR                   ELSE                                                 
     CSR                   MOVEL$1TAXA    @TD,#R                                
E7   CSR                   ENDIF                                                
E6   CSR                   ENDIF                                                
E5   CSR                   ENDIF                                                
     C*----------------------------------------------------------------         
     C*                                                                         
     C*    Tax Summary - by Tax Authority                                       
     C*                                                                         
B5   CSR         $@VAT     IFEQ '3'                                             
     C*                                                                         
     C*    Move current index to save index for tax amount                      
     C*    calculations.                                                        
     C*                                                                         
     CSR                   Z-ADD#R        #S                                    
     CSR                   MOVE *ZEROS    $LNCNT  10                            
B6   C**SR       #XTXTX    IFNE 'Y'                                             
     C*----------------------------------------------------------------         
     C*                                                                         
     C*    Tax Authority 1                                                      
     C*                                                                         
     C*    Retrieve Tax Rate and Description.                                   
     C*                                                                         
B7   CSR         TATXR1    IFNE *ZERO                                           
     CSR                   MOVE '1'       $TXR1                                 
     CSR                   ADD  1         #R                                    
     CSR                   ADD  1         $LNCNT  10                            
     CSR                   MOVE TATXR1    $$TXR1  70                            
     CSR                   MOVEA$$TXR1    @TR,#R                                
     CSR                   MOVELSDTXA1    @TA,#R                                
     C*                                                                         
     C*    Load in tax table summary arrays the tax item for the group          
     C*                                                                         
B8   CSR         $1ITM     IFEQ '1'                                             
     CSR                   Z-ADD$$ITM     @IT,#R                                
E8   CSR                   ENDIF                                                
     C*                                                                        V
     C*    If Vertex Geocode entered, process in Vertex mode                   V
     C*                                                                        V
     CSR         $$GEOC    IFEQ '1'                                            V
     CSR                   MOVEA$XTA1     @TD,#R                               V
     CSR                   ELSE                                                V
     C*                                                                        V
     CSR                   Z-ADDTATA1     ABAN8                                 
     CSR                   MOVEL'A71     '@@FMT                                 
     CSR                   MOVE 'K'       @@ACCS                                
     CSR                   MOVEL'CHAIN   '@@OPER                                
     CSR                   MOVE 'N'       @@LOCK                                
     CSR                   MOVE 'N'       @@CHGR                                
     CSR                   MOVEL'ABKY01  '@@KLST                                
     CSR                   Z-ADD1         @@KNUM                                
     CSR                   CALL 'XF0101'               81                       
     C*                    ---- --------                                        
     CSR                   PARM           PS@@1                                 
     CSR                   PARM           I0101                                 
     C*                                                                         
B8   CSR         *IN81     IFEQ '1'                                             
     CSR         @@IOR     ORNE *BLANK                                          
     CSR                   MOVE *BLANKS   @TD,#R                                
X8   CSR                   ELSE                                                 
     CSR                   CLEAR@UA                                             
     CSR                   MOVEAABALPH    @UA                                   
     CSR                   Z-ADD30        #OUTLG                                
     CSR                   EXSR C9822                                           
     C*                    ---- -----                                           
     CSR                   MOVEA@UB       @TD,#R                                
E8   CSR                   ENDIF                                                
     C*                                                                        V
     CSR                   END                                                 V
     C*                                                                         
     C*    Calculate Taxable Amount                                             
     C*                                                                         
     CSR                   EXSR S010C2                                          
     C*                    ---- ------                                          
     CSR                   MOVE ' '       $TXR1                                 
     CSR         $$GEOC    IFEQ '1'                                            V
     CSR         #XAMT1    DIV  #@AMT1    @TT,#R                               V
     CSR                   END                                                 V
E7   CSR                   ENDIF                                                
     C*----------------------------------------------------------------         
     C*                                                                         
     C*    Tax Authority 2                                                      
     C*                                                                         
     C*    Retrieve Tax Rate and Description.                                   
     C*                                                                         
B7   CSR         TATXR2    IFNE *ZERO                                           
     CSR                   MOVE '1'       $TXR2   1                             
     CSR                   ADD  1         #R                                    
     CSR                   ADD  1         $LNCNT  10                            
     CSR                   MOVE TATXR2    $$TXR2  70                            
     CSR                   MOVEA$$TXR2    @TR,#R                                
     CSR                   MOVELSDTXA1    @TA,#R                                
     C*                                                                         
     C*    Load in tax table summary arrays the tax item for the group          
     C*                                                                         
B8   CSR         $1ITM     IFEQ '1'                                             
     CSR                   Z-ADD$$ITM     @IT,#R                                
E8   CSR                   ENDIF                                                
     C*                                                                        V
     C*    If Vertex Geocode entered, process in Vertex mode                   V
     C*                                                                        V
     CSR         $$GEOC    IFEQ '1'                                            V
     CSR                   MOVEA$XTA2     @TD,#R                               V
     CSR                   ELSE                                                V
     C*                                                                         
     CSR                   Z-ADDTATA2     ABAN8                                 
     CSR                   MOVEL'A71     '@@FMT                                 
     CSR                   MOVE 'K'       @@ACCS                                
     CSR                   MOVEL'CHAIN   '@@OPER                                
     CSR                   MOVE 'N'       @@LOCK                                
     CSR                   MOVE 'N'       @@CHGR                                
     CSR                   MOVEL'ABKY01  '@@KLST                                
     CSR                   Z-ADD1         @@KNUM                                
     CSR                   CALL 'XF0101'               81                       
     C*                    ---- --------                                        
     CSR                   PARM           PS@@1                                 
     CSR                   PARM           I0101                                 
     C*                                                                         
B8   CSR         *IN81     IFEQ '1'                                             
     CSR         @@IOR     ORNE *BLANK                                          
     CSR                   MOVE *BLANKS   @TD,#R                                
X8   CSR                   ELSE                                                 
     CSR                   CLEAR@UA                                             
     CSR                   MOVEAABALPH    @UA                                   
     CSR                   Z-ADD30        #OUTLG                                
     CSR                   EXSR C9822                                           
     C*                    ---- -----                                           
     CSR                   MOVEA@UB       @TD,#R                                
E8   CSR                   ENDIF                                                
     C*                                                                        V
     CSR                   END                                                 V
     C*                                                                         
     C*    Calculate Taxable Amount                                             
     C*                                                                         
     CSR                   EXSR S010C2                                          
     C*                    ---- ------                                          
     CSR         $$GEOC    IFEQ '1'                                            V
     CSR         #XAMT2    DIV  #@AMT2    @TT,#R                               V
     CSR                   END                                                 V
     CSR                   MOVE ' '       $TXR2                                 
E7   CSR                   ENDIF                                                
     C*----------------------------------------------------------------         
     C*                                                                         
     C*    Tax Authority 3                                                      
     C*                                                                         
     C*    Retrieve Tax Rate and Description.                                   
     C*                                                                         
B7   CSR         TATXR3    IFNE *ZERO                                           
     CSR         TATT3     ANDEQ*BLANK                                          
     CSR                   ADD  1         #R                                    
     CSR                   ADD  1         $LNCNT  10                            
     CSR                   MOVE TATXR3    $$TXR3  70                            
     CSR                   MOVEA$$TXR3    @TR,#R                                
     CSR                   MOVELSDTXA1    @TA,#R                                
     C*                                                                         
     C*    Load in tax table summary arrays the tax item for the group          
     C*                                                                         
B8   CSR         $1ITM     IFEQ '1'                                             
     CSR                   Z-ADD$$ITM     @IT,#R                                
E8   CSR                   ENDIF                                                
     C*                                                                        V
     C*    If Vertex Geocode entered, process in Vertex mode                   V
     C*                                                                        V
     CSR         $$GEOC    IFEQ '1'                                            V
     CSR                   MOVEA$XTA3     @TD,#R                               V
     CSR                   ELSE                                                V
     CSR                   Z-ADDTATA3     ABAN8                                 
     CSR                   MOVEL'A71     '@@FMT                                 
     CSR                   MOVE 'K'       @@ACCS                                
     CSR                   MOVEL'CHAIN   '@@OPER                                
     CSR                   MOVE 'N'       @@LOCK                                
     CSR                   MOVE 'N'       @@CHGR                                
     CSR                   MOVEL'ABKY01  '@@KLST                                
     CSR                   Z-ADD1         @@KNUM                                
     CSR                   CALL 'XF0101'               81                       
     C*                    ---- --------                                        
     CSR                   PARM           PS@@1                                 
     CSR                   PARM           I0101                                 
     C*                                                                         
B8   CSR         *IN81     IFEQ '1'                                             
     CSR         @@IOR     ORNE *BLANK                                          
     CSR                   MOVE *BLANKS   @TD,#R                                
X8   CSR                   ELSE                                                 
     CSR                   CLEAR@UA                                             
     CSR                   MOVEAABALPH    @UA                                   
     CSR                   Z-ADD30        #OUTLG                                
     CSR                   EXSR C9822                                           
     C*                    ---- -----                                           
     CSR                   MOVEA@UB       @TD,#R                                
E8   CSR                   ENDIF                                                
     C*                                                                        V
     CSR                   END                                                 V
     C*                                                                         
     C*    Calculate Taxable Amount                                             
     C*                                                                         
     CSR                   EXSR S010C2                                          
     C*                    ---- ------                                          
     CSR         $$GEOC    IFEQ '1'                                            V
     CSR         #XAMT3    DIV  #@AMT3    @TT,#R                               V
     CSR                   END                                                 V
E7   CSR                   ENDIF                                                
     C*----------------------------------------------------------------         
     C*                                                                         
     C*    Tax Authority 4                                                      
     C*                                                                         
     C*    Retrieve Tax Rate and Description.                                   
     C*                                                                         
B7   CSR         TATXR4    IFNE *ZERO                                           
     CSR         TATT4     ANDEQ*BLANK                                          
     CSR                   ADD  1         #R                                    
     CSR                   ADD  1         $LNCNT  10                            
     CSR                   MOVE TATXR4    $$TXR4  70                            
     CSR                   MOVEA$$TXR4    @TR,#R                                
     CSR                   MOVELSDTXA1    @TA,#R                                
     C*                                                                         
     C*    Load in tax table summary arrays the tax item for the group          
     C*                                                                         
B8   CSR         $1ITM     IFEQ '1'                                             
     CSR                   Z-ADD$$ITM     @IT,#R                                
E8   CSR                   ENDIF                                                
     C*                                                                        V
     C*    If Vertex Geocode entered, process in Vertex mode                   V
     C*                                                                        V
     CSR         $$GEOC    IFEQ '1'                                            V
     CSR                   MOVEA$XTA4     @TD,#R                               V
     CSR                   ELSE                                                V
     CSR                   Z-ADDTATA4     ABAN8                                 
     CSR                   MOVEL'A71     '@@FMT                                 
     CSR                   MOVE 'K'       @@ACCS                                
     CSR                   MOVEL'CHAIN   '@@OPER                                
     CSR                   MOVE 'N'       @@LOCK                                
     CSR                   MOVE 'N'       @@CHGR                                
     CSR                   MOVEL'ABKY01  '@@KLST                                
     CSR                   Z-ADD1         @@KNUM                                
     CSR                   CALL 'XF0101'               81                       
     C*                    ---- --------                                        
     CSR                   PARM           PS@@1                                 
     CSR                   PARM           I0101                                 
     C*                                                                         
B8   CSR         *IN81     IFEQ '1'                                             
     CSR         @@IOR     ORNE *BLANK                                          
     CSR                   MOVE *BLANKS   @TD,#R                                
X8   CSR                   ELSE                                                 
     CSR                   CLEAR@UA                                             
     CSR                   MOVEAABALPH    @UA                                   
     CSR                   Z-ADD30        #OUTLG                                
     CSR                   EXSR C9822                                           
     C*                    ---- -----                                           
     CSR                   MOVEA@UB       @TD,#R                                
E8   CSR                   ENDIF                                                
     C*                                                                        V
     CSR                   END                                                 V
     C*                                                                         
     C*    Calculate Taxable Amount                                             
     C*                                                                         
     CSR                   EXSR S010C2                                          
     C*                    ---- ------                                          
     CSR         $$GEOC    IFEQ '1'                        GeoCode             V
     CSR         #XAMT4    DIV  #@AMT4    @TT,#R                               V
     CSR                   END                             $$GEOC = 1          V
E7   CSR                   ENDIF                                                
     C*----------------------------------------------------------------         
     C*                                                                         
     C*    Tax Authority 5                                                      
     C*                                                                         
     C*    Retrieve Tax Rate and Description.                                   
     C*                                                                         
B7   CSR         TATXR5    IFNE *ZERO                                           
     CSR         TATT5     ANDEQ*BLANK                                          
     CSR                   ADD  1         #R                                    
     CSR                   ADD  1         $LNCNT  10                            
     CSR                   MOVE TATXR5    $$TXR5  70                            
     CSR                   MOVEA$$TXR5    @TR,#R                                
     CSR                   MOVELSDTXA1    @TA,#R                                
     C*                                                                         
     C*    Load in tax table summary arrays the tax item for the group          
     C*                                                                         
B8   CSR         $1ITM     IFEQ '1'                                             
     CSR                   Z-ADD$$ITM     @IT,#R                                
E8   CSR                   ENDIF                                                
     C*                                                                        V
     C*    If Vertex Geocode entered, process in Vertex mode                   V
     C*                                                                        V
     CSR         $$GEOC    IFEQ '1'                        GeoCode             V
     CSR                   MOVEA$XTA5     @TD,#R                               V
     CSR                   ELSE                                                V
     CSR                   Z-ADDTATA5     ABAN8                                 
     CSR                   MOVEL'A71     '@@FMT                                 
     CSR                   MOVE 'K'       @@ACCS                                
     CSR                   MOVEL'CHAIN   '@@OPER                                
     CSR                   MOVE 'N'       @@LOCK                                
     CSR                   MOVE 'N'       @@CHGR                                
     CSR                   MOVEL'ABKY01  '@@KLST                                
     CSR                   Z-ADD1         @@KNUM                                
     CSR                   CALL 'XF0101'               81                       
     C*                    ---- --------                                        
     CSR                   PARM           PS@@1                                 
     CSR                   PARM           I0101                                 
     C*                                                                         
B8   CSR         *IN81     IFEQ '1'                                             
     CSR         @@IOR     ORNE *BLANK                                          
     CSR                   MOVE *BLANKS   @TD,#R                                
X8   CSR                   ELSE                                                 
     CSR                   CLEAR@UA                                             
     CSR                   MOVEAABALPH    @UA                                   
     CSR                   Z-ADD30        #OUTLG                                
     CSR                   EXSR C9822                                           
     C*                    ---- -----                                           
     CSR                   MOVEA@UB       @TD,#R                                
E8   CSR                   ENDIF                                                
     C*                                                                        V
     CSR                   END                             $$GEOC = 1          V
     C*                                                                         
     C*    Calculate Taxable Amount                                             
     C*                                                                         
     CSR                   EXSR S010C2                                          
     C*                    ---- ------                                          
     CSR         $$GEOC    IFEQ '1'                        GeoCode             V
     CSR                   Z-ADD*ZEROS    @TT,#R                               V
     CSR                   END                             $$GEOC = 1          V
E7   CSR                   ENDIF                                                
E6   C**SR                 ENDIF                                                
     C*----------------------------------------------------------------         
     C*                                                                         
     CSR                   Z-ADD$LNCNT    @AH,#Z                                
     CSR                   ADD  1         #Z                                    
E5   CSR                   ENDIF                                                
     C*                                                                         
E4   CSR                   ENDIF                                                
     C*                                                                         
E3   CSR                   ENDIF                                                
     C*                                                                         
E2   CSR                   ENDIF                                                
     C*                                                                         
     C*                                                                        V
     C*    If Vertex GeoCode, process Multi Intrastate Taxes for Vertex        V
     C*                                                                        V
     CSR         $$GEOC    IFEQ '1'                        GeoCode             V
     CSR                   EXSR C73012                                         V
     C*                    ---- ------                                         V
     CSR                   END                             $$GEOC = 1          V
     C*                                                                        V
E1   CSR                   ENDIF                                                
     C*----------------------------------------------------------------         
     CSR                   Z-ADD0         $#GRX                                 
     C*                                                                         
     CSR         END10C    ENDSR                                                
SER  C****************************************************************          
SER  C*                                                                         
SER  C*    SUBROUTINE S010CC - Perform Tax Calculations                         
SER  C*    --------------------------------------------                         
SER  C*                                                                         
SER  CSR         S010CC    BEGSR                                                
SER  C*          ------    -----                                                
SER  C*                                                                         
SER  C*    Move extended amount to work field                                   
SER  C*                                                                         
SER  C*    If extended backorders requested, read item master                   
SER  C*                                                                         
SER  CSR         $@EXBO    IFEQ '1'                                             
SER  CSR         SDSOBK    ANDNE0                                               
SER  C*                                                                         
SER  C*    Read Item Master File                                                
SER  C*                                                                         
SER  CSR                   MOVE *BLANKS   PS@@                                  
SER  CSR                   MOVELSDITM     KY@@                                  
SER  CSR                   CALL 'XS4101LA'                                      
SER  C*                    ---- ----------                                      
SER  CSR                   PARM           PS@@                                  
SER  CSR                   PARM           DS4101                                
SER  C*                                                                         
SER  CSR         SDSOQS    ADD  SDSOBK    $WKQTY 150                            
SER  C*                                                                         
SER  C*    Convert quantity ordered to other units of measure                   
SER  C*                                                                         
SER  CSR         $WKQTY    DIV  #@SOBK    #QTY      H                           
SER  CSR                   MOVE SDUOM     #UOM                                  
SER  CSR                   MOVE SDUOM4    #UOM1                                 
SER  CSR                   MOVELSDMCU     #MCU                                  
SER  CSR                   MOVE LFIVI     #IVI                                  
SER  CSR                   MOVE SDCOMM    #READ                                 
SER  CSR                   MOVE *BLANKS   #OT1Y                                 
SER  CSR                   Z-ADD*ZEROS    #STDP                                 
SER  CSR                   MOVEL*BLANKS   #LOTN                                 
SER  C*                                                                         
SER  CSR                   CALL 'X41002  '             98                       
SER  C*                    ---- ----------                                      
SER  CSR                   PARM           DS4101                                
SER  CSR                   PARM           DS@UOM                                
SER  C*                                                                         
SER  CSR         #ERTST    IFEQ '1'                                             
SER  CSR                   Z-ADD1         #CNVP                                 
SER  CSR                   Z-ADD1         #CNVQ                                 
SER  CSR                   ENDIF                                                
SER  CSR                   ENDIF                                                
SER  C*----------------------------------------------------------------         
SER  C*                                                                         
SER  C*    Display Foreign Amount                                               
SER  C*                                                                         
SER  CSR         $@CNV     IFEQ '1'                                             
SER  CSR         $@CURR    IFEQ '1'                                             
SER  C*                                                                         
SER  C*    If extended backorders requested, calculate extension                
SER  C*                                                                         
SER  CSR         $@EXBO    IFEQ '1'                                             
SER  CSR         SDSOBK    ANDNE0                                               
SER  C*                                                                         
SER  CSR         SDFUP     DIV  #@FUP     $WK299    H                           
SER  CSR                   DIV  #CNVP     $WK299    H                           
SER  CSR                   MULT #PQT      $WK299    H                           
SER  CSR         $WK299    MULT #@FDO     $XAEXP    H                           
SER  CSR                   MOVEL$WK150    #SINBR                                
SER  CSR                   ELSE                                                 
SER  CSR                   Z-ADDSDFEA     $XAEXP 150                            
SER  CSR                   ENDIF                                                
SER  C*                                                                         
SER  C*    Display Domestic Amount                                              
SER  C*                                                                         
SER  CSR                   ELSE                                                 
SER  C*                                                                         
SER  C*    If extended backorders requested, calculate extension                
SER  C*                                                                         
SER  CSR         $@EXBO    IFEQ '1'                                             
SER  CSR         SDSOBK    ANDNE0                                               
SER  C*                                                                         
SER  CSR         SDUPRC    DIV  #@UPRC    $WK299    H                           
SER  CSR                   DIV  #CNVP     $WK299    H                           
SER  CSR                   MULT #PQT      $WK299    H                           
SER  CSR         $WK299    MULT #@AEXP    $XAEXP    H                           
SER  CSR                   ELSE                                                 
SER  CSR                   Z-ADDSDAEXP    $XAEXP 150                            
SER  CSR                   ENDIF                                                
SER  CSR                   ENDIF                                                
SER  C*                                                                         
SER  CSR                   ELSE                                                 
SER  C*                                                                         
SER  C*    No Foreign Currency                                                  
SER  C*                                                                         
SER  C*    If extended backorders requested, calculate extension                
SER  C*                                                                         
SER  CSR         $@EXBO    IFEQ '1'                                             
SER  CSR         SDSOBK    ANDNE0                                               
SER  C*                                                                         
SER  CSR         SDUPRC    DIV  #@UPRC    $WK299    H                           
SER  CSR                   DIV  #CNVP     $WK299    H                           
SER  CSR                   MULT #PQT      $WK299    H                           
SER  CSR         $WK299    MULT #@AEXP    $XAEXP    H                           
SER  CSR                   ELSE                                                 
SER  CSR                   Z-ADDSDAEXP    $XAEXP 150                            
SER  CSR                   ENDIF                                                
SER  CSR                   ENDIF                                                
SER  C*                                                                         
SER  C*----------------------------------------------------------------         
SER  C*                                                                         
SER  C*    If taxable flag is 3-8 use 3-8 for item number                       
SER  C*    If taxable flag is Y use short item number                           
SER  C*    If anything else, use zeros                                          
SER  C*    Item number is passed to tax calculator program                      
SER  C*                                                                         
SER  CSR         SDTAX1    IFGE '3'                                             
SER  CSR         SDTAX1    ANDLE'8'                                             
SER  CSR                   MOVE SDTAX1    $$TX    10                            
SER  CSR                   Z-ADD$$TX      $$ITM   80                            
SER  CSR                   ELSE                                                 
SER  CSR         SDTAX1    IFEQ 'Y'                                             
SER  CSR                   Z-ADDSDITM     $$ITM                                 
SER  CSR                   ELSE                                                 
SER  CSR                   Z-ADD0         $$ITM                                 
SER  CSR                   Z-ADD0         $XAEXP                                
SER  CSR                   ENDIF                                                
SER  CSR                   ENDIF                                                
SER  C*----------------------------------------------------------------         
SER  C*                                                                         
SER  C*    Set up parameters for tax program                                    
SER  C*                                                                         
SER  CSR                   CLEARDS#TAX                                          
SER  CSR                   MOVELSDEXR1    #XEXR1           Tax exempt rsn 1     
SER  CSR                   MOVE SDTXA1    #XTXA1           Tax Area 1           
SER  CSR                   MOVE SDTRDJ    #XTRDJ           Service Date         
SER  CSR                   MOVE SDCO      #XCO             Company              
SER  CSR                   MOVE '1'       #XTXSY           Sys Code flg         
SER  CSR                   Z-ADD$$ITM     #XITM            Item number          
SER  CSR                   Z-ADDSDPQOR    #XQTY            Quantity             
SER  CSR                   Z-ADD$XAEXP    #XNET            Net Amount           
SER  C*                                                                         
SER  CSR         LFCDSC    IFEQ 'Y'                                             
SER  CSR                   MOVE $$DCP     #XDCP            Disc/Terms %         
SER  CSR                   END                                                  
SER  C*                                                                        V
SER  C*    If Vertex Geocode entered, calculate in Vertex mode                  
SER  C*                                                                         
SER  CSR         $1$VTX    IFEQ 'Y'                                            V
SER  CSR                   MOVELSDEXR1    $$EXR9  2                            V
SER  CSR                   MOVELSDTXA1    $$TXA9 10                            V
SER  CSR                   MOVE '0'       $$EDT9  1                            V
SER  CSR                   EXSR C73010                                          
SER  C*                    ---- ------                                          
SER  CSR                   ELSE                                                V
SER  CSR                   MOVE '0'       $$GEOC                               V
SER  CSR                   MOVE '0'       $$ERRC                               V
SER  CSR                   END                                                 V
SER  C*                                                                        V
SER  CSR         $$GEOC    IFEQ '1'                                            V
SER  C*                                                                        V
SER  C*    Extended Price (Net Amount) on which Tax is to be Calculated        V
SER  C*                                                                        V
SER  CSR         $XAEXP    DIV  #@AEXP    $$RO08    H                          V
SER  C*                                                                        V
SER  C*    Call Vertex Tax Data Structure Loading Module                       V
SER  C*                                                                        V
SER  CSR                   MOVELI0101     $V0101                               V
SER  CSR                   EXSR C73020                                         V
SER  C*                    ---- ------                                         V
SER  CSR                   MOVEL$V0101    I0101                                V
SER  C*                                                                        V
SER  C*    Call Tax Calculator with vertex parms                               V
SER  C*                                                                        V
SER  CSR                   CALL 'X4008C  '             99                      V
SER  C*                    ---- ----------                                     V
SER  CSR                   PARM           DS#TAX                               V
SER  CSR                   PARM           DS7301                               V
SER  CSR                   PARM           DSVTS1                               V
SER  CSR                   PARM           DSVTS2                               V
SER  CSR                   PARM           DSVTS3                               V
SER  C*                                                                        V
SER  C*    Load applicable Tax Authorithy                                      V
SER  C*      Taxed GeoCode Indicator (LTRN01):                                 V
SER  C*          T = Ship-To Location                                          V
SER  C*          F = Ship-From Location                                        V
SER  C*          O = Order Acceptance Location                                 V
SER  C*                                                                        V
S2595C*   SAVE SDTXA1 AND RESTORE AFTER PRINTING DETAIL LINE                    
S2595CSR                   MOVELSDTXA1    SVTXA1                               V
SER  CSR                   SELEC                                               V
SER  CSR         LTRN01    WHEQ 'T'                                            V
SER  CSR                   MOVEL$$TTX1    SDTXA1                               V
SER  CSR         LTRN01    WHEQ 'F'                                            V
SER  CSR                   MOVEL$$TTX2    SDTXA1                               V
SER  CSR         LTRN01    WHEQ 'O'                                            V
SER  CSR                   MOVEL$$TTX3    SDTXA1                               V
SER  CSR                   ENDSL                                               V
SER  C*                                                                        V
SER  CSR                   ELSE                                                V
SER  C*                                                                         
SER  C*    Call program to calculate tax                                        
SER  C*                                                                         
SER  CSR                   CALL 'X4008C  '             99                       
SER  C*                    ---- ----------                                      
SER  CSR                   PARM           DS#TAX                                
SER  C*                                                                         
SER  CSR                   END                                                  
S2595CSR                   CLEARLTRN01                                          
S2595CSR                   CLEAR$$TTX1                                          
S2595CSR                   CLEAR$$TTX2                                          
S2595CSR                   CLEAR$$TTX3                                          
SER  C*----------------------------------------------------------------         
SER  CSR         EN10CC    ENDSR                                                
     C****************************************************************          
     C*                                                                         
     C*    SUBROUTINE S010C2 - Calculate Total Tax Amount                       
     C*    ----------------------------------------------                       
     C*                                                                         
     CSR         S010C2    BEGSR                                                
     C*          ------    -----                                                
     C*                                                                         
     C*    Calculate Authority Tax Amount.                                      
     C*                                                                         
B1   CSR         @TR,#R    IFNE *ZERO                                           
     C*                                                                         
     CSR                   MOVE *ZERO     $WKATH 299                            
     CSR                   MOVE *ZERO     $WKRAT  85                            
     CSR                   MOVE *ZERO     $WKFAH 299                            
     CSR                   MOVE *ZERO     $WKTM1 299                            
     CSR                   MOVE *ZERO     $WKTM2 299                            
     C*                                                                         
     C*    Get Tax Rate in Percent Form.                                        
     C*                                                                         
     CSR         @TR,#R    DIV  #@TRAT    $WKRAT  85                            
     CSR                   DIV  100       $WKRAT  85                            
     C*                                                                         
     C*    Scrub Taxable Amount for Calculation.                                
     C*                                                                         
B2   CSR         $@CNV     IFEQ '1'                                             
     C*                                                                         
B3   CSR         $@CURR    IFEQ '1'                                             
     CSR         #XATXA    DIV  #@FDO     $WKTM1                                
X3   CSR                   ELSE                                                 
     CSR         #XATXA    DIV  #@CDO     $WKTM1                                
E3   CSR                   ENDIF                                                
     C*                                                                         
X2   CSR                   ELSE                                                 
     CSR         #XATXA    DIV  #@AEXP    $WKTM1                                
E2   CSR                   ENDIF                                                
     C*                                                                         
     C*    Multiply Tax Rate by Amount Taxable.                                 
     C*                                                                         
     CSR         $WKRAT    MULT $WKTM1    $WKATH    H                           
     C*                                                                         
     C*    Calculate Tax On Tax Amount for Authority 2-5                        
     C*                                                                         
     CSR         #XTXTX    IFEQ 'Y'                                             
     CSR         $TXR1     ANDNE'1'                                             
     C*                                                                         
     C*    Calculate Tax Amount for Authority                                   
     C*                                                                         
     CSR         TATXR1    DIV  #@TXR1    $WK85   85                            
     CSR                   DIV  100       $WK85                                 
     CSR                   ADD  1         $WK85                                 
     CSR                   MULT $WK85     $WKATH                                
     C*                                                                         
     C*    Calculate Tax Rate for Authority                                     
     C*                                                                         
     CSR                   MULT $WK85     $WKRAT                                
     CSR                   MULT 100       $WKRAT                                
     CSR                   END                                                  
     C*                                                                         
B2   CSR         $@CNV     IFEQ '1'                                             
     C*                                                                         
B3   CSR         $@CURR    IFEQ '1'                                             
     CSR         $WKATH    MULT #@FDO     $WK150    H                           
     CSR         $WK150    DIV  #@FDO     $WK299                                
X3   CSR                   ELSE                                                 
     CSR         $WKATH    MULT #@CDO     $WK150    H                           
     CSR         $WK150    DIV  #@CDO     $WK299                                
E3   CSR                   ENDIF                                                
     C*                                                                         
X2   CSR                   ELSE                                                 
     CSR         $WKATH    MULT #@AEXP    $WK150    H                           
     CSR         $WK150    DIV  #@AEXP    $WK299                                
E2   CSR                   ENDIF                                                
     C*                                                                         
B2   CSR         $#GRX     IFNE *ZEROS                                          
     CSR                   ADD  $WK299    @TT,#R                                
E2   CSR                   ENDIF                                                
     C*                                                                         
     CSR         #XTXTX    IFEQ 'Y'                                             
     CSR         $TXR2     ANDEQ'1'                                             
     CSR         #R        SUB  1         #S                                    
     CSR         $@CNV     IFEQ '1'                                             
     CSR         $@CURR    IFEQ '1'                                             
S1203CSR         @TT,#S    MULT #@FDO     $WK299                                
     CSR                   ELSE                                                 
S1203CSR         @TT,#S    MULT #@CDO     $WK299                                
     CSR                   ENDIF                                                
     CSR                   ELSE                                                 
S1203CSR         @TT,#S    MULT #@AEXP    $WK299                                
     CSR                   ENDIF                                                
     CSR         @TM,#S    ADD  $WK299    @TM,#R                                
     CSR                   ELSE                                                 
     CSR         #R        IFEQ 1                                               
     CSR                   Z-ADD1         #S                                    
     CSR                   ELSE                                                 
     CSR         #R        SUB  1         #S                                    
     CSR                   ENDIF                                                
     CSR                   Z-ADD@TM,#S    @TM,#R                                
     CSR                   END                                                  
     C*                                                                         
     C*                                                                         
E1   CSR                   ENDIF                                                
     C*----------------------------------------------------------------         
     CSR                   ENDSR                                                
     C*****************************************************************         
     C*                                                                         
     C*    SUBROUTINE S010D - Print Draft                                       
     C*    ------------------------------                                       
     C*                                                                         
     C*    Processing:  1.  Print draft lines.                                  
     C*                                                                         
     CSR         S010D     BEGSR                                                
     C*          -----     -----                                                
     C*                                                                         
     C*    Check if drafts requested                                            
     C*                                                                         
B1   CSR         $@DRFT    IFEQ '1'                                             
     C*                                                                         
     C*    Move draft city from processing option to report field               
     C*                                                                         
     CSR                   MOVEL$@CITY    VC0009                                
     C*                                                                         
     C*    Retrieve Pay Instrument Description                                  
     C*                                                                         
     CSR                   MOVE *BLANKS   VC0008                                
     CSR                   CLEARI0005U                                          
     CSR                   MOVELS@PYIN    #USY                                  
     CSR                   MOVE R@PYIN    #URT                                  
     CSR                   MOVE $BPYIN    #UKY                                  
     CSR                   CALL 'X0005 '               81                       
     C*                    ---- --------                                        
     CSR                   PARM           I0005U                                
B2   CSR         #UERR     IFNE '1'                                             
     CSR                   CLEAR@UA                                             
     CSR                   MOVEA#UDL01    @UA                                   
     CSR                   Z-ADD3         #OUTLG                                
     CSR                   EXSR C9822                                           
     C*                    ---- -----                                           
     CSR                   MOVEA@UB       VC0008                                
E2   CSR                   ENDIF                                                
     C*                                                                         
     C*    Move invoice amount to amount due/amount open fields                 
     C*                                                                         
     CSR                   MOVE RR#ATO    RRAAP                                 
     CSR                   MOVE RR#ATO    R1AAP                                 
     C*                                                                         
     C*    Move invoice date to draft field                                     
     C*                                                                         
     CSR                   MOVE RRDI      RRDSY                                 
     C*                                                                         
     C*    Move to report - Date - Due                                          
     C*                                                                         
     CSR                   MOVE RR#DD     RRDD                                  
     C*                                                                         
     C*    Retrieve default bank account for customer                           
     C*                                                                         
     CSR                   MOVE *BLANKS   RRTNST                                
     CSR                   MOVE *BLANKS   R1TNST                                
     CSR                   MOVE *BLANKS   RRCBNK                                
     CSR                   MOVE *BLANKS   RRCHKD                                
     CSR                   MOVE *BLANKS   RRDL01                                
     C*                                                                         
     CSR                   MOVE $BAN8     AYAN8                                 
     CSR                   MOVE 'D'       AYBKTP                                
     CSR         AYKY01    CHAINI0030                8199                       
B2   CSR         *IN81     IFEQ '0'                                             
     CSR         *IN99     ANDEQ'0'                                             
DBN  CSR                   MOVELAYTNST    $WK10  10                             
     CSR                   MOVEL$WK10     RRTNST                                
DBY5 CSR                   CLEAR@UA                                             
     CSR                   MOVEA$WK10     @UA                                   
     CSR                   Z-ADD5         #OUTLG                                
     CSR                   EXSR C9822                                           
     C*                    ---- -----                                           
     CSR                   MOVEA@UB       R1TNST                                
     CSR                   MOVELAYCBNK    RRCBNK                                
     CSR                   MOVELAYCHKD    RRCHKD                                
     CSR                   CLEAR@UA                                             
     CSR                   MOVEAAYDL01    @UA                                   
     CSR                   Z-ADD24        #OUTLG                                
     CSR                   EXSR C9822                                           
     C*                    ---- -----                                           
     CSR                   MOVEA@UB       RRDL01                                
E2   CSR                   ENDIF                                                
     C*                                                                         
     C*    Load draft amount currency code                                      
     C*                                                                         
     CSR                   MOVE *BLANKS   RRCRCD                                
B2   CSR         $@CNV     IFEQ '1'                                             
B3   CSR         $@CURR    IFEQ '1'                                             
     CSR                   MOVELRPCRCD    RRCRCD                                
X3   CSR                   ELSE                                                 
A    CSR                   MOVELCCCRCD    RRCRCD                                
E3   CSR                   ENDIF                                                
B3   CSR         $@IC      IFEQ '1'                                             
     CSR                   MOVELCCCRCD    RRCRCD                                
X3   CSR                   ENDIF                                                
E2   CSR                   ENDIF                                                
     C*                                                                         
     CSR                   WRITEDRAFT1                 OF                       
     C*                    -----------                                          
     C*                                                                         
E1   CSR                   ENDIF                                                
     C*----------------------------------------------------------------         
     CSR         END10D    ENDSR                                                
     C****************************************************************          
     C*                                                                         
     C*    SUBROUTINE S010S - Load Detail Line of Serial Numbers                
     C*    -----------------------------------------------------                
     C*                                                                         
     CSR         S010S     BEGSR                                                
     C*          -----     -----                                                
     C*                                                                         
     CSR         IBSRNR    IFEQ 'Y'                                             
     CSR         IBSRCE    ORGE '4'                                             
     CSR         IBSRCE    ANDLE'7'                                             
     CSR                   MOVE *BLANKS   $SFIR                                 
     CSR                   MOVE ' '       $FIR    1                             
     CSR         $@SUMZ    IFEQ *BLANKS                                         
     CSR                   MOVE SDITM     SWITM                                 
     CSR                   MOVE SDDOCO    SWDOCO                                
     CSR                   MOVE SDDCTO    SWDCTO                                
     CSR                   MOVE SDKCOO    SWKCOO                                
     CSR                   MOVE SDSFXO    SWSFXO                                
     CSR                   MOVE SDLNID    SWLNID                                
     CSR         IBSRCE    IFEQ '4'                                             
     CSR         IBSRCE    OREQ '5'                                             
     CSR         IBSRCE    OREQ '6'                                             
     CSR         IBSRCE    OREQ '7'                                             
     CSR                   MOVELSDLOTN    SWSRL1                                
     CSR                   ELSE                                                 
     CSR         IBSRNR    IFEQ 'Y'                                             
     CSR         SWKY0G    SETLLI4220G                                          
     CSR                   ENDIF                                                
     CSR                   ENDIF                                                
     CSR                   ELSE                                                 
     C*                                                                         
     CSR                   Z-ADD$2KYLN    $IKYL2  30                            
     CSR                   Z-ADD$2RCLN    $IRCL2  30                            
     CSR                   CLEARDS$2                                            
     CSR                   ENDIF                                                
     C*                                                                         
     CSR                   SETOF                     96                         
     CSR                   MOVEL'0'       PSTAT                                 
B1   CSR         *IN96     DOWEQ'0'                                             
     CSR         PSTAT     OREQ '0'                                             
     CSR         $@SUMZ    IFEQ *BLANKS                                         
     CSR         IBSRNR    IFEQ 'Y'                                             
     CSR         SWKY0G    READEI4220G                   96                     
     CSR         *IN96     IFEQ *ON                                             
     CSR                   MOVEL'1'       PSTAT                                 
     CSR                   ENDIF                                                
     CSR                   ENDIF                                                
     C*                                                                         
     CSR                   ELSE                                                 
     C*                                                                         
     CSR         *IN96     IFEQ *ON                                             
     CSR         $SFIR     OREQ ' '                                             
     CSR                   MOVE '1'       $SFIR   1                             
     CSR                   MOVE *OFF      *IN96                                 
     CSR                   CALL 'X00IDX'                                        
     C*                    ---- --------                                        
     CSR                   PARM           DSIDX2                                
     CSR                   PARM 'I'       PACTN   1                             
     CSR                   PARM 'GT'      PRULE   2                             
     CSR                   PARM           $IKYL2                                
     CSR                   PARM DS$2      PKEY  120                             
     CSR                   PARM           $IRCL2                                
     CSR                   PARM           DS$2                                  
     CSR                   PARM           PSTAT   1                             
     C*                                                                         
     CSR         PSTAT     IFEQ '0'                                             
     CSR                   Z-ADDSDITM     SWITM                                 
     CSR                   Z-ADD$2DOCO    SWDOCO                                
     CSR                   MOVEL$2DCTO    SWDCTO                                
     CSR                   MOVEL$2KCOO    SWKCOO                                
     CSR                   MOVELSDSFXO    SWSFXO                                
     CSR                   Z-ADD$2LNID    SWLNID                                
     CSR         IBSRCE    IFEQ '4'                                             
     CSR         IBSRCE    OREQ '5'                                             
     CSR         IBSRCE    OREQ '6'                                             
     CSR         IBSRCE    OREQ '7'                                             
     CSR                   MOVEL$2LOTN    SWSRL1                                
     CSR                   ELSE                                                 
     CSR         IBSRNR    IFEQ 'Y'                                             
     CSR         SWKY0G    SETLLI4220G                                          
     CSR                   ENDIF                                                
     CSR                   ENDIF                                                
     CSR                   ELSE                                                 
     CSR                   MOVE *ON       *IN96                                 
     CSR                   ENDIF                                                
     CSR                   ENDIF                                                
     CSR         *IN96     IFEQ *OFF                                            
     CSR         IBSRNR    IFEQ 'Y'                                             
     CSR         SWKY0G    READEI4220G                   96                     
     CSR                   ELSE                                                 
     CSR                   MOVE ' '       $SFIR                                 
     CSR                   ENDIF                                                
     CSR                   ENDIF                                                
     CSR                   ENDIF                                                
     C*                                                                         
B2   CSR         *IN96     IFEQ '0'                                             
     CSR         $@SUMZ    IFEQ *BLANKS                                         
     CSR         IBSRCE    IFEQ '4'                                             
     CSR         IBSRCE    OREQ '5'                                             
     CSR         IBSRCE    OREQ '6'                                             
     CSR         IBSRCE    OREQ '7'                                             
     CSR                   MOVE '1'       *IN96                                 
     CSR                   MOVE '1'       PSTAT                                 
     CSR                   ENDIF                                                
     CSR                   ENDIF                                                
     C*                                                                         
     C*----------------------------------------------------------------         
B3   CSR         $FIR      IFEQ ' '                                             
     CSR                   MOVE '1'       $FIR                                  
     C*                                                                         
     C*    Print serial number detail                                           
     C*                                                                         
     CSR                   CLEAR@UA                                             
     CSR         $@SUMZ    IFEQ *BLANKS                                         
     CSR                   MOVEAVTX068    @UA                                   
     CSR                   ELSE                                                 
     CSR                   MOVEAVTX091    @UA                                   
     CSR                   ENDIF                                                
     CSR                   Z-ADD24        #OUTLG                                
     CSR                   EXSR C9822                                           
     C*                    ---- -----                                           
     CSR                   MOVEA@UB       VC0002                                
     C*                                                                         
     CSR         $@SUMZ    IFEQ *BLANKS                                         
     CSR                   MOVEA@UB       VC0002                                
     CSR                   MOVE *BLANK    #SINBR                                
     CSR                   MOVE SWLNID    #SINBR                                
     CSR                   MOVE T@LNID    #DTYP                                 
     CSR                   MOVE W@LNID    #EWRD                                 
     CSR                   MOVE E@LNID    #EC                                   
     CSR                   MOVE F@LNID    #DSPD                                 
     CSR                   MOVE G@LNID    #DATD                                 
     CSR                   MOVE J@LNID    #ALR                                  
     CSR                   MOVE ' '       #ECOR                                 
     CSR                   MOVE ' '       #DCOR                                 
     CSR                   EXSR C00161                                          
     C*                    ---- ------                                          
DBN  CSR                   MOVE #SINBR    VC0005                                
     CSR                   ENDIF                                                
     C*                                                                         
B4   CSR         $@EDI     IFNE '2'                                             
     CSR                   WRITEDETAIL2                OF                       
     C*                    ------------                                         
     CSR                   ENDIF                                                
     C*                                                                         
     C*----------------------------------------------------------------         
     C*                                                                         
     CSR         @@OFLN    SUB  @@CLNO    $$DIFF  30                            
B4   CSR         *INOF     IFEQ '1'                                             
     CSR         $$DIFF    ORLE $TOTL                                           
     CSR                   EXSR S010H                                           
     C*                    ---- -----                                           
     C*                                                                         
     C*    Print serial number continued detail                                 
     C*                                                                         
     CSR                   CLEAR@UA                                             
     CSR         $@SUMZ    IFEQ *BLANKS                                         
     CSR                   MOVEAVTX069    @UA                                   
     CSR                   ELSE                                                 
     CSR                   MOVEAVTX092    @UA                                   
     CSR                   ENDIF                                                
     CSR                   Z-ADD24        #OUTLG                                
     CSR                   EXSR C9822                                           
     C*                    ---- -----                                           
     CSR                   MOVEA@UB       VC0002                                
     CSR         $@SUMZ    IFEQ *BLANKS                                         
     CSR                   MOVE *BLANK    #SINBR                                
     CSR                   MOVE SWLNID    #SINBR                                
     CSR                   MOVE T@LNID    #DTYP                                 
     CSR                   MOVE W@LNID    #EWRD                                 
     CSR                   MOVE E@LNID    #EC                                   
     CSR                   MOVE F@LNID    #DSPD                                 
     CSR                   MOVE G@LNID    #DATD                                 
     CSR                   MOVE J@LNID    #ALR                                  
     CSR                   MOVE ' '       #ECOR                                 
     CSR                   MOVE ' '       #DCOR                                 
     CSR                   EXSR C00161                                          
     C*                    ---- ------                                          
DBN  CSR                   MOVE #SINBR    VC0005                                
     CSR                   ENDIF                                                
     C*                                                                         
B4   CSR         $@EDI     IFNE '2'                                             
     CSR                   WRITEDETAIL2                OF                       
     C*                    ------------                                         
     CSR                   SETOF                     OF                         
E4   CSR                   ENDIF                                                
E4   CSR                   ENDIF                                                
E3   CSR                   ENDIF                                                
     C*----------------------------------------------------------------         
     C*                                                                         
     C*    Write serial number detail                                           
     C*                                                                         
     CSR                   MOVE *BLANK    VC0005                                
     CSR                   MOVE *BLANK    VC0002                                
     CSR                   MOVELSWSRL1    VC0002                                
     C*                                                                         
B4   CSR         $@EDI     IFNE '2'                                             
     CSR                   WRITEDETAIL2                OF                       
     C*                    ------------                                         
     CSR                   ENDIF                                                
     C*                                                                         
     CSR         @@OFLN    SUB  @@CLNO    $$DIFF  30                            
B3   CSR         *INOF     IFEQ '1'                                             
     CSR         $$DIFF    ORLE $TOTL                                           
     CSR                   EXSR S010H                                           
     C*                    ---- -----                                           
     C*                                                                         
     CSR                   CLEAR@UA                                             
     CSR         $@SUMZ    IFEQ *BLANKS                                         
     CSR                   MOVEAVTX069    @UA                                   
     CSR                   ELSE                                                 
     CSR                   MOVEAVTX092    @UA                                   
     CSR                   ENDIF                                                
     CSR                   Z-ADD24        #OUTLG                                
     CSR                   EXSR C9822                                           
     C*                    ---- -----                                           
     CSR                   MOVEA@UB       VC0002                                
     CSR         $@SUMZ    IFEQ *BLANKS                                         
     CSR                   MOVE *BLANK    #SINBR                                
     CSR                   MOVE SWLNID    #SINBR                                
     CSR                   MOVE T@LNID    #DTYP                                 
     CSR                   MOVE W@LNID    #EWRD                                 
     CSR                   MOVE E@LNID    #EC                                   
     CSR                   MOVE F@LNID    #DSPD                                 
     CSR                   MOVE G@LNID    #DATD                                 
     CSR                   MOVE J@LNID    #ALR                                  
     CSR                   MOVE ' '       #ECOR                                 
     CSR                   MOVE ' '       #DCOR                                 
     CSR                   EXSR C00161                                          
     C*                    ---- ------                                          
DBN  CSR                   MOVE #SINBR    VC0005                                
     CSR                   ENDIF                                                
     C*                                                                         
B4   CSR         $@EDI     IFNE '2'                                             
     CSR                   WRITEDETAIL2                OF                       
     C*                    ------------                                         
E3   CSR                   ENDIF                                                
E2   CSR                   ENDIF                                                
E2   CSR                   ENDIF                                                
E1   CSR                   ENDDO                                                
     CSR                   ENDIF                                                
     C*                                                                         
     C*-----------------------------------------------------------              
     C*                                                                         
     C*    Clear user index for Serial #                                        
     C*                                                                         
     CSR         $@SUMZ    IFNE *BLANKS                                         
     CSR                   Z-ADD1         $IKYL2  30                            
     CSR                   MOVE *BLANK    PKEY                                  
     C*                                                                         
     CSR                   CALL 'X00IDX'                                        
     C*                    ---- --------                                        
     CSR                   PARM           DSIDX2                                
     CSR                   PARM 'D'       PACTN   1                             
     CSR                   PARM 'EQ'      PRULE   2                             
     CSR                   PARM           $IKYL2                                
     CSR                   PARM           PKEY  120                             
     CSR                   PARM           $IRCL2                                
     CSR                   PARM           DS$2                                  
     CSR                   PARM           PSTAT   1                             
     CSR                   ENDIF                                                
     C*----------------------------------------------------------------         
     CSR         END10S    ENDSR                                                
     C*****************************************************************         
     C*                                                                         
     C*    SUBROUTINE S010T - Report Print Text                                 
     C*    ------------------------------------                                 
     C*                                                                         
     C*    Processing:  1.  Print report text.                                  
     C*                                                                         
     CSR         S010T     BEGSR                                                
     C*          -----     -----                                                
     C*                                                                         
     CSR         PSITM     IFNE *ZERO                                           
     CSR                   MOVE *BLANKS   PSINMG                                
     CSR                   ENDIF                                                
     C*                                                                         
     C*    Initialize Print Message Flag                                        
     C*                                                                         
     CSR                   MOVE ' '       $PRT    1                             
     C*                                                                         
B1   CSR         PSINMG    IFNE *BLANKS                                         
     CSR         PSITM     ORNE *ZERO                                           
     C*                                                                         
     C*    Bypass printing if kit component line                                
     C*                                                                         
B3   CSR         $SEL      IFNE '3'                                             
     CSR         $GFLAG    ORNE *BLANKS                                         
     CSR         $$HFLG    ORNE *BLANKS                                         
     C*                                                                         
     C*----------------------------------------------------------------         
     C*                                                                         
     C*   Retrieve and Print Text messages                                      
     C*                                                                         
     CSR                   MOVE *BLANKS   $$WRT   1                             
     CSR                   MOVE $$LNGP    PSLNGP                                
     CSR                   MOVE SDTRDJ    PSEXDJ                                
     CSR                   MOVEL*BLANKS   PSPID                                 
     CSR                   MOVEL'P42565  'PSPID                                 
     CSR                   MOVE SDDCTO    PSDCTO                                
     CSR                   CALL 'X4016   '                                      
     C*                    ---- ------                                          
     CSR                   PARM           PSINMG 10                             
     CSR                   PARM           PSITM   80                            
     CSR                   PARM           PSLNGP  2                             
     CSR                   PARM           PSEXDJ  60                            
     CSR                   PARM           PSPID  10                             
     CSR                   PARM           PSDCTO  2                             
     CSR                   PARM           PSEXST  1                             
     C*                                                                         
     C*                                                                         
B4   CSR         PSEXST    IFEQ $$TEXT                                          
     C*                                                                         
     C*     Read text lines from user index                                     
     C*                                                                         
     CSR                   CLEARDS4016                                          
     CSR                   SETOF                     94                         
SER  CSR                   MOVE ' '       FIRST1                                
B5   CSR         *IN94     DOWEQ'0'                                             
     C*                                                                         
     CSR                   MOVE 'I'       PACTN                                 
     CSR                   MOVE 'GT'      PRULE                                 
DBN12CSR                   MOVELDS4016    PKEY                                  
     CSR                   Z-ADD$KYLN     PKEYL                                 
     CSR                   Z-ADD$RCLN     PRECL                                 
     CSR                   CALL 'X00IDX'                                        
     C*                    ---- --------                                        
     CSR                   PARM           DSUIDX                                
     CSR                   PARM           PACTN   1                             
     CSR                   PARM           PRULE   2                             
     CSR                   PARM           PKEYL   30                            
     CSR                   PARM           PKEY  120                             
     CSR                   PARM           PRECL   30                            
     CSR                   PARM           PREC  210                             
     CSR                   PARM           $STAT   1                             
     C*                                                                         
DBN  CSR                   MOVELPREC      DS4016                                
     C*                                                                         
B6   CSR         $STAT     IFEQ '0'                                             
SER  CSR                   MOVELDS$TXT    @@PREF  6                             
SER  CSR         @@PREF    IFEQ '<<ALL>'                                        
SER  CSR         @@PREF    OREQ '<<INV>'                                        
     C*                                                                         
     C*----------------------------------------------------------------         
     C*                                                                         
     C*   Check page overflow.                                                  
     C*                                                                         
     CSR         @@OFLN    SUB  @@CLNO    $$DIFF  30                            
B7   CSR         *INOF     IFEQ '1'                                             
     CSR         $$DIFF    ORLE $TOTL                                           
     CSR                   EXSR S010H                                           
     C*                    ---- -----                                           
E7   CSR                   ENDIF                                                
     C*----------------------------------------------------------------         
     C*                                                                         
     C*    Move to report - Text Information                                    
     C*                                                                         
     CSR                   MOVE '1'       $$WRT                                 
     CSR                   MOVEL*BLANKS   RRTXLN                                
SER  C***                  MOVELDS$TXT    RRTXLN                                
SER  CSR                   MOVE DS$TXT    @@TXLN 72                             
SER  CSR                   MOVEL*BLANKS   RRTXLN                                
SER  CSR                   MOVEL@@TXLN    RRTXLN                                
     C*                                                                         
B4   CSR         $@EDI     IFNE '2'                                             
SER  CSR         FIRST1    IFEQ ' '                                             
SER  CSR                   MOVE 'N'       FIRST1  1                             
SER  CSR                   WRITEDETAIL3B               OF                       
SER  CSR                   ENDIF                                                
     CSR                   WRITEDETAIL3                OF                       
     C*                    ------------                                         
SER  CSR                   ENDIF                                                
E6   CSR                   ENDIF                                                
     C*                                                                         
     CSR                   MOVE *BLANK    RRTXLN                                
X6   CSR                   ELSE                                                 
     CSR                   SETON                     94                         
E6   CSR                   ENDIF                                                
     C*                                                                         
E5   CSR                   ENDDO                                                
     C*                                                                         
     C*    Set Flag that Print Message printed.                                 
     C*                                                                         
     CSR                   MOVE '1'       $PRT    1                             
     C*                                                                         
E3   CSR                   ENDIF                                                
E3   CSR                   ENDIF                                                
     C*                                                                         
E1   CSR                   ENDIF                                                
     C*----------------------------------------------------------------         
     CSR                   ENDSR                                                
     C*****************************************************************         
     C*                                                                         
     C*    SUBROUTINE S010V - Report Print Text                                 
     C*    ------------------------------------                                 
     C*                                                                         
     C*    Processing:  1.  Print associated text.                              
     C*                                                                         
     CSR         S010V     BEGSR                                                
     C*          -----     -----                                                
     C*                                                                         
     CSR         $PDOCO    IFNE *ZERO                                           
     CSR         JMLNID    ANDEQ*ZERO                                           
     CSR                   MOVEL$PDOCO    JMDOCO                                
     CSR                   MOVEL$PDCTO    JMDCTO                                
     CSR                   MOVEL$PKCOO    JMKCOO                                
     CSR                   ENDIF                                                
     C*                                                                         
S5927CSR         $PDOCO    IFEQ JMDOCO                                          
S5927CSR         $PDOCO    OREQ 0                                               
     CSR         JMKY01    CHAINI4314                8199                       
B1   CSR         JMPNTC    IFEQ 'Y'                                             
     CSR                   MOVE 'B'       $$ASSO  1                             
X1   CSR                   ELSE                                                 
     CSR                   MOVE 'A'       $$ASSO                                
E1   CSR                   ENDIF                                                
B1   CSR         *IN81     IFEQ '0'                                             
     CSR         $$ASSO    ANDEQ$$TEXT                                          
     C*                                                                         
     CSR                   MOVE *LOVAL    JMLINS                                
     CSR         JMKY01    SETLLI4314                                           
     C*                                                                         
     C*    Read text line file                                                  
     C*                                                                         
     CSR                   SETOF                     98                         
B2   CSR         *IN98     DOWEQ'0'                                             
     CSR         JMKY01    READEI4314                  9998                     
B3   CSR         *IN98     IFEQ '0'                                             
S3038C*                                                                         
S3038C*    SKIP Internal Comments                                               
S3038C*                                                                         
S3038CSR                   MOVELJMTXLN    INTCMT  1        Internal Cmt         
B4   CSR         INTCMT    IFNE '%'                                             
     C*                                                                         
     C*    If over flow indicator is on, print headings                         
     C*                                                                         
B5   CSR         *INOF     IFEQ '1'                                             
     CSR                   EXSR S010H                                           
     C*                    ---- -----                                           
E5   CSR                   ENDIF                                                
     C*                                                                         
     C*    Write detail text line                                               
     C*                                                                         
     CSR                   MOVELJMTXLN    RRTXLN                                
     C*                                                                         
B5   CSR         $@EDI     IFNE '2'                                             
     CSR                   WRITEDETAIL3                OF                       
     C*                    ------------                                         
     CSR                   MOVE *BLANK    RRTXLN                                
E5   CSR                   ENDIF                                                
     C*                                                                         
B5   CSR         JMLNID    IFEQ *ZERO                                           
     CSR                   MOVE '1'       $ATHR                                 
E5   CSR                   ENDIF                                                
E4   CSR                   ENDIF                                                
E3   CSR                   ENDIF                                                
E2   CSR                   ENDDO                                                
E1   CSR                   ENDIF                                                
S5927CSR                   ENDIF                                                
     C*                                                                         
     C*----------------------------------------------------------------         
     CSR                   ENDSR                                                
     C*****************************************************************         
     C*                                                                         
     C*    SUBROUTINE S010PA - Retreive Price Adjustment History                
     C*    -----------------------------------------------------                
     C*                                                                         
     C*    Processing:  1.  Determine if Price Adjustment History Exist         
     C*                           for Sales Detail Line                         
     C*                 2.  Save Field in Detail 1 to Detail 5                  
     C*                 3.  Accumulate Price Adjustment History Info            
     C*                           in Arrays for Printing                        
     C*                 4.  Determine Base Price from Price Adjustment          
     C*                           History                                       
     C*                 5.  Print Base Price in Unit Price of Detail 1          
     C*                                                                         
     CSR         S010PA    BEGSR                                                
     C*          ------    -----                                                
     C*                                                                         
     CSR                   SETOF                     62                         
     CSR                   SETOF                     63                         
     C*                                                                         
     C*    Do not print adjustments if no adjustment schedule attached          
     C*    or if not doing advance pricing.                                     
     C*                                                                         
     CSR         SDASN     IFEQ *BLANKS                                         
     CSR         $@ADV     OREQ 'N'                                             
     CSR         $@IC      OREQ '1'                                             
     CSR                   GOTO END10P                                          
     C*                    ---- -----                                           
     CSR                   ENDIF                                                
     C*                                                                         
     C*    If this is a credit order generated from Sales History               
     C*     process adjustments as normal.                                      
     CSR         SDPROV    IFEQ '1'                                             
     CSR         SDUORG    ANDLT0                                               
     CSR         SDSO09    ANDNE*BLANKS                                         
     CSR         SDOORN    ANDNE*BLANKS                                         
     CSR                   MOVEL'Y'       $ADJOK  1                             
     CSR                   ELSE                                                 
     CSR                   MOVEL' '       $ADJOK                                
     CSR                   ENDIF                                                
     C*                                                                         
     C*    Do not print adjustments if price was overridden and this            
     C*    is not a blanket order.                                              
     C*                                                                         
     CSR         SDPROV    IFEQ '1'                                             
     CSR         $ADJOK    ANDNE'Y'                                             
     C*                                                                         
     C*    If Original Order Type field is blank or if the order type           
     C*    is not in the UDC table (40/BT), then this is not a blanket          
     C*    order line.                                                          
     C*                                                                         
B3   CSR         SDOCTO    IFEQ *BLANKS                                         
     CSR                   GOTO END10P                                          
     C*                    ---- -----                                           
     CSR                   ELSE                                                 
     CSR                   CLEARI0005U                                          
     CSR                   MOVEL'40'      #USY                                  
     CSR                   MOVE 'BT'      #URT                                  
     CSR                   MOVE SDOCTO    #UKY                                  
     CSR                   CALL 'X0005 '               81                       
     C*                    ---- --------                                        
     CSR                   PARM           I0005U                                
B5   CSR         #UERR     IFEQ '1'                                             
     CSR                   GOTO END10P                                          
     C*                    ---- -----                                           
E4   CSR                   END                                                  
     CSR                   END                                                  
     CSR                   END                                                  
     C*                                                                         
     C*    Print Price Adjustment History, if records exist.                    
     C*                                                                         
     CSR                   MOVE SDDOCO    ALDOCO                                
     CSR                   MOVE SDDCTO    ALDCTO                                
     CSR                   MOVE SDKCOO    ALKCOO                                
     CSR                   MOVE SDLNID    ALLNID                                
     CSR                   Z-ADD0         ALOSEQ                                
     CSR         ALKY02    SETGTI4074C               81                         
     C*                                                                         
B4   CSR         *IN81     IFEQ '0'                                             
     CSR         $5DSPA    ANDEQ'Y'                                             
     CSR                   SETOF                     98                         
     C*                                                                         
     C*    Seton Indicator for supressing Detail 1 fields to be                 
     C*          printed in Detail 5                                            
     C*                                                                         
     CSR                   SETON                     62                         
     C*                                                                         
     C*    Seton Indicator for supressing Cancelled Line and Customer           
     C*          Item Number                                                    
     C*                                                                         
     CSR         RRCITM    IFEQ *BLANKS                                         
     CSR         RRSOCN    ANDEQ*BLANKS                                         
     CSR                   SETON                     63                         
     CSR                   ENDIF                                                
     C*                                                                         
     C*    Save Fields from Detail 1 to Detail 5 for printing after             
     C*          Price Adjustment Detail                                        
     C*                                                                         
     CSR                   MOVELRRUM      R5UM                                  
     CSR                   MOVELRRSOQS    R5SOQS                                
     CSR                   MOVELRRUPRC    R5UPRC                                
     CSR                   MOVELRRAEXP    R5AEXP                                
     CSR                   MOVELRRTX      R5TX                                  
     CSR                   MOVELRRECST    R5ECST                                
     CSR                   MOVELRRPCT     R5PCT                                 
     CSR                   MOVELRRSOBK    R5SOBK                                
     CSR                   MOVELRRUOM4    R5UOM4                                
     CSR                   MOVELRRSOCN    R5SOCN                                
     C*                                                                         
     CSR                   Z-ADD1         $ZCNT  150                            
     CSR                   Z-ADD1         $Z     150                            
     CSR                   Z-ADDSDUPRC    $$UPRC 150                            
     CSR                   Z-ADDSDFUP     $$FUP  150                            
     CSR                   CLEAR@PT                                             
     CSR                   CLEAR@PD                                             
     CSR                   CLEAR@PF                                             
B2   CSR         *IN98     DOWEQ'0'                                             
     CSR         ALKY01    READEI4074C                 9998                     
B3   CSR         *IN98     IFEQ '0'                                             
B3   CSR         ALABAS    IFNE 'Y'                                             
B3   CSR         ALACNT    ANDNE'4'                                             
B3   CSR         ALACNT    ANDNE'5'                                             
     CSR         ALOSEQ    ANDNE*ZEROS                                          
     C*                                                                         
     C*    Load Arrays with Price Adjustment History for Printing               
     C*                                                                         
B3   CSR         ALACNT    IFNE '1'                                             
     CSR                   MOVELALAST     @PT,$Z                                
     CSR                   Z-ADDALUPRC    @PD,$Z                                
     CSR                   Z-ADDALFUP     @PF,$Z                                
     CSR                   ADD  1         $Z                                    
     CSR                   ADD  1         $ZCNT                                 
     C***                  END                                                  
     C*                                                                         
     C*    Calculate Base Price from Unit Price - Price Adjustments             
     C*                                                                         
     CSR                   SUB  ALUPRC    $$UPRC                                
     CSR                   SUB  ALFUP     $$FUP                                 
     CSR                   END                                                  
     CSR                   END                                                  
     CSR                   END                                                  
     CSR         ALABAS    IFEQ 'Y'                                             
     CSR                   Z-ADDSDUPRC    $$UPRC 150                            
     CSR                   Z-ADDSDFUP     $$FUP  150                            
     CSR                   Z-ADD1         $Z     150                            
     CSR                   CLEAR@PT                                             
     CSR                   CLEAR@PD                                             
     CSR                   CLEAR@PF                                             
     CSR                   ENDIF                                                
     CSR                   END                                                  
     C*                                                                         
     C*    If over flow indicator is on, print headings                         
     C*                                                                         
B4   CSR         *INOF     IFEQ '1'                                             
     CSR                   EXSR S010H                                           
     C*                    ---- -----                                           
E4   CSR                   ENDIF                                                
     C*                                                                         
     C*    Move to output - Amount - Price per Unit                             
     C*                                                                         
     CSR                   MOVE *BLANK    #SINBR                                
     CSR                   MOVE *BLANK    RRUPRC                                
     C*                                                                         
     C*    Display Foreign Amount                                               
     C*                                                                         
B2   CSR         $@CNV     IFEQ '1'                                             
     CSR         $@CURR    ANDEQ'1'                                             
     C*                                                                         
     CSR         $@IC      IFEQ '1'                                             
     CSR                   MOVE F@UNCS    #DSPD                                 
     CSR                   ELSE                                                 
     CSR                   MOVE F@FUP     #DSPD                                 
     CSR                   ENDIF                                                
     C*                                                                         
     CSR                   MOVEL$$FUP     #SINBR                                
     CSR                   MOVE T@FUP     #DTYP                                 
     CSR                   MOVE W@FUP     #EWRD                                 
     CSR                   MOVE E@FUP     #EC                                   
     CSR                   MOVE G@FUP     #DATD                                 
     CSR                   MOVE J@FUP     #ALR                                  
     CSR                   MOVE ' '       #ECOR                                 
     CSR                   MOVE ' '       #DCOR                                 
     CSR                   EXSR C00161                                          
     C*                    ---- ------                                          
B3   CSR         #ALR      IFEQ 'L'                                             
     CSR                   MOVEL#SINBR    RRUPRC                                
X3   CSR                   ELSE                                                 
     CSR                   MOVE #SINBR    RRUPRC                                
E3   CSR                   ENDIF                                                
     C*                                                                         
X2   CSR                   ELSE                                                 
     C*                                                                         
SER  C***                  MOVEL$$UPRC    #SINBR                                
SER  CSR         $$UPRC    DIV  10        HDUPRC 150                            
SER  CSR                   MOVELHDUPRC    #SINBR                                
     CSR                   MOVE T@UPRC    #DTYP                                 
     CSR                   MOVE W@UPRC    #EWRD                                 
     CSR                   MOVE E@UPRC    #EC                                   
SER  CSR                   MOVE '3'       #DSPD                                 
SER  C***                  MOVE F@UPRC    #DSPD                                 
     CSR                   MOVE G@UPRC    #DATD                                 
     CSR                   MOVE J@UPRC    #ALR                                  
     CSR                   MOVE ' '       #ECOR                                 
     CSR                   MOVE ' '       #DCOR                                 
     CSR                   EXSR C00161                                          
     C*                    ---- ------                                          
B3   CSR         #ALR      IFEQ 'L'                                             
     CSR                   MOVEL#SINBR    RRUPRC                                
X3   CSR                   ELSE                                                 
     CSR                   MOVE #SINBR    RRUPRC                                
E3   CSR                   ENDIF                                                
E2   CSR                   ENDIF                                                
     C*                                                                         
E3   CSR                   ENDIF                                                
     C*                                                                         
     C*----------------------------------------------------------------         
     CSR         END10P    ENDSR                                                
     C*****************************************************************         
     C*                                                                         
     C*    SUBROUTINE S010PR - Report Print Price Adjustment History            
     C*    --------------------------------------------------------             
     C*                                                                         
     C*    Processing:  1.  Print Price Adjustment History.                     
     C*                                                                         
     CSR         S010PR    BEGSR                                                
     C*          ------    -----                                                
     C*                                                                         
     C*    Print Price Adjustments from Arrays                                  
     C*                                                                         
     CSR         *IN62     IFEQ '1'                                             
     CSR                   Z-ADD1         $Z     150                            
B2   CSR         $ZCNT     DOWGE$Z                                              
     CSR         @PD,$Z    IFNE *ZEROS                                          
     C*                                                                         
     C*    If over flow indicator is on, print headings                         
     C*                                                                         
B4   CSR         *INOF     IFEQ '1'                                             
     CSR                   EXSR S010H                                           
     C*                    ---- -----                                           
E4   CSR                   ENDIF                                                
     C*                                                                         
     C*    Move to output - Price Adjustment Type Description                   
     C*                                                                         
     CSR                   MOVE *BLANK    VC0010                                
     CSR         $$FOPN    IFEQ '0'                                             
     CSR         @PT,$Z    CHAINI4071                81                         
B3   CSR         *IN81     IFEQ '0'                                             
     C*                                                                         
     C*    If there is one, use description in customer's preferred             
     C*    language.                                                            
     C*                                                                         
     CSR         $$LNGP    IFNE *BLANKS                                         
     CSR                   MOVELS@AST     DRSY                                  
     CSR                   MOVELR@AST     DRRT                                  
     CSR                   MOVE @PT,$Z    DRKY                                  
     CSR                   MOVEL$$LNGP    DRLNGP                                
     CSR         DRKY01    CHAINI0005D               8484                       
     CSR         *IN84     IFEQ *ZEROS                                          
     CSR         DRDL01    ANDNE*BLANKS                                         
     CSR                   MOVELDRDL01    VC0010                                
     CSR                   ENDIF                           *IN84                
     CSR                   ENDIF                           $$LNGP               
     C*                                                                         
     CSR         VC0010    IFEQ *BLANKS                                         
     CSR                   MOVELS@AST     #USY                                  
     CSR                   MOVELR@AST     #URT                                  
     CSR                   MOVE @PT,$Z    #UKY                                  
     CSR                   CALL 'X0005 '               83                       
     C*                    ---- --------                                        
     CSR                   PARM           I0005U                                
B4   CSR         #UERR     IFNE '1'                                             
     CSR                   MOVEL#UDL01    VC0010                                
E4   CSR                   ENDIF                                                
     CSR                   ENDIF                           VC0010               
     C*                                                                         
E3   CSR                   ENDIF                                                
     CSR                   ENDIF                                                
     C*                                                                         
     C*    Move to output - Amount - Price per Unit                             
     C*                                                                         
     CSR                   MOVE *BLANK    #SINBR                                
     CSR                   MOVE *BLANK    RRLPRC                                
     C*                                                                         
     C*    Display Foreign Amount                                               
     C*                                                                         
B2   CSR         $@CNV     IFEQ '1'                                             
     CSR         $@CURR    ANDEQ'1'                                             
     CSR                   MOVEL@PF,$Z    #SINBR                                
     CSR                   MOVE T@FUP     #DTYP                                 
     CSR                   MOVE W@FUP     #EWRD                                 
     CSR                   MOVE E@FUP     #EC                                   
     CSR                   MOVE F@FUP     #DSPD                                 
     CSR                   MOVE G@FUP     #DATD                                 
     CSR                   MOVE J@FUP     #ALR                                  
     CSR                   MOVE ' '       #ECOR                                 
     CSR                   MOVE ' '       #DCOR                                 
     CSR                   EXSR C00161                                          
     C*                    ---- ------                                          
B3   CSR         #ALR      IFEQ 'L'                                             
     CSR                   MOVEL#SINBR    RRLPRC                                
X3   CSR                   ELSE                                                 
     CSR                   MOVE #SINBR    RRLPRC                                
E3   CSR                   ENDIF                                                
     C*                                                                         
X2   CSR                   ELSE                                                 
     C*                                                                         
     CSR                   MOVEL@PD,$Z    #SINBR                                
     CSR                   MOVE T@UPRC    #DTYP                                 
     CSR                   MOVE W@UPRC    #EWRD                                 
     CSR                   MOVE E@UPRC    #EC                                   
     CSR                   MOVE F@UPRC    #DSPD                                 
     CSR                   MOVE G@UPRC    #DATD                                 
     CSR                   MOVE J@UPRC    #ALR                                  
     CSR                   MOVE ' '       #ECOR                                 
     CSR                   MOVE ' '       #DCOR                                 
     CSR                   EXSR C00161                                          
     C*                    ---- ------                                          
B3   CSR         #ALR      IFEQ 'L'                                             
     CSR                   MOVEL#SINBR    RRLPRC                                
X3   CSR                   ELSE                                                 
     CSR                   MOVE #SINBR    RRLPRC                                
E3   CSR                   ENDIF                                                
E2   CSR                   ENDIF                                                
     C*                                                                         
B4   CSR         $@EDI     IFNE '2'                                             
     CSR                   WRITEDETAIL4                OF                       
     C*                    ------------                                         
     CSR                   ENDIF                                                
     C*                                                                         
     CSR                   ENDIF                                                
     CSR                   ADD  1         $Z                                    
E2   CSR                   ENDDO                                                
     C*                                                                         
     C*    If over flow indicator is on, print headings                         
     C*                                                                         
B4   CSR         *INOF     IFEQ '1'                                             
     CSR                   EXSR S010H                                           
     C*                    ---- -----                                           
E4   CSR                   ENDIF                                                
     C*                                                                         
     C*    Move to output - Net Price Description                               
     C*                                                                         
     CSR                   MOVE *BLANK    VC0011                                
DBY14CSR                   CLEAR@UA                                             
     CSR                   MOVEAVTX087    @UA                                   
     CSR                   Z-ADD14        #OUTLG                                
     CSR                   EXSR C9822                                           
     C*                    ---- -----                                           
     CSR                   MOVEA@UB       VC0011                                
     C*                                                                         
B4   CSR         $@EDI     IFNE '2'                                             
     CSR                   WRITEDETAIL5                OF                       
     C*                    ------------                                         
E2   CSR                   ENDIF                                                
E2   CSR                   ENDIF                                                
     C*----------------------------------------------------------------         
     CSR                   ENDSR                                                
     C*****************************************************************         
     C*                                                                         
     C*    SUBROUTINE S010U - Update Files                                      
     C*    -------------------------------                                      
     C*                                                                         
     C*    Processing:  1.  Update files.                                       
     C*                                                                         
     CSR         S010U     BEGSR                                                
     C*          -----     -----                                                
     C*                                                                         
     C*    Bypass file update if printing invoice from history.                 
     C*                                                                         
     CSR         $$HIST    CABEQ'Y'       END10U                                
     C*                    -----          ------                                
     C*    Bypass file update if processing a detached adjustment.              
     C*                                                                         
     CSR         $$DADJ    CABEQ'Y'       END10U                                
     C*                    -----          ------                                
     C*                                                                         
B1   CSR         ##MODE    IFEQ '1'                                             
     CSR         $4211     ANDEQ'M'                                             
     CSR                   GOTO END10U                                          
     C*                    ---- ------                                          
E1   CSR                   ENDIF                                                
     C*                                                                         
     CSR                   MOVE SDRESL    SVRESL                                
     C*                                                                         
     C*    Update field to print B/O or cancelled lines once                    
     C*                                                                         
B1   CSR         SDSOBK    IFNE *ZERO                                           
     CSR         SDSOCN    ORNE *ZERO                                           
     C           SDSOBK    OREQ *ZEROS                                          
     C           SDSOCN    ANDEQ*ZEROS                                          
     C           SDUORG    ANDEQ*ZEROS                                          
     C           SDSOQS    ANDEQ*ZEROS                                          
     C           SDSONE    ANDEQ*ZEROS                                          
     C           SDUOPN    ANDEQ*ZEROS                                          
     C           SDNXTR    ANDEQ'999'                                           
     CSR                   MOVE '1'       SDRESL                                
E1   CSR                   ENDIF                                                
     C*                                                                         
     C*    Only print cancelled text lines once                                 
     C*                                                                         
B1   CSR         SDNXTR    IFEQ '999'                                           
     CSR                   MOVE *BLANKS   PS@@                                  
     CSR                   MOVELSDLNTY    KY@@                                  
     CSR                   CALL 'XS40205'                                       
     C*                    ---- ---------                                       
     CSR                   PARM           PS@@                                  
     CSR                   PARM           DS4020                                
B2   CSR         RT@@      IFNE 'N'                                             
     CSR         LFTXYN    ANDEQ'Y'                                             
     CSR                   MOVE '1'       SDRESL                                
     CSR                   MOVE '1'       SVRESL                                
E2   CSR                   ENDIF                                                
E1   CSR                   ENDIF                                                
     C*                                                                         
B1   CSR         SVDOC     IFNE *ZEROS                                          
     CSR                   MOVE SVDOC     SDDOC                                 
     CSR                   MOVE SVDCT     SDDCT                                 
     CSR                   MOVE SVKCO     SDKCO                                 
E1   CSR                   ENDIF                                                
     C*                                                                         
     CSR         SDSOBK    IFNE *ZEROS                                          
     CSR         SDSOQS    ANDEQ*ZEROS                                          
     CSR                   Z-ADD*ZEROS    SDDOC                                 
     CSR                   MOVE *BLANKS   SDDCT                                 
     CSR                   MOVE *BLANKS   SDKCO                                 
     CSR                   ENDIF                                                
     C*                                                                         
     C*    Move to output field - Invoice Date                                  
     C*                                                                         
B1   CSR         SDDOC     IFNE *ZEROS                                          
     CSR         SDIVD     ANDEQ*ZEROS                                          
     CSR                   MOVE $UDATE    SDIVD                                 
E1   CSR                   ENDIF                                                
     C*                                                                         
     CSR                   MOVE ##USER    SDUSER                                
     CSR                   MOVE ##PROG    SDPID                                 
     CSR                   MOVE ##JOBN    SDJOBN                                
     CSR                   MOVE $$UPMJ    SDUPMJ                                
     CSR                   TIME           SDTDAY                                
     C*                                                                         
     C*    Update detail record only if the Based-On file is the                
     C*    Sales Detail (F4211) file or the (F49211)                            
     C*                                                                         
B1   CSR         ##MODE    IFEQ ' '                                             
     C*                                                                         
     CSR         $@IC      IFEQ '1'                                             
     CSR         SDKY0A    CHAINF49211               99                         
     CSR                   MOVE SDCO      UDKCO                                 
     CSR                   MOVE SDDOC     UDDOC                                 
     CSR                   MOVE $@DCT     UDDCT                                 
     CSR                   MOVE SDNXTR    $SNXTR  3                             
     CSR                   MOVE SDLTTR    $SLTTR  3                             
     CSR                   UPDATI49211                 99                       
     CSR         SDKY0A    CHAINI4211A               9899                       
     CSR                   MOVE $SNXTR    SDNXTR                                
     CSR                   MOVE $SLTTR    SDLTTR                                
     CSR                   UPDATI4211A                 99                       
     C*                                                                         
     C*   If interbranch invoice, the unit cost on F4211 is the price           
     C*   to the selling branch.                                                
     C*                                                                         
     CSR         SDUOM     IFNE SDUOM1                                          
     CSR                   Z-ADD1.0       #QTY                                  
     CSR                   MOVE SDUOM     #UOM                                  
     CSR                   MOVE SDUOM1    #UOM1                                 
     CSR                   MOVELSDMCU     #MCU                                  
     CSR                   MOVE LFIVI     #IVI                                  
     CSR                   MOVE SDCOMM    #READ                                 
     CSR                   MOVE *BLANKS   #OT1Y                                 
     CSR                   Z-ADD*ZEROS    #STDP                                 
     CSR                   MOVEL*BLANKS   #LOTN                                 
     C*                                                                         
     CSR                   CALL 'X41002  '             98                       
     C*                    ---- ----------                                      
     CSR                   PARM           DS4101                                
     CSR                   PARM           DS@UOM                                
     C*                                                                         
B5   CSR         #ERTST    IFEQ '1'                                             
     CSR                   Z-ADD1         #CNVP                                 
     CSR                   Z-ADD1         #CNVQ                                 
E5   CSR                   ENDIF                                                
     C*                                                                         
     CSR         SDUNCS    DIV  #CNVP     $WK299    H                           
     CSR                   MULT #PQT      $WK299    H                           
     CSR         $WK299    MULT #@FDO     $WK150    H                           
     CSR                   MOVEL$WK150    SDUNCS                                
     CSR                   ENDIF                                                
     C*                                                                         
     CSR         $@IC      IFEQ '1'                                             
     CSR         $@CNV     IFEQ '1'                                             
     CSR                   Z-ADDSDUNCS    SDFUP                                 
     CSR                   Z-ADDSDECST    SDFEA                                 
     CSR         UDCRR     IFEQ *ZERO                                           
     CSR                   Z-ADD1         UDCRR                                 
     CSR                   ENDIF                                                
B2   CSR         $@CNV     IFEQ '1'                                             
     CSR         $@CURR    ANDEQ' '                                             
     CSR         SDFUP     DIV  #@UNCS    $WFUP  299H                           
B3   CSR         $$CRYR    IFEQ 'Y'                                             
     CSR         $WFUP     DIV  UDCRR     $WFUP     H                           
E3   CSR                   ENDIF                                                
B3   CSR         $$CRYR    IFEQ 'Z'                                             
     CSR         $WFUP     MULT UDCRR     $WFUP     H                           
     CSR                   ENDIF                                                
     CSR         SDSOBK    DIV  #@SOBK    $WSOBK 299H                           
     CSR         SDSOQS    DIV  #@SOQS    $WSOQS 299H                           
     CSR         $WSOBK    ADD  $WSOQS    $WQTY  299                            
     CSR         $WFUP     MULT $WQTY     $WFEA  299H                           
     CSR                   MOVE *BLANKS   PS@@                                  
     CSR                   MOVEL$CDO      $ICDO   1                             
     CSR                   MOVELUDCRCD    KY@@                                  
     CSR                   CALL 'XS0013'               81                       
     C*                    ---- --------                                        
     CSR                   PARM           PS@@                                  
     CSR                   PARM           DS0013                                
B3   CSR         RT@@      IFNE 'N'                                             
     CSR         CVCDEC    ANDNE*BLANK                                          
     CSR                   MOVE CVCDEC    $CDO    1                             
E3   CSR                   ENDIF                                                
     CSR                   Z-ADD1         #@CDO  110                            
     CSR                   MOVE $CDO      #A                                    
B2   CSR                   DO   #A                                              
     CSR                   MULT 10        #@CDO                                 
E2   CSR                   ENDDO                                                
     CSR         SDRLIT    IFEQ *BLANKS                                         
     CSR         $WFEA     MULT #@CDO     SDAEXP    H                           
     CSR                   ENDIF                                                
     CSR         $WFUP     MULT #@UNCS    SDUPRC    H                           
     CSR                   ELSE                                                 
     CSR         #@FDO     IFNE *ZEROS                                          
     CSR         SDFUP     DIV  #@FDO     SDFUP                                 
     CSR                   ENDIF                                                
     CSR                   ENDIF                                                
     C*                                                                         
     C*  CURRENCY OFF                                                           
     CSR                   ELSE                                                 
     CSR                   Z-ADDSDUNCS    SDUPRC                                
     CSR                   Z-ADDSDECST    SDAEXP                                
     CSR                   ENDIF                                                
     C*                                                                         
     CSR                   Z-ADDUDCRR     SDCRR                                 
     CSR                   Z-ADDUDIAN8    SDAN8                                 
     CSR                   Z-ADDUDIAN8    SHAN8                                 
     CSR                   MOVE UDPTC     SDPTC                                 
     CSR                   MOVE CCCRCD    SDCRCD                                
     CSR                   MOVE UDTXA1    SDTXA1                                
     CSR                   MOVE UDEXR1    SDEXR1                                
     C*                                                                         
     C*  Tax codes are reset to blanks because inter-branch tax                 
     C*    is not going to be calculated at this time.  Future change.          
     CSR                   MOVE *BLANKS   SDTXA1                                
     CSR                   MOVE *BLANKS   SDEXR1                                
     C*                                                                         
     CSR                   ENDIF                                                
     CSR                   ELSE                                                 
     CSR         $CYCLE    IFEQ '1'                                             
     CSR                   UPDATI4211A                 99                       
     CSR                   ELSE                                                 
     CSR         $FOR      IFEQ '1'                                             
     CSR                   Z-ADD*ZEROS    SDFUP                                 
     CSR                   Z-ADD*ZEROS    SDFEA                                 
     CSR                   ENDIF                                                
     CSR                   UPDATI4211                  99                       
     CSR                   ENDIF                                                
     CSR                   ENDIF                                                
     C*                                                                         
X1   CSR                   ELSE                                                 
     CSR         $FOR      IFEQ '1'                                             
     CSR                   Z-ADD*ZEROS    SDFUP                                 
     CSR                   Z-ADD*ZEROS    SDFEA                                 
     CSR                   ENDIF                                                
     CSR                   UPDATI4211A                 99                       
E1   CSR                   ENDIF                                                
     CSR         $FOR      IFEQ '1'                                             
     CSR                   Z-ADDSDUPRC    SDFUP                                 
     CSR                   Z-ADDSDAEXP    SDFEA                                 
     CSR                   ENDIF                                                
     C*---------------------------------------------------------------          
     C*                                                                         
     C*    Write ledger record for detail record                                
     C*                                                                         
B1   CSR         FSWRTH    IFEQ 'Y'                                             
DBN  CSR                   MOVELDS4211    D42199                                
     CSR         $@IC      IFEQ '1'                                             
     CSR                   MOVE UDDOC     SLDOC                                 
     CSR                   MOVE UDDCT     SLDCT                                 
     CSR                   MOVE UDKCO     SLKCO                                 
     CSR                   MOVE $$UPMJ    SLUPMJ                                
     CSR                   TIME           $$TDAY  60                            
     CSR                   Z-ADD$$TDAY    SLTDAY                                
     CSR                   ENDIF                                                
     CSR                   MOVE ##PROG    SLPID                                 
     CSR                   CALL 'X42199  '             99                       
     C*                    ---- ----------                                      
     CSR                   PARM           D42199                                
E1   CSR                   ENDIF                                                
     C*----------------------------------------------------------------         
     CSR         END10U    ENDSR                                                
     C****************************************************************          
     C*                                                                         
     C*    SUBROUTINE S010X - Print Tax Summary Information                     
     C*    ------------------------------------------------                     
     C*                                                                         
     CSR         S010X     BEGSR                                                
     C*          -----     -----                                                
     C*                                                                         
     CSR                   MOVE *BLANKS   RRFVTY                                
     CSR                   MOVE *BLANKS   RRTXR1                                
     CSR                   MOVE *BLANKS   RRSTOT                                
     CSR                   MOVE *BLANKS   RRATXA                                
     CSR                   MOVE *BLANKS   RRSTAM                                
     CSR                   MOVE *ZEROS    $#TAX                                 
     C*----------------------------------------------------------------         
     C*                                                                         
     C*    Build and write the Order total (W/O VAT).                           
     C*                                                                         
     CSR                   MOVE *BLANK    #SINBR                                
     C*                                                                         
     C*    Display Foreign Tax                                                  
     C*                                                                         
B1   CSR         $@CNV     IFEQ '1'                                             
     CSR         $@CURR    ANDEQ'1'                                             
     CSR                   Z-ADD$FTOTL    $WK150 150                            
     CSR                   MOVE $WK150    #SINBR                                
     CSR                   MOVE T@FEA     #DTYP                                 
     CSR                   MOVE W@FEA     #EWRD                                 
     CSR                   MOVE E@FEA     #EC                                   
     CSR                   MOVE $FDO      #DSPD                                 
     CSR                   MOVE G@FEA     #DATD                                 
     CSR                   MOVE J@FEA     #ALR                                  
     CSR                   MOVE ' '       #ECOR                                 
     CSR                   MOVE ' '       #DCOR                                 
     CSR                   EXSR C00161                                          
     C*                    ---- ------                                          
B2   CSR         #ALR      IFEQ 'L'                                             
     CSR                   MOVEL#SINBR    RRSTOT                                
X2   CSR                   ELSE                                                 
     CSR                   MOVE #SINBR    RRSTOT                                
E2   CSR                   ENDIF                                                
     C*                                                                         
X1   CSR                   ELSE                                                 
     C*                                                                         
     C*    Display Domestic Tax                                                 
     C*                                                                         
B2   CSR         $@CNV     IFEQ '1'                                             
     CSR         $@CURR    ANDEQ' '                                             
     CSR                   MOVE $CDO      #DSPD                                 
E2   CSR                   ENDIF                                                
     C*                                                                         
     C*    No Foreign Currency                                                  
     C*                                                                         
B2   CSR         $@CNV     IFNE '1'                                             
     CSR                   MOVE F@AEXP    #DSPD                                 
E2   CSR                   ENDIF                                                
     C*                                                                         
     CSR                   Z-ADD$#ATO     $WK150                                
     CSR                   MOVE $WK150    #SINBR                                
     CSR                   MOVE T@AEXP    #DTYP                                 
     CSR                   MOVE W@AEXP    #EWRD                                 
     CSR                   MOVE E@AEXP    #EC                                   
     CSR                   MOVE G@AEXP    #DATD                                 
     CSR                   MOVE J@AEXP    #ALR                                  
     CSR                   MOVE ' '       #ECOR                                 
     CSR                   MOVE ' '       #DCOR                                 
     CSR                   EXSR C00161                                          
     C*                    ---- ------                                          
B2   CSR         #ALR      IFEQ 'L'                                             
     CSR                   MOVEL#SINBR    RRSTOT                                
X2   CSR                   ELSE                                                 
     CSR                   MOVE #SINBR    RRSTOT                                
E2   CSR                   ENDIF                                                
     C*                                                                         
E1   CSR                   ENDIF                                                
     C*----------------------------------------------------------------         
     C*                                                                         
     C*    Write order total line                                               
     C*                                                                         
B2   CSR         $@EDI     IFNE '2'                                             
     CSR                   WRITETOTAL1                 OF                       
     C*                    -----------                                          
E1   CSR                   ENDIF                                                
     C*                                                                         
     C*    If over flow indicator is on, print headings                         
     C*                                                                         
     CSR         @@OFLN    SUB  @@CLNO    $$DIFF  30                            
B1   CSR         *INOF     IFEQ '1'                                             
     CSR         $$DIFF    ORLE $TOTL                                           
     CSR                   Z-ADD$#PG      $$PGSV                                
     CSR                   Z-ADD##PGSV    $#PG                                  
     CSR                   EXSR S010H                                           
     C*                    ---- -----                                           
     CSR                   Z-ADD$#PG      ##PGSV                                
     CSR                   Z-ADD$$PGSV    $#PG                                  
E1   CSR                   ENDIF                                                
     C*                                                                         
     C*    Write tax heading                                                    
     C*                                                                         
B2   CSR         $@EDI     IFNE '2'                                             
     CSR                   WRITETOTAL2                 OF                       
     C*                    -----------                                          
E1   CSR                   ENDIF                                                
     C*----------------------------------------------------------------         
     C*                                                                         
     C*    Load Tax Amount from Sum of User Index if rounded                    
     C*         Tax Group Summary                                               
     C*                                                                         
     CSR         $@VAT     IFEQ '1'                                             
     CSR         $RND      ANDEQ'1'                                             
     CSR                   CLEAR@TT                                             
     CSR                   Z-ADD*ZEROS    $WK152 299                            
     CSR                   MOVE *BLANKS   DSKY$1                                
     CSR                   MOVEL*BLANKS   K1TXA1                                
     CSR                   Z-ADD*ZEROS    K1ITM                                 
     CSR                   MOVE *BLANKS   K1EXR1                                
     CSR                   MOVE 'I'       PACTN                                 
     CSR                   MOVE 'GE'      PRULE                                 
     CSR                   MOVE '0'       PSTAT1                                
     C*                                                                         
     CSR         PSTAT1    DOWEQ'0'                                             
     C*                                                                         
     CSR                   MOVE *BLANKS   PKEY                                  
DBN12CSR                   MOVELDSKY$1    PKEY                                  
     C*                                                                         
     CSR                   EXSR S0041                                           
     C*                    ---- -----                                           
     C*                                                                         
     CSR         $1TXA1    IFEQ K1TXA1                                          
     CSR         $1ITM1    ANDEQK1ITM                                           
     CSR         $1EXR1    ANDEQK1EXR1                                          
     CSR         $1TAX1    ANDEQK1TAX1                                          
     CSR                   MOVE '1'       PSTAT1                                
     CSR                   END                                                  
     C*                                                                         
     CSR         PSTAT1    IFEQ '0'                                             
     C*                                                                         
     C*    Set array index to correct value based on taxable field.             
     C*                                                                         
     CSR         $1TAX1    IFEQ 'Y'                                             
     CSR                   Z-ADD1         #R                                    
     CSR                   END                                                  
     CSR         $1TAX1    IFEQ 'N'                                             
     CSR                   Z-ADD2         #R                                    
     CSR                   END                                                  
     CSR         $1TAX1    IFEQ '3'                                             
     CSR                   Z-ADD3         #R                                    
     CSR                   END                                                  
     CSR         $1TAX1    IFEQ '4'                                             
     CSR                   Z-ADD4         #R                                    
     CSR                   END                                                  
     CSR         $1TAX1    IFEQ '5'                                             
     CSR                   Z-ADD5         #R                                    
     CSR                   END                                                  
     CSR         $1TAX1    IFEQ '6'                                             
     CSR                   Z-ADD6         #R                                    
     CSR                   END                                                  
     CSR         $1TAX1    IFEQ '7'                                             
     CSR                   Z-ADD7         #R                                    
     CSR                   END                                                  
     CSR         $1TAX1    IFEQ '8'                                             
     CSR                   Z-ADD8         #R                                    
     CSR                   END                                                  
     C*                                                                         
     CSR                   Z-ADD$1UTAM    $WK150    H                           
     C*                                                                         
     CSR                   Z-ADD$WK150    $WK152                                
     C*                                                                         
     CSR                   MOVE *BLANKS   DSKY$1                                
     CSR                   MOVE $1TXA1    K1TXA1                                
     CSR                   MOVE $1ITM1    K1ITM                                 
     CSR                   MOVE $1EXR1    K1EXR1                                
     CSR                   MOVE $1TAX1    K1TAX1                                
     CSR                   MOVE 'GT'      PRULE                                 
     CSR         $@CNV     IFEQ '1'                                             
     C*                                                                         
     CSR         $@CURR    IFEQ '1'                                             
     CSR                   DIV  #@FDO     $WK152                                
     CSR                   ELSE                                                 
     CSR                   DIV  #@CDO     $WK152                                
     CSR                   END                                                  
     C*                                                                         
     CSR                   END                                                  
     C*                                                                         
     CSR         $@CNV     IFNE '1'                                             
     CSR                   DIV  #@STA1    $WK152                                
     CSR                   END                                                  
     CSR                   ADD  $WK152    @TT,#R                                
     CSR                   END                                                  
     C*                                                                         
     CSR                   END                                                  
     CSR                   END                                                  
     C*                                                                         
     C*    If printing by Tax Area or Authority, write until                    
     C*    Tax Amount array is zero.                                            
     C*                                                                         
     CSR                   Z-ADD1         #R                                    
     CSR                   Z-ADD1         $LNUM                                 
B1   CSR         @TM,#R    DOWNE0                                               
     C*                                                                         
     C*    If printing by Tax Group, write up to eight lines.                   
     C*                                                                         
     CSR         $@VAT     OREQ '1'                                             
     CSR         $LNUM     ANDLE8                                               
     C*                                                                         
     C*    Skip record if blank.                                                
     C*                                                                         
     CSR                   ADD  1         $LNUM   10                            
B2   CSR         @TM,#R    IFNE 0                                               
     C*                                                                         
B3   CSR         $@VAT     IFEQ '1'                                             
B4   CSR         #R        IFEQ 1                                               
     CSR                   MOVEL'Y'       $ATX                                  
E4   CSR                   ENDIF                                                
B4   CSR         #R        IFEQ 2                                               
     CSR                   MOVEL'N'       $ATX                                  
E4   CSR                   ENDIF                                                
B4   CSR         #R        IFEQ 3                                               
     CSR                   MOVEL'3'       $ATX                                  
E4   CSR                   ENDIF                                                
B4   CSR         #R        IFEQ 4                                               
     CSR                   MOVEL'4'       $ATX                                  
E4   CSR                   ENDIF                                                
B4   CSR         #R        IFEQ 5                                               
     CSR                   MOVEL'5'       $ATX                                  
E4   CSR                   ENDIF                                                
B4   CSR         #R        IFEQ 6                                               
     CSR                   MOVEL'6'       $ATX                                  
E4   CSR                   ENDIF                                                
B4   CSR         #R        IFEQ 7                                               
     CSR                   MOVEL'7'       $ATX                                  
E4   CSR                   ENDIF                                                
B4   CSR         #R        IFEQ 8                                               
     CSR                   MOVEL'8'       $ATX                                  
E4   CSR                   ENDIF                                                
     C*                                                                         
     C*    Move to output - Tax Area Description                                
     C*                                                                         
     CSR                   MOVE ') '      $ATX                                  
X3   CSR                   ELSE                                                 
     CSR                   MOVEL*BLANKS   $ATX    3                             
E3   CSR                   ENDIF                                                
     C*                                                                         
     CSR                   CLEAR@UA                                             
     CSR                   MOVEA@TD,#R    @UA                                   
     CSR                   Z-ADD27        #OUTLG                                
     CSR                   EXSR C9822                                           
     C*                    ---- -----                                           
     CSR                   MOVEA@UB       $$DSC2 27                             
S1203CSR                   MOVEL$ATX      RRDSC3 30                             
     CSR                   MOVE $$DSC2    RRDSC3                                
     C*                                                                         
     C*    Move $ or % sign in ( )                                              
     C*                                                                         
     C***        $@VAT     IFNE '1'                                            V
     CSR                   MOVE '   '     RRFVTY                                
     CSR                   MOVEL'('       RRFVTY                                
     CSR                   MOVE @TF,#R    RRFVTY                                
     CSR                   MOVE ')'       RRFVTY                                
     C***                  ENDIF                                               V
     C*----------------------------------------------------------------         
     C*                                                                         
     C*    Tax % or $ amount                                                    
     C*                                                                         
     C***        $@VAT     IFNE '1'                                            V
     CSR                   Z-ADD0         $WK153 153                            
     CSR                   MOVE @TR,#R    $WK153 153                            
     CSR                   Z-ADD$WK153    $WK154 299                            
B4   CSR         $@CURR    IFEQ '1'                                             
     C*                                                                         
B5   CSR         @TF,#R    IFEQ '$'                                             
B6   CSR         $$CRYR    IFEQ 'Y'                                             
     CSR         SDCRR     ANDNE*ZERO                                           
     CSR                   DIV  SDCRR     $WK154    H                           
E6   CSR                   ENDIF                                                
B6   CSR         $$CRYR    IFEQ 'Z'                                             
     CSR         SDCRR     ANDNE*ZERO                                           
     CSR                   MULT SDCRR     $WK154    H                           
E6   CSR                   ENDIF                                                
     CSR         $WK154    MULT @TY,#R    @TZ,#R    H                           
     CSR                   Z-ADD$WK154    $WK153    H                           
E5   CSR                   ENDIF                                                
E4   CSR                   ENDIF                                                
     C*                                                                         
     CSR         $WK153    MULT #@TRAT    $WK150                                
     CSR                   MOVE *BLANK    #SINBR                                
     CSR                   MOVE $WK150    #SINBR                                
     CSR                   MOVE T@TRAT    #DTYP                                 
     CSR                   MOVE W@TRAT    #EWRD                                 
     CSR                   MOVE E@TRAT    #EC                                   
     CSR                   MOVE F@TRAT    #DSPD                                 
     CSR                   MOVE G@TRAT    #DATD                                 
     CSR                   MOVE J@TRAT    #ALR                                  
     CSR                   MOVE ' '       #ECOR                                 
     CSR                   MOVE ' '       #DCOR                                 
     CSR                   EXSR C00161                                          
     C*                    ---- ------                                          
B4   CSR         #ALR      IFEQ 'L'                                             
     CSR                   MOVEL#SINBR    RRTXR1                                
X4   CSR                   ELSE                                                 
     CSR                   MOVE #SINBR    RRTXR1                                
E4   CSR                   ENDIF                                                
     CSR         $@VAT     IFEQ '1'                                            V
     CSR         $MLTTX    ANDNE*BLANKS                                        V
     CSR                   CLEAR@UA                                            V
     CSR                   MOVEAVTX012    @UA                                  V
     CSR                   Z-ADD25        #OUTLG                               V
     CSR                   EXSR C9822                                          V
     C*                    -----------                                         V
     CSR                   MOVEA@UB       RRTXR1                               V
     CSR                   MOVE *BLANK    RRFVTY                               V
     CSR                   ENDIF                                               V
     C***                  ENDIF                                               V
     C*----------------------------------------------------------------         
     C*                                                                         
     C*    Taxable amount                                                       
     C*                                                                         
     CSR                   MOVE *BLANK    #SINBR                                
     C*                                                                         
     C*    Display Foreign                                                      
     C*                                                                         
B3   CSR         $@CNV     IFEQ '1'                                             
     CSR         $@CURR    ANDEQ'1'                                             
     CSR         @TF,#R    ANDNE'$'                                             
     CSR                   Z-ADD@TM,#R    $WK150                                
     CSR                   MOVE *BLANK    #SINBR                                
     CSR                   MOVE $WK150    #SINBR                                
     CSR                   MOVE T@FEA     #DTYP                                 
     CSR                   MOVE W@FEA     #EWRD                                 
     CSR                   MOVE E@FEA     #EC                                   
     CSR                   MOVE $FDO      #DSPD                                 
     CSR                   MOVE G@FEA     #DATD                                 
     CSR                   MOVE J@FEA     #ALR                                  
     CSR                   MOVE ' '       #ECOR                                 
     CSR                   MOVE ' '       #DCOR                                 
     CSR                   EXSR C00161                                          
     C*                    ---- ------                                          
B4   CSR         #ALR      IFEQ 'L'                                             
DBN  CSR                   MOVEL#SINBR    RRATXA                                
X4   CSR                   ELSE                                                 
DBN  CSR                   MOVE #SINBR    RRATXA                                
E4   CSR                   ENDIF                                                
X3   CSR                   ELSE                                                 
     C*                                                                         
     C*    Display Domestic                                                     
     C*                                                                         
B4   CSR         $@CNV     IFEQ '1'                                             
     CSR         $@CURR    ANDEQ' '                                             
     CSR                   MOVE $CDO      #DSPD                                 
E4   CSR                   ENDIF                                                
     C*                                                                         
     C*    No Foreign Currency                                                  
     C*                                                                         
B4   CSR         $@CNV     IFNE '1'                                             
     CSR                   MOVE F@AEXP    #DSPD                                 
E4   CSR                   ENDIF                                                
     C*                                                                         
     CSR                   Z-ADD@TM,#R    $WK150                                
     CSR                   MOVE $WK150    #SINBR                                
     CSR                   MOVE T@AEXP    #DTYP                                 
     CSR                   MOVE W@AEXP    #EWRD                                 
     CSR                   MOVE E@AEXP    #EC                                   
     CSR                   MOVE G@AEXP    #DATD                                 
     CSR                   MOVE J@AEXP    #ALR                                  
     CSR                   MOVE ' '       #ECOR                                 
     CSR                   MOVE ' '       #DCOR                                 
     CSR                   EXSR C00161                                          
     C*                    ---- ------                                          
B4   CSR         #ALR      IFEQ 'L'                                             
DBN  CSR                   MOVEL#SINBR    RRATXA                                
X4   CSR                   ELSE                                                 
DBN  CSR                   MOVE #SINBR    RRATXA                                
E4   CSR                   ENDIF                                                
     C*                                                                         
E3   CSR                   ENDIF                                                
     C*                                                                         
     C*    Save Tax Amount if summarizing by Tax Authority for Rounding         
     C*                                                                         
     CSR         $@VAT     IFEQ '3'                                             
     CSR                   Z-ADD@TM,#R    $STXAM 299                            
     CSR         $@CNV     IFEQ '1'                                             
     C*                                                                         
     CSR         $@CURR    IFEQ '1'                                             
     CSR                   DIV  #@FDO     $STXAM                                
     CSR                   ELSE                                                 
     CSR                   DIV  #@CDO     $STXAM                                
     CSR                   END                                                  
     CSR                   END                                                  
     C*                                                                         
     CSR         $@CNV     IFNE '1'                                             
     CSR                   DIV  #@STA1    $STXAM                                
     CSR                   END                                                  
     CSR                   END                                                  
     C*----------------------------------------------------------------         
     C*                                                                         
     C*    Load Tax Amount from Arrays if not Rounded                           
     C*                                                                         
     CSR         $RND      IFNE '1'                                             
     CSR         $@VAT     OREQ '1'                                             
     CSR                   Z-ADD@TT,#R    $WK152 299                            
     CSR                   ELSE                                                 
     C*                                                                         
     C*    Load Tax Amount from Sum of User Index if rounded                    
     C*                                                                         
     CSR         $@VAT     IFEQ '2'                                             
     CSR         $@VAT     OREQ '3'                                             
     CSR                   Z-ADD*ZEROS    $WK152 299                            
     CSR                   MOVE *BLANKS   DSKY$1                                
DBN10CSR                   MOVEL@TD,#R    K1TXA1                                
     CSR                   Z-ADD@IT,#R    K1ITM                                 
     CSR                   MOVE *BLANKS   K1EXR1                                
     CSR                   MOVE *BLANKS   K1TAX1                                
     CSR                   MOVE 'I'       PACTN                                 
     CSR                   MOVE 'GE'      PRULE                                 
     CSR                   MOVE '0'       PSTAT1                                
     C*                                                                         
     CSR         PSTAT1    DOWEQ'0'                                             
     C*                                                                         
     CSR                   MOVE *BLANKS   PKEY                                  
DBN12CSR                   MOVELDSKY$1    PKEY                                  
     C*                                                                         
     CSR                   EXSR S0041                                           
     C*                    ---- -----                                           
     C*                                                                         
     CSR         $1TXA1    IFEQ K1TXA1                                          
     CSR         $1ITM1    ANDEQK1ITM                                           
     CSR         $1EXR1    ANDEQK1EXR1                                          
     CSR         $1TAX1    ANDEQK1TAX1                                          
     CSR                   MOVE '1'       PSTAT1                                
     CSR                   END                                                  
     C*                                                                         
     CSR         $1TXA1    IFNE K1TXA1                                          
     CSR         $1ITM1    ORNE K1ITM                                           
     CSR                   MOVE '1'       PSTAT1                                
     CSR                   END                                                  
     C*                                                                         
     CSR         PSTAT1    IFEQ '0'                                             
     CSR         $1TAX1    IFNE 'N'                                             
     CSR                   Z-ADD$1UTAM    $WK150    H                           
     C*                                                                         
     C*                                                                         
     CSR                   ADD  $WK150    $WK152                                
     CSR                   ENDIF                                                
     C*                                                                         
     CSR                   MOVE *BLANKS   DSKY$1                                
     CSR                   MOVE $1TXA1    K1TXA1                                
     CSR                   MOVE $1ITM1    K1ITM                                 
     CSR                   MOVE $1EXR1    K1EXR1                                
     CSR                   MOVE $1TAX1    K1TAX1                                
     CSR                   MOVE 'GT'      PRULE                                 
     CSR                   END                                                  
     C*                                                                         
     CSR                   END                                                  
     CSR         $@CNV     IFEQ '1'                                             
     C*                                                                         
     CSR         $@CURR    IFEQ '1'                                             
     CSR                   DIV  #@FDO     $WK152                                
     CSR                   ELSE                                                 
     CSR                   DIV  #@CDO     $WK152                                
     CSR                   END                                                  
     C*                                                                         
     CSR                   END                                                  
     C*                                                                         
     CSR         $@CNV     IFNE '1'                                             
     CSR                   DIV  #@STA1    $WK152                                
     CSR                   END                                                  
     CSR                   END                                                  
     CSR                   END                                                  
     C*                                                                         
     C*                                                                         
     C*    Tax Amount                                                           
     C*                                                                         
     CSR                   MOVE *BLANK    #SINBR                                
     C*                                                                         
     C*    Display Foreign                                                      
     C*                                                                         
B3   CSR         $@CNV     IFEQ '1'                                             
     CSR         $@CURR    ANDEQ'1'                                             
     CSR         @TF,#R    ANDNE'$'                                             
     CSR         $WK152    MULT #@FDO     $WK150    H                           
     CSR                   MOVE $WK150    #SINBR                                
     CSR                   MOVE T@FEA     #DTYP                                 
     CSR                   MOVE W@FEA     #EWRD                                 
     CSR                   MOVE E@FEA     #EC                                   
     CSR                   MOVE $FDO      #DSPD                                 
     CSR                   MOVE G@FEA     #DATD                                 
     CSR                   MOVE J@FEA     #ALR                                  
     CSR                   MOVE ' '       #ECOR                                 
     CSR                   MOVE ' '       #DCOR                                 
     CSR                   EXSR C00161                                          
     C*                    ---- ------                                          
B4   CSR         #ALR      IFEQ 'L'                                             
DBN  CSR                   MOVEL#SINBR    RRSTAM                                
X4   CSR                   ELSE                                                 
DBN  CSR                   MOVE #SINBR    RRSTAM                                
E4   CSR                   ENDIF                                                
X3   CSR                   ELSE                                                 
     C*                                                                         
     C*    Display Domestic                                                     
     C*                                                                         
B4   CSR         $@CNV     IFEQ '1'                                             
     CSR         $@CURR    ANDEQ' '                                             
     CSR         $WK152    MULT #@CDO     $WK150    H                           
     CSR                   MOVE $CDO      #DSPD                                 
E4   CSR                   ENDIF                                                
     C*                                                                         
     C*    No Foreign Currency                                                  
     C*                                                                         
B4   CSR         $@CNV     IFNE '1'                                             
     CSR         $WK152    MULT #@AEXP    $WK150    H                           
     CSR                   MOVE F@AEXP    #DSPD                                 
E4   CSR                   ENDIF                                                
     C*                                                                         
     CSR                   MOVE $WK150    #SINBR                                
     CSR                   MOVE T@AEXP    #DTYP                                 
     CSR                   MOVE W@AEXP    #EWRD                                 
     CSR                   MOVE E@AEXP    #EC                                   
     CSR                   MOVE G@AEXP    #DATD                                 
     CSR                   MOVE J@AEXP    #ALR                                  
     CSR                   MOVE ' '       #ECOR                                 
     CSR                   MOVE ' '       #DCOR                                 
     CSR                   EXSR C00161                                          
     C*                    ---- ------                                          
B4   CSR         #ALR      IFEQ 'L'                                             
DBN  CSR                   MOVEL#SINBR    RRSTAM                                
X4   CSR                   ELSE                                                 
DBN  CSR                   MOVE #SINBR    RRSTAM                                
E4   CSR                   ENDIF                                                
E3   CSR                   ENDIF                                                
     C*----------------------------------------------------------------         
     C*                                                                         
     C*    If over flow indicator is on, print headings                         
     C*                                                                         
B2   CSR         $@EDI     IFNE '2'                                             
     C*                                                                         
     CSR         @@OFLN    SUB  @@CLNO    $$DIFF  30                            
B3   CSR         *INOF     IFEQ '1'                                             
     CSR         $$DIFF    ORLE $TOTL                                           
     CSR                   SETON                     31                         
     CSR                   Z-ADD$#PG      $$PGSV                                
     CSR                   Z-ADD##PGSV    $#PG                                  
     CSR                   EXSR S010H                                           
     C*                    ---- -----                                           
     CSR                   Z-ADD$#PG      ##PGSV                                
     CSR                   Z-ADD$$PGSV    $#PG                                  
     C*                                                                         
     C*                                                                         
     C*    Write order total line                                               
     C*                                                                         
     CSR                   WRITETOTAL1                 OF                       
     C*                    -----------                                          
     C*                                                                         
     C*    Write tax heading                                                    
     C*                                                                         
     CSR                   WRITETOTAL2                 OF                       
     C*                    -----------                                          
     CSR                   SETOF                     31OF02                     
E3   CSR                   ENDIF                                                
     C*                                                                         
     C*    Write tax detail                                                     
     C*                                                                         
     CSR                   WRITETOTAL3                 OF                       
     C*                    -----------                                          
     C*                                                                         
E5   CSR                   ENDIF                                                
     C*----------------------------------------------------------------         
     C*                                                                         
     C*    Check for Tax Authority                                              
     C*                                                                         
B3   CSR         $@VAT     IFEQ '3'                                             
     C*                                                                         
     C*    Move fields to output and write detail for each authority            
     C*                                                                         
     CSR                   Z-ADD@AH,#T    $#LNCT  10                            
     CSR                   Z-ADD*ZEROS    $#DCNT  10       |DETAIL COUNT        
     C*                                                                         
     C*    Check for rounding problem                                           
     CSR                   EXSR S0043                                           
     CSR         $TRND     SUB  $DRND     $W150  150                            
     C*                                                                         
     C*    Do for number of Authority Lines in Tax Area.                        
     C*                                                                         
B4   CSR                   DO   $#LNCT                                          
     CSR                   ADD  1         $#DCNT                                
     CSR                   ADD  1         #R                                    
     C*----------------------------------------------------------------         
     C*                                                                         
     C*    Move to report - Authority Description                               
     C*                                                                         
     CSR                   CLEAR@UA                                             
     CSR                   MOVEA@TD,#R    @UA                                   
     CSR                   Z-ADD25        #OUTLG                                
     CSR                   EXSR C9822                                           
     C*                    ---- -----                                           
     CSR                   MOVEA@UB       R4DSC2                                
     C*----------------------------------------------------------------         
     C*                                                                         
     C*    Move to report - Authority Rate                                      
     C*                                                                         
     CSR                   MOVE @TR,#R    $WK153 153                            
     CSR         $WK153    MULT #@TRAT    $WK150    H                           
     CSR                   MOVE *BLANK    #SINBR                                
     CSR                   MOVE $WK150    #SINBR                                
     CSR                   MOVE T@TRAT    #DTYP                                 
     CSR                   MOVE W@TRAT    #EWRD                                 
     CSR                   MOVE E@TRAT    #EC                                   
     CSR                   MOVE F@TRAT    #DSPD                                 
     CSR                   MOVE G@TRAT    #DATD                                 
     CSR                   MOVE J@TRAT    #ALR                                  
     CSR                   MOVE ' '       #ECOR                                 
     CSR                   MOVE ' '       #DCOR                                 
     CSR                   EXSR C00161                                          
     C*                    ---- ------                                          
B5   CSR         #ALR      IFEQ 'L'                                             
DBN  CSR                   MOVEL#SINBR    R4TXR1                                
X5   CSR                   ELSE                                                 
DBN  CSR                   MOVE #SINBR    R4TXR1                                
E5   CSR                   ENDIF                                                
     C*----------------------------------------------------------------         
     C*                                                                         
     C*    Move to report - Authority Taxable Amount                            
     C*                                                                         
B3   CSR         $@CNV     IFEQ '1'                                             
     CSR         $@CURR    ANDEQ'1'                                             
     CSR         @TF,#R    ANDNE'$'                                             
     CSR                   Z-ADD@TM,#R    $WK150                                
     CSR                   MOVE *BLANK    #SINBR                                
     CSR                   MOVE $WK150    #SINBR                                
     CSR                   MOVE T@FEA     #DTYP                                 
     CSR                   MOVE W@FEA     #EWRD                                 
     CSR                   MOVE E@FEA     #EC                                   
     CSR                   MOVE $FDO      #DSPD                                 
     CSR                   MOVE G@FEA     #DATD                                 
     CSR                   MOVE J@FEA     #ALR                                  
     CSR                   MOVE ' '       #ECOR                                 
     CSR                   MOVE ' '       #DCOR                                 
     CSR                   EXSR C00161                                          
     C*                    ---- ------                                          
B4   CSR         #ALR      IFEQ 'L'                                             
DBN  CSR                   MOVEL#SINBR    R4ATXA                                
X4   CSR                   ELSE                                                 
DBN  CSR                   MOVE #SINBR    R4ATXA                                
E4   CSR                   ENDIF                                                
X3   CSR                   ELSE                                                 
     C*                                                                         
     C*    Display Domestic                                                     
     C*                                                                         
B4   CSR         $@CNV     IFEQ '1'                                             
     CSR         $@CURR    ANDEQ' '                                             
     CSR                   MOVE $CDO      #DSPD                                 
E4   CSR                   ENDIF                                                
     C*                                                                         
     C*    No Foreign Currency                                                  
     C*                                                                         
B4   CSR         $@CNV     IFNE '1'                                             
     CSR                   MOVE F@AEXP    #DSPD                                 
E4   CSR                   ENDIF                                                
     C*                                                                         
     CSR                   Z-ADD@TM,#R    $WK150                                
     CSR                   MOVE $WK150    #SINBR                                
     CSR                   MOVE T@AEXP    #DTYP                                 
     CSR                   MOVE W@AEXP    #EWRD                                 
     CSR                   MOVE E@AEXP    #EC                                   
     CSR                   MOVE G@AEXP    #DATD                                 
     CSR                   MOVE J@AEXP    #ALR                                  
     CSR                   MOVE ' '       #ECOR                                 
     CSR                   MOVE ' '       #DCOR                                 
     CSR                   EXSR C00161                                          
     C*                    ---- ------                                          
B4   CSR         #ALR      IFEQ 'L'                                             
DBN  CSR                   MOVEL#SINBR    R4ATXA                                
X4   CSR                   ELSE                                                 
DBN  CSR                   MOVE #SINBR    R4ATXA                                
E4   CSR                   ENDIF                                                
     C*                                                                         
E3   CSR                   ENDIF                                                
     C*----------------------------------------------------------------         
     C*                                                                         
     C*    Move to report - Authority Tax Amount                                
     C*                                                                         
     CSR                   MOVE *BLANK    #SINBR                                
     C*                                                                         
     CSR                   Z-ADD*ZEROS    $WK152                                
     CSR         $RND      IFNE '1'                                             
     CSR                   Z-ADD@TT,#R    $WK152                                
     CSR                   ELSE                                                 
     C*                                                                         
     CSR         @TT,#R    IFNE *ZEROS                                          
     CSR                   Z-ADD@TM,#R    $WK152                                
     C*                                                                         
     CSR         $@CNV     IFNE '1'                                             
     CSR                   Z-ADD@TM,#R    $WK152                                
     CSR                   END                                                  
     C*                                                                         
     CSR         $WK153    DIV  100       $W299  299H                           
     CSR                   MULT $W299     $WK152    H                           
     C*                                                                         
     CSR         $@CNV     IFEQ '1'                                             
     CSR         $@CURR    IFEQ '1'                                             
     CSR                   DIV  #@FDO     $WK152                                
     CSR         $W150     DIV  #@FDO     $W152  152                            
     CSR                   ELSE                                                 
     CSR                   DIV  #@CDO     $WK152                                
     CSR         $W150     DIV  #@CDO     $W152  152                            
     CSR                   END                                                  
     CSR                   END                                                  
     C*                                                                         
     CSR         $@CNV     IFNE '1'                                             
     CSR                   DIV  #@STA1    $WK152                                
     CSR         $W150     DIV  #@STA1    $W152  152                            
     CSR                   END                                                  
     C*                                                                         
     C*  Add rounding error amount to first tax authority                       
     CSR         $#DCNT    IFEQ 1                                               
     CSR         $W152     ANDLE.05                        |LIMIT ERROR         
     CSR         $W152     ANDGE-.05                                            
     CSR                   ADD  $W152     $WK152                                
     CSR                   END                                                  
     C*                                                                         
     CSR                   END                                                  
     CSR                   END                                                  
     C*                                                                         
     C*    Display Foreign                                                      
     C*                                                                         
B5   CSR         $@CNV     IFEQ '1'                                             
     CSR         $@CURR    ANDEQ'1'                                             
     CSR         $WK152    MULT #@FDO     $WK150    H                           
     CSR                   MOVE $WK150    #SINBR                                
     CSR                   MOVE T@FEA     #DTYP                                 
     CSR                   MOVE W@FEA     #EWRD                                 
     CSR                   MOVE E@FEA     #EC                                   
     CSR                   MOVE $FDO      #DSPD                                 
     CSR                   MOVE G@FEA     #DATD                                 
     CSR                   MOVE J@FEA     #ALR                                  
     CSR                   MOVE ' '       #ECOR                                 
     CSR                   MOVE ' '       #DCOR                                 
     CSR                   EXSR C00161                                          
     C*                    ---- ------                                          
B6   CSR         #ALR      IFEQ 'L'                                             
DBN  CSR                   MOVEL#SINBR    R4STAM                                
X6   CSR                   ELSE                                                 
DBN  CSR                   MOVE #SINBR    R4STAM                                
E6   CSR                   ENDIF                                                
X5   CSR                   ELSE                                                 
     C*                                                                         
     C*    Display Domestic                                                     
     C*                                                                         
B6   CSR         $@CNV     IFEQ '1'                                             
     CSR         $@CURR    ANDEQ' '                                             
     CSR                   MOVE $CDO      #DSPD                                 
     CSR         $WK152    MULT #@CDO     $WK150    H                           
E6   CSR                   ENDIF                                                
     C*                                                                         
     C*    No Foreign Currency                                                  
     C*                                                                         
B6   CSR         $@CNV     IFNE '1'                                             
     CSR                   MOVE F@AEXP    #DSPD                                 
     CSR         $WK152    MULT #@AEXP    $WK150    H                           
E6   CSR                   ENDIF                                                
     C*                                                                         
     CSR                   MOVE $WK150    #SINBR                                
     CSR                   MOVE T@AEXP    #DTYP                                 
     CSR                   MOVE W@AEXP    #EWRD                                 
     CSR                   MOVE E@AEXP    #EC                                   
     CSR                   MOVE G@AEXP    #DATD                                 
     CSR                   MOVE J@AEXP    #ALR                                  
     CSR                   MOVE ' '       #ECOR                                 
     CSR                   MOVE ' '       #DCOR                                 
     CSR                   EXSR C00161                                          
     C*                    ---- ------                                          
B6   CSR         #ALR      IFEQ 'L'                                             
DBN  CSR                   MOVEL#SINBR    R4STAM                                
X6   CSR                   ELSE                                                 
DBN  CSR                   MOVE #SINBR    R4STAM                                
E6   CSR                   ENDIF                                                
     C*                                                                         
E5   CSR                   ENDIF                                                
     C*----------------------------------------------------------------         
     C*                                                                         
     C*    If over flow indicator is on, print headings                         
     C*                                                                         
B2   CSR         $@EDI     IFNE '2'                                             
     C*                                                                         
     CSR         @@OFLN    SUB  @@CLNO    $$DIFF  30                            
B5   CSR         *INOF     IFEQ '1'                                             
     CSR         $$DIFF    ORLE $TOTL                                           
     CSR                   SETON                     31                         
     CSR                   Z-ADD$#PG      $$PGSV                                
     CSR                   Z-ADD##PGSV    $#PG                                  
     CSR                   EXSR S010H                                           
     C*                    ---- -----                                           
     CSR                   Z-ADD$#PG      ##PGSV                                
     CSR                   Z-ADD$$PGSV    $#PG                                  
     C*                                                                         
     C*    Write order total line                                               
     C*                                                                         
     CSR                   WRITETOTAL1                 OF                       
     C*                    -----------                                          
     C*                                                                         
     C*    Write tax heading                                                    
     C*                                                                         
     CSR                   WRITETOTAL2                 OF                       
     C*                    -----------                                          
     CSR                   SETOF                     31OF02                     
E5   CSR                   ENDIF                                                
     C*                                                                         
     C*    Write tax authority detail                                           
     C*                                                                         
     CSR                   WRITETOTAL4                 OF                       
     C*                    -----------                                          
E5   CSR                   ENDIF                                                
     C*                                                                         
E4   CSR                   ENDDO                                                
     CSR                   ADD  1         #T                                    
E3   CSR                   ENDIF                                                
E2   CSR                   ENDIF                                                
     CSR                   ADD  1         #R                                    
E1   CSR                   ENDDO                                                
     C*----------------------------------------------------------------         
     C*                                                                         
     C*    Clear arrays.                                                        
     C*                                                                         
     CSR                   MOVE *BLANKS   @TD                                   
     CSR                   MOVE *ZEROS    @TM                                   
     CSR                   MOVE *ZEROS    @TT                                   
     CSR                   MOVE *ZEROS    @TR                                   
     CSR                   MOVE *ZEROS    @IT                                   
     CSR                   MOVE *BLANKS   @TA                                   
     CSR                   MOVE *BLANKS   @TF                                   
     CSR                   MOVE *ZEROS    @TY                                   
     CSR                   MOVE *BLANKS   @TZ                                   
     CSR                   MOVEA*ZERO     @AH                                   
     CSR                   Z-ADD1         #R                                    
     CSR                   Z-ADD1         #T                                    
     CSR                   Z-ADD1         #Z                                    
     C*                                                                         
     C*    Clear Tax Summary Print Flag                                         
     C*                                                                         
     CSR                   MOVE ' '       $TAX    1                             
     C*----------------------------------------------------------------         
     CSR         END10X    ENDSR                                                
     C*****************************************************************         
     C*                                                                         
     C*    SUBROUTINE WRTHD1 - Write EDI Order Header                           
     C*    -----------------------------------------------------------          
     C*                                                                         
     CSR         WRTHD1    BEGSR                                                
     C*          ------    -----                                                
     C*                                                                         
     CSR                   MOVE '1'       $$EDIH                                
     CSR                   SETON                     40                         
     C*                                                                         
     C*    Skip record, if proof mode.                                          
     C*                                                                         
     CSR         $@UPDT    IFEQ '1'                                             
     CSR                   GOTO ENDHD1                                          
     CSR                   END                                                  
     C*                                                                         
     C*    Calculate Next EDI Document Number                                   
     C*                                                                         
     CSR                   MOVEL*ZEROS    SZEKCO                                
     C*                                                                         
     CSR                   MOVELSDMCU     PSMCU                                 
     CSR                   MOVE *BLANK    PSERR#                                
     CSR                   CALL 'X0006'                                         
     C*                    ---- -------                                         
     CSR                   PARM '1'       PSOMOD  1                             
     CSR                   PARM '1'       PSIMOD  1                             
     CSR                   PARM           PSMCU  12                             
     CSR                   PARM           PSERR#  4                             
     CSR                   PARM           I0006                                 
     C*                                                                         
     CSR         PSERR#    IFEQ *BLANK                                          
     CSR                   MOVELMCCO      $$EKCO  5                             
     CSR                   ELSE                                                 
     CSR                   MOVE '00000'   $$EKCO                                
     CSR                   END                                                  
     C*                                                                         
     C*    Calculate Fiscal Year based on the current date.                     
     C*                                                                         
     CSR                   MOVE '1'       #CALC                                 
     CSR                   MOVEL$$EKCO    #CO                                   
     CSR                   MOVEL$$EDT     #DG     60                            
     CSR                   CALL 'X09031'               99                       
     C*                    ---- --------                                        
     CSR                   PARM           #CALC   1                             
     CSR                   PARM           #CO     5                             
     CSR                   PARM           #DG     60                            
     CSR                   PARM           #PN     20                            
     CSR                   PARM           #FY     20                            
     CSR                   PARM           #CTRY   20                            
     CSR                   PARM           #EDT    1                             
     CSR                   PARM ' '       #DGSY   1                             
     C*                                                                         
     CSR                   SETOF                     84                         
     CSR         *IN84     DOWEQ'0'                                             
     CSR                   CALL 'X0010'                                         
     C*                    ---- -------                                         
     CSR                   PARM '47'      PSSY    4                             
     CSR                   PARM '01'      PSIDX   2                             
     CSR                   PARM *ZEROS    #NXTNO  80                            
     C*                                                                         
     CSR                   Z-ADD#NXTNO    SZEDOC                                
     CSR                   Z-ADD#NXTNO    $$EDOC  90                            
     C*                                                                         
     CSR                   SELEC                                                
     C*                                                                         
     C* For EDI invoice                                                         
     C*                                                                         
     CSR         $@EDST    WHEQ '810'                                           
     CSR         SZKEY1    SETLLI47046               8484                       
     CSR         *IN84     IFEQ '0'                                             
     CSR         SZKEY1    SETLLI470461              8484                       
     CSR                   END                                                  
     CSR         *IN84     IFEQ '0'                                             
     CSR         SZKEY1    SETLLI47047               8484                       
     CSR                   END                                                  
     CSR         *IN84     IFEQ '0'                                             
     CSR         SZKEY1    SETLLI470471              8484                       
     CSR                   END                                                  
     C*                                                                         
     C* For EDI Prod Transfer                                                   
     C*                                                                         
     CSR         $@EDST    WHEQ '867'                                           
     CSR         SZKEY1    SETLLI47186               8484                       
     CSR         *IN84     IFEQ '0'                                             
     CSR         SZKEY1    SETLLI471861              8484                       
     CSR                   END                                                  
     CSR         *IN84     IFEQ '0'                                             
     CSR         SZKEY1    SETLLI47187               8484                       
     CSR                   END                                                  
     CSR         *IN84     IFEQ '0'                                             
     CSR         SZKEY1    SETLLI471871              8484                       
     CSR                   END                                                  
     C*                                                                         
     C* For EDI RRFQ                                                            
     C*                                                                         
     CSR         $@EDST    WHEQ '843'                                           
     CSR         SZKEY1    SETLLI47106               8484                       
     CSR         *IN84     IFEQ '0'                                             
     CSR         SZKEY1    SETLLI471061              8484                       
     CSR                   END                                                  
     CSR         *IN84     IFEQ '0'                                             
     CSR         SZKEY1    SETLLI47107               8484                       
     CSR                   END                                                  
     CSR         *IN84     IFEQ '0'                                             
     CSR         SZKEY1    SETLLI471071              8484                       
     CSR                   END                                                  
     CSR                   ENDSL                                                
     CSR                   ENDDO                                                
     C*                                                                         
     CSR                   MOVELSHKCOO    SYKCOO                                
     CSR                   Z-ADDSHDOCO    SYDOCO                                
     CSR                   MOVELSHDCTO    SYDCTO                                
     CSR                   MOVELSHSFXO    SYSFXO                                
     CSR                   MOVELSHMCU     SYMCU                                 
     CSR                   MOVELSHCO      SYCO                                  
     CSR                   MOVELSHOKCO    SYOKCO                                
     CSR                   MOVELSHOORN    SYOORN                                
     CSR                   MOVELSHOCTO    SYOCTO                                
     CSR                   MOVELSHRKCO    SYRKCO                                
     CSR                   MOVELSHRORN    SYRORN                                
     CSR                   MOVELSHRCTO    SYRCTO                                
     CSR                   Z-ADDSHAN8     SYAN8                                 
     CSR                   Z-ADDSHSHAN    SYSHAN                                
     CSR                   MOVELSHPA8     SYPA8                                 
     CSR                   Z-ADDSHDRQJ    SYDRQJ                                
     CSR                   Z-ADDSHTRDJ    SYTRDJ                                
     CSR                   Z-ADDSHPDDJ    SYPDDJ                                
     CSR                   Z-ADDSHOPDJ    SYOPDJ                                
     CSR                   Z-ADDSHADDJ    SYADDJ                                
     CSR                   Z-ADDSHCNDJ    SYCNDJ                                
     CSR                   Z-ADDSHPPDJ    SYPPDJ                                
     CSR                   Z-ADDSHPSDJ    SYPSDJ                                
     CSR                   MOVELSHVR01    SYVR01                                
     CSR                   MOVELSHVR02    SYVR02                                
     CSR                   MOVELSHDEL1    SYDEL1                                
     CSR                   MOVELSHDEL2    SYDEL2                                
     CSR                   MOVELSHINMG    SYINMG                                
     CSR                   MOVELSHPTC     SYPTC                                 
     CSR                   MOVELSHPRGP    SYPRGP                                
     CSR                   Z-ADDSHTRDC    SYTRDC                                
     CSR                   Z-ADDSHPCRT    SYPCRT                                
     CSR                   MOVELSHTXA1    SYTXA1                                
     CSR                   MOVELSHEXR1    SYEXR1                                
     CSR                   MOVELSHTXCT    SYTXCT                                
     CSR                   MOVELSHPRIO    SYPRIO                                
     CSR                   MOVELSHBACK    SYBACK                                
     CSR                   MOVELSHSBAL    SYSBAL                                
     CSR                   MOVELSHNTR     SYNTR                                 
     CSR                   Z-ADDSHANBY    SYANBY                                
     CSR                   Z-ADDSHCARS    SYCARS                                
     CSR                   MOVELSHMOT     SYMOT                                 
     CSR                   MOVELSHCOT     SYCOT                                 
     CSR                   MOVELSHROUT    SYROUT                                
     CSR                   MOVELSHSTOP    SYSTOP                                
     CSR                   MOVELSHZON     SYZON                                 
     CSR                   MOVELSHCNID    SYCNID                                
     CSR                   MOVELSHFRTH    SYFRTH                                
     CSR                   MOVELSHAFT     SYAFT                                 
     CSR                   Z-ADDSHCMC1    SYCMC1                                
     CSR                   Z-ADDSHCMR1    SYCMR1                                
     CSR                   Z-ADDSHCMC2    SYCMC2                                
     CSR                   Z-ADDSHCMR2    SYCMR2                                
     CSR                   MOVELSHRCD     SYRCD                                 
     CSR                   Z-ADD*ZERO     SYOTOT                                
     CSR                   Z-ADD*ZERO     SYTOTC                                
     CSR                   MOVELSHWUMD    SYWUMD                                
     CSR                   MOVELSHVUMD    SYVUMD                                
     CSR                   MOVELSHAUTN    SYAUTN                                
     CSR                   MOVELSHCACT    SYCACT                                
     CSR                   Z-ADDSHCEXP    SYCEXP                                
     CSR                   MOVELSHCRRM    SYCRRM                                
     CSR                   MOVELSHCRCD    SYCRCD                                
     CSR                   Z-ADDSHCRR     SYCRR                                 
     CSR                   MOVELSHLNGP    SYLNGP                                
     CSR                   Z-ADDSHFAP     SYFAP                                 
     CSR                   Z-ADDSHFCST    SYFCST                                
     CSR                   MOVELSHORBY    SYORBY                                
     CSR                   MOVELSHTKBY    SYTKBY                                
     C*----------------------------------------------------------------         
     C*                                                                         
     C*    Move to output - EDI - Line Number                                   
     C*                                                                         
     CSR         1         MULT #@EDLN    SYEDLN                                
     C*----------------------------------------------------------------         
     C*                                                                         
     C*    Scrub and edit - User Reserved Fields                                
     C*                                                                         
     CSR                   MOVE SHURCD    SYURCD                                
     CSR                   MOVE SHURRF    SYURRF                                
     CSR                   Z-ADDSHURDT    SYURDT                                
     CSR                   Z-ADDSHURAT    SYURAT                                
     CSR                   Z-ADDSHURAB    SYURAB                                
     C*----------------------------------------------------------------         
     C*                                                                         
     C*    Scrub and edit - Fields added with A7.1                              
     C*                                                                         
     CSR                   Z-ADDSHPEFJ    SYPEFJ                                
     CSR                   MOVE SHRYIN    SYRYIN                                
     CSR                   MOVE SHASN     SYASN                                 
     CSR                   MOVE SHATXT    SYATXT                                
     CSR                   MOVE SHCRMD    SYCRMD                                
     C*----------------------------------------------------------------         
     CSR                   MOVE 'H'       SYEDTY                                
     CSR                   MOVE '01'      SYEDSQ                                
     CSR                   MOVEL$$EKCO    SYEKCO                                
     CSR                   MOVEL$$EDOC    SYEDOC                                
     CSR                   MOVEL$@EDCT    SYEDCT                                
     CSR                   MOVEL$@EDST    SYEDST                                
     CSR                   MOVEL$@EDFT    SYEDFT                                
     CSR                   Z-ADD0         SYEDDT                                
     CSR                   MOVE 'S'       SYEDER                                
     CSR                   Z-ADD0         SYEDDL                                
     CSR                   MOVE ' '       SYEDSP                                
     CSR                   MOVEL$$EDBT    SYEDBT                                
     CSR                   MOVEL$@PNID    SYPNID                                
     CSR                   MOVEL$@TPUR    SYTPUR                                
     CSR                   MOVEL##USER    SYTORG                                
     CSR                   MOVEL##USER    SYUSER                                
     CSR                   MOVEL##JOBN    SYJOBN                                
     CSR                   MOVEL##PROG    SYPID                                 
     CSR                   MOVEL$UDATE    SYUPMJ                                
     CSR                   MOVEL$$TIME    SYTDAY                                
     CSR                   MOVE ' '       $$810                                 
     CSR                   MOVE ' '       $$867                                 
     CSR                   MOVE ' '       $$843                                 
     CSR                   SELEC                                                
     CSR         $@EDST    WHEQ '810'                                           
     CSR                   WRITEI47046                 99                       
     CSR                   MOVE '1'       $$810   1                             
     CSR         $@EDST    WHEQ '867'                                           
     CSR                   WRITEI47186                 99                       
     CSR                   MOVE '1'       $$867   1                             
     CSR         $@EDST    WHEQ '843'                                           
     CSR                   WRITEI47106                 99                       
     CSR                   MOVE '1'       $$843   1                             
     CSR                   ENDSL                                                
     C*----------------------------------------------------------------         
     C*                                                                         
     C*    Load address information.                                            
     C*                                                                         
     CSR                   MOVE 'H'       ZAEDTY                                
     CSR                   MOVE '04'      ZAEDSQ                                
     CSR                   MOVE SYEKCO    ZAEKCO                                
     CSR                   Z-ADDSYEDOC    ZAEDOC                                
     CSR                   MOVE SYEDCT    ZAEDCT                                
     CSR                   Z-ADDSYEDLN    ZAEDLN                                
     CSR                   MOVE SYEDSP    ZAEDSP                                
     CSR                   MOVE SYEDBT    ZAEDBT                                
     CSR                   MOVE *BLANKS   ZAFILE                                
     CSR         $$810     IFEQ '1'                                             
     CSR                   MOVEL'F47046'  ZAFILE                                
     CSR                   ELSE                                                 
     CSR         $$867     IFEQ '1'                                             
     CSR                   MOVEL'F47186'  ZAFILE                                
     CSR                   ELSE                                                 
     CSR         $$843     IFEQ '1'                                             
     CSR                   MOVEL'F47106'  ZAFILE                                
     CSR                   ENDIF                                                
     CSR                   ENDIF                                                
     CSR                   ENDIF                                                
     CSR                   Z-ADDSYDOCO    ZADOCO                                
     CSR                   MOVE SYDCTO    ZADCTO                                
     CSR                   MOVE SYKCOO    ZAKCOO                                
     CSR                   MOVE '1'       ZAANTY                                
     CSR                   MOVE SYAN8     ZAAN8   80                            
     CSR                   MOVE SYUSER    ZATORG                                
     CSR                   MOVE SYUSER    ZAUSER                                
     CSR                   MOVE SYPID     ZAPID                                 
     CSR                   Z-ADDSYUPMJ    ZAUPMJ                                
     CSR                   MOVE SYJOBN    ZAJOBN                                
     CSR                   Z-ADDSYTDAY    ZATDAY                                
     C*                                                                         
     C*    Retrieve address from address file first.                            
     C*                                                                         
     CSR                   Z-ADDSYDOCO    OADOCO                                
     CSR                   MOVELSYDCTO    OADCTO                                
     CSR                   MOVELSYKCOO    OAKCOO                                
     CSR                   MOVE '1'       OAANTY                                
     CSR         OAKY01    CHAINI4006                8199                       
     C*                                                                         
     CSR         *IN81     IFEQ '0'                                             
     CSR         *IN99     ANDEQ'0'                                             
     CSR                   MOVE OAANTY    ZAANTY                                
     CSR                   MOVE OAMLNM    ZAMLNM                                
     CSR                   MOVE OAADD1    ZAADD1                                
     CSR                   MOVE OAADD2    ZAADD2                                
     CSR                   MOVE OAADD3    ZAADD3                                
     CSR                   MOVE OAADD4    ZAADD4                                
     CSR                   MOVE OAADDZ    ZAADDZ                                
     CSR                   MOVE OACTY1    ZACTY1                                
     CSR                   MOVE OACOUN    ZACOUN                                
     CSR                   MOVE OAADDS    ZAADDS                                
     CSR                   MOVE OACRTE    ZACRTE                                
     CSR                   MOVE OABKML    ZABKML                                
     CSR                   MOVE OACTR     ZACTR                                 
     CSR                   ELSE                                                 
     C*                                                                         
     C*    Alternately, retrieve from default address book files.               
     C*                                                                         
     CSR                   CLEARPS@@                                            
     CSR                   MOVELSYAN8     KY@@                                  
     CSR                   CALL 'XS0101LA'                                      
     C*                    ---- ----------                                      
     CSR                   PARM           PS@@                                  
     CSR         RT@@      IFNE 'N'                                             
     CSR                   MOVE D1@@      ZAMLNM                                
     CSR                   MOVE D2@@      ZAADD1                                
     CSR                   MOVE D3@@      ZAADD2                                
     CSR                   MOVE D4@@      ZAADD3                                
     CSR                   MOVE D5@@      ZAADD4                                
     C*                                                                         
     C*    Format the address based on the country constants.                   
     C*                                                                         
     CSR                   MOVE *BLANKS   @AD                                   
DBN  CSR                   MOVELI0116     PS0116                                
     CSR                   MOVELSYAN8     #1AN8                                 
     CSR                   MOVEL'1'       #1INQ                                 
     CSR                   CALL 'X01100'               98                       
     C*                    ---- --------                                        
     CSR                   PARM           DS1100                                
     CSR                   PARM           @AD                                   
     CSR                   PARM           PS0116                                
     C*                                                                         
     CSR         RT@@      IFNE 'N'                                             
DBN  CSR                   MOVELPS0116    I0116                                 
     CSR                   MOVE ALADDZ    ZAADDZ                                
     CSR                   MOVE ALCTY1    ZACTY1                                
     CSR                   MOVE ALCOUN    ZACOUN                                
     CSR                   MOVE ALADDS    ZAADDS                                
     CSR                   MOVE ALCTR     ZACTR                                 
     CSR                   MOVE *BLANKS   ZACRTE                                
     CSR                   MOVE *BLANKS   ZABKML                                
     CSR                   END                                                  
     CSR                   END                                                  
     CSR                   ENDIF                                                
     CSR                   WRITEI4706                                           
     CSR                   CLEARI4706                                           
     C*----------------------------------------------------------------         
     C*                                                                         
     C*    Load Ship To Address information.                                    
     C*                                                                         
     CSR                   MOVE 'H'       ZAEDTY                                
     CSR                   MOVE '04'      ZAEDSQ                                
     CSR                   MOVE SYEKCO    ZAEKCO                                
     CSR                   Z-ADDSYEDOC    ZAEDOC                                
     CSR                   MOVE SYEDCT    ZAEDCT                                
     CSR                   Z-ADDSYEDLN    ZAEDLN                                
     CSR                   MOVE SYEDSP    ZAEDSP                                
     CSR                   MOVE SYEDBT    ZAEDBT                                
     CSR                   MOVE *BLANKS   ZAFILE                                
     CSR         $$810     IFEQ '1'                                             
     CSR                   MOVEL'F47046'  ZAFILE                                
     CSR                   ELSE                                                 
     CSR         $$867     IFEQ '1'                                             
     CSR                   MOVEL'F47186'  ZAFILE                                
     CSR                   ELSE                                                 
     CSR         $$843     IFEQ '1'                                             
     CSR                   MOVEL'F47106'  ZAFILE                                
     CSR                   ENDIF                                                
     CSR                   ENDIF                                                
     CSR                   ENDIF                                                
     CSR                   Z-ADDSYDOCO    ZADOCO                                
     CSR                   MOVE SYDCTO    ZADCTO                                
     CSR                   MOVE SYKCOO    ZAKCOO                                
     CSR                   MOVE SYUSER    ZATORG                                
     CSR                   MOVE SYUSER    ZAUSER                                
     CSR                   MOVE SYPID     ZAPID                                 
     CSR                   Z-ADDSYUPMJ    ZAUPMJ                                
     CSR                   MOVE SYJOBN    ZAJOBN                                
     CSR                   Z-ADDSYTDAY    ZATDAY                                
     CSR                   MOVE '2'       ZAANTY                                
     CSR                   MOVE SYSHAN    ZAAN8                                 
     C*                                                                         
     C*    Retrieve address from address file first.                            
     C*                                                                         
     CSR                   Z-ADDSYDOCO    OADOCO                                
     CSR                   MOVELSYDCTO    OADCTO                                
     CSR                   MOVELSYKCOO    OAKCOO                                
     CSR                   MOVE '2'       OAANTY                                
     CSR         OAKY01    CHAINI4006                8199                       
     C*                                                                         
     CSR         *IN81     IFEQ '0'                                             
     CSR         *IN99     ANDEQ'0'                                             
     CSR                   MOVE OAANTY    ZAANTY                                
     CSR                   MOVE OAMLNM    ZAMLNM                                
     CSR                   MOVE OAADD1    ZAADD1                                
     CSR                   MOVE OAADD2    ZAADD2                                
     CSR                   MOVE OAADD3    ZAADD3                                
     CSR                   MOVE OAADD4    ZAADD4                                
     CSR                   MOVE OAADDZ    ZAADDZ                                
     CSR                   MOVE OACTY1    ZACTY1                                
     CSR                   MOVE OACOUN    ZACOUN                                
     CSR                   MOVE OAADDS    ZAADDS                                
     CSR                   MOVE OACRTE    ZACRTE                                
     CSR                   MOVE OABKML    ZABKML                                
     CSR                   MOVE OACTR     ZACTR                                 
     CSR                   ELSE                                                 
     C*                                                                         
     C*    Alternately, retrieve from default address book files.               
     C*                                                                         
     CSR                   CLEARPS@@                                            
     CSR                   MOVELSYSHAN    KY@@                                  
     CSR                   CALL 'XS0101LA'                                      
     C*                    ---- ----------                                      
     CSR                   PARM           PS@@                                  
     CSR         RT@@      IFNE 'N'                                             
     CSR                   MOVE D1@@      ZAMLNM                                
     CSR                   MOVE D2@@      ZAADD1                                
     CSR                   MOVE D3@@      ZAADD2                                
     CSR                   MOVE D4@@      ZAADD3                                
     CSR                   MOVE D5@@      ZAADD4                                
     C*                                                                         
     C*    Format the address based on the country constants.                   
     C*                                                                         
     CSR                   MOVE *BLANKS   @AD                                   
DBN  CSR                   MOVELI0116     PS0116                                
     CSR                   MOVELSYSHAN    #1AN8                                 
     CSR                   MOVEL'1'       #1INQ                                 
     CSR                   CALL 'X01100'               98                       
     C*                    ---- --------                                        
     CSR                   PARM           DS1100                                
     CSR                   PARM           @AD                                   
     CSR                   PARM           PS0116                                
     C*                                                                         
     CSR         RT@@      IFNE 'N'                                             
DBN  CSR                   MOVELPS0116    I0116                                 
     CSR                   MOVE ALADDZ    ZAADDZ                                
     CSR                   MOVE ALCTY1    ZACTY1                                
     CSR                   MOVE ALCOUN    ZACOUN                                
     CSR                   MOVE ALADDS    ZAADDS                                
     CSR                   MOVE ALCTR     ZACTR                                 
     CSR                   MOVE *BLANKS   ZACRTE                                
     CSR                   MOVE *BLANKS   ZABKML                                
     CSR                   END                                                  
     CSR                   END                                                  
     CSR                   ENDIF                                                
     CSR                   WRITEI4706                                           
     CSR                   CLEARI4706                                           
     C*----------------------------------------------------------------         
     C*                                                                         
     C*    Load extended text.                                                  
     C*                                                                         
     CSR                   MOVE SYEDTY    ZTEDTY                                
     CSR                   Z-ADD3         ZTEDSQ                                
     CSR                   MOVE SYEKCO    ZTEKCO                                
     CSR                   Z-ADDSYEDOC    ZTEDOC                                
     CSR                   MOVE SYEDCT    ZTEDCT                                
     CSR                   Z-ADDSYEDLN    ZTEDLN                                
     CSR                   MOVE SYEDSP    ZTEDSP                                
     CSR                   MOVE SYEDBT    ZTEDBT                                
     CSR                   MOVE *BLANKS   ZTFILE                                
     CSR                   MOVEL'F47046'  ZTFILE                                
     CSR                   MOVE JMTXLN    ZTTXLN                                
     CSR                   MOVELSYUSER    ZTTORG                                
     CSR                   MOVE SYUSER    ZTUSER                                
     CSR                   MOVE SYPID     ZTPID                                 
     CSR                   Z-ADDSYUPMJ    ZTUPMJ                                
     CSR                   MOVE SYJOBN    ZTJOBN                                
     CSR                   Z-ADDSYTDAY    ZTTDAY                                
     C*                                                                         
     CSR                   Z-ADDSYDOCO    JMDOCO                                
     CSR                   MOVELSYDCTO    JMDCTO                                
     CSR                   MOVELSYKCOO    JMKCOO                                
     CSR                   Z-ADD*ZEROS    JMLNID                                
     CSR         JMKY01    SETLLI4314                                           
     CSR                   SETOF                     8199                       
     CSR         JMKY01    READEI4314                    8199                   
     CSR         *IN81     DOWEQ'0'                                             
     CSR         *IN99     ANDEQ'0'                                             
     CSR                   Z-ADDJMDOCO    ZTDOCO                                
     CSR                   MOVE JMDCTO    ZTDCTO                                
     CSR                   MOVE JMKCOO    ZTKCOO                                
     CSR                   Z-ADDJMLNID    ZTLNID                                
     CSR                   MOVE JMPNTC    ZTPNTC                                
     CSR                   MOVE JMLINS    ZTLINS                                
     CSR                   MOVE JMTXLN    ZTTXLN                                
     CSR                   WRITEI4714                                           
     CSR         JMKY01    READEI4314                    8199                   
     CSR                   END                                                  
     C*----------------------------------------------------------------         
     CSR         ENDHD1    ENDSR                                                
     C*****************************************************************         
     C*                                                                         
     C*    SUBROUTINE WRTHD2 - Write EDI Additional Header                      
     C*    -----------------------------------------------------------          
     C*                                                                         
     CSR         WRTHD2    BEGSR                                                
     C*          ------    -----                                                
     C*                                                                         
     C*    Skip record, if proof mode.                                          
     C*                                                                         
     CSR         $@UPDT    IFEQ '1'                                             
     CSR                   GOTO ENDHD2                                          
     CSR                   END                                                  
     C*----------------------------------------------------------------         
     C*                                                                         
     C*    Load "Remit to" address information.                                 
     C*                                                                         
     CSR                   MOVE 'H'       ZAEDTY                                
     CSR                   MOVE '04'      ZAEDSQ                                
     CSR                   MOVE SYEKCO    ZAEKCO                                
     CSR                   Z-ADDSYEDOC    ZAEDOC                                
     CSR                   MOVE SYEDCT    ZAEDCT                                
     CSR                   Z-ADDSYEDLN    ZAEDLN                                
     CSR                   MOVE SYEDSP    ZAEDSP                                
     CSR                   MOVE SYEDBT    ZAEDBT                                
     CSR                   MOVE *BLANKS   ZAFILE                                
     CSR         $$810     IFEQ '1'                                             
     CSR                   MOVEL'F47046'  ZAFILE                                
     CSR                   ELSE                                                 
     CSR         $$867     IFEQ '1'                                             
     CSR                   MOVEL'F47186'  ZAFILE                                
     CSR                   ELSE                                                 
     CSR         $$843     IFEQ '1'                                             
     CSR                   MOVEL'F47106'  ZAFILE                                
     CSR                   ENDIF                                                
     CSR                   ENDIF                                                
     CSR                   ENDIF                                                
     CSR                   Z-ADDSYDOCO    ZADOCO                                
     CSR                   MOVE SYDCTO    ZADCTO                                
     CSR                   MOVE SYKCOO    ZAKCOO                                
     CSR                   MOVE '3'       ZAANTY                                
     CSR                   MOVE SYPA8     ZAAN8                                 
     CSR                   MOVE SYUSER    ZATORG                                
     CSR                   MOVE SYUSER    ZAUSER                                
     CSR                   MOVE SYPID     ZAPID                                 
     CSR                   Z-ADDSYUPMJ    ZAUPMJ                                
     CSR                   MOVE SYJOBN    ZAJOBN                                
     CSR                   Z-ADDSYTDAY    ZATDAY                                
     C*                                                                         
     C*    Alternately, retrieve from default address book files.               
     C*                                                                         
     CSR                   CLEARPS@@                                            
     CSR                   MOVELSYPA8     KY@@                                  
     CSR                   CALL 'XS0101LA'                                      
     C*                    ---- ----------                                      
     CSR                   PARM           PS@@                                  
     CSR         RT@@      IFNE 'N'                                             
     CSR                   MOVE D1@@      ZAMLNM                                
     CSR                   MOVE D2@@      ZAADD1                                
     CSR                   MOVE D3@@      ZAADD2                                
     CSR                   MOVE D4@@      ZAADD3                                
     CSR                   MOVE D5@@      ZAADD4                                
     C*                                                                         
     C*    Format the address based on the country constants.                   
     C*                                                                         
     CSR                   MOVE *BLANKS   @AD                                   
DBN  CSR                   MOVELI0116     PS0116                                
     CSR                   MOVELSYPA8     #1AN8                                 
     CSR                   MOVEL'1'       #1INQ                                 
     CSR                   CALL 'X01100'               98                       
     C*                    ---- --------                                        
     CSR                   PARM           DS1100                                
     CSR                   PARM           @AD                                   
     CSR                   PARM           PS0116                                
     C*                                                                         
     CSR         RT@@      IFNE 'N'                                             
DBN  CSR                   MOVELPS0116    I0116                                 
     CSR                   MOVE ALADDZ    ZAADDZ                                
     CSR                   MOVE ALCTY1    ZACTY1                                
     CSR                   MOVE ALCOUN    ZACOUN                                
     CSR                   MOVE ALADDS    ZAADDS                                
     CSR                   MOVE ALCTR     ZACTR                                 
     CSR                   MOVE *BLANKS   ZACRTE                                
     CSR                   MOVE *BLANKS   ZABKML                                
     CSR                   END                                                  
     CSR                   ENDIF                                                
     CSR                   WRITEI4706                                           
     CSR                   MOVE ZAMLNM    S3MLNM                                
     CSR                   CLEARI4706                                           
     C*----------------------------------------------------------------         
     C*                                                                         
     C*    Load "Remit to"  information                                         
     C*                                                                         
     CSR                   MOVE SZKCO     S3KCO                                 
     CSR                   Z-ADDSZDOC     S3DOC                                 
     CSR                   MOVELSZDCT     S3DCT                                 
     CSR                   Z-ADDSZDOCO    S3DOCO                                
     CSR                   MOVELSZDCTO    S3DCTO                                
     CSR                   MOVELSZSFXO    S3SFXO                                
     CSR                   MOVELSYMCU     S3MCU                                 
     CSR                   MOVE SYAN8     S3AN8                                 
     CSR                   MOVE 'R'       S3NAID                                
     CSR                   MOVE ABTAX     S3TAX                                 
     CSR                   MOVE ABTAXC    S3TAXC                                
     CSR                   MOVE ABTX2     S3TX2                                 
     C*----------------------------------------------------------------         
     C*                                                                         
     C*    Scrub and edit - Service/Tax Date                                    
     C*                                                                         
     CSR                   MOVEL$UDATE    S3DSVJ                                
     C*----------------------------------------------------------------         
     C*                                                                         
     C*    Output Summary Tax                                                   
     C*                                                                         
     CSR                   Z-ADDXTA,1     S3TA1                                 
     CSR                   Z-ADDXTA,2     S3TA2                                 
     CSR                   Z-ADDXTA,3     S3TA3                                 
     CSR                   Z-ADDXTA,4     S3TA4                                 
     CSR                   Z-ADDXTA,5     S3TA5                                 
     CSR                   Z-ADDXTR,1     S3TXR1                                
     CSR                   Z-ADDXTR,2     S3TXR2                                
     CSR                   Z-ADDXTR,3     S3TXR3                                
     CSR                   Z-ADDXTR,4     S3TXR4                                
     CSR                   Z-ADDXTR,5     S3TXR5                                
     CSR                   Z-ADDXAM,1     S3TAXT                                
     CSR                   Z-ADDXAM,2     S3TAX2                                
     CSR                   Z-ADDXAM,3     S3TAX3                                
     CSR                   Z-ADDXAM,4     S3TAX4                                
     CSR                   Z-ADDXAM,5     S3TAX5                                
     C*-------------------------------------------------------                  
     C*    Retrive Payment Term Information using Payment Term                  
     C*    code from header record.  This information is for                    
     C*    the outbound EDI record only.  The Payment Term Code                 
     C*    on the detail record is used to compute terms discount               
     C*    (as done in Sales Update).                                           
     C*                                                                         
     CSR                   MOVE PNPTD     S3PTD                                 
     CSR                   MOVE PNDCP     S3DCP                                 
     CSR                   MOVE PNDCD     S3DCD                                 
     CSR                   MOVE PNNDTP    S3NDTP                                
     CSR                   MOVE PNNSP     S3NSP                                 
     CSR                   MOVE PNDTPA    S3DTPA                                
     C*-------------------------------------------------------                  
     C*                                                                         
     C*    Move Last Invoice Date to Header Invoice Date                        
     C*                                                                         
     CSR                   Z-ADDSDIVD     S3IVD                                 
     C*-------------------------------------------------------                  
     C*                                                                         
     C*    Calculate Due Date.                                                  
     C*                                                                         
     CSR                   MOVELPSDD      S3DDJ            Net Due Datee        
     CSR                   MOVELPSDDD     S3DDU            Discount date        
     C*----------------------------------------------------------------         
     C*                                                                         
     C*    Write record                                                         
     CSR                   MOVE 'H'       S3EDTY                                
     CSR                   MOVE '02'      S3EDSQ                                
     CSR                   MOVEL$$EKCO    S3EKCO                                
     CSR                   MOVEL$$EDOC    S3EDOC                                
     CSR                   MOVEL$@EDCT    S3EDCT                                
     CSR                   Z-ADDSYEDLN    S3EDLN                                
     CSR                   MOVE ' '       S3EDSP                                
     CSR                   MOVEL$$EDBT    S3EDBT                                
     CSR                   MOVEL##USER    S3TORG                                
     CSR                   MOVEL##USER    S3USER                                
     CSR                   MOVEL##JOBN    S3JOBN                                
     CSR                   MOVEL##PROG    S3PID                                 
     CSR                   MOVEL$UDATE    S3UPMJ                                
     CSR                   MOVEL$$TIME    S3TDAY                                
     CSR         $@CNV     IFEQ '1'                                             
     CSR         $@CURR    ANDEQ'1'                                             
     CSR         $RND      IFEQ '1'                                             
     CSR                   ADD  $WKUTM    S3ACR     H                           
     CSR                   ADD  $WKUTM    S3FAP     H                           
     CSR                   Z-ADD$WKUTM    S3CTAM    H                           
     CSR                   ENDIF                                                
     C*                                                                         
     CSR                   ELSE                                                 
     CSR         $RND      IFEQ '1'                                             
     CSR                   ADD  $WKUTM    S3AG      H                           
     CSR                   ADD  $WKUTM    S3AAP     H                           
     CSR                   Z-ADD$WKUTM    S3STAM    H                           
     CSR                   ENDIF                                                
     CSR                   ENDIF                                                
     C*                                                                         
     CSR                   SELEC                                                
     CSR         $@EDST    WHEQ '810'                                           
     CSR                   WRITEI470461                99                       
     CSR                   CLEARI470461                                         
     CSR         $@EDST    WHEQ '867'                                           
     CSR                   WRITEI471861                99                       
     CSR                   CLEARI471861                                         
     CSR         $@EDST    WHEQ '843'                                           
     CSR                   WRITEI471061                99                       
     CSR                   CLEARI471061                                         
     CSR                   ENDSL                                                
     C*----------------------------------------------------------------         
     C*                                                                         
     C*    Update Header fields                                                 
     C*                                                                         
     CSR                   SELEC                                                
     CSR         $@EDST    WHEQ '810'                                           
     CSR         SZKEY1    CHAINI47046               99                         
     CSR         *IN99     IFEQ '0'                                             
     CSR         $LINE     MULT #@EDDL    SYEDDL                                
     CSR                   UPDATI47046                                          
     CSR                   END                                                  
     C*                                                                         
     CSR         $@EDST    WHEQ '867'                                           
     CSR         SZKEY1    CHAINI47186               99                         
     CSR         *IN99     IFEQ '0'                                             
     CSR         $LINE     MULT #@EDDL    SYEDDL                                
     CSR                   UPDATI47186                                          
     CSR                   END                                                  
     C*                                                                         
     CSR         $@EDST    WHEQ '843'                                           
     CSR         SZKEY1    CHAINI47106               99                         
     CSR         *IN99     IFEQ '0'                                             
     CSR         $LINE     MULT #@EDDL    SYEDDL                                
     CSR                   UPDATI47106                                          
     CSR                   END                                                  
     CSR                   ENDSL                                                
     C*----------------------------------------------------------------         
     C*                                                                         
     C*    Clear the accumulation fields for tag files.                         
     C*                                                                         
     CSR                   Z-ADD*ZEROS    $LINE   70                            
     CSR                   Z-ADD*ZEROS    XAM                                   
     CSR                   Z-ADD*ZEROS    XTA                                   
     CSR                   Z-ADD*ZEROS    XTR                                   
     CSR                   MOVE *BLANKS   $$EDIH                                
     CSR                   Z-ADD*ZEROS    $WKUTM                                
     C*                                                                         
     C*----------------------------------------------------------------         
     CSR         ENDHD2    ENDSR                                                
     C*****************************************************************         
     C*                                                                         
     C*    SUBROUTINE WRTDT1 - Write EDI Invoice Detail                         
     C*    -----------------------------------------------------------          
     C*                                                                         
     CSR         WRTDT1    BEGSR                                                
     C*          ------    -----                                                
     CSR         $@CNV     IFEQ '1'                                             
     CSR         $@CURR    ANDEQ'1'                                             
     CSR                   ADD  AG        S3ACR                                 
     CSR                   ADD  AG        S3FAP                                 
     CSR                   ELSE                                                 
     CSR                   ADD  AG        S3AG                                  
     CSR                   ADD  AG        S3AAP                                 
     CSR                   END                                                  
     C*                                                                         
     C*    Scrub and Edit - EDI - Line Number                                   
     C*                                                                         
     CSR                   ADD  1         $LINE                                 
     CSR         $LINE     MULT #@EDLN    SZEDLN                                
     C*----------------------------------------------------------------         
     C*                                                                         
     C*    Skip writing record, if proof mode.                                  
     C*                                                                         
     CSR         $@UPDT    IFEQ '1'                                             
     CSR                   GOTO BYPDT1                                          
     CSR                   END                                                  
     C*----------------------------------------------------------------         
     CSR                   MOVELSDKCOO    SZKCOO                                
     CSR                   Z-ADDSDDOCO    SZDOCO                                
     CSR                   MOVELSDDCTO    SZDCTO                                
     CSR                   Z-ADDSDLNID    SZLNID                                
     CSR                   MOVELSDSFXO    SZSFXO                                
     CSR                   MOVELSDMCU     SZMCU                                 
     CSR                   MOVELSDCO      SZCO                                  
     CSR                   MOVELSDOKCO    SZOKCO                                
     CSR                   MOVELSDOORN    SZOORN                                
     CSR                   MOVELSDOCTO    SZOCTO                                
     CSR                   Z-ADDSDOGNO    SZOGNO                                
     CSR                   MOVELSDRKCO    SZRKCO                                
     CSR                   MOVELSDRORN    SZRORN                                
     CSR                   MOVELSDRCTO    SZRCTO                                
     CSR                   Z-ADDSDRLLN    SZRLLN                                
     CSR                   Z-ADDSDAN8     SZAN8                                 
     CSR                   Z-ADDSDSHAN    SZSHAN                                
     CSR                   Z-ADDSDPA8     SZPA8                                 
     C*----------------------------------------------------------------         
     C*                                                                         
     C*    Scrub and edit - Dates                                               
     C*                                                                         
     CSR                   Z-ADDSDDRQJ    SZDRQJ                                
     CSR                   Z-ADDSDTRDJ    SZTRDJ                                
     CSR                   Z-ADDSDPDDJ    SZPDDJ                                
     CSR                   Z-ADDSDOPDJ    SZOPDJ                                
     CSR                   Z-ADDSDADDJ    SZADDJ                                
     CSR                   Z-ADDSDCNDJ    SZCNDJ                                
     CSR                   Z-ADDSDDGL     SZDGL                                 
     CSR                   Z-ADDSDRSDJ    SZRSDJ                                
     CSR                   Z-ADDSDPPDJ    SZPPDJ                                
     CSR                   Z-ADDSDPSDJ    SZPSDJ                                
     CSR                   Z-ADDSDIVD     SZIVD                                 
     C*----------------------------------------------------------------         
     C*                                                                         
     C*    Load customer item number through cross reference.                   
     C*                                                                         
     CSR                   Z-ADDSDITM     SZITM                                 
     CSR                   MOVELSDLITM    SZLITM                                
     CSR                   MOVELSDAITM    SZAITM                                
     CSR                   Z-ADDSDITM     PSITM   80                            
     CSR                   MOVEL*BLANK    PSSYM5  1                             
     CSR                   MOVEL$@XRT     PSXRT   2                             
     CSR                   Z-ADDSDAN8     PS#AN8  80                            
     CSR                   Z-ADDSDTRDJ    PSEXDJ  60                            
     CSR                   MOVEL*BLANKS   PSUITM 26                             
     C*                                                                         
     CSR                   CALL 'X40104'                                        
     C*                    -------------                                        
     CSR                   PARM           PSITM                                 
     CSR                   PARM           PSSYM5                                
     CSR                   PARM           PSXRT                                 
     CSR                   PARM           PS#AN8                                
     CSR                   PARM           PSEXDJ                                
     CSR                   PARM           PSUITM                                
     C*                                                                         
     CSR                   MOVE *BLANKS   SZCITM                                
DBY25CSR                   CLEAR@UA                                             
     CSR                   MOVEAPSUITM    @UA                                   
     CSR                   Z-ADD25        #OUTLG                                
     CSR                   EXSR C9822                                           
     C*                    ---- -----                                           
     CSR                   MOVEA@UB       SZCITM                                
     C*----------------------------------------------------------------         
     CSR                   MOVELSDVR01    SZVR01                                
     CSR                   MOVELSDVR02    SZVR02                                
     CSR                   MOVELSDLOCN    SZLOCN                                
     CSR                   MOVELSDLOTN    SZLOTN                                
     CSR                   MOVELSDDSC1    SZDSC1                                
     CSR                   MOVELSDDSC2    SZDSC2                                
     CSR                   MOVELSDLNTY    SZLNTY                                
     CSR                   MOVELSDNXTR    SZNXTR                                
     CSR                   MOVELSDLTTR    SZLTTR                                
     CSR                   MOVELSDEMCU    SZEMCU                                
     CSR                   MOVELSDRLIT    SZRLIT                                
     CSR                   MOVELSDCPNT    SZCPNT                                
     CSR                   MOVELSDKTLN    SZKTLN                                
     CSR                   MOVELSDRKIT    SZRKIT                                
     CSR                   MOVELSDKTP     SZKTP                                 
     C*----------------------------------------------------------------         
     C*                                                                         
     C*    Scrub and edit - Reporting Codes                                     
     C*                                                                         
     CSR                   MOVELSDSRP1    SZSRP1                                
     CSR                   MOVELSDSRP2    SZSRP2                                
     CSR                   MOVELSDSRP3    SZSRP3                                
     CSR                   MOVELSDSRP4    SZSRP4                                
     CSR                   MOVELSDSRP5    SZSRP5                                
     CSR                   MOVELSDPRP1    SZPRP1                                
     CSR                   MOVELSDPRP2    SZPRP2                                
     CSR                   MOVELSDPRP3    SZPRP3                                
     CSR                   MOVELSDPRP4    SZPRP4                                
     CSR                   MOVELSDPRP5    SZPRP5                                
     C*----------------------------------------------------------------         
     C*                                                                         
     C*    Scrub and edit - Quantity Fields                                     
     C*                                                                         
     CSR                   MOVELSDUOM     SZUOM                                 
     CSR                   Z-ADDSDUORG    SZUORG                                
     CSR                   Z-ADDSDSOQS    SZSOQS                                
     CSR                   Z-ADDSDSOBK    SZSOBK                                
     CSR                   Z-ADDSDSOCN    SZSOCN                                
     CSR                   Z-ADDSDSONE    SZSONE                                
     CSR                   Z-ADDSDUOPN    SZUOPN                                
     CSR                   Z-ADDSDQTYT    SZQTYT                                
     CSR                   Z-ADDSDQRLV    SZQRLV                                
     CSR                   MOVE SDCOMM    SZCOMM                                
     CSR                   MOVE SDOTQY    SZOTQY                                
     C*----------------------------------------------------------------         
     C*                                                                         
     C*    Scrub and edit - Cost and price                                      
     C*                                                                         
     CSR                   Z-ADDSDUPRC    SZUPRC                                
     CSR                   Z-ADDSDAOPN    SZAOPN                                
     CSR                   MOVELSDPROV    SZPROV                                
     CSR                   Z-ADDSDLPRC    SZLPRC                                
     CSR                   Z-ADDSDUNCS    SZUNCS                                
     CSR                   MOVELSDCSTO    SZCSTO                                
     CSR                   Z-ADDSDTCST    SZTCST                                
     C*----------------------------------------------------------------         
     CSR                   MOVELSDINMG    SZINMG                                
     CSR                   MOVELSDPTC     SZPTC                                 
     CSR                   MOVELSDTRDC    SZTRDC                                
     CSR                   MOVELSDFUN2    SZFUN2                                
     CSR                   MOVELSDPRGR    SZPRGR                                
     CSR                   MOVELSDCLVL    SZCLVL                                
     CSR                   MOVELSDDSPR    SZDSPR                                
     CSR                   MOVELSDDSFT    SZDSFT                                
     CSR                   MOVELSDFAPP    SZFAPP                                
     CSR                   MOVELSDCADC    SZCADC                                
     CSR                   MOVELSDKCO     SZKCO                                 
     CSR                   MOVELSDDOC     SZDOC                                 
     CSR                   MOVELSDDCT     SZDCT                                 
     CSR                   MOVELSDPSN     SZPSN                                 
     CSR                   MOVELSDDELN    SZDELN                                
     CSR                   MOVELSDPRMO    SZPRMO                                
     CSR                   MOVELSDDFTN    SZDFTN                                
     CSR                   MOVELSDTAX1    SZTAX1                                
     CSR                   MOVELSDTXA1    SZTXA1                                
     CSR                   MOVELSDEXR1    SZEXR1                                
     CSR                   MOVELSDATXT    SZATXT                                
     CSR                   MOVELSDPRIO    SZPRIO                                
     CSR                   MOVELSDRESL    SZRESL                                
     CSR                   MOVELSDBACK    SZBACK                                
     CSR                   MOVELSDSBAL    SZSBAL                                
     CSR                   MOVELSDAPTS    SZAPTS                                
     CSR                   MOVELSDCDCD    SZCDCD                                
     CSR                   MOVELSDNTR     SZNTR                                 
     CSR                   MOVELSDVEND    SZVEND                                
     CSR                   MOVELSDANBY    SZANBY                                
     CSR                   MOVELSDCARS    SZCARS                                
     CSR                   MOVELSDMOT     SZMOT                                 
     CSR                   MOVELSDCOT     SZCOT                                 
     CSR                   MOVELSDROUT    SZROUT                                
     CSR                   MOVELSDSTOP    SZSTOP                                
     CSR                   MOVELSDZON     SZZON                                 
     CSR                   MOVELSDCNID    SZCNID                                
     CSR                   MOVELSDFRTH    SZFRTH                                
     CSR                   MOVELSDAFT     SZAFT                                 
     CSR                   MOVELSDFUF1    SZFUF1                                
     CSR                   MOVELSDFRTC    SZFRTC                                
     CSR                   MOVELSDFRAT    SZFRAT                                
     CSR                   MOVELSDRATT    SZRATT                                
     CSR                   MOVELSDSHCM    SZSHCM                                
     CSR                   MOVELSDSHCN    SZSHCN                                
     CSR                   MOVELSDSERN    SZSERN                                
     CSR                   MOVELSDUOM1    SZUOM1                                
     CSR                   MOVELSDPQOR    SZPQOR                                
     CSR                   MOVELSDUOM2    SZUOM2                                
     CSR                   MOVELSDSQOR    SZSQOR                                
     CSR                   MOVELSDUOM4    SZUOM4                                
     CSR                   MOVELSDITWT    SZITWT                                
     CSR                   MOVELSDWTUM    SZWTUM                                
     CSR                   MOVELSDITVL    SZITVL                                
     CSR                   MOVELSDVLUM    SZVLUM                                
     CSR                   MOVELSDRPRC    SZRPRC                                
     CSR                   MOVELSDORPR    SZORPR                                
     CSR                   MOVELSDORP     SZORP                                 
     CSR                   MOVELSDCMGP    SZCMGP                                
     CSR                   MOVELSDCMGL    SZCMGL                                
     CSR                   MOVELSDGLC     SZGLC                                 
     CSR                   MOVELSDCTRY    SZCTRY                                
     CSR                   MOVELSDFY      SZFY                                  
     CSR                   MOVELSDSTTS    SZSTTS                                
     CSR                   MOVELSDSO01    SZSO01                                
     CSR                   MOVELSDSO02    SZSO02                                
     CSR                   MOVELSDSO03    SZSO03                                
     CSR                   MOVELSDSO04    SZSO04                                
     CSR                   MOVELSDSO05    SZSO05                                
     CSR                   MOVELSDSO06    SZSO06                                
     CSR                   MOVELSDSO07    SZSO07                                
     CSR                   MOVELSDSO08    SZSO08                                
     CSR                   MOVELSDSO09    SZSO09                                
     CSR                   MOVELSDSO10    SZSO10                                
     CSR                   MOVELSDSLSM    SZSLSM                                
     CSR                   MOVELSDSLCM    SZSLCM                                
     CSR                   MOVELSDSLM2    SZSLM2                                
     CSR                   MOVELSDSLC2    SZSLC2                                
     CSR                   MOVELSDACOM    SZACOM                                
     CSR                   MOVELSDCMCG    SZCMCG                                
     CSR                   MOVELSDRCD     SZRCD                                 
     CSR                   MOVELSDGRWT    SZGRWT                                
     CSR                   MOVELSDGWUM    SZGWUM                                
     CSR                   MOVELSDANI     SZANI                                 
     CSR                   MOVELSDAID     SZAID                                 
     CSR                   MOVELSDOMCU    SZOMCU                                
     CSR                   MOVELSDOBJ     SZOBJ                                 
     CSR                   MOVELSDSUB     SZSUB                                 
     CSR                   MOVELSDLT      SZLT                                  
     CSR                   MOVELSDSBL     SZSBL                                 
     CSR                   MOVELSDSBLT    SZSBLT                                
     CSR                   MOVELSDLCOD    SZLCOD                                
     CSR                   MOVELSDSWMS    SZSWMS                                
     CSR                   MOVELSDUNCD    SZUNCD                                
     C*----------------------------------------------------------------         
     C*                                                                         
     C*    Scrub and edit - Currency Fields                                     
     C*                                                                         
     CSR                   MOVELSDCRCD    SZCRCD                                
     CSR                   Z-ADDSDCRR     SZCRR                                 
     CSR                   Z-ADDSDFUP     SZFUP                                 
     CSR                   Z-ADDSDFEA     SZFEA                                 
     CSR                   Z-ADDSDFUC     SZFUC                                 
     CSR                   Z-ADDSDFEC     SZFEC                                 
     C*----------------------------------------------------------------         
     C*                                                                         
     C*    Scrub and edit - User Reserved Fields                                
     C*                                                                         
     CSR                   MOVE SDURCD    SZURCD                                
     CSR                   MOVE SDURRF    SZURRF                                
     CSR                   Z-ADDSDURDT    SZURDT                                
     CSR                   Z-ADDSDURAT    SZURAT                                
     CSR                   Z-ADDSDURAB    SZURAB                                
     C*----------------------------------------------------------------         
     C*                                                                         
     C*    Scrub and edit - Extended Price                                      
     C*                                                                         
     CSR                   Z-ADDSDAEXP    SZAEXP                                
     CSR                   ADD  SZAEXP    SYOTOT                                
     C*----------------------------------------------------------------         
     C*                                                                         
     C*    Scrub and edit - Extended Cost                                       
     C*                                                                         
     CSR                   Z-ADDSDECST    SZECST                                
     CSR                   ADD  SZECST    SYTOTC                                
     C*----------------------------------------------------------------         
     C*                                                                         
     C*   Calculate Discount                                                    
     C*                                                                         
     CSR         $$DCP     IFNE *ZEROS                                          
     CSR         $@CNV     IFEQ '1'                                             
     CSR         $@CURR    ANDEQ'1'                                             
     C*                                                                         
     CSR         SDFPRC    SUB  SDFUP     $WK150                                
     CSR         #@FDO     IFNE 0                                               
     CSR         $WK150    DIV  #@FDO     $WK299    H                           
     CSR                   ELSE                                                 
     CSR                   Z-ADD$WK150    $WK299                                
     CSR                   END                                                  
     CSR         SDSOQS    DIV  #@SOQS    $QT299 299H                           
     CSR                   MULT $QT299    $WK299    H                           
     CSR         $WK299    MULT #@DSCT    S4DSCT                                
     CSR                   ELSE                                                 
     C*                    ----                                                 
     CSR         SDLPRC    SUB  SDUPRC    $WK150                                
     CSR         $WK150    DIV  #@UPRC    $WK299    H                           
     CSR         SDSOQS    DIV  #@SOQS    $QT299 299H                           
     CSR                   MULT $QT299    $WK299    H                           
     CSR         $WK299    MULT #@DSCT    S4DSCT                                
     CSR                   END                                                  
     CSR                   END                                                  
     C*                                                                         
     CSR                   ADD  S4DSCT    S3DSCT                                
     C*----------------------------------------------------------------         
     C*                                                                         
     C*    Scrub and edit - Fields added with A7.1                              
     C*                                                                         
     CSR                   MOVE SDDMCT    SZDMCT                                
     CSR                   Z-ADDSDDMCS    SZDMCS                                
     CSR                   Z-ADDSDPEFJ    SZPEFJ                                
     CSR                   MOVELRRFRGD    SZFRGD                                
     CSR                   MOVELRRTHGD    SZTHGD                                
     CSR                   Z-ADDSDFRMP    SZFRMP                                
     CSR                   Z-ADDSDTHRP    SZTHRP                                
     CSR                   Z-ADDSDEXDP    SZEXDP                                
     CSR                   MOVE SDTPC     SZTPC                                 
     CSR                   MOVE SDAPUM    SZAPUM                                
     CSR                   MOVE SDRYIN    SZRYIN                                
     CSR                   MOVE SDDTBS    SZDTBS                                
     CSR                   MOVE SDASN     SZASN                                 
     CSR                   Z-ADDSDODOC    SZODOC                                
     CSR                   MOVE SDODCT    SZODCT                                
     CSR                   MOVE SDOKC     SZOKC                                 
     CSR                   MOVE SDLOB     SZLOB                                 
     CSR                   MOVE SDEUSE    SZEUSE                                
     CSR                   MOVE SDDTYS    SZDTYS                                
     CSR                   MOVE SDSO11    SZSO11                                
     CSR                   MOVE SDSO12    SZSO12                                
     CSR                   MOVE SDSO13    SZSO13                                
     CSR                   MOVE SDSO14    SZSO14                                
     CSR                   MOVE SDSO15    SZSO15                                
     CSR                   MOVE SDUPC1    SZUPC1                                
     CSR                   MOVE SDUPC2    SZUPC2                                
     CSR                   MOVE SDUPC3    SZUPC3                                
     CSR                   MOVE SDCRMD    SZCRMD                                
     CSR                   MOVE SDFPRC    SZFPRC                                
     C*----------------------------------------------------------------         
     C*                                                                         
     C*    Write record.                                                        
     C*                                                                         
     CSR                   MOVE 'D'       SZEDTY                                
     CSR                   MOVE '01'      SZEDSQ                                
     CSR                   MOVEL$$EKCO    SZEKCO                                
     CSR                   MOVEL$$EDOC    SZEDOC                                
     CSR                   MOVEL$@EDCT    SZEDCT                                
     CSR                   MOVEL$@EDST    SZEDST                                
     CSR                   MOVEL$@EDFT    SZEDFT                                
     CSR                   Z-ADD0         SZEDDT                                
     CSR                   MOVE 'S'       SZEDER                                
     CSR                   Z-ADD1         SZEDDL                                
     CSR                   MOVE ' '       SZEDSP                                
     CSR                   MOVEL$$EDBT    SZEDBT                                
     CSR                   MOVEL$@PNID    SZPNID                                
     CSR                   MOVEL##USER    SZTORG                                
     CSR                   MOVEL##USER    SZUSER                                
     CSR                   MOVEL##JOBN    SZJOBN                                
     CSR                   MOVEL##PROG    SZPID                                 
     CSR                   MOVEL$UDATE    SZUPMJ                                
     CSR                   MOVEL$$TIME    SZTDAY                                
     C*                                                                         
     CSR                   SELEC                                                
     CSR         $@EDST    WHEQ '810'                                           
     CSR                   WRITEI47047                 99                       
     CSR         $@EDST    WHEQ '867'                                           
     CSR                   WRITEI47187                 99                       
     CSR         $@EDST    WHEQ '843'                                           
     CSR                   WRITEI47107                 99                       
     CSR                   ENDSL                                                
     C*----------------------------------------------------------------         
     C*                                                                         
     C*    Load extended text.                                                  
     C*                                                                         
     CSR                   MOVE SZEDTY    ZDEDTY                                
     CSR                   Z-ADD03        ZDEDSQ                                
     CSR                   MOVE SZEKCO    ZDEKCO                                
     CSR                   Z-ADDSZEDOC    ZDEDOC                                
     CSR                   MOVE SZEDCT    ZDEDCT                                
     CSR                   Z-ADDSZEDLN    ZDEDLN                                
     CSR                   MOVE SZEDSP    ZDEDSP                                
     CSR                   MOVE SZEDBT    ZDEDBT                                
     CSR                   MOVE *BLANKS   ZDFILE                                
     CSR                   MOVEL'F47047'  ZDFILE                                
     CSR                   MOVE SYUSER    ZDUSER                                
     CSR                   MOVE SYUSER    ZDTORG                                
     CSR                   MOVE SYPID     ZDPID                                 
     CSR                   Z-ADDSYUPMJ    ZDUPMJ                                
     CSR                   MOVE SYJOBN    ZDJOBN                                
     CSR                   Z-ADDSYTDAY    ZDTDAY                                
     C*                                                                         
     CSR                   Z-ADDSZDOCO    JMDOCO                                
     CSR                   MOVELSZDCTO    JMDCTO                                
     CSR                   MOVELSZKCOO    JMKCOO                                
     CSR                   Z-ADDSZLNID    JMLNID                                
     CSR         JMKY01    SETLLI4314                                           
     CSR                   SETOF                     8199                       
     CSR         JMKY01    READEI4314                    8199                   
     CSR         *IN81     DOWEQ'0'                                             
     CSR         *IN99     ANDEQ'0'                                             
     CSR                   Z-ADDJMDOCO    ZDDOCO                                
     CSR                   MOVE JMDCTO    ZDDCTO                                
     CSR                   MOVE JMKCOO    ZDKCOO                                
     CSR                   Z-ADDJMLNID    ZDLNID                                
     CSR                   MOVE JMPNTC    ZDPNTC                                
     CSR                   MOVE JMLINS    ZDLINS                                
     CSR                   MOVE JMTXLN    ZDTXLN                                
     CSR                   WRITEI4715                                           
     CSR         JMKY01    READEI4314                    8199                   
     CSR                   ENDDO                                                
     C*-------------------------------------------------------                  
     CSR         BYPDT1    TAG                                                  
     C*-------------------------------------------------------                  
     C*                                                                         
     C*    Execute report print control.                                        
     C*                                                                         
     CSR                   EXSR WRTADT                                          
     C*-------------------------------------------------------                  
     C*                                                                         
     CSR                   ENDSR                                                
     C*****************************************************************         
     C*                                                                         
     C*    SUBROUTINE WRTDT2 - Write EDI Invoice Detail                         
     C*    -----------------------------------------------------------          
     C*                                                                         
     CSR         WRTDT2    BEGSR                                                
     C*          ------    -----                                                
     C*                                                                         
     C*    Skip record, if proof mode.                                          
     C*                                                                         
     CSR         $@UPDT    IFEQ '1'                                             
     CSR                   GOTO ENDDT2                                          
     CSR                   END                                                  
     C*-------------------------------------------------------                  
     C*    Retrive Payment Term Information using Payment Term                  
     C*    code from detail record.  This information is for                    
     C*    the outbound EDI record only.  The Payment Term Code                 
     C*    on the detail record is used to compute terms discount               
     C*    (as done in Sales Update).                                           
     C*                                                                         
     C*                                                                         
     CSR         $@EDST    IFEQ '810'                                           
     CSR                   MOVE PNPTD     S4PTD                                 
     CSR                   MOVE PNDCP     S4DCP                                 
     CSR                   MOVE PNDCD     S4DCD                                 
     CSR                   MOVE PNNDTP    S4NDTP                                
     CSR                   MOVE PNNSP     S4NSP                                 
     CSR                   MOVE PNDTPA    S4DTPA                                
     CSR                   ENDIF                                                
     C*-------------------------------------------------------                  
     C*                                                                         
     C*    Calculate Due Date.                                                  
     C*                                                                         
     CSR                   MOVELPSDD      S4DDJ            Net Due Datee        
     CSR                   MOVELPSDDD     S4DDU            Disc. Date  e        
     C*----------------------------------------------------------------         
     C*                                                                         
     C*    Scrub and edit - Service/Tax Date                                    
     C*                                                                         
     CSR                   MOVEL$UDATE    S4DSVJ                                
     C*----------------------------------------------------------------         
     C*                                                                         
     C*    Move Tax Authorities to output                                       
     C*                                                                         
     CSR                   Z-ADD#XTA1     S4TA1                                 
     CSR                   Z-ADD#XTA2     S4TA2                                 
     CSR                   Z-ADD#XTA3     S4TA3                                 
     CSR                   Z-ADD#XTA4     S4TA4                                 
     CSR                   Z-ADD#XTA5     S4TA5                                 
     C*                                                                         
     C*    Move Tax Rates to Output                                             
     C*                                                                         
     CSR                   Z-ADD#XTXR1    S4TXR1                                
     CSR                   Z-ADD#XTXR2    S4TXR2                                
     CSR                   Z-ADD#XTXR3    S4TXR3                                
     CSR                   Z-ADD#XTXR4    S4TXR4                                
     CSR                   Z-ADD#XTXR5    S4TXR5                                
     C*                                                                         
     C*    Add Tax Amount (Use accumulated total in case item                   
     C*                    consolidation is being used.)                        
     C*                                                                         
     CSR                   Z-ADD$$AMT1    S4TAXT                                
     CSR                   Z-ADD$$AMT2    S4TAX2                                
     CSR                   Z-ADD$$AMT3    S4TAX3                                
     CSR                   Z-ADD$$AMT4    S4TAX4                                
     CSR                   Z-ADD$$AMT5    S4TAX5                                
     C*-----------------------------------------------------                    
     C*                                                                         
     C*    Write record                                                         
     C*                                                                         
     CSR                   MOVE 'D'       S4EDTY                                
     CSR                   MOVE '02'      S4EDSQ                                
     CSR                   MOVEL$$EKCO    S4EKCO                                
     CSR                   MOVEL$$EDOC    S4EDOC                                
     CSR                   MOVEL$@EDCT    S4EDCT                                
     CSR                   Z-ADDSZEDLN    S4EDLN                                
     CSR                   MOVE ' '       S4EDSP                                
     CSR                   MOVEL$$EDBT    S4EDBT                                
     CSR                   MOVE SZKCO     S4KCO                                 
     CSR                   MOVE SZDOC     S4DOC                                 
     CSR                   MOVE SZDCT     S4DCT                                 
     CSR                   MOVE SZDOCO    S4DOCO                                
     CSR                   MOVE SZDCTO    S4DCTO                                
     CSR                   MOVE SZSFXO    S4SFXO                                
     CSR                   MOVE SZLNID    S4LNID                                
     CSR                   MOVE SZMCU     S4MCU                                 
     CSR                   MOVE SZAN8     S4AN8                                 
     C*                                                                         
     CSR                   MOVE *BLANKS   S4VINV                                
     C***        SDDOC     IFNE *ZEROS                                          
     CSR         SZDOC     IFNE *ZEROS                                          
     C***                  MOVELSDDOC     S4VINV                                
     CSR                   MOVELSZDOC     S4VINV                                
     CSR                   ELSE                                                 
     CSR                   MOVELSZDOCO    S4VINV                                
     CSR                   END                                                  
     C*                                                                         
     CSR                   MOVEL##USER    S4TORG                                
     CSR                   MOVEL##USER    S4USER                                
     CSR                   MOVEL##JOBN    S4JOBN                                
     CSR                   MOVEL##PROG    S4PID                                 
     CSR                   MOVEL$UDATE    S4UPMJ                                
     CSR                   MOVEL$$TIME    S4TDAY                                
     C*                                                                         
     CSR                   SELEC                                                
     CSR         $@EDST    WHEQ '810'                                           
     CSR                   WRITEI470471                99                       
     CSR         $@EDST    WHEQ '867'                                           
     CSR                   WRITEI471871                99                       
     CSR         $@EDST    WHEQ '843'                                           
     CSR                   WRITEI471071                99                       
     CSR                   ENDSL                                                
     C*----------------------------------------------------------------         
     C*                                                                         
     C*    Total Tax Amounts                                                    
     C*                                                                         
B2   CSR         $@CNV     IFEQ '1'                                             
     CSR         $@CURR    ANDEQ'1'                                             
     CSR         $RND      IFEQ ' '                                             
     CSR                   ADD  $$STAM    S3ACR                                 
     CSR                   ADD  $$STAM    S3FAP                                 
     CSR                   ENDIF                                                
     CSR                   ADD  $$ATXA    S3CTXA                                
     CSR         SDTAX1    IFEQ 'N'                                             
     CSR                   ADD  $$FEA     S3CTXN                                
     CSR                   ELSE                                                 
     CSR                   ADD  $$ATXN    S3CTXN                                
     CSR                   END                                                  
     CSR                   ADD  $$ADSC    S3CDS                                 
     CSR         $RND      IFEQ '1'                                             
     CSR                   ADD  $$UTAM    $WKUTM 299                            
     CSR                   ELSE                                                 
     CSR                   ADD  $$STAM    S3CTAM                                
     CSR                   ENDIF                                                
     C*                                                                         
     C*    Not currency                                                         
     CSR                   ELSE                                                 
     CSR         $RND      IFEQ ' '                                             
     CSR                   ADD  $$STAM    S3AG                                  
     CSR                   ADD  $$STAM    S3AAP                                 
     CSR                   ENDIF                                                
     CSR         SDTAX1    IFEQ 'N'                                             
     CSR                   ADD  $$AEXP    S3ATXN                                
     CSR                   ELSE                                                 
     CSR                   ADD  $$ATXA    S3ATXA                                
     CSR                   END                                                  
     CSR                   ADD  $$ATXN    S3ATXN                                
     CSR                   ADD  $$ADSC    S3ADSC                                
     CSR         $RND      IFEQ '1'                                             
     CSR                   ADD  $$UTAM    $WKUTM 299                            
     CSR                   ELSE                                                 
     CSR                   ADD  $$STAM    S3STAM                                
     CSR                   END                                                  
     CSR                   END                                                  
     C*-----------------------------------------------------                    
     C*                                                                         
     C*    First Tax Amount                                                     
     C*                                                                         
     CSR                   Z-ADD1         Z       30                            
     CSR         #XTA1     LOKUPXTA,Z                    85                     
     C*                                                                         
     C*    Found: Accumulate the tax amount                                     
     C*                                                                         
     CSR         *IN85     IFEQ '1'                                             
     CSR                   ADD  $$AMT1    XAM,Z                                 
     CSR                   END                                                  
     C*                                                                         
     C*    Not Found: Load the array and accumulate the tax amount              
     C*                                                                         
     CSR         *IN85     IFNE '1'                                             
     CSR                   Z-ADD1         Z                                     
     CSR                   Z-ADD0         $X80                                  
     CSR         $X80      LOKUPXTA,Z                    86                     
     CSR         *IN86     IFEQ '1'                                             
     CSR                   Z-ADD$$AMT1    XAM,Z                                 
     CSR                   Z-ADD#XTA1     XTA,Z                                 
     CSR                   Z-ADD#XTXR1    XTR,Z                                 
     CSR                   END                                                  
     CSR                   END                                                  
     C*-----------------------------------------------------                    
     C*                                                                         
     C*    Second Tax Amount                                                    
     C*                                                                         
     CSR                   Z-ADD1         Z                                     
     CSR         #XTA2     LOKUPXTA,Z                    85                     
     C*                                                                         
     C*    Found: Accumulate the tax amount                                     
     C*                                                                         
     CSR         *IN85     IFEQ '1'                                             
     CSR                   ADD  $$AMT2    XAM,Z                                 
     CSR                   END                                                  
     C*                                                                         
     C*    Not Fount: Load the array and accumulate the tax amount              
     C*                                                                         
     CSR         *IN85     IFNE '1'                                             
     CSR                   Z-ADD1         Z                                     
     CSR                   Z-ADD0         $X80    80                            
     CSR         $X80      LOKUPXTA,Z                    86                     
     CSR         *IN86     IFEQ '1'                                             
     CSR                   Z-ADD$$AMT2    XAM,Z                                 
     CSR                   Z-ADD#XTA2     XTA,Z                                 
     CSR                   Z-ADD#XTXR2    XTR,Z                                 
     CSR                   END                                                  
     CSR                   END                                                  
     C*-----------------------------------------------------                    
     C*                                                                         
     C*    Third  Tax Amount                                                    
     C*                                                                         
     CSR                   Z-ADD1         Z                                     
     CSR         #XTA3     LOKUPXTA,Z                    85                     
     C*                                                                         
     C*    Found: Accumulate the tax amount                                     
     C*                                                                         
     CSR         *IN85     IFEQ '1'                                             
     CSR                   ADD  $$AMT3    XAM,Z                                 
     CSR                   END                                                  
     C*                                                                         
     C*    Not Found: Load the array and accumulate the tax amount              
     C*                                                                         
     CSR         *IN85     IFNE '1'                                             
     CSR                   Z-ADD1         Z                                     
     CSR                   Z-ADD0         $X80                                  
     CSR         $X80      LOKUPXTA,Z                    86                     
     CSR         *IN86     IFEQ '1'                                             
     CSR                   Z-ADD$$AMT3    XAM,Z                                 
     CSR                   Z-ADD#XTA3     XTA,Z                                 
     CSR                   Z-ADD#XTXR3    XTR,Z                                 
     CSR                   END                                                  
     CSR                   END                                                  
     C*-----------------------------------------------------                    
     C*                                                                         
     C*    Fourth Tax Amount                                                    
     C*                                                                         
     CSR                   Z-ADD1         Z                                     
     CSR         #XTA4     LOKUPXTA,Z                    85                     
     C*                                                                         
     C*    Found: Accumulate the tax amount                                     
     C*                                                                         
     CSR         *IN85     IFEQ '1'                                             
     CSR                   ADD  $$AMT4    XAM,Z                                 
     CSR                   END                                                  
     C*                                                                         
     C*    Not Found: Load the array and accumulate the tax amount              
     C*                                                                         
     CSR         *IN85     IFNE '1'                                             
     CSR                   Z-ADD1         Z                                     
     CSR                   Z-ADD0         $X80                                  
     CSR         $X80      LOKUPXTA,Z                    86                     
     CSR         *IN86     IFEQ '1'                                             
     CSR                   Z-ADD$$AMT4    XAM,Z                                 
     CSR                   Z-ADD#XTA4     XTA,Z                                 
     CSR                   Z-ADD#XTXR4    XTR,Z                                 
     CSR                   END                                                  
     CSR                   END                                                  
     C*-----------------------------------------------------                    
     C*                                                                         
     C*    Fifth  Tax Amount                                                    
     C*                                                                         
     CSR                   Z-ADD1         Z                                     
     CSR         #XTA5     LOKUPXTA,Z                    85                     
     C*                                                                         
     C*    Found: Accumulate the tax amount                                     
     C*                                                                         
     CSR         *IN85     IFEQ '1'                                             
     CSR                   ADD  $$AMT5    XAM,Z                                 
     CSR                   END                                                  
     C*                                                                         
     C*    Not Found: Load the array and accumulate the tax amount              
     C*                                                                         
     CSR         *IN85     IFNE '1'                                             
     CSR                   Z-ADD1         Z                                     
     CSR                   Z-ADD0         $X80                                  
     CSR         $X80      LOKUPXTA,Z                    86                     
     CSR         *IN86     IFEQ '1'                                             
     CSR                   Z-ADD$$AMT5    XAM,Z                                 
     CSR                   Z-ADD#XTA5     XTA,Z                                 
     CSR                   Z-ADD#XTXR5    XTR,Z                                 
     CSR                   END                                                  
     CSR                   END                                                  
     C*-----------------------------------------------------                    
     C*                                                                         
     CSR                   SELEC                                                
     CSR         $@EDST    WHEQ '810'                                           
     CSR                   CLEARI470471                                         
     CSR         $@EDST    WHEQ '867'                                           
     CSR                   CLEARI471871                                         
     CSR         $@EDST    WHEQ '843'                                           
     CSR                   CLEARI471071                                         
     CSR                   ENDSL                                                
     C*-----------------------------------------------------                    
     C*  Clear tax totals                                                       
     C                     Z-ADD*ZEROS    $$STAM                                
     C                     Z-ADD*ZEROS    $$ATXA                                
     C                     Z-ADD*ZEROS    $$ATXN                                
     C                     Z-ADD*ZEROS    $$ADSC                                
     C                     Z-ADD*ZEROS    $$UTAM                                
     C                     Z-ADD*ZEROS    $$AMT1                                
     C                     Z-ADD*ZEROS    $$AMT2                                
     C                     Z-ADD*ZEROS    $$AMT3                                
     C                     Z-ADD*ZEROS    $$AMT4                                
     C                     Z-ADD*ZEROS    $$AMT5                                
     C                     Z-ADD*ZEROS    $$FEA                                 
     C                     Z-ADD*ZEROS    $$AEXP                                
     C*-----------------------------------------------------                    
     CSR         ENDDT2    ENDSR                                                
     C*****************************************************************         
     C*                                                                         
     C*    SUBROUTINE WRTADT - Write Audit Report                               
     C*    --------------------------------------                               
     C*                                                                         
     CSR         WRTADT    BEGSR                                                
     C*          ------    -----                                                
     C*                                                                         
     C*----------------------------------------------------------------         
     C*                                                                         
     C*    Move to output -                                                     
     C*                                                                         
     CSR                   MOVELRRAN8     RRSHAN                                
     CSR                   MOVEL@SL,1     VC0101                                
     CSR                   MOVELSDSHAN    RRSHAN                                
     CSR                   MOVEL@SH,1     VC0102                                
     CSR                   MOVELRRDI      RRIVD                                 
     CSR                   MOVELRR#DOC    RRDOC                                 
     C*                                                                         
     C*----------------------------------------------------------------         
     C*                                                                         
SER  C*    Use R5542565 Detail 1 fields for -                                   
     C*                                                                         
     C*                                   RRAEXP                                
     C*                                   RRAN8                                 
     C*                                   RRDOCO                                
     C*                                   RRDCTO                                
     C*                                   RRDSC1                                
     C*                                   RRLNID                                
     C*                                   RRUITM                                
     C*                                   RRSOQS                                
     C*----------------------------------------------------------------         
     C*                                                                         
     C*    Format for output - EDI Document Number                              
     C*                                                                         
     CSR                   MOVE *BLANK    #SINBR                                
     CSR                   MOVELSZEDOC    #SINBR                                
     CSR                   MOVE T@EDOC    #DTYP                                 
     CSR                   MOVE W@EDOC    #EWRD                                 
     CSR                   MOVE E@EDOC    #EC                                   
     CSR                   MOVE F@EDOC    #DSPD                                 
     CSR                   MOVE G@EDOC    #DATD                                 
     CSR                   MOVE J@EDOC    #ALR                                  
     CSR                   MOVE ' '       #ECOR                                 
     CSR                   MOVE ' '       #DCOR                                 
     CSR                   EXSR C00161                                          
     C*                    ---- ------                                          
     CSR         #ALR      IFEQ 'L'                                             
     CSR                   MOVEL#SINBR    RREDOC                                
     CSR                   ELSE                                                 
     CSR                   MOVE #SINBR    RREDOC                                
     CSR                   END                                                  
     C*----------------------------------------------------------------         
     C*                                                                         
     C*    If level break sensed, print report totals.                          
     C*                                                                         
     CSR         *INOV     IFEQ '1'                                             
     CSR                   SETON                     40                         
SER  C*                                                                         
SER  C* If credit memo (Proc opt 40) = ' ', clear alt heading flds              
SER  C*                                                                         
SER  CSR         ALTFLG    IFEQ 'N'                                             
SER  CSR                   CLEARRRTTL@                                          
SER  CSR                   CLEARRRTTL2                                          
SER  CSR                   ENDIF                                                
     CSR                   WRITEHEADING2               OV                       
     C*                    -------------                                        
     CSR                   SETOF                     OV                         
     CSR                   END                                                  
     CSR                   WRITEDETAIL6                OV                       
     C*                    ------------                                         
     CSR                   SETOF                     40                         
     C*                                                                         
     C*----------------------------------------------------------------         
     CSR         ENDADT    ENDSR                                                
     C*                                                                         
     C*****************************************************************         
     C*                                                                         
     C*    Copy Common Subroutine - Double Byte Truncation                      
     C*                                                                         
     C/COPY JDECPY,C9822                                                        
     C*****************************************************************         
     C*                                                                         
     C*    Copy Common Subroutine - Right Justify Numeric Fields                
     C*                                                                         
     C/COPY JDECPY,C0012                                                        
     C*****************************************************************         
     C*                                                                         
     C*    SUBROUTINE S010B1 - Load VTX fields for Language Preference          
     C*    -----------------------------------------------------------          
     C*                                                                         
     CSR         S010B1    BEGSR                                                
     C*          ------    -----                                                
     C*----------------------------------------------------------------         
     C*                                                                         
     C*    Load VTX fields for Audit Report                                     
     C*                                                                         
     CSR         $@EDI     IFNE *BLANKS                                         
     C*                                                                         
     CSR         ADTRPT    IFEQ *BLANKS                                         
     CSR                   MOVEL'R47042  'PSKEY  10                             
     CSR                   MOVEL'R47042  '$$KEY                                 
     CSR                   Z-ADD123       PSVTX#                                
     CSR                   MOVEL'P47042  'PSPID                                 
     CSR                   MOVEL##VERS    PSVERS                                
     C/COPY JDECPY,C00RSC                                                       
DBN  CSR                   MOVE DSTXT     DSTXT2                                
     CSR                   MOVE RRTTL@    RRTTL2                                
     CSR                   MOVE RRTXT2    RRTXT4                                
     CSR                   MOVE RRTXT3    RRTXT5                                
     CSR                   SETON                     OV                         
     CSR                   OPEN R47042                 81                       
     CSR                   MOVE '1'       ADTRPT  1                             
     C*                                                                         
     C*    Find next number for new batch number, if final mode.                
     C*                                                                         
     CSR         $@UPDT    IFEQ ' '                                             
     CSR                   CALL 'X0010'                                         
     C*                    ---- -------                                         
     CSR                   PARM '47'      PSSY                                  
     CSR                   PARM '02'      PSIDX   2                             
     CSR                   PARM *ZEROS    #NXTNO  80                            
     CSR                   MOVEL#NXTNO    $TEMP   8                             
     CSR         '0'       CHECK$TEMP     #B      10     88                     
     CSR         #B        IFGT 0                                               
     CSR                   Z-ADD0         #C                                    
     CSR         9         SUB  #B        #C      10                            
     CSR         #C        SUBST$TEMP:#B  $$EDBT 15                             
     CSR                   END                                                  
     CSR                   MOVEL$$EDBT    RREDBT                                
     CSR                   ENDIF                                                
     CSR                   ENDIF                                                
     CSR                   ENDIF                                                
     C*----------------------------------------------------------------         
     C*                                                                         
     CSR         $@EDI     IFNE '2'                                             
SER  CSR                   MOVEL'R5542565'PSKEY  10                             
SER  CSR                   Z-ADD099       PSVTX#  30                            
SER  C***                  Z-ADD092       PSVTX#  30                            
     CSR                   MOVE *BLANKS   $$LNGP                                
SER  CSR                   MOVEL'R5542565'$$KEY  10                             
     C*                                                                         
     C*    Load initial VTX fields.                                             
     C*                                                                         
DBN  CSR                   MOVELDSVTX     DSTXT                                 
DBN  CSR                   MOVELABLNGP    $$LNGP  2                             
     C*                                                                         
B1   C***        $$LNGP    IFNE *BLANK                                          
     C***        $FIRST    OREQ '1'                                             
     C*                                                                         
     C*    Build Vocabulary Override key for language preference.               
     C*                                                                         
     CSR                   MOVEA$$KEY     @KY                                   
     CSR                   MOVE 01        $I      20                            
     CSR         ' '       LOKUP@KY,$I                   83                     
B2   CSR         *IN83     IFEQ '1'                                             
DBN1 CSR                   MOVEA$$LNGP    @KY,$I                                
E2   CSR                   ENDIF                                                
     CSR                   MOVEA@KY       PSKEY                                 
     C*                                                                         
     C*    Load text for language preference.                                   
     C*                                                                         
     CSR                   MOVEL##VERS    PSVERS                                
     C/COPY JDECPY,C00RSC                                                       
     C*                                                                         
DBN  CSR                   MOVE *BLANKS   $FIRST                                
DBN  CSR                   MOVELDSTXT     DSVTX                                 
E1   C***                  ENDIF                                                
E1   CSR                   ENDIF                                                
     C*----------------------------------------------------------------         
DBN  CSR                   MOVE DSTXT2    DSTXT                                 
     C*                                                                         
     CSR         END999    ENDSR                                                
     C****************************************************************          
     C*                                                                         
     C*    SUBROUTINE S998  - Load dictionary parameters.                       
     C*    ----------------------------------------------                       
     C*                                                                         
     CSR         S998      BEGSR                                                
     C*          ----      -----                                                
     C*                                                                        V
     C*    Dictionary parameters for - Quantity - Quantity Shipped             V
     C*                                                                        V
     CSR                   MOVE *BLANK    FRDTAI                               V
     CSR                   MOVEL'SOQS'    FRDTAI                               V
     CSR                   CALL 'X9800E'               81                      V
     C*                    ---- --------                                       V
     CSR                   PARM           I9800E                               V
     CSR                   MOVE FRCDEC    F@SOQS  1                            V
     CSR         FRERR     IFEQ '0'                                            V
     CSR                   Z-ADD1         #@SOQS 110                           V
     CSR                   MOVE F@SOQS    #A                                   V
     CSR                   DO   #A                                             V
     CSR                   MULT 10        #@SOQS                               V
     CSR                   END                                                 V
     CSR                   END                                                 V
     C*----------------------------------------------------------------        V
     C*                                                                        V
     C*    Dictionary parameters for - Amount 1                                V
     C*                                                                        V
     CSR                   MOVE *BLANK    FRDTAI                               V
     CSR                   MOVEL'AMT1'    FRDTAI                               V
     CSR                   CALL 'X9800E'               81                      V
     C*                    ---- --------                                       V
     CSR                   PARM           I9800E                               V
     CSR                   MOVE FRCDEC    F@AMT1  1                            V
     CSR         FRERR     IFEQ '0'                                            V
     CSR                   Z-ADD1         #@AMT1 110                           V
     CSR                   MOVE F@AMT1    #A                                   V
     CSR                   DO   #A                                             V
     CSR                   MULT 10        #@AMT1                               V
     CSR                   END                                                 V
     CSR                   END                                                 V
     C*----------------------------------------------------------------        V
     C*                                                                        V
     C*    Dictionary parameters for - Amount 2                                V
     C*                                                                        V
     CSR                   MOVE *BLANK    FRDTAI                               V
     CSR                   MOVEL'AMT2'    FRDTAI                               V
     CSR                   CALL 'X9800E'               81                      V
     C*                    ---- --------                                       V
     CSR                   PARM           I9800E                               V
     CSR                   MOVE FRCDEC    F@AMT2  1                            V
     CSR         FRERR     IFEQ '0'                                            V
     CSR                   Z-ADD1         #@AMT2 110                           V
     CSR                   MOVE F@AMT2    #A                                   V
     CSR                   DO   #A                                             V
     CSR                   MULT 10        #@AMT2                               V
     CSR                   END                                                 V
     CSR                   END                                                 V
     C*----------------------------------------------------------------        V
     C*                                                                        V
     C*    Dictionary parameters for - Amount 3                                V
     C*                                                                        V
     CSR                   MOVE *BLANK    FRDTAI                               V
     CSR                   MOVEL'AMT3'    FRDTAI                               V
     CSR                   CALL 'X9800E'               81                      V
     C*                    ---- --------                                       V
     CSR                   PARM           I9800E                               V
     CSR                   MOVE FRCDEC    F@AMT3  1                            V
     CSR         FRERR     IFEQ '0'                                            V
     CSR                   Z-ADD1         #@AMT3 110                           V
     CSR                   MOVE F@AMT3    #A                                   V
     CSR                   DO   #A                                             V
     CSR                   MULT 10        #@AMT3                               V
     CSR                   END                                                 V
     CSR                   END                                                 V
     C*----------------------------------------------------------------        V
     C*                                                                        V
     C*    Dictionary parameters for - Amount 4                                V
     C*                                                                        V
     CSR                   MOVE *BLANK    FRDTAI                               V
     CSR                   MOVEL'AMT4'    FRDTAI                               V
     CSR                   CALL 'X9800E'               81                      V
     C*                    ---- --------                                       V
     CSR                   PARM           I9800E                               V
     CSR                   MOVE FRCDEC    F@AMT4  1                            V
     CSR         FRERR     IFEQ '0'                                            V
     CSR                   Z-ADD1         #@AMT4 110                           V
     CSR                   MOVE F@AMT4    #A                                   V
     CSR                   DO   #A                                             V
     CSR                   MULT 10        #@AMT4                               V
     CSR                   END                                                 V
     CSR                   END                                                 V
     C*----------------------------------------------------------------        V
     C*                                                                         
     C*    Dictionary parameters for - Amount - Discount Available              
     C*                                                                         
     CSR                   MOVE *BLANK    FRDTAI                                
     CSR                   MOVEL'ADSC'    FRDTAI                                
     CSR                   CALL 'X9800E'               81                       
     C*                    ---- --------                                        
     CSR                   PARM           I9800E                                
B1   CSR         FRERR     IFEQ '0'                                             
     CSR                   MOVE FRDSCR    B@ADSC 40                             
     CSR                   MOVE FRDTAT    T@ADSC  1                             
     CSR                   MOVE FREC      E@ADSC  1                             
     CSR                   MOVE FRDTAS    C@ADSC  40                            
     CSR                   MOVE FRDTAD    G@ADSC  10                            
     CSR                   MOVE FRCDEC    F@ADSC  1                             
     CSR                   MOVELFRSY      S@ADSC  4                             
     CSR                   MOVE FRRT      R@ADSC  2                             
     CSR                   MOVE FRDVAL    D@ADSC 40                             
     CSR                   MOVE FRVAL     A@ADSC 40                             
     CSR                   MOVE FRLVAL    L@ADSC 40                             
     CSR                   MOVE FRUVAL    U@ADSC 40                             
     CSR                   MOVE FREDWR    W@ADSC 30                             
     CSR                   MOVE FRLR      J@ADSC  1                             
     CSR                   MOVE FRNNIX    N@ADSC  20                            
     CSR                   Z-ADD1         #@ADSC 110                            
     CSR                   MOVE F@ADSC    #A                                    
B2   CSR                   DO   #A                                              
     CSR                   MULT 10        #@ADSC                                
E2   CSR                   ENDDO                                                
E1   CSR                   ENDIF                                                
     C*----------------------------------------------------------------         
     C*                                                                         
     C*    Dictionary parameters for - Amount - Extended Price                  
     C*                                                                         
     CSR                   MOVE *BLANK    FRDTAI                                
     CSR                   MOVEL'AEXP'    FRDTAI                                
     CSR                   CALL 'X9800E'               81                       
     C*                    ---- --------                                        
     CSR                   PARM           I9800E                                
B1   CSR         FRERR     IFEQ '0'                                             
     CSR                   MOVE FRDSCR    B@AEXP 40                             
     CSR                   MOVE FRDTAT    T@AEXP  1                             
     CSR                   MOVE FREC      E@AEXP  1                             
S7312 * Change formatting for Mexico amounts (comma, zero bal, float -)         
S7312C           *IN76     IFEQ *ON                        MEXICO               
S7312C                     MOVE 'N'       E@AEXP  1                             
S7312C                     ENDIF                                                
     CSR                   MOVE FRDTAS    C@AEXP  40                            
     CSR                   MOVE FRDTAD    G@AEXP  10                            
     CSR                   MOVE FRCDEC    F@AEXP  1                             
     CSR                   MOVELFRSY      S@AEXP  4                             
     CSR                   MOVE FRRT      R@AEXP  2                             
     CSR                   MOVE FRDVAL    D@AEXP 40                             
     CSR                   MOVE FRVAL     A@AEXP 40                             
     CSR                   MOVE FRLVAL    L@AEXP 40                             
     CSR                   MOVE FRUVAL    U@AEXP 40                             
     CSR                   MOVE FREDWR    W@AEXP 30                             
     CSR                   MOVE FRLR      J@AEXP  1                             
     CSR                   MOVE FRNNIX    N@AEXP  20                            
     CSR                   Z-ADD1         #@AEXP 110                            
     CSR                   MOVE F@AEXP    #A                                    
B2   CSR                   DO   #A                                              
     CSR                   MULT 10        #@AEXP                                
E2   CSR                   ENDDO                                                
E1   CSR                   ENDIF                                                
     C*----------------------------------------------------------------         
     C*                                                                         
     C*    Dictionary parameters for - Address Number                           
     C*                                                                         
     CSR                   MOVE *BLANK    FRDTAI                                
     CSR                   MOVEL'AN8'     FRDTAI                                
     CSR                   CALL 'X9800E'               81                       
     C*                    ---- --------                                        
     CSR                   PARM           I9800E                                
B1   CSR         FRERR     IFEQ '0'                                             
     CSR                   MOVE FRDSCR    B@AN8  40                             
     CSR                   MOVE FRDTAT    T@AN8   1                             
     CSR                   MOVE FREC      E@AN8   1                             
     CSR                   MOVE FRDTAS    C@AN8   40                            
     CSR                   MOVE FRDTAD    G@AN8   10                            
     CSR                   MOVE FRCDEC    F@AN8   1                             
     CSR                   MOVELFRSY      S@AN8   4                             
     CSR                   MOVE FRRT      R@AN8   2                             
     CSR                   MOVE FRDVAL    D@AN8  40                             
     CSR                   MOVE FRVAL     A@AN8  40                             
     CSR                   MOVE FRLVAL    L@AN8  40                             
     CSR                   MOVE FRUVAL    U@AN8  40                             
     CSR                   MOVE FREDWR    W@AN8  30                             
     CSR                   MOVE FRLR      J@AN8   1                             
     CSR                   MOVE FRNNIX    N@AN8   20                            
     CSR                   Z-ADD1         #@AN8  110                            
     CSR                   MOVE F@AN8     #A                                    
B2   CSR                   DO   #A                                              
     CSR                   MULT 10        #@AN8                                 
E2   CSR                   ENDDO                                                
E1   CSR                   ENDIF                                                
     C*----------------------------------------------------------------         
     C*                                                                         
     C*    Dictionary parameters for - Price Adjustment Type                    
     C*                                                                         
     CSR                   MOVE *BLANK    FRDTAI                                
     CSR                   MOVEL'AST '    FRDTAI                                
     CSR                   CALL 'X9800E'               81                       
     C*                    ---- --------                                        
     CSR                   PARM           I9800E                                
B1   CSR         FRERR     IFEQ '0'                                             
     CSR                   MOVE FRDSCR    B@AST  40                             
     CSR                   MOVE FRDTAT    T@AST   1                             
     CSR                   MOVE FREC      E@AST   1                             
     CSR                   MOVE FRDTAS    C@AST   40                            
     CSR                   MOVE FRDTAD    G@AST   10                            
     CSR                   MOVE FRCDEC    F@AST   1                             
     CSR                   MOVELFRSY      S@AST   4                             
     CSR                   MOVE FRRT      R@AST   2                             
     CSR                   MOVE FRDVAL    D@AST  40                             
     CSR                   MOVE FRVAL     A@AST  40                             
     CSR                   MOVE FRLVAL    L@AST  40                             
     CSR                   MOVE FRUVAL    U@AST  40                             
     CSR                   MOVE FREDWR    W@AST  30                             
     CSR                   MOVE FRLR      J@AST   1                             
     CSR                   MOVE FRNNIX    N@AST   20                            
     CSR                   Z-ADD1         #@AST  110                            
     CSR                   MOVE F@AST     #A                                    
B2   CSR                   DO   #A                                              
     CSR                   MULT 10        #@AST                                 
E2   CSR                   ENDDO                                                
E1   CSR                   ENDIF                                                
     C*----------------------------------------------------------------         
     C*                                                                         
     C*    Dictionary parameters for - Discount % - Cash                        
     C*                                                                         
     CSR                   MOVE *BLANK    FRDTAI                                
     CSR                   MOVEL'CADC'    FRDTAI                                
     CSR                   CALL 'X9800E'               81                       
     C*                    ---- --------                                        
     CSR                   PARM           I9800E                                
B1   CSR         FRERR     IFEQ '0'                                             
     CSR                   MOVE FRDSCR    B@CADC 40                             
     CSR                   MOVE FRDTAT    T@CADC  1                             
     CSR                   MOVE FREC      E@CADC  1                             
     CSR                   MOVE FRDTAS    C@CADC  40                            
     CSR                   MOVE FRDTAD    G@CADC  10                            
     CSR                   MOVE FRCDEC    F@CADC  1                             
     CSR                   MOVELFRSY      S@CADC  4                             
     CSR                   MOVE FRRT      R@CADC  2                             
     CSR                   MOVE FRDVAL    D@CADC 40                             
     CSR                   MOVE FRVAL     A@CADC 40                             
     CSR                   MOVE FRLVAL    L@CADC 40                             
     CSR                   MOVE FRUVAL    U@CADC 40                             
     CSR                   MOVE FREDWR    W@CADC 30                             
     CSR                   MOVE FRLR      J@CADC  1                             
     CSR                   MOVE FRNNIX    N@CADC  20                            
     CSR                   Z-ADD1         #@CADC 110                            
     CSR                   MOVE F@CADC    #A                                    
B2   CSR                   DO   #A                                              
     CSR                   MULT 10        #@CADC                                
E2   CSR                   ENDDO                                                
E1   CSR                   ENDIF                                                
     C*----------------------------------------------------------------         
     C*                                                                         
     C*    Dictionary parameters for - Amount - Foreign Discount Avail          
     C*                                                                         
     CSR                   MOVE *BLANK    FRDTAI                                
     CSR                   MOVEL'CDS '    FRDTAI                                
     CSR                   CALL 'X9800E'               81                       
     C*                    ---- --------                                        
     CSR                   PARM           I9800E                                
B1   CSR         FRERR     IFEQ '0'                                             
     CSR                   MOVE FRDSCR    B@CDS  40                             
     CSR                   MOVE FRDTAT    T@CDS   1                             
     CSR                   MOVE FREC      E@CDS   1                             
     CSR                   MOVE FRDTAS    C@CDS   40                            
     CSR                   MOVE FRDTAD    G@CDS   10                            
     CSR                   MOVE FRCDEC    F@CDS   1                             
     CSR                   MOVELFRSY      S@CDS   4                             
     CSR                   MOVE FRRT      R@CDS   2                             
     CSR                   MOVE FRDVAL    D@CDS  40                             
     CSR                   MOVE FRVAL     A@CDS  40                             
     CSR                   MOVE FRLVAL    L@CDS  40                             
     CSR                   MOVE FRUVAL    U@CDS  40                             
     CSR                   MOVE FREDWR    W@CDS  30                             
     CSR                   MOVE FRLR      J@CDS   1                             
     CSR                   MOVE FRNNIX    N@CDS   20                            
     CSR                   Z-ADD1         #@CDS  110                            
     CSR                   MOVE F@CDS     #A                                    
B2   CSR                   DO   #A                                              
     CSR                   MULT 10        #@CDS                                 
E2   CSR                   ENDDO                                                
E1   CSR                   ENDIF                                                
     C*----------------------------------------------------------------         
     C*                                                                         
     C*    Dictionary parameters for - Document Number                          
     C*                                                                         
     CSR                   MOVE *BLANK    FRDTAI                                
     CSR                   MOVEL'DOC '    FRDTAI                                
     CSR                   CALL 'X9800E'               81                       
     C*                    ---- --------                                        
     CSR                   PARM           I9800E                                
B1   CSR         FRERR     IFEQ '0'                                             
     CSR                   MOVE FRDSCR    B@DOC  40                             
     CSR                   MOVE FRDTAT    T@DOC   1                             
     CSR                   MOVE FREC      E@DOC   1                             
     CSR                   MOVE FRDTAS    C@DOC   40                            
     CSR                   MOVE FRDTAD    G@DOC   10                            
     CSR                   MOVE FRCDEC    F@DOC   1                             
     CSR                   MOVELFRSY      S@DOC   4                             
     CSR                   MOVE FRRT      R@DOC   2                             
     CSR                   MOVE FRDVAL    D@DOC  40                             
     CSR                   MOVE FRVAL     A@DOC  40                             
     CSR                   MOVE FRLVAL    L@DOC  40                             
     CSR                   MOVE FRUVAL    U@DOC  40                             
     CSR                   MOVE FREDWR    W@DOC  30                             
     CSR                   MOVE FRLR      J@DOC   1                             
     CSR                   MOVE FRNNIX    N@DOC   20                            
     CSR                   Z-ADD1         #@DOC  110                            
     CSR                   MOVE F@DOC     #A                                    
B2   CSR                   DO   #A                                              
     CSR                   MULT 10        #@DOC                                 
E2   CSR                   ENDDO                                                
E1   CSR                   ENDIF                                                
     C*----------------------------------------------------------------         
     C*                                                                         
     C*    Dictionary parameters for - Document (Order #, Invoice, etc.)        
     C*                                                                         
     CSR                   MOVE *BLANK    FRDTAI                                
     CSR                   MOVEL'DOCO'    FRDTAI                                
     CSR                   CALL 'X9800E'               81                       
     C*                    ---- --------                                        
     CSR                   PARM           I9800E                                
B1   CSR         FRERR     IFEQ '0'                                             
     CSR                   MOVE FRDSCR    B@DOCO 40                             
     CSR                   MOVE FRDTAT    T@DOCO  1                             
     CSR                   MOVE FREC      E@DOCO  1                             
     CSR                   MOVE FRDTAS    C@DOCO  40                            
     CSR                   MOVE FRDTAD    G@DOCO  10                            
     CSR                   MOVE FRCDEC    F@DOCO  1                             
     CSR                   MOVELFRSY      S@DOCO  4                             
     CSR                   MOVE FRRT      R@DOCO  2                             
     CSR                   MOVE FRDVAL    D@DOCO 40                             
     CSR                   MOVE FRVAL     A@DOCO 40                             
     CSR                   MOVE FRLVAL    L@DOCO 40                             
     CSR                   MOVE FRUVAL    U@DOCO 40                             
     CSR                   MOVE FREDWR    W@DOCO 30                             
     CSR                   MOVE FRLR      J@DOCO  1                             
     CSR                   MOVE FRNNIX    N@DOCO  20                            
     CSR                   Z-ADD1         #@DOCO 110                            
     CSR                   MOVE F@DOCO    #A                                    
B2   CSR                   DO   #A                                              
     CSR                   MULT 10        #@DOCO                                
E2   CSR                   ENDDO                                                
E1   CSR                   ENDIF                                                
     C*----------------------------------------------------------------         
     C*                                                                         
     C*    Dictionary parameters for - Amount - Extended Cost                   
     C*                                                                         
     CSR                   MOVE *BLANK    FRDTAI                                
     CSR                   MOVEL'ECST'    FRDTAI                                
     CSR                   CALL 'X9800E'               81                       
     C*                    ---- --------                                        
     CSR                   PARM           I9800E                                
B1   CSR         FRERR     IFEQ '0'                                             
     CSR                   MOVE FRDSCR    B@ECST 40                             
     CSR                   MOVE FRDTAT    T@ECST  1                             
     CSR                   MOVE FREC      E@ECST  1                             
     CSR                   MOVE FRDTAS    C@ECST  40                            
     CSR                   MOVE FRDTAD    G@ECST  10                            
     CSR                   MOVE FRCDEC    F@ECST  1                             
     CSR                   MOVELFRSY      S@ECST  4                             
     CSR                   MOVE FRRT      R@ECST  2                             
     CSR                   MOVE FRDVAL    D@ECST 40                             
     CSR                   MOVE FRVAL     A@ECST 40                             
     CSR                   MOVE FRLVAL    L@ECST 40                             
     CSR                   MOVE FRUVAL    U@ECST 40                             
     CSR                   MOVE FREDWR    W@ECST 30                             
     CSR                   MOVE FRLR      J@ECST  1                             
     CSR                   MOVE FRNNIX    N@ECST  20                            
     CSR                   Z-ADD1         #@ECST 110                            
     CSR                   MOVE F@ECST    #A                                    
B2   CSR                   DO   #A                                              
     CSR                   MULT 10        #@ECST                                
E2   CSR                   ENDDO                                                
E1   CSR                   ENDIF                                                
     C*----------------------------------------------------------------         
     C*                                                                         
     C*    Dictionary parameters for - Amount - Foreign Extended Price          
     C*                                                                         
     CSR                   MOVE *BLANK    FRDTAI                                
     CSR                   MOVEL'FEA '    FRDTAI                                
     CSR                   CALL 'X9800E'               81                       
     C*                    ---- --------                                        
     CSR                   PARM           I9800E                                
B1   CSR         FRERR     IFEQ '0'                                             
     CSR                   MOVE FRDSCR    B@FEA  40                             
     CSR                   MOVE FRDTAT    T@FEA   1                             
     CSR                   MOVE FREC      E@FEA   1                             
S7312 * Change formatting for Mexico amounts (comma, zero bal, float -)         
S7312C           *IN76     IFEQ *ON                        MEXICO               
S7312C                     MOVE 'N'       E@FEA   1                             
S7312C                     ENDIF                                                
     CSR                   MOVE FRDTAS    C@FEA   40                            
     CSR                   MOVE FRDTAD    G@FEA   10                            
     CSR                   MOVE FRCDEC    F@FEA   1                             
     CSR                   MOVELFRSY      S@FEA   4                             
     CSR                   MOVE FRRT      R@FEA   2                             
     CSR                   MOVE FRDVAL    D@FEA  40                             
     CSR                   MOVE FRVAL     A@FEA  40                             
     CSR                   MOVE FRLVAL    L@FEA  40                             
     CSR                   MOVE FRUVAL    U@FEA  40                             
     CSR                   MOVE FREDWR    W@FEA  30                             
     CSR                   MOVE FRLR      J@FEA   1                             
     CSR                   MOVE FRNNIX    N@FEA   20                            
     CSR                   Z-ADD1         #@FEA  110                            
     CSR                   MOVE F@FEA     #A                                    
B2   CSR                   DO   #A                                              
     CSR                   MULT 10        #@FEA                                 
E2   CSR                   ENDDO                                                
E1   CSR                   ENDIF                                                
     C*----------------------------------------------------------------         
     C*                                                                         
     C*    Dictionary parameters for - Amount - Foreign Extended Cost           
     C*                                                                         
     CSR                   MOVE *BLANK    FRDTAI                                
     CSR                   MOVEL'FEC '    FRDTAI                                
     CSR                   CALL 'X9800E'               81                       
     C*                    ---- --------                                        
     CSR                   PARM           I9800E                                
B1   CSR         FRERR     IFEQ '0'                                             
     CSR                   MOVE FRDSCR    B@FEC  40                             
     CSR                   MOVE FRDTAT    T@FEC   1                             
     CSR                   MOVE FREC      E@FEC   1                             
     CSR                   MOVE FRDTAS    C@FEC   40                            
     CSR                   MOVE FRDTAD    G@FEC   10                            
     CSR                   MOVE FRCDEC    F@FEC   1                             
     CSR                   MOVELFRSY      S@FEC   4                             
     CSR                   MOVE FRRT      R@FEC   2                             
     CSR                   MOVE FRDVAL    D@FEC  40                             
     CSR                   MOVE FRVAL     A@FEC  40                             
     CSR                   MOVE FRLVAL    L@FEC  40                             
     CSR                   MOVE FRUVAL    U@FEC  40                             
     CSR                   MOVE FREDWR    W@FEC  30                             
     CSR                   MOVE FRLR      J@FEC   1                             
     CSR                   MOVE FRNNIX    N@FEC   20                            
     CSR                   Z-ADD1         #@FEC  110                            
     CSR                   MOVE F@FEC     #A                                    
B2   CSR                   DO   #A                                              
     CSR                   MULT 10        #@FEC                                 
E2   CSR                   ENDDO                                                
E1   CSR                   ENDIF                                                
     C*----------------------------------------------------------------         
     C*                                                                         
     C*    Dictionary parameters for - From Potency                    ed       
     C*                                                                         
     CSR                   MOVE *BLANK    FRDTAI                                
     CSR                   MOVEL'FRMP'    FRDTAI                                
     CSR                   CALL 'X9800E'               81                       
     C*                    ---- --------                                        
     CSR                   PARM           I9800E                                
     CSR         FRERR     IFEQ '0'                                             
     CSR                   MOVE FRDSCR    B@FRMP 40                             
     CSR                   MOVE FRDTAT    T@FRMP  1                             
     CSR                   MOVE FREC      E@FRMP  1                             
     CSR                   MOVE FRDTAS    C@FRMP  40                            
     CSR                   MOVE FRDTAD    G@FRMP  10                            
     CSR                   MOVE FRCDEC    F@FRMP  1                             
     CSR                   MOVELFRSY      S@FRMP  4                             
     CSR                   MOVE FRRT      R@FRMP  2                             
     CSR                   MOVE FRDVAL    D@FRMP 40                             
     CSR                   MOVE FRVAL     A@FRMP 40                             
     CSR                   MOVE FRLVAL    L@FRMP 40                             
     CSR                   MOVE FRUVAL    U@FRMP 40                             
     CSR                   MOVE FREDWR    W@FRMP 30                             
     CSR                   MOVE FRLR      J@FRMP  1                             
     CSR                   MOVE FRNNIX    N@FRMP  20                            
     CSR                   Z-ADD1         #@FRMP 110                            
     CSR                   MOVE F@FRMP    #A                                    
     CSR                   DO   #A                                              
     CSR                   MULT 10        #@FRMP                                
     CSR                   END                                                  
     CSR                   END                                                  
     C*----------------------------------------------------------------         
     C*                                                                         
     C*    Dictionary parameters for - Amount - Foreign Unit Cost               
     C*                                                                         
     CSR                   MOVE *BLANK    FRDTAI                                
     CSR                   MOVEL'FUC '    FRDTAI                                
     CSR                   CALL 'X9800E'               81                       
     C*                    ---- --------                                        
     CSR                   PARM           I9800E                                
B1   CSR         FRERR     IFEQ '0'                                             
     CSR                   MOVE FRDSCR    B@FUC  40                             
     CSR                   MOVE FRDTAT    T@FUC   1                             
     CSR                   MOVE FREC      E@FUC   1                             
     CSR                   MOVE FRDTAS    C@FUC   40                            
     CSR                   MOVE FRDTAD    G@FUC   10                            
     CSR                   MOVE FRCDEC    F@FUC   1                             
     CSR                   MOVELFRSY      S@FUC   4                             
     CSR                   MOVE FRRT      R@FUC   2                             
     CSR                   MOVE FRDVAL    D@FUC  40                             
     CSR                   MOVE FRVAL     A@FUC  40                             
     CSR                   MOVE FRLVAL    L@FUC  40                             
     CSR                   MOVE FRUVAL    U@FUC  40                             
     CSR                   MOVE FREDWR    W@FUC  30                             
     CSR                   MOVE FRLR      J@FUC   1                             
     CSR                   MOVE FRNNIX    N@FUC   20                            
     CSR                   Z-ADD1         #@FUC  110                            
     CSR                   MOVE F@FUC     #A                                    
B2   CSR                   DO   #A                                              
     CSR                   MULT 10        #@FUC                                 
E2   CSR                   ENDDO                                                
E1   CSR                   ENDIF                                                
     C*----------------------------------------------------------------         
     C*                                                                         
     C*    Dictionary parameters for - Amount - Foreign Price per Unit          
     C*                                                                         
     CSR                   MOVE *BLANK    FRDTAI                                
     CSR                   MOVEL'FUP '    FRDTAI                                
     CSR                   CALL 'X9800E'               81                       
     C*                    ---- --------                                        
     CSR                   PARM           I9800E                                
B1   CSR         FRERR     IFEQ '0'                                             
     CSR                   MOVE FRDSCR    B@FUP  40                             
     CSR                   MOVE FRDTAT    T@FUP   1                             
     CSR                   MOVE FREC      E@FUP   1                             
     CSR                   MOVE FRDTAS    C@FUP   40                            
     CSR                   MOVE FRDTAD    G@FUP   10                            
     CSR                   MOVE FRCDEC    F@FUP   1                             
     CSR                   MOVELFRSY      S@FUP   4                             
     CSR                   MOVE FRRT      R@FUP   2                             
     CSR                   MOVE FRDVAL    D@FUP  40                             
     CSR                   MOVE FRVAL     A@FUP  40                             
     CSR                   MOVE FRLVAL    L@FUP  40                             
     CSR                   MOVE FRUVAL    U@FUP  40                             
     CSR                   MOVE FREDWR    W@FUP  30                             
     CSR                   MOVE FRLR      J@FUP   1                             
     CSR                   MOVE FRNNIX    N@FUP   20                            
     CSR                   Z-ADD1         #@FUP  110                            
     CSR                   MOVE F@FUP     #A                                    
B2   CSR                   DO   #A                                              
     CSR                   MULT 10        #@FUP                                 
E2   CSR                   ENDDO                                                
E1   CSR                   ENDIF                                                
     C*----------------------------------------------------------------         
     C*                                                                         
     C*    Dictionary parameters for - Item Number (Short)                      
     C*                                                                         
     CSR                   MOVE *BLANK    FRDTAI                                
     CSR                   MOVEL'ITM '    FRDTAI                                
     CSR                   CALL 'X9800E'               81                       
     C*                    ---- --------                                        
     CSR                   PARM           I9800E                                
B1   CSR         FRERR     IFEQ '0'                                             
     CSR                   MOVE FRDSCR    B@ITM  40                             
     CSR                   MOVE FRDTAT    T@ITM   1                             
     CSR                   MOVE FREC      E@ITM   1                             
     CSR                   MOVE FRDTAS    C@ITM   40                            
     CSR                   MOVE FRDTAD    G@ITM   10                            
     CSR                   MOVE FRCDEC    F@ITM   1                             
     CSR                   MOVELFRSY      S@ITM   4                             
     CSR                   MOVE FRRT      R@ITM   2                             
     CSR                   MOVE FRDVAL    D@ITM  40                             
     CSR                   MOVE FRVAL     A@ITM  40                             
     CSR                   MOVE FRLVAL    L@ITM  40                             
     CSR                   MOVE FRUVAL    U@ITM  40                             
     CSR                   MOVE FREDWR    W@ITM  30                             
     CSR                   MOVE FRLR      J@ITM   1                             
     CSR                   MOVE FRNNIX    N@ITM   20                            
     CSR                   Z-ADD1         #@ITM  110                            
     CSR                   MOVE F@ITM     #A                                    
B2   CSR                   DO   #A                                              
     CSR                   MULT 10        #@ITM                                 
E2   CSR                   ENDDO                                                
E1   CSR                   ENDIF                                                
     C*----------------------------------------------------------------         
     C*                                                                         
     C*    Dictionary parameters for - Line Number                              
     C*                                                                         
     CSR                   MOVE *BLANK    FRDTAI                                
     CSR                   MOVEL'LNID'    FRDTAI                                
     CSR                   CALL 'X9800E'               81                       
     C*                    ---- --------                                        
     CSR                   PARM           I9800E                                
B1   CSR         FRERR     IFEQ '0'                                             
     CSR                   MOVE FRDSCR    B@LNID 40                             
     CSR                   MOVE FRDTAT    T@LNID  1                             
     CSR                   MOVE FREC      E@LNID  1                             
     CSR                   MOVE FRDTAS    C@LNID  40                            
     CSR                   MOVE FRDTAD    G@LNID  10                            
     CSR                   MOVE FRCDEC    F@LNID  1                             
     CSR                   MOVELFRSY      S@LNID  4                             
     CSR                   MOVE FRRT      R@LNID  2                             
     CSR                   MOVE FRDVAL    D@LNID 40                             
     CSR                   MOVE FRVAL     A@LNID 40                             
     CSR                   MOVE FRLVAL    L@LNID 40                             
     CSR                   MOVE FRUVAL    U@LNID 40                             
     CSR                   MOVE FREDWR    W@LNID 30                             
     CSR                   MOVE FRLR      J@LNID  1                             
     CSR                   MOVE FRNNIX    N@LNID  20                            
     CSR                   Z-ADD1         #@LNID 110                            
     CSR                   MOVE F@LNID    #A                                    
B2   CSR                   DO   #A                                              
     CSR                   MULT 10        #@LNID                                
E2   CSR                   ENDDO                                                
E1   CSR                   ENDIF                                                
     C*----------------------------------------------------------------         
     C*                                                                         
     C*    Dictionary parameters for - Lot Potency                     ed       
     C*                                                                         
     CSR                   MOVE *BLANK    FRDTAI                                
     CSR                   MOVEL'LOTP'    FRDTAI                                
     CSR                   CALL 'X9800E'               81                       
     C*                    ---- --------                                        
     CSR                   PARM           I9800E                                
     CSR         FRERR     IFEQ '0'                                             
     CSR                   MOVE FRDSCR    B@LOTP 40                             
     CSR                   MOVE FRDTAT    T@LOTP  1                             
     CSR                   MOVE FREC      E@LOTP  1                             
     CSR                   MOVE FRDTAS    C@LOTP  40                            
     CSR                   MOVE FRDTAD    G@LOTP  10                            
     CSR                   MOVE FRCDEC    F@LOTP  1                             
     CSR                   MOVELFRSY      S@LOTP  4                             
     CSR                   MOVE FRRT      R@LOTP  2                             
     CSR                   MOVE FRDVAL    D@LOTP 40                             
     CSR                   MOVE FRVAL     A@LOTP 40                             
     CSR                   MOVE FRLVAL    L@LOTP 40                             
     CSR                   MOVE FRUVAL    U@LOTP 40                             
     CSR                   MOVE FREDWR    W@LOTP 30                             
     CSR                   MOVE FRLR      J@LOTP  1                             
     CSR                   MOVE FRNNIX    N@LOTP  20                            
     CSR                   Z-ADD1         #@LOTP 110                            
     CSR                   MOVE F@LOTP    #A                                    
     CSR                   DO   #A                                              
     CSR                   MULT 10        #@LOTP                                
     CSR                   END                                                  
     CSR                   END                                                  
     C*----------------------------------------------------------------         
     C*                                                                         
     C*    Dictionary parameters for - Percent                                  
     C*                                                                         
     CSR                   MOVE *BLANK    FRDTAI                                
     CSR                   MOVEL'PCT'     FRDTAI                                
     CSR                   CALL 'X9800E'               81                       
     C*                    ---- --------                                        
     CSR                   PARM           I9800E                                
B1   CSR         FRERR     IFEQ '0'                                             
     CSR                   MOVE FRDSCR    B@PCT  40                             
     CSR                   MOVE FRDTAT    T@PCT   1                             
     CSR                   MOVE FREC      E@PCT   1                             
     CSR                   MOVE FRDTAS    C@PCT   40                            
     CSR                   MOVE FRDTAD    G@PCT   10                            
     CSR                   MOVE FRCDEC    F@PCT   1                             
     CSR                   MOVELFRSY      S@PCT   4                             
     CSR                   MOVE FRRT      R@PCT   2                             
     CSR                   MOVE FRDVAL    D@PCT  40                             
     CSR                   MOVE FRVAL     A@PCT  40                             
     CSR                   MOVE FRLVAL    L@PCT  40                             
     CSR                   MOVE FRUVAL    U@PCT  40                             
     CSR                   MOVE FREDWR    W@PCT  30                             
     CSR                   MOVE FRLR      J@PCT   1                             
     CSR                   MOVE FRNNIX    N@PCT   20                            
     CSR                   Z-ADD1         #@PCT  110                            
     CSR                   MOVE F@PCT     #A                                    
B2   CSR                   DO   #A                                              
     CSR                   MULT 10        #@PCT                                 
E2   CSR                   ENDDO                                                
E1   CSR                   ENDIF                                                
     C*----------------------------------------------------------------         
     C*                                                                         
     C*    Dictionary parameters for - Related PO/SO/WO Number                  
     C*                                                                         
     CSR                   MOVE *BLANK    FRDTAI                                
     CSR                   MOVEL'RORN'    FRDTAI                                
     CSR                   CALL 'X9800E'               81                       
     C*                    ---- --------                                        
     CSR                   PARM           I9800E                                
B1   CSR         FRERR     IFEQ '0'                                             
     CSR                   MOVE FRDSCR    B@RORN 40                             
     CSR                   MOVE FRDTAT    T@RORN  1                             
     CSR                   MOVE FREC      E@RORN  1                             
     CSR                   MOVE FRDTAS    C@RORN  40                            
     CSR                   MOVE FRDTAD    G@RORN  10                            
     CSR                   MOVE FRCDEC    F@RORN  1                             
     CSR                   MOVELFRSY      S@RORN  4                             
     CSR                   MOVE FRRT      R@RORN  2                             
     CSR                   MOVE FRDVAL    D@RORN 40                             
     CSR                   MOVE FRVAL     A@RORN 40                             
     CSR                   MOVE FRLVAL    L@RORN 40                             
     CSR                   MOVE FRUVAL    U@RORN 40                             
     CSR                   MOVE FREDWR    W@RORN 30                             
     CSR                   MOVE FRLR      J@RORN  1                             
     CSR                   MOVE FRNNIX    N@RORN  20                            
     CSR                   Z-ADD1         #@RORN 110                            
     CSR                   MOVE F@RORN    #A                                    
B2   CSR                   DO   #A                                              
     CSR                   MULT 10        #@RORN                                
E2   CSR                   ENDDO                                                
E1   CSR                   ENDIF                                                
     C*----------------------------------------------------------------         
     C*                                                                         
     C*    Dictionary parameters for - Salesperson                              
     C*                                                                         
     CSR                   MOVE *BLANK    FRDTAI                                
     CSR                   MOVEL'SLSM'    FRDTAI                                
     CSR                   CALL 'X9800E'               81                       
     C*                    ---- --------                                        
     CSR                   PARM           I9800E                                
B1   CSR         FRERR     IFEQ '0'                                             
     CSR                   MOVE FRDSCR    B@SLSM 40                             
     CSR                   MOVE FRDTAT    T@SLSM  1                             
     CSR                   MOVE FREC      E@SLSM  1                             
     CSR                   MOVE FRDTAS    C@SLSM  40                            
     CSR                   MOVE FRDTAD    G@SLSM  10                            
     CSR                   MOVE FRCDEC    F@SLSM  1                             
     CSR                   MOVELFRSY      S@SLSM  4                             
     CSR                   MOVE FRRT      R@SLSM  2                             
     CSR                   MOVE FRDVAL    D@SLSM 40                             
     CSR                   MOVE FRVAL     A@SLSM 40                             
     CSR                   MOVE FRLVAL    L@SLSM 40                             
     CSR                   MOVE FRUVAL    U@SLSM 40                             
     CSR                   MOVE FREDWR    W@SLSM 30                             
     CSR                   MOVE FRLR      J@SLSM  1                             
     CSR                   MOVE FRNNIX    N@SLSM  20                            
     CSR                   Z-ADD1         #@SLSM 110                            
     CSR                   MOVE F@SLSM    #A                                    
B2   CSR                   DO   #A                                              
     CSR                   MULT 10        #@SLSM                                
E2   CSR                   ENDDO                                                
E1   CSR                   ENDIF                                                
     C*----------------------------------------------------------------         
     C*                                                                         
     C*    Dictionary parameters for - Units - Qty Backordered/Held             
     C*                                                                         
     CSR                   MOVE *BLANK    FRDTAI                                
     CSR                   MOVEL'SOBK'    FRDTAI                                
     CSR                   CALL 'X9800E'               81                       
     C*                    ---- --------                                        
     CSR                   PARM           I9800E                                
B1   CSR         FRERR     IFEQ '0'                                             
     CSR                   MOVE FRDSCR    B@SOBK 40                             
     CSR                   MOVE FRDTAT    T@SOBK  1                             
     CSR                   MOVE FREC      E@SOBK  1                             
     CSR                   MOVE FRDTAS    C@SOBK  40                            
     CSR                   MOVE FRDTAD    G@SOBK  10                            
     CSR                   MOVE FRCDEC    F@SOBK  1                             
     CSR                   MOVELFRSY      S@SOBK  4                             
     CSR                   MOVE FRRT      R@SOBK  2                             
     CSR                   MOVE FRDVAL    D@SOBK 40                             
     CSR                   MOVE FRVAL     A@SOBK 40                             
     CSR                   MOVE FRLVAL    L@SOBK 40                             
     CSR                   MOVE FRUVAL    U@SOBK 40                             
     CSR                   MOVE FREDWR    W@SOBK 30                             
     CSR                   MOVE FRLR      J@SOBK  1                             
     CSR                   MOVE FRNNIX    N@SOBK  20                            
     CSR                   Z-ADD1         #@SOBK 110                            
     CSR                   MOVE F@SOBK    #A                                    
B2   CSR                   DO   #A                                              
     CSR                   MULT 10        #@SOBK                                
E2   CSR                   ENDDO                                                
E1   CSR                   ENDIF                                                
     C*----------------------------------------------------------------         
     C*                                                                         
     C*    Dictionary parameters for - Units - Quantity Canceled/Scrapped       
     C*                                                                         
     CSR                   MOVE *BLANK    FRDTAI                                
     CSR                   MOVEL'SOCN'    FRDTAI                                
     CSR                   CALL 'X9800E'               81                       
     C*                    ---- --------                                        
     CSR                   PARM           I9800E                                
B1   CSR         FRERR     IFEQ '0'                                             
     CSR                   MOVE FRDSCR    B@SOCN 40                             
     CSR                   MOVE FRDTAT    T@SOCN  1                             
     CSR                   MOVE FREC      E@SOCN  1                             
     CSR                   MOVE FRDTAS    C@SOCN  40                            
     CSR                   MOVE FRDTAD    G@SOCN  10                            
     CSR                   MOVE FRCDEC    F@SOCN  1                             
     CSR                   MOVELFRSY      S@SOCN  4                             
     CSR                   MOVE FRRT      R@SOCN  2                             
     CSR                   MOVE FRDVAL    D@SOCN 40                             
     CSR                   MOVE FRVAL     A@SOCN 40                             
     CSR                   MOVE FRLVAL    L@SOCN 40                             
     CSR                   MOVE FRUVAL    U@SOCN 40                             
     CSR                   MOVE FREDWR    W@SOCN 30                             
     CSR                   MOVE FRLR      J@SOCN  1                             
     CSR                   MOVE FRNNIX    N@SOCN  20                            
     CSR                   Z-ADD1         #@SOCN 110                            
     CSR                   MOVE F@SOCN    #A                                    
B2   CSR                   DO   #A                                              
     CSR                   MULT 10        #@SOCN                                
E2   CSR                   ENDDO                                                
E1   CSR                   ENDIF                                                
     C*----------------------------------------------------------------         
     C*                                                                         
     C*    Dictionary parameters for - Units - Quantity Shipped/Completed       
     C*                                                                         
     CSR                   MOVE *BLANK    FRDTAI                                
     CSR                   MOVEL'SOQS'    FRDTAI                                
     CSR                   CALL 'X9800E'               81                       
     C*                    ---- --------                                        
     CSR                   PARM           I9800E                                
B1   CSR         FRERR     IFEQ '0'                                             
     CSR                   MOVE FRDSCR    B@SOQS 40                             
     CSR                   MOVE FRDTAT    T@SOQS  1                             
     CSR                   MOVE FREC      E@SOQS  1                             
S7312 * Change formatting for Mexico qty (no comma, no 0 bal, float -)          
S7312C           *IN76     IFEQ *ON                        MEXICO               
S7312C                     MOVE 'Q'       E@SOQS  1                             
S7312C                     ENDIF                                                
     CSR                   MOVE FRDTAS    C@SOQS  40                            
     CSR                   MOVE FRDTAD    G@SOQS  10                            
     CSR                   MOVE FRCDEC    F@SOQS  1                             
     CSR                   MOVELFRSY      S@SOQS  4                             
     CSR                   MOVE FRRT      R@SOQS  2                             
     CSR                   MOVE FRDVAL    D@SOQS 40                             
     CSR                   MOVE FRVAL     A@SOQS 40                             
     CSR                   MOVE FRLVAL    L@SOQS 40                             
     CSR                   MOVE FRUVAL    U@SOQS 40                             
     CSR                   MOVE FREDWR    W@SOQS 30                             
     CSR                   MOVE FRLR      J@SOQS  1                             
     CSR                   MOVE FRNNIX    N@SOQS  20                            
     CSR                   Z-ADD1         #@SOQS 110                            
     CSR                   MOVE F@SOQS    #A                                    
B2   CSR                   DO   #A                                              
     CSR                   MULT 10        #@SOQS                                
E2   CSR                   ENDDO                                                
E1   CSR                   ENDIF                                                
     C*----------------------------------------------------------------         
     C*                                                                         
     C*    Dictionary parameters - Sales Tax 1                                  
     C*                                                                         
     CSR                   MOVE *BLANK    FRDTAI                                
     CSR                   MOVEL'STA1'    FRDTAI                                
     CSR                   CALL 'X9800E'               81                       
     C*                    ---- --------                                        
     CSR                   PARM           I9800E                                
B1   CSR         FRERR     IFEQ '0'                                             
     CSR                   MOVE FRDSCR    B@STA1 40                             
     CSR                   MOVE FRDTAT    T@STA1  1                             
     CSR                   MOVE FREC      E@STA1  1                             
     CSR                   MOVE FRDTAS    C@STA1  40                            
     CSR                   MOVE FRDTAD    G@STA1  10                            
     CSR                   MOVE FRCDEC    F@STA1  1                             
     CSR                   MOVELFRSY      S@STA1  4                             
     CSR                   MOVE FRRT      R@STA1  2                             
     CSR                   MOVE FRDVAL    D@STA1 40                             
     CSR                   MOVE FRVAL     A@STA1 40                             
     CSR                   MOVE FRLVAL    L@STA1 40                             
     CSR                   MOVE FRUVAL    U@STA1 40                             
     CSR                   MOVE FREDWR    W@STA1 30                             
     CSR                   MOVE FRLR      J@STA1  1                             
     CSR                   MOVE FRNNIX    N@STA1  20                            
     CSR                   Z-ADD1         #@STA1 110                            
     CSR                   MOVE F@STA1    #A                                    
B2   CSR                   DO   #A                                              
     CSR                   MULT 10        #@STA1                                
E2   CSR                   ENDDO                                                
E1   CSR                   ENDIF                                                
     C*----------------------------------------------------------------         
     C*                                                                         
     C*    Dictionary parameters for - Amount - State Total Tax                 
     C*                                                                         
     CSR                   MOVE *BLANK    FRDTAI                                
     CSR                   MOVEL'STOT'    FRDTAI                                
     CSR                   CALL 'X9800E'               81                       
     C*                    ---- --------                                        
     CSR                   PARM           I9800E                                
B1   CSR         FRERR     IFEQ '0'                                             
     CSR                   MOVE FRDSCR    B@STOT 40                             
     CSR                   MOVE FRDTAT    T@STOT  1                             
     CSR                   MOVE FREC      E@STOT  1                             
     CSR                   MOVE FRDTAS    C@STOT  40                            
     CSR                   MOVE FRDTAD    G@STOT  10                            
     CSR                   MOVE FRCDEC    F@STOT  1                             
     CSR                   MOVELFRSY      S@STOT  4                             
     CSR                   MOVE FRRT      R@STOT  2                             
     CSR                   MOVE FRDVAL    D@STOT 40                             
     CSR                   MOVE FRVAL     A@STOT 40                             
     CSR                   MOVE FRLVAL    L@STOT 40                             
     CSR                   MOVE FRUVAL    U@STOT 40                             
     CSR                   MOVE FREDWR    W@STOT 30                             
     CSR                   MOVE FRLR      J@STOT  1                             
     CSR                   MOVE FRNNIX    N@STOT  20                            
     CSR                   Z-ADD1         #@STOT 110                            
     CSR                   MOVE F@STOT    #A                                    
B2   CSR                   DO   #A                                              
     CSR                   MULT 10        #@STOT                                
E2   CSR                   ENDDO                                                
E1   CSR                   ENDIF                                                
     C*----------------------------------------------------------------         
     C*                                                                         
     C*    Dictionary parameters for - Through Potency                 ed       
     C*                                                                         
     CSR                   MOVE *BLANK    FRDTAI                                
     CSR                   MOVEL'THRP'    FRDTAI                                
     CSR                   CALL 'X9800E'               81                       
     C*                    ---- --------                                        
     CSR                   PARM           I9800E                                
     CSR         FRERR     IFEQ '0'                                             
     CSR                   MOVE FRDSCR    B@THRP 40                             
     CSR                   MOVE FRDTAT    T@THRP  1                             
     CSR                   MOVE FREC      E@THRP  1                             
     CSR                   MOVE FRDTAS    C@THRP  40                            
     CSR                   MOVE FRDTAD    G@THRP  10                            
     CSR                   MOVE FRCDEC    F@THRP  1                             
     CSR                   MOVELFRSY      S@THRP  4                             
     CSR                   MOVE FRRT      R@THRP  2                             
     CSR                   MOVE FRDVAL    D@THRP 40                             
     CSR                   MOVE FRVAL     A@THRP 40                             
     CSR                   MOVE FRLVAL    L@THRP 40                             
     CSR                   MOVE FRUVAL    U@THRP 40                             
     CSR                   MOVE FREDWR    W@THRP 30                             
     CSR                   MOVE FRLR      J@THRP  1                             
     CSR                   MOVE FRNNIX    N@THRP  20                            
     CSR                   Z-ADD1         #@THRP 110                            
     CSR                   MOVE F@THRP    #A                                    
     CSR                   DO   #A                                              
     CSR                   MULT 10        #@THRP                                
     CSR                   END                                                  
     CSR                   END                                                  
     C*----------------------------------------------------------------         
     C*                                                                         
     C*    Dictionary parameters for - Total Area Tax Rate                      
     C*                                                                         
     CSR                   MOVE *BLANK    FRDTAI                                
     CSR                   MOVEL'TRAT'    FRDTAI                                
     CSR                   CALL 'X9800E'               81                       
     C*                    ---- --------                                        
     CSR                   PARM           I9800E                                
B1   CSR         FRERR     IFEQ '0'                                             
     CSR                   MOVE FRDSCR    B@TRAT 40                             
     CSR                   MOVE FRDTAT    T@TRAT  1                             
     CSR                   MOVE FREC      E@TRAT  1                             
     CSR                   MOVE FRDTAS    C@TRAT  40                            
     CSR                   MOVE FRDTAD    G@TRAT  10                            
     CSR                   MOVE FRCDEC    F@TRAT  1                             
     CSR                   MOVELFRSY      S@TRAT  4                             
     CSR                   MOVE FRRT      R@TRAT  2                             
     CSR                   MOVE FRDVAL    D@TRAT 40                             
     CSR                   MOVE FRVAL     A@TRAT 40                             
     CSR                   MOVE FRLVAL    L@TRAT 40                             
     CSR                   MOVE FRUVAL    U@TRAT 40                             
     CSR                   MOVE FREDWR    W@TRAT 30                             
     CSR                   MOVE FRLR      J@TRAT  1                             
     CSR                   MOVE FRNNIX    N@TRAT  20                            
     CSR                   Z-ADD1         #@TRAT 110                            
     CSR                   MOVE F@TRAT    #A                                    
B2   CSR                   DO   #A                                              
     CSR                   MULT 10        #@TRAT                                
E2   CSR                   ENDDO                                                
E1   CSR                   ENDIF                                                
     C*----------------------------------------------------------------         
     C*                                                                         
     C*    Dictionary parameters for - Amount - Cost per Unit                   
     C*                                                                         
     CSR                   MOVE *BLANK    FRDTAI                                
     CSR                   MOVEL'UNCS'    FRDTAI                                
     CSR                   CALL 'X9800E'               81                       
     C*                    ---- --------                                        
     CSR                   PARM           I9800E                                
B1   CSR         FRERR     IFEQ '0'                                             
     CSR                   MOVE FRDSCR    B@UNCS 40                             
     CSR                   MOVE FRDTAT    T@UNCS  1                             
     CSR                   MOVE FREC      E@UNCS  1                             
     CSR                   MOVE FRDTAS    C@UNCS  40                            
     CSR                   MOVE FRDTAD    G@UNCS  10                            
     CSR                   MOVE FRCDEC    F@UNCS  1                             
     CSR                   MOVELFRSY      S@UNCS  4                             
     CSR                   MOVE FRRT      R@UNCS  2                             
     CSR                   MOVE FRDVAL    D@UNCS 40                             
     CSR                   MOVE FRVAL     A@UNCS 40                             
     CSR                   MOVE FRLVAL    L@UNCS 40                             
     CSR                   MOVE FRUVAL    U@UNCS 40                             
     CSR                   MOVE FREDWR    W@UNCS 30                             
     CSR                   MOVE FRLR      J@UNCS  1                             
     CSR                   MOVE FRNNIX    N@UNCS  20                            
     CSR                   Z-ADD1         #@UNCS 110                            
     CSR                   MOVE F@UNCS    #A                                    
B2   CSR                   DO   #A                                              
     CSR                   MULT 10        #@UNCS                                
E2   CSR                   ENDDO                                                
E1   CSR                   ENDIF                                                
     C*----------------------------------------------------------------         
     C*                                                                         
     C*    Dictionary parameters for - Amount - Price per Unit                  
     C*                                                                         
     CSR                   MOVE *BLANK    FRDTAI                                
     CSR                   MOVEL'UPRC'    FRDTAI                                
     CSR                   CALL 'X9800E'               81                       
     C*                    ---- --------                                        
     CSR                   PARM           I9800E                                
B1   CSR         FRERR     IFEQ '0'                                             
     CSR                   MOVE FRDSCR    B@UPRC 40                             
     CSR                   MOVE FRDTAT    T@UPRC  1                             
     CSR                   MOVE FREC      E@UPRC  1                             
     CSR                   MOVE FRDTAS    C@UPRC  40                            
     CSR                   MOVE FRDTAD    G@UPRC  10                            
     CSR                   MOVE FRCDEC    F@UPRC  1                             
     CSR                   MOVELFRSY      S@UPRC  4                             
     CSR                   MOVE FRRT      R@UPRC  2                             
     CSR                   MOVE FRDVAL    D@UPRC 40                             
     CSR                   MOVE FRVAL     A@UPRC 40                             
     CSR                   MOVE FRLVAL    L@UPRC 40                             
     CSR                   MOVE FRUVAL    U@UPRC 40                             
     CSR                   MOVE FREDWR    W@UPRC 30                             
     CSR                   MOVE FRLR      J@UPRC  1                             
     CSR                   MOVE FRNNIX    N@UPRC  20                            
     CSR                   Z-ADD1         #@UPRC 110                            
     CSR                   MOVE F@UPRC    #A                                    
B2   CSR                   DO   #A                                              
     CSR                   MULT 10        #@UPRC                                
E2   CSR                   ENDDO                                                
E1   CSR                   ENDIF                                                
     C*----------------------------------------------------------------         
     C*                                                                         
     C*    Dictionary parameters for - Amount - Total Sales Tax                 
     C*                                                                         
     CSR                   MOVE *BLANK    FRDTAI                                
     CSR                   MOVEL'#ATT'    FRDTAI                                
     CSR                   CALL 'X9800E'               81                       
     C*                    ---- --------                                        
     CSR                   PARM           I9800E                                
B1   CSR         FRERR     IFEQ '0'                                             
     CSR                   MOVE FRDSCR    B@#ATT 40                             
     CSR                   MOVE FRDTAT    T@#ATT  1                             
     CSR                   MOVE FREC      E@#ATT  1                             
     CSR                   MOVE FRDTAS    C@#ATT  40                            
     CSR                   MOVE FRDTAD    G@#ATT  10                            
     CSR                   MOVE FRCDEC    F@#ATT  1                             
     CSR                   MOVELFRSY      S@#ATT  4                             
     CSR                   MOVE FRRT      R@#ATT  2                             
     CSR                   MOVE FRDVAL    D@#ATT 40                             
     CSR                   MOVE FRVAL     A@#ATT 40                             
     CSR                   MOVE FRLVAL    L@#ATT 40                             
     CSR                   MOVE FRUVAL    U@#ATT 40                             
     CSR                   MOVE FREDWR    W@#ATT 30                             
     CSR                   MOVE FRLR      J@#ATT  1                             
     CSR                   MOVE FRNNIX    N@#ATT  20                            
     CSR                   Z-ADD1         #@#ATT 110                            
     CSR                   MOVE F@#ATT    #A                                    
B2   CSR                   DO   #A                                              
     CSR                   MULT 10        #@#ATT                                
E2   CSR                   ENDDO                                                
E1   CSR                   ENDIF                                                
     C*----------------------------------------------------------------         
     C*                                                                         
     C*    Dictionary parameters for - Country Code                             
     C*                                                                         
     CSR                   MOVE *BLANK    FRDTAI                                
     CSR                   MOVEL'CTR2'    FRDTAI                                
     CSR                   CALL 'X9800E'               81                       
     C*                    ---- --------                                        
     CSR                   PARM           I9800E                                
B1   CSR         FRERR     IFEQ '0'                                             
     CSR                   MOVE FRDSCR    B@CTR2 40                             
     CSR                   MOVE FRDTAT    T@CTR2  1                             
     CSR                   MOVE FREC      E@CTR2  1                             
     CSR                   MOVE FRDTAS    C@CTR2  40                            
     CSR                   MOVE FRDTAD    G@CTR2  10                            
     CSR                   MOVE FRCDEC    F@CTR2  1                             
     CSR                   MOVELFRSY      S@CTR2  4                             
     CSR                   MOVE FRRT      R@CTR2  2                             
     CSR                   MOVE FRDVAL    D@CTR2 40                             
     CSR                   MOVE FRVAL     A@CTR2 40                             
     CSR                   MOVE FRLVAL    L@CTR2 40                             
     CSR                   MOVE FRUVAL    U@CTR2 40                             
     CSR                   MOVE FREDWR    W@CTR2 30                             
     CSR                   MOVE FRLR      J@CTR2  1                             
     CSR                   MOVE FRNNIX    N@CTR2  20                            
     CSR                   Z-ADD1         #@CTR2 110                            
     CSR                   MOVE F@CTR2    #A                                    
B2   CSR                   DO   #A                                              
     CSR                   MULT 10        #@CTR2                                
E2   CSR                   ENDDO                                                
E1   CSR                   ENDIF                                                
     C*----------------------------------------------------------------         
     C*                                                                         
     C*    Dictionary parameters for - Country Code                             
     C*                                                                         
     CSR                   MOVE *BLANK    FRDTAI                                
     CSR                   MOVEL'CTR '    FRDTAI                                
     CSR                   CALL 'X9800E'               81                       
     C*                    ---- --------                                        
     CSR                   PARM           I9800E                                
B1   CSR         FRERR     IFEQ '0'                                             
     CSR                   MOVE FRDSCR    B@CTR  40                             
     CSR                   MOVE FRDTAT    T@CTR   1                             
     CSR                   MOVE FREC      E@CTR   1                             
     CSR                   MOVE FRDTAS    C@CTR   40                            
     CSR                   MOVE FRDTAD    G@CTR   10                            
     CSR                   MOVE FRCDEC    F@CTR   1                             
     CSR                   MOVELFRSY      S@CTR   4                             
     CSR                   MOVE FRRT      R@CTR   2                             
     CSR                   MOVE FRDVAL    D@CTR  40                             
     CSR                   MOVE FRVAL     A@CTR  40                             
     CSR                   MOVE FRLVAL    L@CTR  40                             
     CSR                   MOVE FRUVAL    U@CTR  40                             
     CSR                   MOVE FREDWR    W@CTR  30                             
     CSR                   MOVE FRLR      J@CTR   1                             
     CSR                   MOVE FRNNIX    N@CTR   20                            
     CSR                   Z-ADD1         #@CTR  110                            
     CSR                   MOVE F@CTR     #A                                    
B2   CSR                   DO   #A                                              
     CSR                   MULT 10        #@CTR                                 
E2   CSR                   ENDDO                                                
E1   CSR                   ENDIF                                                
     C*----------------------------------------------------------------         
     C*                                                                         
     C*    Dictionary parameters for - Freight Handling Code                    
     C*                                                                         
     CSR                   MOVE *BLANK    FRDTAI                                
     CSR                   MOVEL'FRTH'    FRDTAI                                
     CSR                   CALL 'X9800E'               81                       
     C*                    ---- --------                                        
     CSR                   PARM           I9800E                                
B1   CSR         FRERR     IFEQ '0'                                             
     CSR                   MOVE FRDSCR    B@FRTH 40                             
     CSR                   MOVE FRDTAT    T@FRTH  1                             
     CSR                   MOVE FREC      E@FRTH  1                             
     CSR                   MOVE FRDTAS    C@FRTH  40                            
     CSR                   MOVE FRDTAD    G@FRTH  10                            
     CSR                   MOVE FRCDEC    F@FRTH  1                             
     CSR                   MOVELFRSY      S@FRTH  4                             
     CSR                   MOVE FRRT      R@FRTH  2                             
     CSR                   MOVE FRDVAL    D@FRTH 40                             
     CSR                   MOVE FRVAL     A@FRTH 40                             
     CSR                   MOVE FRLVAL    L@FRTH 40                             
     CSR                   MOVE FRUVAL    U@FRTH 40                             
     CSR                   MOVE FREDWR    W@FRTH 30                             
     CSR                   MOVE FRLR      J@FRTH  1                             
     CSR                   MOVE FRNNIX    N@FRTH  20                            
     CSR                   Z-ADD1         #@FRTH 110                            
     CSR                   MOVE F@FRTH    #A                                    
B2   CSR                   DO   #A                                              
     CSR                   MULT 10        #@FRTH                                
E2   CSR                   ENDDO                                                
E1   CSR                   ENDIF                                                
     C*----------------------------------------------------------------         
     C*                                                                         
     C*    Dictionary parameters for - Payment Instrument                       
     C*                                                                         
     CSR                   MOVE *BLANK    FRDTAI                                
     CSR                   MOVEL'PYIN'    FRDTAI                                
     CSR                   CALL 'X9800E'               81                       
     C*                    ---- --------                                        
     CSR                   PARM           I9800E                                
B1   CSR         FRERR     IFEQ '0'                                             
     CSR                   MOVE FRDSCR    B@PYIN 40                             
     CSR                   MOVE FRDTAT    T@PYIN  1                             
     CSR                   MOVE FREC      E@PYIN  1                             
     CSR                   MOVE FRDTAS    C@PYIN  40                            
     CSR                   MOVE FRDTAD    G@PYIN  10                            
     CSR                   MOVE FRCDEC    F@PYIN  1                             
     CSR                   MOVELFRSY      S@PYIN  4                             
     CSR                   MOVE FRRT      R@PYIN  2                             
     CSR                   MOVE FRDVAL    D@PYIN 40                             
     CSR                   MOVE FRVAL     A@PYIN 40                             
     CSR                   MOVE FRLVAL    L@PYIN 40                             
     CSR                   MOVE FRUVAL    U@PYIN 40                             
     CSR                   MOVE FREDWR    W@PYIN 30                             
     CSR                   MOVE FRLR      J@PYIN  1                             
     CSR                   MOVE FRNNIX    N@PYIN  20                            
     CSR                   Z-ADD1         #@PYIN 110                            
     CSR                   MOVE F@PYIN    #A                                    
B2   CSR                   DO   #A                                              
     CSR                   MULT 10        #@PYIN                                
E2   CSR                   ENDDO                                                
E1   CSR                   ENDIF                                                
     C*----------------------------------------------------------------         
     C*                                                                         
     C*    Dictionary parameters for - Page Number                              
     C*                                                                         
     CSR                   MOVE *BLANK    FRDTAI                                
     CSR                   MOVEL'#PG'     FRDTAI                                
     CSR                   CALL 'X9800E'               81                       
     C*                    ---- --------                                        
     CSR                   PARM           I9800E                                
B1   CSR         FRERR     IFEQ '0'                                             
     CSR                   MOVE FRDSCR    B@#PG  40                             
     CSR                   MOVE FRDTAT    T@#PG   1                             
     CSR                   MOVE FREC      E@#PG   1                             
     CSR                   MOVE FRDTAS    C@#PG   40                            
     CSR                   MOVE FRDTAD    G@#PG   10                            
     CSR                   MOVE FRCDEC    F@#PG   1                             
     CSR                   MOVE FRSY      S@#PG   4                             
     CSR                   MOVE FRRT      R@#PG   2                             
     CSR                   MOVE FRDVAL    D@#PG  40                             
     CSR                   MOVE FRVAL     A@#PG  40                             
     CSR                   MOVE FRLVAL    L@#PG  40                             
     CSR                   MOVE FRUVAL    U@#PG  40                             
     CSR                   MOVE FREDWR    W@#PG  30                             
     CSR                   MOVE FRLR      J@#PG   1                             
     CSR                   MOVE FRNNIX    N@#PG   20                            
     CSR                   Z-ADD1         #@#PG  110                            
     CSR                   MOVE F@#PG     #A                                    
B2   CSR                   DO   #A                                              
     CSR                   MULT 10        #@#PG                                 
E2   CSR                   ENDDO                                                
E1   CSR                   ENDIF                                                
     C*----------------------------------------------------------------         
     C*                                                                         
     C*    Dictionary parameters for - Tax Rate 1                               
     C*                                                                         
     CSR                   MOVE *BLANK    FRDTAI                                
     CSR                   MOVEL'TXR1'    FRDTAI                                
     CSR                   CALL 'X9800E'               81                       
     C*                    ---- --------                                        
     CSR                   PARM           I9800E                                
     CSR         FRERR     IFEQ '0'                                             
     CSR                   MOVE FRDSCR    B@TXR1 40                             
     CSR                   MOVE FRDTAT    T@TXR1  1                             
     CSR                   MOVE FREC      E@TXR1  1                             
     CSR                   MOVE FRDTAS    C@TXR1  40                            
     CSR                   MOVE FRDTAD    G@TXR1  10                            
     CSR                   MOVE FRCDEC    F@TXR1  1                             
     CSR                   MOVELFRSY      S@TXR1  4                             
     CSR                   MOVE FRRT      R@TXR1  2                             
     CSR                   MOVE FRDVAL    D@TXR1 40                             
     CSR                   MOVE FRVAL     A@TXR1 40                             
     CSR                   MOVE FRLVAL    L@TXR1 40                             
     CSR                   MOVE FRUVAL    U@TXR1 40                             
     CSR                   MOVE FREDWR    W@TXR1 30                             
     CSR                   MOVE FRLR      J@TXR1  1                             
     CSR                   MOVE FRNNIX    N@TXR1  20                            
     CSR                   Z-ADD1         #@TXR1 110                            
     CSR                   MOVE F@TXR1    #A                                    
     CSR                   DO   #A                                              
     CSR                   MULT 10        #@TXR1                                
     CSR                   END                                                  
     CSR                   END                                                  
     C*----------------------------------------------------------------         
     C*                                                                         
     C*    Dictionary parameters for - Edi Document Number                      
     C*                                                                         
     CSR                   MOVE *BLANK    FRDTAI                                
     CSR                   MOVEL'EDOC'    FRDTAI                                
     CSR                   CALL 'X9800E'               81                       
     C*                    ---- --------                                        
     CSR                   PARM           I9800E                                
     CSR         FRERR     IFEQ '0'                                             
     CSR                   MOVE FRDSCR    B@EDOC 40                             
     CSR                   MOVE FRDTAT    T@EDOC  1                             
     CSR                   MOVE FREC      E@EDOC  1                             
     CSR                   MOVE FRDTAS    C@EDOC  40                            
     CSR                   MOVE FRDTAD    G@EDOC  10                            
     CSR                   MOVE FRCDEC    F@EDOC  1                             
     CSR                   MOVELFRSY      S@EDOC  4                             
     CSR                   MOVE FRRT      R@EDOC  2                             
     CSR                   MOVE FRDVAL    D@EDOC 40                             
     CSR                   MOVE FRVAL     A@EDOC 40                             
     CSR                   MOVE FRLVAL    L@EDOC 40                             
     CSR                   MOVE FRUVAL    U@EDOC 40                             
     CSR                   MOVE FREDWR    W@EDOC 30                             
     CSR                   MOVE FRLR      J@EDOC  1                             
     CSR                   MOVE FRNNIX    N@EDOC  20                            
     CSR                   Z-ADD1         #@EDOC 110                            
     CSR                   MOVE F@EDOC    #A                                    
     CSR                   DO   #A                                              
     CSR                   MULT 10        #@EDOC                                
     CSR                   END                                                  
     CSR                   END                                                  
     C*----------------------------------------------------------------         
     C*                                                                         
     C*    Dictionary parameters for - Edi Line Number                          
     C*                                                                         
     CSR                   MOVE *BLANK    FRDTAI                                
     CSR                   MOVEL'EDLN'    FRDTAI                                
     CSR                   CALL 'X9800E'               81                       
     C*                    ---- --------                                        
     CSR                   PARM           I9800E                                
     CSR         FRERR     IFEQ '0'                                             
     CSR                   MOVE FRDSCR    B@EDLN 40                             
     CSR                   MOVE FRDTAT    T@EDLN  1                             
     CSR                   MOVE FREC      E@EDLN  1                             
     CSR                   MOVE FRDTAS    C@EDLN  40                            
     CSR                   MOVE FRDTAD    G@EDLN  10                            
     CSR                   MOVE FRCDEC    F@EDLN  1                             
     CSR                   MOVELFRSY      S@EDLN  4                             
     CSR                   MOVE FRRT      R@EDLN  2                             
     CSR                   MOVE FRDVAL    D@EDLN 40                             
     CSR                   MOVE FRVAL     A@EDLN 40                             
     CSR                   MOVE FRLVAL    L@EDLN 40                             
     CSR                   MOVE FRUVAL    U@EDLN 40                             
     CSR                   MOVE FREDWR    W@EDLN 30                             
     CSR                   MOVE FRLR      J@EDLN  1                             
     CSR                   MOVE FRNNIX    N@EDLN  20                            
     CSR                   Z-ADD1         #@EDLN 110                            
     CSR                   MOVE F@EDLN    #A                                    
     CSR                   DO   #A                                              
     CSR                   MULT 10        #@EDLN                                
     CSR                   END                                                  
     CSR                   END                                                  
     C*----------------------------------------------------------------         
     C*                                                                         
     C*    Dictionary parameters for - Edi Line #                               
     C*                                                                         
     CSR                   MOVE *BLANK    FRDTAI                                
     CSR                   MOVEL'EDDL'    FRDTAI                                
     CSR                   CALL 'X9800E'               81                       
     C*                    ---- --------                                        
     CSR                   PARM           I9800E                                
     CSR         FRERR     IFEQ '0'                                             
     CSR                   MOVE FRDSCR    B@EDDL 40                             
     CSR                   MOVE FRDTAT    T@EDDL  1                             
     CSR                   MOVE FREC      E@EDDL  1                             
     CSR                   MOVE FRDTAS    C@EDDL  40                            
     CSR                   MOVE FRDTAD    G@EDDL  10                            
     CSR                   MOVE FRCDEC    F@EDDL  1                             
     CSR                   MOVELFRSY      S@EDDL  4                             
     CSR                   MOVE FRRT      R@EDDL  2                             
     CSR                   MOVE FRDVAL    D@EDDL 40                             
     CSR                   MOVE FRVAL     A@EDDL 40                             
     CSR                   MOVE FRLVAL    L@EDDL 40                             
     CSR                   MOVE FRUVAL    U@EDDL 40                             
     CSR                   MOVE FREDWR    W@EDDL 30                             
     CSR                   MOVE FRLR      J@EDDL  1                             
     CSR                   MOVE FRNNIX    N@EDDL  20                            
     CSR                   Z-ADD1         #@EDDL 110                            
     CSR                   MOVE F@EDDL    #A                                    
     CSR                   DO   #A                                              
     CSR                   MULT 10        #@EDDL                                
     CSR                   END                                                  
     CSR                   END                                                  
     C*----------------------------------------------------------------         
     C*                                                                         
     C*    Dictionary parameters for -                                          
     C*                                                                         
     CSR                   MOVE *BLANK    FRDTAI                                
     CSR                   MOVEL'DSPR'    FRDTAI                                
     CSR                   CALL 'X9800E'               81                       
     C*                    ---- --------                                        
     CSR                   PARM           I9800E                                
     CSR         FRERR     IFEQ '0'                                             
     CSR                   MOVE FRDSCR    B@DSPR 40                             
     CSR                   MOVE FRDTAT    T@DSPR  1                             
     CSR                   MOVE FREC      E@DSPR  1                             
     CSR                   MOVE FRDTAS    C@DSPR  40                            
     CSR                   MOVE FRDTAD    G@DSPR  10                            
     CSR                   MOVE FRCDEC    F@DSPR  1                             
     CSR                   MOVELFRSY      S@DSPR  4                             
     CSR                   MOVE FRRT      R@DSPR  2                             
     CSR                   MOVE FRDVAL    D@DSPR 40                             
     CSR                   MOVE FRVAL     A@DSPR 40                             
     CSR                   MOVE FRLVAL    L@DSPR 40                             
     CSR                   MOVE FRUVAL    U@DSPR 40                             
     CSR                   MOVE FREDWR    W@DSPR 30                             
     CSR                   MOVE FRLR      J@DSPR  1                             
     CSR                   MOVE FRNNIX    N@DSPR  20                            
     CSR                   Z-ADD1         #@DSPR 110                            
     CSR                   MOVE F@DSPR    #A                                    
     CSR                   DO   #A                                              
     CSR                   MULT 10        #@DSPR                                
     CSR                   END                                                  
     CSR                   END                                                  
     C*----------------------------------------------------------------         
     C*                                                                         
     C*    Dictionary parameters for -                                          
     C*                                                                         
     CSR                   MOVE *BLANK    FRDTAI                                
     CSR                   MOVEL'DSCT'    FRDTAI                                
     CSR                   CALL 'X9800E'               81                       
     C*                    ---- --------                                        
     CSR                   PARM           I9800E                                
     CSR         FRERR     IFEQ '0'                                             
     CSR                   MOVE FRDSCR    B@DSCT 40                             
     CSR                   MOVE FRDTAT    T@DSCT  1                             
     CSR                   MOVE FREC      E@DSCT  1                             
     CSR                   MOVE FRDTAS    C@DSCT  40                            
     CSR                   MOVE FRDTAD    G@DSCT  10                            
     CSR                   MOVE FRCDEC    F@DSCT  1                             
     CSR                   MOVELFRSY      S@DSCT  4                             
     CSR                   MOVE FRRT      R@DSCT  2                             
     CSR                   MOVE FRDVAL    D@DSCT 40                             
     CSR                   MOVE FRVAL     A@DSCT 40                             
     CSR                   MOVE FRLVAL    L@DSCT 40                             
     CSR                   MOVE FRUVAL    U@DSCT 40                             
     CSR                   MOVE FREDWR    W@DSCT 30                             
     CSR                   MOVE FRLR      J@DSCT  1                             
     CSR                   MOVE FRNNIX    N@DSCT  20                            
     CSR                   Z-ADD1         #@DSCT 110                            
     CSR                   MOVE F@DSCT    #A                                    
     CSR                   DO   #A                                              
     CSR                   MULT 10        #@DSCT                                
     CSR                   END                                                  
     CSR                   END                                                  
     C*----------------------------------------------------------------         
     C*----------------------------------------------------------------         
     CSR         END998    ENDSR                                                
     C*****************************************************************         
     C*                                                                         
     C*    SUBROUTINE S999  - Housekeeping                                      
     C*    -------------------------------                                      
     C*                                                                         
     C*    Processing:  1.  Receive passed parameters.                          
     C*                 2.  Load report text.                                   
     C*                 3.  Load default report title.                          
     C*                 4.  Initialize data file key list(s).                   
     C*                 4.  Load organization name.                             
     C*                 5.  Retrieve DREAM writer parameters.                   
     C*                 6.  Print cover page and help instructions.             
     C*                 7.  Load processing opts & level break arrays.          
     C*                 8.  Open data base files.                               
     C*                 9.  File open errors.                                   
     C*                                                                         
     CSR         S999      BEGSR                                                
     C*          ----      -----                                                
     C*                                                                         
     C*    Required program parameters.                                         
     C*                                                                         
     CSR         *ENTRY    PLIST                                                
     CSR                   PARM           ##PID  10                             
     CSR                   PARM           ##VERS 10                             
     CSR                   PARM           ##MODE  1                             
     CSR                   PARM           ##LIB  10                             
     CSR                   PARM           DSPLST                                
     C*                                                                         
     C*----------------------------------------------------------------        V
     C*                                                                         
     C*    Determine if Vertex is Active.                                      V
     C*                                                                        V
     CSR                   EXSR C7301                                          V
     C*                    ---- -----                                          V
     C*----------------------------------------------------------------        V
     C*                                                                         
     C*    Key list for - Bank Transit Master File                              
     C*                                                                         
     CSR         AYKY01    KLIST                                                
     CSR                   KFLD           AYAN8                                 
     CSR                   KFLD           AYBKTP                                
      *                                                                         
     CSR         UMKY01    KLIST                                                
     CSR                   KFLD           UMMCU                                 
     CSR                   KFLD           UMITM                                 
     CSR                   KFLD           UMUM                                  
     CSR                   KFLD           UMRUM                                 
      *                                                                         
     C*----------------------------------------------------------------         
     C*                                                                         
     C*    Key list for - Price Adjustment History                              
     C*                                                                         
     CSR         ALKY01    KLIST                                                
     CSR                   KFLD           ALDOCO                                
     CSR                   KFLD           ALDCTO                                
     CSR                   KFLD           ALKCOO                                
     CSR                   KFLD           ALLNID                                
     C*                                                                         
     CSR         ALKY02    KLIST                                                
     CSR                   KFLD           ALDOCO                                
     CSR                   KFLD           ALDCTO                                
     CSR                   KFLD           ALKCOO                                
     CSR                   KFLD           ALLNID                                
     CSR                   KFLD           ALOSEQ                                
     C*----------------------------------------------------------------         
     C*                                                                         
     C*    Key list for - Dream Writer Printer Overrides                        
     C*                                                                         
     CSR         DPKY01    KLIST                                                
     CSR                   KFLD           PSPID                                 
     CSR                   KFLD           PSVERS                                
     C*----------------------------------------------------------------         
     C*                                                                         
     C*    Key list for - LF - Order Type, Line Status, Line Type               
     C*                                                                         
     CSR         FSKY0A    KLIST                                                
     CSR                   KFLD           FSDCTO                                
     CSR                   KFLD           FSTRTY                                
     CSR                   KFLD           FSLNTY                                
     C*----------------------------------------------------------------         
     C*                                                                         
     C*    Key list for - Sales Order/Purchasing Text Detail Lines              
     C*                                                                         
     CSR         JMKY01    KLIST                                                
     CSR                   KFLD           JMDOCO                                
     CSR                   KFLD           JMDCTO                                
     CSR                   KFLD           JMKCOO                                
     CSR                   KFLD           JMLNID                                
     C*----------------------------------------------------------------         
     C*                                                                         
     C*    Key list for - Sales Order/Purchasing Text Detail Lines              
     C*                                                                         
     CSR         JMKY02    KLIST                                                
     CSR                   KFLD           JMDOCO                                
     CSR                   KFLD           JMDCTO                                
     CSR                   KFLD           JMKCOO                                
     CSR                   KFLD           JMLNID                                
     CSR                   KFLD           JMLINS                                
     C*----------------------------------------------------------------         
     C*                                                                         
     C*    Key list for - LF - A/R Invoice Number, Order Type                   
     C*                                                                         
     C***        RPKY01    KLIST                                                
     C***                  KFLD           SDDOC                                 
     C***                  KFLD           $@DCT                                 
     C***                  KFLD           SDKCO                                 
     C*----------------------------------------------------------------         
     C*                                                                         
     C*    Key list for - LF - Order Number, Order Type, Line Number            
     C*                                                                         
     CSR         SDKY0A    KLIST                                                
     CSR                   KFLD           SDDOCO                                
     CSR                   KFLD           SDDCTO                                
     CSR                   KFLD           SDKCOO                                
     CSR                   KFLD           SDLNID                                
     C*----------------------------------------------------------------         
     C*                                                                         
     C*    Key list for - LF - Order Number, Order Type                         
     C*                                                                         
     CSR         SDKYA3    KLIST                                                
     CSR                   KFLD           SDDOCO                                
     CSR                   KFLD           SDDCTO                                
     CSR                   KFLD           SDKCOO                                
     C*----------------------------------------------------------------         
     C*                                                                         
     C*    Key list for - F49219                                                
     C*                                                                         
     CSR         UDKY01    KLIST                                                
     CSR                   KFLD           UDDOCO                                
     CSR                   KFLD           UDDCTO                                
     CSR                   KFLD           UDKCOO                                
     C*----------------------------------------------------------------         
     C*                                                                         
     C*    Key list for - LF - Document Number, Document Type, Key CO           
     C*                                                                         
     CSR         SDKY0M    KLIST                                                
     CSR                   KFLD           SDDOC                                 
     CSR                   KFLD           SDDCT                                 
     CSR                   KFLD           SDKCO                                 
     C*----------------------------------------------------------------         
     C*                                                                         
     C*    Key list for - LF - Order Number, Order Type                         
     C*                                                                         
     CSR         SHKY0A    KLIST                                                
     CSR                   KFLD           SHDOCO                                
     CSR                   KFLD           SHDCTO                                
     CSR                   KFLD           SHKCOO                                
     C*----------------------------------------------------------------         
     C*                                                                         
     C*    Key list for - LF - Item Number, Line Number, Order Number, Ord      
     C*                                                                         
     CSR         SWKY0G    KLIST                                                
     CSR                   KFLD           SWITM                                 
     CSR                   KFLD           SWDOCO                                
     CSR                   KFLD           SWDCTO                                
     CSR                   KFLD           SWKCOO                                
     CSR                   KFLD           SWSFXO                                
     CSR                   KFLD           SWLNID                                
     C*----------------------------------------------------------------         
     C*                                                                         
     C*    Key list for - Tax Areas                                             
     C*                                                                         
     CSR         TAKY01    KLIST                                                
     CSR                   KFLD           TATXA1                                
     CSR                   KFLD           TAITM                                 
     CSR                   KFLD           SDTRDJ                                
     C*                                                                         
     CSR         TAKY11    KLIST                                                
     CSR                   KFLD           TATXA1                                
     CSR                   KFLD           TAITM                                 
     C*----------------------------------------------------------------         
     C*                                                                         
     C*    Key list for - Unique Document Number                                
     C*                                                                         
     CSR         SZKEY1    KLIST                                                
     CSR                   KFLD           SZEDOC                                
     CSR                   KFLD           SZEDCT                                
     CSR                   KFLD           SZEKCO                                
     C*----------------------------------------------------------------         
     C*                                                                         
     C*    Key list for - Address Information                                   
     C*                                                                         
     CSR         OAKY01    KLIST                                                
     CSR                   KFLD           OADOCO                                
     CSR                   KFLD           OADCTO                                
     CSR                   KFLD           OAKCOO                                
     CSR                   KFLD           OAANTY                                
     C*----------------------------------------------------------------         
     C*                                                                         
     C*    Key list for - User Defined Codes - Alternate Language               
     C*                   Description                                           
     C*                                                                         
     CSR         DRKY01    KLIST                                                
     CSR                   KFLD           DRSY                                  
     CSR                   KFLD           DRRT                                  
     CSR                   KFLD           DRKY                                  
     CSR                   KFLD           DRLNGP                                
     C*                                                                         
     CSR         DRKEY     KLIST                                                
     CSR                   KFLD           DRSY                                  
     CSR                   KFLD           DRRT                                  
     CSR                   KFLD           DRKY                                  
     C*                                                                         
     CSR         A5KEY     KLIST                                                
     CSR                   KFLD           WAPP   15                             
     CSR                   KFLD           CKEY   40                             
S6527C*                                                                         
     CSR         KEY01     KLIST                                                
     CSR                   KFLD           HFDOCO                                
     CSR                   KFLD           HFDCTO                                
     CSR                   KFLD           HFDATE                                
     C*                                                                         
     CSR         KEY02     KLIST                                                
     CSR                   KFLD           DRK1    4                             
     CSR                   KFLD           DRK2    2                             
     CSR                   KFLD           DRK3   10                             
     C*----------------------------------------------------------------         
     C*                                                                         
     C*    Initialize data structures.                                          
     C*                                                                         
     CSR                   CLEARPS@@1                                           
     CSR                   CLEARI0101                                           
     CSR                   CLEARI0301                                           
     CSR                   CLEARI4102                                           
     C*----------------------------------------------------------------         
     C*                                                                         
     C*    Load Complimentary products constants                                
     C*                                                                         
     CSR                   MOVE *ALL'0'   DSCOMP                                
     CSR                   MOVE *BLANKS   PS@@                                  
     CSR                   MOVE *BLANKS   KY@@                                  
     CSR                   CALL 'XS7300'               81                       
     C*                    ---- --------                                        
     CSR                   PARM           PS@@                                  
     CSR                   PARM           DSCOMP                                
     C*                                                                         
     C*----------------------------------------------------------------         
     C*                                                                         
     C*    Load HAZOX (R) System constants                                      
     C*                                                                         
     CSR         #CHZX     IFEQ '1'                                             
     CSR                   MOVE '0'       $@SPPI  1                             
     CSR                   MOVE *BLANKS   PS@@                                  
DBN  CSR                   MOVEL*BLANKS   KY@@                                  
     CSR                   CALL 'XS7303 '              81                       
     C*                    ---- ---------                                       
     CSR                   PARM           PS@@                                  
     CSR                   PARM           DS7303                                
     C*                                                                         
     CSR         RT@@      IFEQ *BLANKS                                         
DBN  CSR                   MOVE #RSPPI    $@SPPI                                
     CSR                   ENDIF                                                
     CSR                   ENDIF                                                
     C*                                                                         
     C*----------------------------------------------------------------         
     C*                                                                         
     C*    Load system date                                                     
     C*                                                                         
     CSR                   TIME           $WK120 120                            
     CSR                   MOVEL$WK120    $$TIME  60                            
     CSR                   MOVE $WK120    $$EDT   60                            
     CSR                   MOVE '000000'  $UDATE  60                            
     C*                                                                         
     CSR                   MOVEL$$EDT     #SIDAT  6                             
     CSR                   MOVE *BLANK    #EDAT   8                             
     CSR                   MOVEL'*SYSVAL '#FFMT   7                             
     CSR                   MOVEL'*JUL    '#TFMT   7                             
     CSR                   MOVEL'*NONE   '#SEP    7                             
     CSR                   MOVEL' '       $ERTST  1                             
     CSR                   CALL 'X0028   '             81                       
     C*                    ---- ---------                                       
     CSR                   PARM           #SIDAT                                
     CSR                   PARM           #EDAT                                 
     CSR                   PARM           #FFMT                                 
     CSR                   PARM           #TFMT                                 
     CSR                   PARM           #SEP                                  
     CSR                   PARM           $ERTST                                
     CSR                   MOVEL#SIDAT    $$UPMJ  60                            
     C*----------------------------------------------------------------         
     C*                                                                         
     C*    Retrieve processing options and level breaks.                        
     C*                                                                         
     C/COPY JDECPY,C81DRPT                                                      
     C*                                                                         
     C*    Load Status Range to process.                                        
     C*                                                                         
     C*      Status Code From                                                   
     C*                                                                         
     CSR                   MOVEL@OP,1     $@STF   3                             
     C*                                                                         
     C*      Status Code To                                                     
     C*                                                                         
     CSR                   MOVEL@OP,2     $@STT   3                             
     C*                                                                         
     C*    Set Defaults for selection range, upper is not optional.             
     C*                                                                         
B1   CSR         $@STF     IFEQ *BLANKS                                         
     CSR                   MOVE *LOVAL    $@STF                                 
E1   CSR                   ENDIF                                                
     C*                                                                         
     C*    If upper limit is blank, reverse defaults to select none.            
     C*                                                                         
B1   CSR         $@STT     IFEQ *BLANKS                                         
     CSR                   MOVE *HIVAL    $@STF                                 
     CSR                   MOVE *LOVAL    $@STT                                 
E1   CSR                   ENDIF                                                
     C*                                                                         
     C*    Override next status                                                 
     C*                                                                         
     CSR                   MOVEL@OP,3     $@STS   3                             
     C*                                                                         
     C*    Don't update the next status code                                    
     C*                                                                         
     CSR                   MOVEL@OP,4     $@UPDT  1                             
B1   CSR         $@UPDT    IFNE '1'                                             
     CSR                   MOVE ' '       $@UPDT                                
E1   CSR                   ENDIF                                                
     C*                                                                         
     C*    Proof or final mode          Blank=Final   1=Proof                   
     C*                                                                         
     CSR         $@UPDT    IFEQ ' '                                             
     CSR                   MOVEL'Final'   VC0103                                
     CSR                   ELSE                                                 
     CSR                   MOVEL'Proof'   VC0103                                
     CSR                   END                                                  
     C*                                                                         
     C*    Tax Information                                                      
     C*      1 - Print by Tax Group                                             
     C*      2 - Print by Tax Area                                              
     C*      3 - Print by Tax Authority                                         
     C*                                                                         
     CSR                   MOVEL@OP,5     $@VAT   1                             
     C*                                                                         
     C*    Date to be printed as invoice date                                   
     C*                                                                         
     CSR                   MOVEA@OP,6     @NM                                   
     CSR                   EXSR C0012                                           
     C*                    ---- -----                                           
     CSR                   Z-ADD#NUMR     $IVD    60                            
     C*                                                                         
     C*    Print the global print message                                       
     C*                                                                         
     CSR                   MOVEL@OP,8     $@INMG 10                             
     C*                                                                         
     C*    Assign A/R invoice number                                            
     C*                                                                         
     CSR                   MOVEL@OP,9     $@PRF   1                             
B1   CSR         $@PRF     IFNE '1'                                             
     CSR                   MOVE ' '       $@PRF                                 
E1   CSR                   ENDIF                                                
     C*                                                                         
     C*    Print serial numbers                                                 
     C*                                                                         
     CSR                   MOVEL@OP,10    $@SRL   1                             
     C*                                                                         
     C*    Print sales order associated text                                    
     C*                                                                         
     CSR                   MOVEL@OP,11    $@ASTX  1                             
     C*                                                                         
     C*    Print backordered and cancelled lines only once                      
     C*                                                                         
     CSR                   MOVEL@OP,12    $@BCPT  1                             
     C*                                                                         
     C*    Print backordered/cancelled lines                                    
     C*      1 - Print backordered lines                                        
     C*      2 - Print cancelled lines                                          
     C*      3 - Print both                                                     
     C*      4 - Print neither                                                  
     C*                                                                         
     CSR                   MOVEL@OP,13    $@BOCN  1                             
     C*                                                                         
     C*    Print kit component lines                                            
     C*                                                                         
     CSR                   MOVEL@OP,14    $@KITS  1                             
B1   CSR         $@KITS    IFNE '1'                                             
     CSR                   MOVE ' '       $@KITS                                
E1   CSR                   ENDIF                                                
     C*                                                                         
     C*    Print future committed inventory lines                               
     C*                                                                         
     CSR                   MOVEL@OP,15    $@FTCM  1                             
     C*                                                                         
     C*    Print item number                                                    
     C*      1 - Print our item number                                          
     C*      2 - Print our item# and the customer item#                         
     C*                                                                         
     CSR                   MOVEL@OP,16    $@PCN   1                             
     C*                                                                         
     C*    Cross reference number for customer item number                      
     C*                                                                         
     CSR                   MOVEL@OP,17    $@XRT   2                             
     C*                                                                         
     C*    Summarize items                                                      
     C*      1 - Summarize all items                                            
     C*      2 - Summarize items within each whole line number                  
     C*                                                                         
     CSR                   MOVEL@OP,18    $@SUMZ  1                             
B1   CSR         $@SUMZ    IFNE '1'                                             
     CSR         $@SUMZ    ANDNE'2'                                             
     CSR                   MOVE ' '       $@SUMZ                                
E1   CSR                   ENDIF                                                
     C*                                                                         
     C*    Hard commit inventory                                                
     C*                                                                         
     CSR                   MOVEL@OP,19    $@COMM  1                             
B1   CSR         $@COMM    IFNE '1'                                             
     CSR                   MOVE ' '       $@COMM                                
E1   CSR                   ENDIF                                                
     C*                                                                         
     C*    Print amounts in foreign currency                                    
     C*                                                                         
     CSR                   MOVEL@OP,20    $@CURR  1                             
B1   CSR         $@CURR    IFNE '1'                                             
     CSR                   MOVE ' '       $@CURR                                
E1   CSR                   ENDIF                                                
     C*                                                                         
     C*    Index for A/R Next Number                                            
     C*    Don't retrieve index if proof mode requested.                        
     C*                                                                         
     CSR                   MOVE *ZEROS    $ARIN                                 
     CSR                   MOVE *BLANKS   $@ARIN                                
B1   CSR         $@PRF     IFEQ ' '                                             
     CSR                   MOVEL@OP,21    $@ARIN  2                             
     CSR                   MOVEA$@ARIN    @NM                                   
     CSR                   EXSR C0012                                           
     C*                    ---- -----                                           
     CSR                   Z-ADD#NUMR     $ARIN   20                            
B2   CSR         $ARIN     IFEQ 00                                              
     CSR                   MOVE 01        $ARIN                                 
E2   CSR                   ENDIF                                                
E1   CSR                   ENDIF                                                
     C*                                                                         
     C*    Extend amount for backorder lines                                    
     C*                                                                         
     CSR                   MOVEL@OP,22    $@EXBO  1                             
B1   CSR         $@EXBO    IFNE '1'                                             
     CSR                   MOVE ' '       $@EXBO                                
E1   CSR                   ENDIF                                                
     C*                                                                         
     C*    Print drafts                                                         
     C*                                                                         
     CSR                   MOVEL@OP,23    $@DRFT  1                             
B1   CSR         $@DRFT    IFNE '1'                                             
     CSR                   MOVE ' '       $@DRFT                                
E1   CSR                   ENDIF                                                
     C*                                                                         
     C*    Print draft city                                                     
     C*                                                                         
     CSR                   MOVE *BLANKS   $@CITY 17                             
B1   CSR         $@DRFT    IFEQ '1'                                             
     CSR                   MOVEL@OP,7     $@CITY                                
E1   CSR                   ENDIF                                                
     C*                                                                         
     C*    Print discount available                                             
     C*                                                                         
     CSR                   MOVEL@OP,24    $@DISC  1                             
B1   CSR         $@DISC    IFNE '1'                                             
     CSR                   MOVE ' '       $@DISC                                
E1   CSR                   ENDIF                                                
     C*                                                                         
     C*    Update Sales Cost if specified.                                      
     C*                                                                         
     CSR                   MOVEL@OP,25    $@UDT   1                             
     CSR                   MOVEL@OP,26    $@UVER 10                             
B1   CSR         $@UVER    IFEQ *BLANKS                                         
     CSR                   MOVE 'ZJDE0001'$@UVER                                
E1   CSR                   ENDIF                                                
     C*                                                                         
     C*    Default the invoice type.                                            
     C*                                                                         
     CSR                   MOVEL@OP,27    $@DCT   2                             
     CSR                   MOVEL@OP,27    $@DCT2  2                             
B1   CSR         $@DCT     IFEQ *BLANKS                                         
     CSR                   MOVE 'RI'      $@DCT                                 
E1   CSR                   ENDIF                                                
     C*                                                                         
     C*    Load Inventory preference                                            
     C*                                                                         
     CSR                   MOVEL@OP,28    $@PREF  1                             
     C*                                                                         
     C*    Load Intercompany Invoice                                            
     C*                                                                         
     CSR                   MOVE '0'       *IN40                                 
     CSR                   MOVEL@OP,29    $@IC    1                             
     CSR         $@IC      IFEQ '1'                                             
     CSR                   MOVE '1'       *IN40                                 
     CSR                   MOVE '1'       *IN41                                 
B1   CSR         $@DCT2    IFEQ *BLANKS                                         
     CSR                   MOVE 'RT'      $@DCT                                 
E1   CSR                   ENDIF                                                
     CSR                   ENDIF                                                
     C*----------------------------------------------------------------         
     C*                                                                         
     C*    EDI Processing Option                                                
     C*       Blank= No EDI  1= EDI+Invoice Print   3=EDI only                  
     C*                                                                         
     CSR                   MOVEL@OP,30    $@EDI   1                             
B1   CSR         $@EDI     IFNE '1'                                             
B1   CSR         $@EDI     ANDNE'2'                                             
     CSR                   MOVE ' '       $@EDI                                 
E1   CSR                   ENDIF                                                
     C*                                                                         
     C*    EDI Document Type to Create                                          
     C*                                                                         
     CSR         @OP,31    IFEQ *BLANKS                                         
     CSR                   MOVEL'IN'      $@EDCT  2                             
     CSR                   ELSE                                                 
     CSR                   MOVEL@OP,31    $@EDCT                                
     CSR                   END                                                  
     C*                                                                         
     C*    EDI Transaction Set to Create                                        
     C*                                                                         
     CSR         @OP,32    IFEQ *BLANKS                                         
     CSR                   MOVEL'810'     $@EDST  6                             
     CSR                   ELSE                                                 
     CSR                   MOVEL@OP,32    $@EDST                                
     CSR                   END                                                  
     C*                                                                         
     C*    EDI Translation Format to Use                                        
     C*                                                                         
     CSR                   MOVEL@OP,33    $@EDFT 10                             
     C*                                                                         
     C*    EDI Trading Partner I.D.                                             
     C*                                                                         
     CSR                   MOVEL@OP,34    $@PNID 15                             
     C*                                                                         
     C*    Transaction Set Purpose.                                             
     C*                                                                         
     CSR         @OP,35    IFEQ *BLANKS                                         
     CSR                   MOVEL'00'      $@TPUR  2                             
     CSR                   ELSE                                                 
     CSR                   MOVEL@OP,35    $@TPUR                                
     CSR                   END                                                  
SER  C*                                                                         
SER  C*    Remove Optional heading line 1 if left blank                         
SER  C*                                                                         
SER  CSR         @OP,40    IFEQ *BLANKS                                         
SER  CSR                   MOVE 'N'       ALTFLG  1                             
SER  CSR                   ELSE                                                 
SER  CSR                   MOVE 'Y'       ALTFLG                                
SER  CSR                   ENDIF                                                
SER  C*                                                                         
SER  CSR         @OP,41    IFEQ *BLANKS                                         
SER  CSR                   MOVE 'N'       ORGFLG  1                             
SER  CSR                   ELSE                                                 
SER  CSR                   MOVE 'Y'       ORGFLG                                
SER  CSR                   ENDIF                                                
S6042C*                                                                         
S6042CSR         @OP,42    IFEQ *BLANKS                                         
S6042CSR                   MOVEL'UUSAUSD' SVVERS 10 P                           
S6042CSR                   ELSE                                                 
S6042CSR                   MOVEL@OP,42    SVVERS    P                           
S6042CSR                   ENDIF                                                
S7312 *  ---------------------------------------------------------              
S7312 *  ---------------------------------------------------------              
S7312 *  Turn on indicators to process a selected company based on              
S7312 *  the DW Version being processed.                                        
S7312C                     MOVE *OFF      *IN56            Canada               
S7312C                     MOVE *OFF      *IN57            Canadian Dollar      
S7312C                     MOVE *OFF      *IN58            USA                  
S7312C                     MOVE *OFF      *IN59            US Dollar            
S7312C                     MOVE *OFF      *IN76            Mexico               
S7312C                     MOVE *OFF      *IN77            Mexican Peso         
27250C                     MOVE *OFF      *IN54            Austrailian $$       
S7312C                     MOVELSVVERS    VTEST1  4 P                           
S7312C           VTEST1    IFEQ 'UCAN'                                          
S7312C                     MOVE *ON       *IN56            Canada               
S7312C                     ELSE                                                 
S7312C           VTEST1    IFEQ 'UMEX'                                          
S7312C                     MOVE *ON       *IN76            Mexico               
S7312C                     ELSE                                                 
S7312C                     MOVE *ON       *IN58            US Default           
S7312C                     ENDIF                                                
S7312C                     ENDIF                                                
23276 *                                                                         
23276 * if *IN76 = *ON, lookup UDC 42 FS                                        
23276 * FTP = OFF/ON Send TXT file via FTP - helpful for testing                
23276 * USE = OFF/ON Write factura to data stage which reserves                 
23276 *              a factura number. A requirement is to not                  
23276 *              have any gaps in the factura number series                 
      *                                                                         
23276 * USE - UDC 42 FS                                                         
23276C                     MOVE *BLANKS   DRKY                                  
23276C                     MOVE *BLANKS   $$USE                                 
23276C                     MOVE '42  '    DRSY                                  
23276C                     MOVE 'FS'      DRRT                                  
23276C                     MOVEL'USE'     DRKY                                  
23276C           DRKEY     CHAINF0005                31                         
23276C           *IN31     IFEQ *OFF                                            
23276C                     MOVELDRDL01    $$USE   3                             
23276C                     ENDIF                                                
      *                                                                         
23276 * FTP - UDC 42 FS (02.14.2012)                                            
23276C                     MOVE *BLANKS   DRKY                                  
23276C                     MOVE *BLANKS   $$FTP                                 
23276C                     MOVE '42  '    DRSY                                  
23276C                     MOVE 'FS'      DRRT                                  
23276C                     MOVEL'FTP'     DRKY                                  
23276C           DRKEY     CHAINF0005                31                         
23276C           *IN31     IFEQ *OFF                                            
23276C                     MOVELDRDL01    $$FTP   3                             
23276C                     ENDIF                                                
23276 *                                                                         
     C*                    CALL 'DUMP'                                          
      *                    ---- ------                                          
S7312 *  Determine Currency Code based on DW Version being processed.           
S7312C                     MOVELSVVERS    VTEST2  7 P                           
S7312C                     MOVE VTEST2    VCURR   3                             
S7312C           VCURR     IFEQ 'CAD'                                           
S7312C                     MOVE *ON       *IN57            Canadian$            
S7312C                     ELSE                                                 
S7312C           VCURR     IFEQ 'MXP'                                           
S7312C                     MOVE *ON       *IN77            Pesos                
S7312C                     ELSE                                                 
27250C           VCURR     IFEQ 'AUD'                                           
27250C                     MOVE *ON       *IN54            Austrailian$         
27250C                     ELSE                                                 
S7312C                     MOVE *ON       *IN59            US$ Default          
27250C                     ENDIF                                                
S7312C                     ENDIF                                                
S7312C                     ENDIF                                                
S7312 *-----------------------------------------------------------              
     C*                                                                         
     C*    Load report text.                                                    
     C*                                                                         
     CSR                   MOVE *BLANKS   $$LNGP                                
     CSR                   MOVE '1'       $FIRST  1                             
     CSR                   EXSR S010B1                                          
     C*                    ---- ------                                          
     C*----------------------------------------------------------------         
     C*                                                                         
     C*    If printing foreign currency, retrieve base currency code.           
     C*                                                                         
     CSR                   MOVE *BLANKS   PS@@                                  
     CSR                   MOVEL'00000'   KY@@                                  
     CSR                   CALL 'XS0010'               81                       
     C*                    ---- --------                                        
     CSR                   PARM           PS@@                                  
     CSR                   PARM           DS0010                                
     C*                                                                         
B1   CSR         RT@@      IFNE 'N'                                             
     CSR                   MOVELCCCRYR    $$CRYR                                
B2   CSR         $$CRYR    IFEQ 'Y'                                             
     CSR         $$CRYR    OREQ 'Z'                                             
     CSR         $$CRYR    OREQ 'S'                                             
     CSR                   SETON                     30                         
     CSR                   MOVE '1'       $@CNV   1                             
     CSR                   MOVELCCCRCD    $WK6                                  
     CSR                   MOVE 'to'      $WK6    6                             
E2   CSR                   ENDIF                                                
E1   CSR                   ENDIF                                                
     C*                                                                         
     C*    If currency code is not on, only print domestic.                     
     C*                                                                         
B1   CSR         $@CNV     IFEQ *BLANKS                                         
     CSR                   MOVE *BLANKS   $@CURR                                
E1   CSR                   ENDIF                                                
     C*                                                                         
     C*    Define currency data structure (server).                             
     C*                                                                         
     CSR         *LIKE     DEFN I0101     $V0101                               V
     CSR         *LIKE     DEFN DS0013    PS0013                                
     CSR         *LIKE     DEFN #CNVQ     $CNVQ                                 
     CSR         *LIKE     DEFN #CNVP     $CNVP                                 
     CSR         *LIKE     DEFN PNPTC     PSPTC                                 
     CSR         *LIKE     DEFN SDRESL    SVRESL                                
     CSR         *LIKE     DEFN CCCRYR    $$CRYR                                
SER  CSR         *LIKE     DEFN SHOCTO    RROCTO                                
     C*                                                                         
     C*    Define save data structures for the Sales Order Detail file          
     C*                                                                         
     CSR         *LIKE     DEFN DS4211    SV4211                                
     CSR         *LIKE     DEFN DS4211    PR4211                                
     CSR         *LIKE     DEFN D42019    SV4201                                
     CSR         *LIKE     DEFN D42019    PR4201                                
     C*                                                                         
     CSR                   CLEARDS4211                                          
DBN  CSR                   MOVELDS4211    SV4211                                
DBN  CSR                   MOVELDS4211    PR4211                                
     C*----------------------------------------------------------------         
     C*                                                                         
     C*    Set total line count used for overflow checking.                     
     C*                                                                         
     C*----------------------------------------------------------------         
     CSR         *LIKE     DEFN SDDOC     $#DOC                                 
     CSR         *LIKE     DEFN SDDCT     $#DCT                                 
     CSR         *LIKE     DEFN SDKCO     $#KCO                                 
     CSR         *LIKE     DEFN SDPTC     $#PTC                                 
     CSR         *LIKE     DEFN SDDOCO    $#DOCO                                
     CSR         *LIKE     DEFN SDDCTO    $#DCTO                                
     CSR         *LIKE     DEFN SDKCOO    $#KCOO                                
S5599C           *LIKE     DEFN SDMCU     $#MCU                                 
     CSR         *LIKE     DEFN SDAN8     $#AN8                                 
     CSR         *LIKE     DEFN SHSHAN    $#SHAN                                
     CSR         *LIKE     DEFN SDCRCD    $#CRCD                                
     CSR         *LIKE     DEFN SDCRR     $#CRR                                 
     CSR         *LIKE     DEFN SDLITM    $SLITM                                
     CSR         *LIKE     DEFN SDLNTY    $SLNTY                                
     CSR         *LIKE     DEFN SDUPRC    $SUPRC                                
     CSR         *LIKE     DEFN SDUOM     $SUOM                                 
     CSR         *LIKE     DEFN SHTRDJ    $$TRDJ                                
     CSR         *LIKE     DEFN SDDOCO    SVDOCO                                
     CSR         *LIKE     DEFN SDDCTO    SVDCTO                                
     CSR         *LIKE     DEFN SDKCOO    SVKCOO                                
     CSR         *LIKE     DEFN SDLNID    SVLNID                                
     CSR         *LIKE     DEFN SDDOC     SVDOC                                 
     CSR         *LIKE     DEFN SDDCT     SVDCT                                 
     CSR         *LIKE     DEFN SDKCO     SVKCO                                 
     CSR         *LIKE     DEFN A5RYIN    $BPYIN                                
     CSR         *LIKE     DEFN ABAN8     $BAN8                                 
     CSR         *LIKE     DEFN SHINMG    SVINMG                                
     CSR         *LIKE     DEFN SHINMG    $$INMG                                
     CSR         *LIKE     DEFN SHDOCO    $PDOCO                                
     CSR         *LIKE     DEFN SHDCTO    $PDCTO                                
     CSR         *LIKE     DEFN SHKCOO    $PKCOO                                
     CSR         *LIKE     DEFN SDDOC     $PDOC                                 
     CSR         *LIKE     DEFN SDDCT     $PDCT                                 
     CSR         *LIKE     DEFN SDKCO     $PKCO                                 
     C*                                                                         
     CSR         *LIKE     DEFN SDAN8     $AN8                                  
     CSR         *LIKE     DEFN SDSHAN    $SHAN                                 
     CSR         *LIKE     DEFN SDPA8     $PA8                                  
     C*                                                                         
S2595CSR         *LIKE     DEFN SDTXA1    SVTXA1                                
     CSR         *LIKE     DEFN #XSTAM    $$STAM                                
     CSR         *LIKE     DEFN #XATXA    $$ATXA                                
     CSR         *LIKE     DEFN #XATXN    $$ATXN                                
     CSR         *LIKE     DEFN #XADSC    $$ADSC                                
     CSR         *LIKE     DEFN #XUTAM    $$UTAM                                
     CSR         *LIKE     DEFN #XAMT1    $$AMT1                                
     CSR         *LIKE     DEFN #XAMT2    $$AMT2                                
     CSR         *LIKE     DEFN #XAMT3    $$AMT3                                
     CSR         *LIKE     DEFN #XAMT4    $$AMT4                                
     CSR         *LIKE     DEFN #XAMT5    $$AMT5                                
     CSR         *LIKE     DEFN SDFEA     $$FEA                                 
     CSR         *LIKE     DEFN SDAEXP    $$AEXP                                
     CSR         *LIKE     DEFN A5ICON    $5ICON                                
     CSR         *LIKE     DEFN A5DSPA    $5DSPA                                
     CSR         *LIKE     DEFN A5INMG    $5ING                                 
     C*                                                                         
     CSR         *LIKE     DEFN D42019    PS4201                                
     CSR         *LIKE     DEFN DS4211    PS4211                                
     CSR         *LIKE     DEFN DS4211    $$4211                                
     CSR         *LIKE     DEFN LFCDSC    $$CDSC                                
     CSR         *LIKE     DEFN SDFEA     $#FEA                                 
     CSR         *LIKE     DEFN SDAEXP    $#AEXP                                
S3162CSR         *LIKE     DEFN VTX022    RRX022                                
     C*----------------------------------------------------------------         
     C*                                                                         
     C*    Create Data Queue                                                    
     C*                                                                         
B1   CSR         ##MODE    IFEQ '2'                                             
     CSR         ##PARM    ANDGE4                                               
     CSR                   MOVEL'DTAQINV' $WK10  10                             
     CSR         ##LIB     CAT  '/':0     $WK21  21                             
     CSR         $WK21     CAT  $WK10:0   $WK21                                 
DBN  CSR                   MOVEA$WK21     @C,14                                 
DBN  CSR                   MOVEAVTX085    @C,86                                 
     CSR                   Z-ADD160       PSLEN  155                            
     C*                                                                         
     CSR                   CALL 'QCMDEXC'              98                       
     C*                    ---- ---------                                       
     CSR                   PARM           @C                                    
     CSR                   PARM           PSLEN                                 
E1   CSR                   ENDIF                                                
     C*----------------------------------------------------------------         
     C*                                                                         
     C*    Retrieve printer overrides for DREAM Writer version.                 
     C*                                                                         
     CSR         ##MODE    IFEQ '2'                                             
     CSR                   CALL 'J40OVR'               98                       
     C*                    ---- --------                                        
     CSR                   PARM           PSPID                                 
     CSR                   PARM           PSVERS                                
     CSR                   PARM           PRTOVR                                
     C*                                                                         
     CSR                   Z-ADD512       PSLEN                                 
     CSR                   CALL 'QCMDEXC'              98                       
     C*                    ---- ---------                                       
     CSR                   PARM           PRTOVR                                
     CSR                   PARM           PSLEN                                 
     C*                                                                         
     CSR                   END                                                  
     C*----------------------------------------------------------------         
     C*                                                                         
     C*    If option is 1 don't show line numbers                               
     C*                                                                         
B1   CSR         $@SUMZ    IFEQ '1'                                             
     CSR         $@SUMZ    OREQ '2'                                             
     CSR                   MOVE '0'       *IN60                                 
X1   CSR                   ELSE                                                 
     CSR                   MOVE '1'       *IN60                                 
E1   CSR                   ENDIF                                                
     C*----------------------------------------------------------------         
     C*                                                                         
     C*    Initialize tax data structure in X4008C                              
     C*                                                                         
     CSR                   CLEARDS#TAX                                          
     C*----------------------------------------------------------------         
     C*                                                                         
     C*    Check if Tax Summary user index exists.                              
     C*                                                                         
     CSR                   MOVE *BLANKS   PSERR                                 
     CSR                   CALL 'J98CKOBJ'             99                       
     C*                    ---- ----------                                      
     CSR                   PARM 'P42565  'PSOBJT 10                             
     CSR                   PARM 'QTEMP   'PSLIB  10                             
     CSR                   PARM '*USRIDX' $$TYPE  7                             
     CSR                   PARM '*NONE   'PSMBR  10                             
     CSR                   PARM '*NONE   'PSAUT  10                             
     CSR                   PARM           PSERR   1                             
     C*                                                                         
     C*    Create user index.                                                   
     C*                                                                         
     CSR                   Z-ADD$1KYLN    $IKYLN  30                            
     CSR                   Z-ADD$1RCLN    $IRCLN  30                            
     CSR         PSERR     IFEQ '1'                                             
     C*                                                                         
     C*    Create a User Index - Tax Summary                                    
     C*                                                                         
     CSR                   CALL 'QUSCRTUI'             99                       
     C*                    ---- ----------                                      
     CSR                   PARM           DSIDX1                                
     CSR                   PARM *BLANKS   $ATR   10                             
     CSR                   PARM 'F'       $FXLN   1                             
     CSR                   PARM           $1RCLN                                
     CSR                   PARM '1'       $KIND   1                             
     CSR                   PARM           $1KYLN                                
     CSR                   PARM '0'       $IMUP   1                             
     CSR                   PARM '1'       $OPTM   1                             
     CSR                   PARM '*ALL'    $IDAU  10                             
     CSR                   PARM DSIDX1    $IDTX  50                             
     CSR                   ELSE                                                 
     C*                                                                         
     C*    Clear user index.                                                    
     C*                                                                         
     CSR                   Z-ADD1         PSKEYL  30                            
     CSR                   MOVE *BLANK    PKEY                                  
     C*                                                                         
     CSR                   CALL 'X00IDX'                                        
     C*                    ---- --------                                        
     CSR                   PARM           DSIDX1                                
     CSR                   PARM 'D'       PACTN                                 
     CSR                   PARM 'EQ'      PRULE                                 
     CSR                   PARM           PSKEYL                                
     CSR                   PARM           PKEY                                  
     CSR                   PARM           $IRCLN                                
     CSR                   PARM           DS$1                                  
     CSR                   PARM           PSTAT1                                
     C*                                                                         
     CSR                   END                                                  
     C*                                                                         
     C*    Rounding Summary flag.                                               
     C*                                                                         
     CSR                   MOVE ' '       $RND                                  
     C*----------------------------------------------------------------         
     C*                                                                         
     C*    Check if Serial # index exists.                                      
     C*                                                                         
     CSR                   MOVE *BLANKS   PSERR                                 
     CSR                   CALL 'J98CKOBJ'             99                       
     C*                    ---- ----------                                      
     CSR                   PARM 'P42565S 'PSOBJT 10                             
     CSR                   PARM 'QTEMP   'PSLIB  10                             
     CSR                   PARM '*USRIDX' $$TYPE  7                             
     CSR                   PARM '*NONE   'PSMBR  10                             
     CSR                   PARM '*NONE   'PSAUT  10                             
     CSR                   PARM           PSERR   1                             
     C*                                                                         
     C*    Create user index.                                                   
     C*                                                                         
     CSR                   Z-ADD$2KYLN    $IKYL2  30                            
     CSR                   Z-ADD$2RCLN    $IRCL2  30                            
     CSR         PSERR     IFEQ '1'                                             
     C*                                                                         
     C*    Create a User Index - Serial #                                       
     C*                                                                         
     CSR                   CALL 'QUSCRTUI'             99                       
     C*                    ---- ----------                                      
     CSR                   PARM           DSIDX2                                
     CSR                   PARM *BLANKS   $ATR   10                             
     CSR                   PARM 'F'       $FXLN   1                             
     CSR                   PARM           $2RCLN                                
     CSR                   PARM '1'       $KIND   1                             
     CSR                   PARM           $2KYLN                                
     CSR                   PARM '0'       $IMUP   1                             
     CSR                   PARM '1'       $OPTM   1                             
     CSR                   PARM '*ALL'    $IDAU  10                             
     CSR                   PARM DSIDX2    $IDTX  50                             
     CSR                   ELSE                                                 
     C*                                                                         
     C*    Clear user index.                                                    
     C*                                                                         
     CSR                   Z-ADD1         PSKEYL  30                            
     CSR                   MOVE *BLANK    PKEY                                  
     C*                                                                         
     CSR                   CALL 'X00IDX'                                        
     C*                    ---- --------                                        
     CSR                   PARM           DSIDX2                                
     CSR                   PARM 'D'       PACTN                                 
     CSR                   PARM 'EQ'      PRULE                                 
     CSR                   PARM           PSKEYL                                
     CSR                   PARM           PKEY                                  
     CSR                   PARM           $IRCL2                                
     CSR                   PARM           DS$2                                  
     CSR                   PARM           PSTAT                                 
     C*                                                                         
     CSR                   END                                                  
     C*----------------------------------------------------------------         
     C*                                                                         
     C*    Clear I/O server data structure.                                     
     C*                                                                         
     CSR                   CLEARDS4211                                          
     CSR                   CLEARD42019                                          
     C*----------------------------------------------------------------         
     CSR                   SETON                     OF                         
     CSR                   MOVE ' '       $$PAGE  1                             
     CSR                   Z-ADD*ZERO     $#PG    40                            
     CSR                   MOVE '1'       *IN02                                 
     CSR                   MOVE ' '       $PFLAG  1                             
     CSR                   MOVE ' '       $HFLAG  1                             
     CSR                   MOVE 01        $COPY                                 
     CSR                   Z-ADD1         #Z                                    
     CSR                   Z-ADD1         #T                                    
     CSR                   MOVE ' '       $$FIR   1                             
     C*----------------------------------------------------------------         
     C*                                                                         
B1   CSR         ##MODE    IFEQ ' '                                             
     CSR         ##MODE    OREQ '2'                                             
     C*                                                                         
     C*   Retrieve DREAM Writer specifications for this program.                
     C*                                                                         
     CSR                   CALL 'P81RTV  '                                      
     C*                    ----  ------                                         
     CSR                   PARM           ##PID  10                             
     CSR                   PARM           ##VERS 10                             
     CSR                   PARM ' '       PSERR   1                             
     CSR                   PARM           PSFILE 10                             
     CSR                   PARM           PSMBR  10                             
     CSR                   PARM           PSFMT  10                             
     C*                                                                         
     C*     If the History file is specified to be the based-on file,           
     C*     set $$HIST(ory) indicator to 'Y' (invoice from history).            
     C*                                                                         
     CSR                   MOVE 'N'       $$HIST                                
     C*                                                                         
B2   CSR         PSFILE    IFEQ 'F42119'                                        
     C*                                                                         
     CSR                   MOVE 'Y'       $$HIST  1                             
     C*                                                                         
     C*     If reading from Ledger, call level-break reset program              
     C*     to reset level breaks based on the Sales Detail file                
     C*     (F4211) rather than the Sales History (F42119).                     
     C*                                                                         
     CSR                   MOVEL'*LIBL'   PSLIB                                 
     CSR                   MOVEL*BLANKS   PSFILE                                
     CSR                   MOVEL'F4211'   PSFILE                                
     C*                                                                         
     CSR                   CALL 'X40LVLBK'             94                       
     C*                    ---- ----------                                      
     CSR                   PARM           PSFILE 10                             
     CSR                   PARM           PSLIB  10                             
     CSR                   PARM           @@L                                   
     CSR                   PARM           @@B                                   
X2   CSR                   ELSE                                                 
     CSR                   MOVE 'N'       $$HIST                                
X2   CSR                   ENDIF                                                
     C*                                                                         
     CSR         PSFILE    IFEQ 'F49219  '                                      
     CSR                   MOVE 'Y'       $$HIST                                
     CSR                   ENDIF                                                
     C*                                                                         
     C*     Open the Sales Detail file if it is specified as the Based-         
     C*     On file.                                                            
     C*                                                                         
B2   CSR         PSFILE    IFEQ 'F4211'                                         
     CSR                   OPEN F4201LA                81                       
     CSR                   OPEN F4211LA                81                       
E2   CSR                   ENDIF                                                
     C*                                                                         
     C*     Open the Sales Detail tag file if it is specified as the            
     C*     Based-On file.                                                      
     C*                                                                         
     CSR                   MOVE ' '       $CYCLE  1                             
     C*                                                                         
B2   CSR         PSFILE    IFEQ 'F49211JA'                                      
     CSR         PSFILE    OREQ 'F49219  '                                      
     CSR                   OPEN F49211                 81                       
     C****                 OPEN F49211JA               81                       
     CSR                   OPEN F4201LA                81                       
     CSR                   OPEN F4211LA                81                       
     CSR                   MOVE '1'       $CYCLE  1                             
E2   CSR                   ENDIF                                                
     C*                                                                         
E1   CSR                   ENDIF                                                
     C*----------------------------------------------------------------         
     C*                                                                         
B1   CSR         ##MODE    IFEQ '1'                                             
     C*                                                                         
B2   CSR         $IDOC     IFNE *BLANKS                                         
     CSR                   MOVE 'M'       $4211   1                             
     C*                                                                         
     CSR                   MOVEA$IDOC     @NM                                   
     CSR                   EXSR C0012                                           
     C*                    ---- -----                                           
     CSR                   Z-ADD#NUMR     SDDOC                                 
     C*                                                                         
     CSR                   MOVE $IDCT     SDDCT                                 
     CSR                   MOVE $IDCT     $@DCT                                 
     CSR                   MOVEL$IKCO     SDKCO                                 
     C*                                                                         
     C*    If invoice number was passed, do not update status codes             
     C*    or call the Commitment Program.  Do print the Invoice                
     C*    Number.                                                              
     C*                                                                         
     CSR                   MOVEL'1'       $@UPDT                                
     CSR                   MOVEL' '       $@PRF                                 
     CSR                   MOVEL' '       $@COMM                                
X2   CSR                   ELSE                                                 
     C*                                                                         
     CSR                   MOVE 'A'       $4211                                 
     C*                                                                         
     CSR                   MOVEA$IDOCO    @NM                                   
     CSR                   EXSR C0012                                           
     C*                    ---- -----                                           
     CSR                   Z-ADD#NUMR     SDDOCO                                
     C*                                                                         
     CSR                   MOVE $IDCTO    SDDCTO                                
     CSR                   MOVEL$IKCOO    SDKCOO                                
E2   CSR                   ENDIF                                                
     C*                                                                         
     C*    Load the status code selection range if passed.                      
     C*                                                                         
B2   CSR         $I#STF    IFNE *BLANKS                                         
     CSR                   MOVEL$I#STF    $@STF                                 
E2   CSR                   ENDIF                                                
     C*                                                                         
B2   CSR         $I#STT    IFNE *BLANKS                                         
     CSR                   MOVEL$I#STT    $@STT                                 
E2   CSR                   ENDIF                                                
     C*                                                                         
     C*    Load backorder print/extension indicators if passed.                 
     C*                                                                         
     CSR                   MOVEL'4'       $@BOCN                                
     C*                                                                         
B2   CSR         $I#IBO    IFEQ '1'                                             
     CSR                   MOVEL'1'       $@BOCN                                
     CSR                   MOVEL' '       $@EXBO                                
X2   CSR                   ELSE                                                 
     C*                                                                         
B3   CSR         $I#IBO    IFEQ '2'                                             
     CSR                   MOVEL'1'       $@BOCN                                
     CSR                   MOVEL'1'       $@EXBO                                
E3   CSR                   ENDIF                                                
E2   CSR                   ENDIF                                                
     CSR                   MOVEL@OP,13    $$BOCN  1                             
B2   CSR         $@BOCN    IFEQ '1'                                             
     CSR         $$BOCN    ANDEQ'2'                                             
     CSR         $@BOCN    OREQ '1'                                             
     CSR         $$BOCN    ANDEQ'3'                                             
     CSR                   MOVEL'3'       $@BOCN                                
E2   CSR                   ENDIF                                                
     C*                                                                         
     C*    Specify print from F4211 or F42119 (History).                        
     C*                                                                         
     CSR         $IFILE    IFEQ 'F49219  '                                      
     CSR                   MOVE 'Y'       $$HIST                                
     CSR                   ELSE                                                 
B2   CSR         $IFILE    IFEQ 'F42119  '                                      
     C*                                                                         
     CSR                   MOVE 'Y'       $$HIST                                
X2   CSR                   ELSE                                                 
     C*                                                                         
     CSR                   MOVE 'N'       $$HIST                                
B3   CSR         $4211     IFEQ 'M'                                             
     CSR         $4211M    ANDEQ' '                                             
     CSR                   OPEN F4211LM                81                       
     CSR                   MOVE '1'       $4211M  1                             
     CSR                   ENDIF                                                
E3   CSR                   ENDIF                                                
E2   CSR                   ENDIF                                                
     C*                                                                         
E1   CSR                   ENDIF                                                
     C*----------------------------------------------------------------         
     C*                                                                         
     C*    If file F4071 exists, open the file                                  
     C*                                                                         
     CSR                   MOVE '0'       $$FOPN  1                             
     CSR                   OPEN F4071                  81                       
     CSR         *IN81     IFEQ '1'                                             
     CSR                   MOVE '1'       $$FOPN                                
     CSR                   ENDIF                                                
     C*                                                                         
     C*----------------------------------------------------------------         
     C*                                                                         
     C*    Open EDI fiels if processing EDI.                                    
     C*                                                                         
     CSR         $@EDI     IFNE ' '                                             
     CSR                   OPEN F4706                                           
     CSR                   OPEN F4714                                           
     CSR                   OPEN F4715                                           
     CSR                   OPEN F47046                                          
     CSR                   OPEN F470461                                         
     CSR                   OPEN F47047                                          
     CSR                   OPEN F470471                                         
     CSR                   OPEN F47186                                          
     CSR                   OPEN F471861                                         
     CSR                   OPEN F47187                                          
     CSR                   OPEN F471871                                         
     CSR                   OPEN F47106                                          
     CSR                   OPEN F471061                                         
     CSR                   OPEN F47107                                          
     CSR                   OPEN F471071                                         
     CSR                   ENDIF                                                
     C*----------------------------------------------------------------         
     C*                                                                         
     C*    Clear Data Structure for preferences                                 
     C*                                                                         
     CSR                   CLEARZ40300                                          
     CSR                   CLEARE40300                                          
     C*----------------------------------------------------------------         
     C*                                                                         
     C*    Load Advanced Pricing Flag from System Constants.                    
     C*                                                                         
     CSR                   MOVE 'N'       $@ADV   1                             
     C*                                                                         
     CSR                   MOVE *BLANKS   PS@@                                  
     CSR                   MOVEL*BLANKS   KY@@                                  
     CSR                   CALL 'XS4009'               81                       
     C*                    ---- ---------                                       
     CSR                   PARM           PS@@                                  
     CSR                   PARM           DS4009                                
B1   CSR         RT@@      IFNE 'N'                                             
     CSR                   MOVELCPADVP    $@ADV                                 
E1   CSR                   ENDIF                                                
     C*----------------------------------------------------------------         
SER  CSR         *IN99     IFEQ *ON                                             
SER  CSR         *IN99     ANDEQ*OFF                                            
SER  CSR                   WRITENOPRINT                                         
SER  CSR                   ENDIF                                                
SER  C*----------------------------------------------------------------         
     C*                                                                         
     CSR                   ENDSR                                                
     C*****************************************************************         
     C*                                                                        V
     C*    Copy Common Subroutine - Determine if Vertex is Active.             V
     C*                                                                        V
     C/COPY JDECPY,C7301                                                       V
     C*****************************************************************        V
     C*                                                                        V
     C*    Copy Common Subroutine - GeoCode Edit.                              V
     C*                                                                        V
     C/COPY JDECPY,C73010                                                      V
     C*****************************************************************        V
     C*                                                                        V
     C*    Copy Common Subroutine - Multi-State.                               V
     C*                                                                        V
     C/COPY JDECPY,C73012                                                      V
     C*****************************************************************        V
     C*                                                                        V
     C*    Copy Common Subroutine - Perform Tax Calc. Vertex Mode              V
     C*                                                                        V
     C/COPY JDECPY,C73013                                                      V
     C*****************************************************************        V
     C*                                                                        V
     C*    Copy Common Subroutine -  Load Vertex Sales Tax Parameters          V
     C*                                                                        V
     C/COPY JDECPY,C73020                                                      V
     C*****************************************************************        V
     OI4211A  E                U4211A                                           
     O*****************************************************************         
**    Table for command to override printer file outq                           
OVRPRTF FILE(R5542565) OUTQ(           ) FILESEP(0) FORMTYPE(          )        
HOLD(    ) SHARE(*YES) LPI(   ) CPI(    ) COPIES(  )                            
**    Table for command to create data queue                                    
CRTDTAQ DTAQ(                     ) MAXLEN(38) AUT(*ALL)                        
TEXT(                                        )                                  
